;================================
; CNS File for Goku Z2 by Team Z2
; Special and EX moves
;================================

;===========================================================================
; <<<<< KI BLAST >>>>>
; 1st light = 1000
; 2nd light = 1001
; 3rd light = 1002
; 1st med = 1003
; 2nd med = 1004
; 3rd med = 1005
; 1st strong = 1006
; 2nd strong = 1007
; 3rd strong = 1008
; Light helper = 1010
; Destroyed Helper = 1013
;===========================================================================

;LIGHT KI BLAST, 1st STRIKE
[Statedef 1000]
type    = S
movetype= A
physics = N
juggle  = 7
velset = 0,0
anim = 1000
ctrl = 0
sprpriority = 2
poweradd = 35

[State 0, RemoveExplod]
type = RemoveExplod
trigger1 = !Time
id = 90010006

[State 0, RemoveExplod]
type = RemoveExplod
trigger1 = !Time
id = 90010104

[State 220, gethit gut ?]
type = VarSet
trigger1 = AnimElemtime(3)=0
var(14) = 0

[State 220, snd]
type = playsnd
trigger1 = animelem=3
value = 3,100+random%6
channel = 0

[state 1215, Smoke FX]
type = explod
trigger1 = animelemtime(3)=0
anim = 1206+(var(2)=0)
id = 1206
pos = -25,3
postype = P1
sprpriority = 3
ownpal = 1
removetime = -2
persistent = 0
ignorehitpause = 1
scale = .7,.7

[State 800, VarSet]
type = VarSet
trigger1 = !time
var(3) = 0
[State 800, VarSet]
type = VarSet
trigger1 = time > 3 && !AILevel
trigger1 = ifelse(facing = 1,NumExplod(90010006),NumExplod(90010104))
trigger1 =  command = "x" 
var(3) = 1
[State 800, VarSet]
type = VarSet
trigger1 = time > 3 && !AILevel
trigger1 = ifelse(facing = 1,NumExplod(90010006),NumExplod(90010104))
trigger1 =  command = "y" 
var(3) = 2
[State 800, VarSet]
type = VarSet
trigger1 = time > 3 && !AILevel
trigger1 = ifelse(facing = 1,NumExplod(90010006),NumExplod(90010104))
trigger1 =  command = "z"  
var(3) = 3
[State 800, VarSet]
type = VarSet
trigger1 = time > 15 && !AILevel
trigger1 = ((ifElse(P2DisT x < -12, Facing = -1, Facing = 1) && (NumExplod(90030016) || NumExplod(90030114))) || (ifElse(P2DisT x < -12, Facing = 1, Facing = -1) && (NumExplod(90030114) || NumExplod(90030016))))
trigger1 = NumExplod(90000200)  
var(3) = 4
[State 800, VarSet]
type = VarSet
trigger1 = time > 15 && !AILevel
trigger1 = ((ifElse(P2DisT x < -12, Facing = -1, Facing = 1) && (NumExplod(90030016) || NumExplod(90030114))) || (ifElse(P2DisT x < -12, Facing = 1, Facing = -1) && (NumExplod(90030114) || NumExplod(90030016))))
trigger1 = NumExplod(90000210) 
var(3) = 5
[State 800, VarSet]
type = VarSet
trigger1 = time > 15 && !AILevel
trigger1 = ((ifElse(P2DisT x < -12, Facing = -1, Facing = 1) && (NumExplod(90030016) || NumExplod(90030114))) || (ifElse(P2DisT x < -12, Facing = 1, Facing = -1) && (NumExplod(90030114) || NumExplod(90030016))))
trigger1 = NumExplod(90000220) 
var(3) = 6

[State 800, VarSet]
type = VarSet
trigger1 = time > 15 && !AILevel
trigger1 = ((ifElse(P2DisT x < -12, Facing = -1, Facing = 1) && (NumExplod(90030101) || NumExplod(90030114))) || (ifElse(P2DisT x < -12, Facing = 1, Facing = -1) && (NumExplod(90030016) || NumExplod(90030003))))
trigger1 = NumExplod(90000200)  || NumExplod(90000210) ||  NumExplod(90000220) 
var(3) = 7

[State 800, VarSet]
type = VarSet
trigger1 = time > 15 && !AILevel
trigger1 = ((ifElse(P2DisT x < -12, Facing = -1, Facing = 1) && (NumExplod(90030101) || NumExplod(90030114))) || (ifElse(P2DisT x < -12, Facing = 1, Facing = -1) && (NumExplod(90030016) || NumExplod(90030003))))
trigger1 = (ifElse(NumExplod(90000200), 1, 0) + ifElse(NumExplod(90000210), 1, 0) + ifElse(NumExplod(90000220), 1, 0) >= 2) || (ifElse(NumExplod(90000205), 1, 0) + ifElse(NumExplod(90000215), 1, 0) + ifElse(NumExplod(90000225), 1, 0) >= 2)
var(3) = 8

[State 800, VarSet]
type = VarSet
trigger1 = time > 15 && !AILevel
trigger1 = ((ifElse(P2DisT x < -12, Facing = -1, Facing = 1) && (NumExplod(90030101) || NumExplod(90030114))) || (ifElse(P2DisT x < -12, Facing = 1, Facing = -1) && (NumExplod(90030016) || NumExplod(90030003))))
trigger1 = (NumExplod(90000200) && NumExplod(90000210) && NumExplod(90000220)) || (NumExplod(90000205) && NumExplod(90000215) && NumExplod(90000225)) 
var(3) = 9

[State 800, VarSet]
type = VarSet
triggerall = Ailevel && time > 15 && numenemy && (random < 230 * (AIlevel ** 2 / 64.0))  && (P2MoveType = A || P2BodyDist X >160)
trigger1 = P2Movetype=H
trigger2 = P2Stateno!=[1000,4999]
var(3) = 3
[State 800, VarSet]
type = VarSet
triggerall = Ailevel && time > 15 && numenemy && (random < 230 * (AIlevel ** 2 / 64.0))  && (P2MoveType = A || (P2BodyDist X = [120,160]))
trigger1 = P2Movetype=H
trigger2 = P2Stateno!=[1000,4999]
var(3) = 2
[State 800, VarSet]
type = VarSet
triggerall = Ailevel && time > 15 && numenemy && (random < 230 * (AIlevel ** 2 / 64.0))  && P2MoveType != A && P2BodyDist X <120
trigger1 = P2Movetype=H
trigger2 = P2Stateno!=[1000,4999]
var(3) = 1

[State 800, VarSet]
type = VarSet
triggerall = Ailevel && time > 15  && numenemy
trigger1 = power>1500 && (random < 150 * (AIlevel ** 2 / 64.0))
var(3) = 4+random%3

[State 200, 1]
type = PlaySnd
trigger1 = AnimElemtime(4)=0
value = 10,0

[State 1000, lkb]
type = Helper
helpertype = normal
trigger1 = AnimElemtime(4)=0
name = "kiblastL1"
postype = P1
pos = 60,-66
ownpal = 1
stateno = cond(var(43) = 0, 1010, 1020)
id = 1010



[state 1000, attackdist]
type = attackdist
trigger1 = animelemtime(5) >= 0
value = 0

[State 1000, 6]
type = ChangeState
triggerall = var(51) = 0
triggerall = roundstate = 2
triggerall = Var(3) = 9
triggerall = AnimElem = 4, >= 10
;trigger1 = numhelper(1011)
trigger1 = power>=1000 && var(18)=0
value = 3102
ctrl = 0

[State 1000, 6]
type = ChangeState
triggerall = var(51) = 0
triggerall = roundstate = 2
triggerall = Var(3) = 8
triggerall = AnimElem = 4, >= 10
;trigger1 = numhelper(1011)
trigger1 = power>=1000 && var(18)=0
value = 3101
ctrl = 0

[State 1000, 6]
type = ChangeState
triggerall = var(51) = 0
triggerall = roundstate = 2
triggerall = Var(3) = 7
triggerall = AnimElem = 4, >= 10
;trigger1 = numhelper(1011)
trigger1 = power>=1000 && var(18)=0
value = 3100
ctrl = 0

[State 1000, 6]
type = ChangeState
triggerall = var(51) = 0
triggerall = roundstate = 2
triggerall = Var(3) = 4
triggerall = AnimElem = 5, >= 10
;trigger1 = numhelper(1010)
trigger1 = power>=1000 && var(18)=0
value = 2000
ctrl = 0
[State 1000, 6]
type = ChangeState
triggerall = var(51) = 0
triggerall = roundstate = 2
triggerall = Var(3) = 5
triggerall = AnimElem = 5, >= 10
;trigger1 = numhelper(1010)
trigger1 = power>=1000 && var(18)=0
value = 2000
ctrl = 0
[State 1000, 6]
type = ChangeState
triggerall = var(51) = 0
triggerall = roundstate = 2
triggerall = Var(3) = 6
triggerall = AnimElem = 5, >= 10
;trigger1 = numhelper(1010)
trigger1 = power>=1000 && var(18)=0
value = 2000
ctrl = 0
[State 1000, 6]
type = ChangeState
triggerall = roundstate = 2
triggerall = AnimElem = 5, >= 11
trigger1 = Var(3) = 1
trigger2 = Var(3) = 4 && power < 1000
trigger3 = Var(3) = 4 && var(18)=1
value = 1001
ctrl = 0
[State 1000, 6]
type = ChangeState
triggerall = roundstate = 2
triggerall = AnimElem = 5, >= 11
trigger1 = Var(3) = 2
trigger2 = Var(3) = 5 && power < 1000
trigger3 = Var(3) = 5 && var(18)=1
value = 1004
ctrl = 0
[State 1000, 6]
type = ChangeState
triggerall = roundstate = 2
triggerall = AnimElem = 5, >= 11
trigger1 = Var(3) = 3
trigger2 = Var(3) = 6 && power < 1000
trigger3 = Var(3) = 6 && var(18)=1
value = 1007
ctrl = 0



[State 1000, 7]
type = ChangeState
trigger1 = AnimTime = 0
value = 0
ctrl = 1

;------------------------------------
;LIGHT KI BLAST, 2nd STRIKE
[Statedef 1001]
type    = S
movetype= A
physics = N
juggle  = 7
velset = 0,0
anim = 1001
ctrl = 0
sprpriority = 2
poweradd = 10

[State 0, RemoveExplod]
type = RemoveExplod
trigger1 = !Time
id = 90010006

[State 0, RemoveExplod]
type = RemoveExplod
trigger1 = !Time
id = 90010104

[State 220, gethit gut ?]
type = VarSet
trigger1 = AnimElemtime(3)=0
var(14) = 1

[State 220, snd]
type = playsnd
trigger1 = animelem=3
value = 3,100+random%6
channel = 0

[state 1215, Smoke FX]
type = explod
trigger1 = animelemtime(3)=0
anim = 1206+(var(2)=0)
id = 1206
pos = -25,3
postype = P1
sprpriority = 3
ownpal = 1
removetime = -2
persistent = 0
ignorehitpause = 1
scale = .7,.7

[State 800, VarSet]
type = VarSet
trigger1 = !time
var(3) = 0
[State 800, VarSet]
type = VarSet
trigger1 = time > 15 && !AILevel
trigger1 = ifelse(facing = 1,NumExplod(90010006),NumExplod(90010104))
trigger1 =  command = "x" 
var(3) = 1
[State 800, VarSet]
type = VarSet
trigger1 = time > 15 && !AILevel
trigger1 = ifelse(facing = 1,NumExplod(90010006),NumExplod(90010104))
trigger1 =  command = "y" 
var(3) = 2
[State 800, VarSet]
type = VarSet
trigger1 = time > 15 && !AILevel
trigger1 = ifelse(facing = 1,NumExplod(90010006),NumExplod(90010104))
trigger1 =  command = "z"  
var(3) = 3
[State 800, VarSet]
type = VarSet
trigger1 = time > 15 && !AILevel
trigger1 = ((ifElse(P2DisT x < -12, Facing = -1, Facing = 1) && (NumExplod(90030016) || NumExplod(90030114))) || (ifElse(P2DisT x < -12, Facing = 1, Facing = -1) && (NumExplod(90030114) || NumExplod(90030016))))
trigger1 = NumExplod(90000200)  
var(3) = 4
[State 800, VarSet]
type = VarSet
trigger1 = time > 15 && !AILevel
trigger1 = ((ifElse(P2DisT x < -12, Facing = -1, Facing = 1) && (NumExplod(90030016) || NumExplod(90030114))) || (ifElse(P2DisT x < -12, Facing = 1, Facing = -1) && (NumExplod(90030114) || NumExplod(90030016))))
trigger1 = NumExplod(90000210) 
var(3) = 5
[State 800, VarSet]
type = VarSet
trigger1 = time > 15 && !AILevel
trigger1 = ((ifElse(P2DisT x < -12, Facing = -1, Facing = 1) && (NumExplod(90030016) || NumExplod(90030114))) || (ifElse(P2DisT x < -12, Facing = 1, Facing = -1) && (NumExplod(90030114) || NumExplod(90030016))))
trigger1 = NumExplod(90000220) 
var(3) = 6

[State 800, VarSet]
type = VarSet
trigger1 = time > 15 && !AILevel
trigger1 = ((ifElse(P2DisT x < -12, Facing = -1, Facing = 1) && (NumExplod(90030101) || NumExplod(90030114))) || (ifElse(P2DisT x < -12, Facing = 1, Facing = -1) && (NumExplod(90030016) || NumExplod(90030003))))
trigger1 = NumExplod(90000200)  || NumExplod(90000210) ||  NumExplod(90000220) 
var(3) = 7

[State 800, VarSet]
type = VarSet
trigger1 = time > 15 && !AILevel
trigger1 = ((ifElse(P2DisT x < -12, Facing = -1, Facing = 1) && (NumExplod(90030101) || NumExplod(90030114))) || (ifElse(P2DisT x < -12, Facing = 1, Facing = -1) && (NumExplod(90030016) || NumExplod(90030003))))
trigger1 = (ifElse(NumExplod(90000200), 1, 0) + ifElse(NumExplod(90000210), 1, 0) + ifElse(NumExplod(90000220), 1, 0) >= 2) || (ifElse(NumExplod(90000205), 1, 0) + ifElse(NumExplod(90000215), 1, 0) + ifElse(NumExplod(90000225), 1, 0) >= 2)
var(3) = 8

[State 800, VarSet]
type = VarSet
trigger1 = time > 15 && !AILevel
trigger1 = ((ifElse(P2DisT x < -12, Facing = -1, Facing = 1) && (NumExplod(90030101) || NumExplod(90030114))) || (ifElse(P2DisT x < -12, Facing = 1, Facing = -1) && (NumExplod(90030016) || NumExplod(90030003))))
trigger1 = (NumExplod(90000200) && NumExplod(90000210) && NumExplod(90000220)) || (NumExplod(90000205) && NumExplod(90000215) && NumExplod(90000225)) 
var(3) = 9

[State 800, VarSet]
type = VarSet
triggerall = Ailevel && time > 15 && numenemy && (random < 230 * (AIlevel ** 2 / 64.0))  && (P2MoveType = A || P2BodyDist X >160)
trigger1 = P2Movetype=H
trigger2 = P2Stateno!=[1000,4999]
var(3) = 3
[State 800, VarSet]
type = VarSet
triggerall = Ailevel && time > 15 && numenemy && (random < 230 * (AIlevel ** 2 / 64.0))  && (P2MoveType = A || (P2BodyDist X = [120,160]))
trigger1 = P2Movetype=H
trigger2 = P2Stateno!=[1000,4999]
var(3) = 2
[State 800, VarSet]
type = VarSet
triggerall = Ailevel && time > 15 && numenemy && (random < 230 * (AIlevel ** 2 / 64.0))  && P2MoveType != A && P2BodyDist X <120
trigger1 = P2Movetype=H
trigger2 = P2Stateno!=[1000,4999]
var(3) = 1



[State 800, VarSet]
type = VarSet
triggerall = Ailevel>=1 && time > 15 && numenemy
trigger1 = power>1500 && (random < 150 * (AIlevel ** 2 / 64.0))
var(3) = 4+random%3
[State 200, 1]
type = PlaySnd
trigger1 = AnimElemtime(3)=0
value = 10,0

[State 1000, lkb]
type = Helper
helpertype = normal
trigger1 = AnimElemtime(3)=0
name = "kiblastL2"
postype = P1
pos = 60,-60  ;-62
ownpal = 1
stateno = cond(var(43) = 0, 1010, 1020)
id = 1011



[State 1000, 6]
type = ChangeState
triggerall = var(51) = 0
triggerall = roundstate = 2
triggerall = Var(3) = 9
triggerall = AnimElem = 4, >= 10
;trigger1 = numhelper(1011)
trigger1 = power>=1000 && var(18)=0
value = 3102
ctrl = 0

[State 1000, 6]
type = ChangeState
triggerall = var(51) = 0
triggerall = roundstate = 2
triggerall = Var(3) = 8
triggerall = AnimElem = 4, >= 10
;trigger1 = numhelper(1011)
trigger1 = power>=1000 && var(18)=0
value = 3101
ctrl = 0

[State 1000, 6]
type = ChangeState
triggerall = var(51) = 0
triggerall = roundstate = 2
triggerall = Var(3) = 7
triggerall = AnimElem = 4, >= 10
;trigger1 = numhelper(1011)
trigger1 = power>=1000 && var(18)=0
value = 3100
ctrl = 0


[State 1000, 6]
type = ChangeState
triggerall = var(51) = 0
triggerall = roundstate = 2
triggerall = Var(3) = 4
triggerall = AnimElem = 4, >= 10
;trigger1 = numhelper(1011)
trigger1 = power>=1000 && var(18)=0
value = 2000
ctrl = 0
[State 1000, 6]
type = ChangeState
triggerall = var(51) = 0
triggerall = roundstate = 2
triggerall = Var(3) = 5
triggerall = AnimElem = 4, >= 10
;trigger1 = numhelper(1011)
trigger1 = power>=1000 && var(18)=0
value = 2000
ctrl = 0
[State 1000, 6]
type = ChangeState
triggerall = var(51) = 0
triggerall = roundstate = 2
triggerall = Var(3) = 6
triggerall = AnimElem = 4, >= 10
;trigger1 = numhelper(1011)
trigger1 = power>=1000 && var(18)=0
value = 2000
ctrl = 0
[State 1000, 6]
type = ChangeState
triggerall = roundstate = 2
triggerall = AnimElem = 4, >= 11
trigger1 = Var(3) = 1
trigger2 = Var(3) = 4 && power < 1000
trigger3 = Var(3) = 4 && var(18)=1
value = 1002
ctrl = 0
[State 1000, 6]
type = ChangeState
triggerall = roundstate = 2
triggerall = AnimElem = 4, >= 11
trigger1 = Var(3) = 2
trigger2 = Var(3) = 5 && power < 1000
trigger3 = Var(3) = 5 && var(18)=1
value = 1005
ctrl = 0
[State 1000, 6]
type = ChangeState
triggerall = roundstate = 2
triggerall = AnimElem = 4, >= 11
trigger1 = Var(3) = 3
trigger2 = Var(3) = 6 && power < 1000
trigger3 = Var(3) = 6 && var(18)=1
value = 1008
ctrl = 0

[State 1000, 7]
type = ChangeState
trigger1 = AnimTime = 0
value = 0
ctrl = 1

;------------------------------------
;LIGHT KI BLAST, 3rd STRIKE
[Statedef 1002]
type    = S
movetype= A
physics = N
juggle  = 7
velset = 0,0
anim = 1002
ctrl = 0
sprpriority = 2
poweradd = 10

[State 0, RemoveExplod]
type = RemoveExplod
trigger1 = !Time
id = 90010006

[State 0, RemoveExplod]
type = RemoveExplod
trigger1 = !Time
id = 90010104

[State 220, gethit gut ?]
type = VarSet
trigger1 = AnimElemtime(3)=0
var(14) = 0

[State 220, snd]
type = playsnd
trigger1 = animelem=3
value = 3,100+random%6
channel = 0

[state 1215, Smoke FX]
type = explod
trigger1 = animelemtime(3)=0
anim = 1206+(var(2)=0)
id = 1206
pos = -25,3
postype = P1
sprpriority = 3
ownpal = 1
removetime = -2
persistent = 0
ignorehitpause = 1
scale = .7,.7

[State 200, 1]
type = PlaySnd
trigger1 = AnimElemtime(3)=0
value = 10,0

[State 1000, lkb]
type = Helper
helpertype = normal
trigger1 = AnimElemtime(3)=0
name = "kiblastL3"
postype = P1
pos = 60,-68  ;-66
ownpal = 1
stateno = cond(var(43) = 0, 1010, 1020)
id = 1012

[State 1000, 7]
type = ChangeState
trigger1 = AnimTime = 0
value = 0
ctrl = 1

;=======================================
;MEDIUM KI BLAST, 1st STRIKE
[Statedef 1003]
type    = S
movetype= A
physics = N
juggle  = 7
velset = 0,0
anim = 1800
ctrl = 0
sprpriority = 2
poweradd = 35

[State 0, RemoveExplod]
type = RemoveExplod
trigger1 = !Time
id = 90010006

[State 0, RemoveExplod]
type = RemoveExplod
trigger1 = !Time
id = 90010104

[State 220, gethit gut ?]
type = VarSet
trigger1 = AnimElemtime(4)=0
var(14) = 0

[State 220, snd]
type = playsnd
trigger1 = animelem=4
value = 3,100+random%6
channel = 0

[state 1215, Smoke FX]
type = explod
trigger1 = animelemtime(4)=0
anim = 1206+(var(2)=0)
id = 1206
pos = -25,3
postype = P1
sprpriority = 3
ownpal = 1
removetime = -2
persistent = 0
ignorehitpause = 1
scale = .8,.8

[State 800, VarSet]
type = VarSet
trigger1 = !time
var(3) = 0
[State 800, VarSet]
type = VarSet
trigger1 = time > 3 && !AILevel
trigger1 = ifelse(facing = 1,NumExplod(90010006),NumExplod(90010104))
trigger1 =  command = "x" 
var(3) = 1
[State 800, VarSet]
type = VarSet
trigger1 = time > 3 && !AILevel
trigger1 = ifelse(facing = 1,NumExplod(90010006),NumExplod(90010104))
trigger1 =  command = "y" 
var(3) = 2
[State 800, VarSet]
type = VarSet
trigger1 = time > 3 && !AILevel
trigger1 = ifelse(facing = 1,NumExplod(90010006),NumExplod(90010104))
trigger1 =  command = "z"  
var(3) = 3
[State 800, VarSet]
type = VarSet
trigger1 = time > 15 && !AILevel
trigger1 = ((ifElse(P2DisT x < -12, Facing = -1, Facing = 1) && (NumExplod(90030016) || NumExplod(90030114))) || (ifElse(P2DisT x < -12, Facing = 1, Facing = -1) && (NumExplod(90030114) || NumExplod(90030016))))
trigger1 = NumExplod(90000200)   || NumExplod(90000205) 
var(3) = 4
[State 800, VarSet]
type = VarSet
trigger1 = time > 15 && !AILevel
trigger1 = ((ifElse(P2DisT x < -12, Facing = -1, Facing = 1) && (NumExplod(90030016) || NumExplod(90030114))) || (ifElse(P2DisT x < -12, Facing = 1, Facing = -1) && (NumExplod(90030114) || NumExplod(90030016))))
trigger1 = NumExplod(90000210)  || NumExplod(90000215) 
var(3) = 5
[State 800, VarSet]
type = VarSet
trigger1 = time > 15 && !AILevel
trigger1 = ((ifElse(P2DisT x < -12, Facing = -1, Facing = 1) && (NumExplod(90030016) || NumExplod(90030114))) || (ifElse(P2DisT x < -12, Facing = 1, Facing = -1) && (NumExplod(90030114) || NumExplod(90030016))))
trigger1 = NumExplod(90000220)  || NumExplod(90000225) 
var(3) = 6

[State 800, VarSet]
type = VarSet
trigger1 = time > 15 && !AILevel
trigger1 = ((ifElse(P2DisT x < -12, Facing = -1, Facing = 1) && (NumExplod(90030101) || NumExplod(90030114))) || (ifElse(P2DisT x < -12, Facing = 1, Facing = -1) && (NumExplod(90030016) || NumExplod(90030003))))
trigger1 = NumExplod(90000200)  || NumExplod(90000210) ||  NumExplod(90000220) 
var(3) = 7

[State 800, VarSet]
type = VarSet
trigger1 = time > 15 && !AILevel
trigger1 = ((ifElse(P2DisT x < -12, Facing = -1, Facing = 1) && (NumExplod(90030101) || NumExplod(90030114))) || (ifElse(P2DisT x < -12, Facing = 1, Facing = -1) && (NumExplod(90030016) || NumExplod(90030003))))
trigger1 = (ifElse(NumExplod(90000200), 1, 0) + ifElse(NumExplod(90000210), 1, 0) + ifElse(NumExplod(90000220), 1, 0) >= 2) || (ifElse(NumExplod(90000205), 1, 0) + ifElse(NumExplod(90000215), 1, 0) + ifElse(NumExplod(90000225), 1, 0) >= 2)
var(3) = 8

[State 800, VarSet]
type = VarSet
trigger1 = time > 15 && !AILevel
trigger1 = ((ifElse(P2DisT x < -12, Facing = -1, Facing = 1) && (NumExplod(90030101) || NumExplod(90030114))) || (ifElse(P2DisT x < -12, Facing = 1, Facing = -1) && (NumExplod(90030016) || NumExplod(90030003))))
trigger1 = (NumExplod(90000200) && NumExplod(90000210) && NumExplod(90000220)) || (NumExplod(90000205) && NumExplod(90000215) && NumExplod(90000225)) 
var(3) = 9

[State 800, VarSet]
type = VarSet
triggerall = Ailevel && time > 15 && numenemy && (random < 230 * (AIlevel ** 2 / 64.0))  && (P2MoveType = A || P2BodyDist X >160)
trigger1 = P2Movetype=H
trigger2 = P2Stateno!=[1000,4999]
var(3) = 3
[State 800, VarSet]
type = VarSet
triggerall = Ailevel && time > 15 && numenemy && (random < 230 * (AIlevel ** 2 / 64.0))  && (P2MoveType = A || (P2BodyDist X = [120,160]))
trigger1 = P2Movetype=H
trigger2 = P2Stateno!=[1000,4999]
var(3) = 2
[State 800, VarSet]
type = VarSet
triggerall = Ailevel && time > 15 && numenemy && (random < 230 * (AIlevel ** 2 / 64.0))  && P2MoveType != A && P2BodyDist X <120
trigger1 = P2Movetype=H
trigger2 = P2Stateno!=[1000,4999]
var(3) = 1
[State 800, VarSet]
type = VarSet
triggerall = Ailevel>=1 && time > 15 && numenemy
trigger1 = power>1500 && (random < 150 * (AIlevel ** 2 / 64.0))
var(3) = 4+random%3


[State 200, 1]
type = PlaySnd
trigger1 = AnimElemtime(5)=0
value = 10,0

[State 1000, lkb]
type = Helper
helpertype = normal
trigger1 = AnimElemtime(5)=0
name = "kiblastL1"
postype = P1
pos = 65,-105
ownpal = 1
stateno = cond(var(43) = 0, 1011, 1021)
id = 1013

[state 1000, attackdist]
type = attackdist
trigger1 = animelemtime(6) >= 0
value = 0

[State 1000, 6]
type = ChangeState
triggerall = var(51) = 0
triggerall = roundstate = 2
triggerall = Var(3) = 9
triggerall = AnimElem = 4, >= 10
;trigger1 = numhelper(1011)
trigger1 = power>=1000 && var(18)=0
value = 3102
ctrl = 0

[State 1000, 6]
type = ChangeState
triggerall = var(51) = 0
triggerall = roundstate = 2
triggerall = Var(3) = 8
triggerall = AnimElem = 4, >= 10
;trigger1 = numhelper(1011)
trigger1 = power>=1000 && var(18)=0
value = 3101
ctrl = 0

[State 1000, 6]
type = ChangeState
triggerall = var(51) = 0
triggerall = roundstate = 2
triggerall = Var(3) = 7
triggerall = AnimElem = 4, >= 10
;trigger1 = numhelper(1011)
trigger1 = power>=1000 && var(18)=0
value = 3100
ctrl = 0

[State 1000, 6]
type = ChangeState
triggerall = var(51) = 0
triggerall = roundstate = 2
triggerall = Var(3) = 4
triggerall = AnimElem = 8, >= 0
;trigger1 = numhelper(1010)
trigger1 = power>=1000 && var(18)=0
value = 2000
ctrl = 0
[State 1000, 6]
type = ChangeState
triggerall = var(51) = 0
triggerall = roundstate = 2
triggerall = Var(3) = 5
triggerall = AnimElem = 8, >= 0
;trigger1 = numhelper(1010)
trigger1 = power>=1000 && var(18)=0
value = 2000
ctrl = 0
[State 1000, 6]
type = ChangeState
triggerall = var(51) = 0
triggerall = roundstate = 2
triggerall = Var(3) = 6
triggerall = AnimElem = 8, >= 0
;trigger1 = numhelper(1010)
trigger1 = power>=1000 && var(18)=0
value = 2000
ctrl = 0
[State 1000, 6]
type = ChangeState
triggerall = roundstate = 2
triggerall = AnimElem = 8, >= 1
trigger1 = Var(3) = 1
trigger2 = Var(3) = 4 && power < 1000
trigger3 = Var(3) = 4 && var(18)=1
value = 1001
ctrl = 0
[State 1000, 6]
type = ChangeState
triggerall = roundstate = 2
triggerall = AnimElem = 8, >= 1
trigger1 = Var(3) = 2
trigger2 = Var(3) = 5 && power < 1000
trigger3 = Var(3) = 5 && var(18)=1
value = 1004
ctrl = 0
[State 1000, 6]
type = ChangeState
triggerall = roundstate = 2
triggerall = AnimElem = 8, >= 1
trigger1 = Var(3) = 3
trigger2 = Var(3) = 6 && power < 1000
trigger3 = Var(3) = 6 && var(18)=1
value = 1007
ctrl = 0

[State 1000, 7]
type = ChangeState
trigger1 = AnimTime = 0
value = 0
ctrl = 1
;------------------------------------
;MEDIUM KI BLAST, 2nd STRIKE
[Statedef 1004]
type    = S
movetype= A
physics = N
juggle  = 7
velset = 0,0
anim = 1801
ctrl = 0
sprpriority = 2
poweradd = 10

[State 0, RemoveExplod]
type = RemoveExplod
trigger1 = !Time
id = 90010006

[State 0, RemoveExplod]
type = RemoveExplod
trigger1 = !Time
id = 90010104

[State 220, gethit gut ?]
type = VarSet
trigger1 = AnimElemtime(4)=0
var(14) = 1

[State 220, snd]
type = playsnd
trigger1 = animelem=4
value = 3,100+random%6
channel = 0

[state 1215, Smoke FX]
type = explod
trigger1 = animelemtime(4)=0
anim = 1206+(var(2)=0)
id = 1206
pos = -25,3
postype = P1
sprpriority = 3
ownpal = 1
removetime = -2
persistent = 0
ignorehitpause = 1
scale = .8,.8

[State 800, VarSet]
type = VarSet
trigger1 = !time
var(3) = 0
[State 800, VarSet]
type = VarSet
trigger1 = time > 3 && !AILevel
trigger1 = ifelse(facing = 1,NumExplod(90010006),NumExplod(90010104))
trigger1 =  command = "x" 
var(3) = 1
[State 800, VarSet]
type = VarSet
trigger1 = time > 3 && !AILevel
trigger1 = ifelse(facing = 1,NumExplod(90010006),NumExplod(90010104))
trigger1 =  command = "y" 
var(3) = 2
[State 800, VarSet]
type = VarSet
trigger1 = time > 3 && !AILevel
trigger1 = ifelse(facing = 1,NumExplod(90010006),NumExplod(90010104))
trigger1 =  command = "z"  
var(3) = 3
[State 800, VarSet]
type = VarSet
trigger1 = time > 15 && !AILevel
trigger1 = ((ifElse(P2DisT x < -12, Facing = -1, Facing = 1) && (NumExplod(90030016) || NumExplod(90030114))) || (ifElse(P2DisT x < -12, Facing = 1, Facing = -1) && (NumExplod(90030114) || NumExplod(90030016))))
trigger1 = NumExplod(90000200)   || NumExplod(90000205) 
var(3) = 4
[State 800, VarSet]
type = VarSet
trigger1 = time > 15 && !AILevel
trigger1 = ((ifElse(P2DisT x < -12, Facing = -1, Facing = 1) && (NumExplod(90030016) || NumExplod(90030114))) || (ifElse(P2DisT x < -12, Facing = 1, Facing = -1) && (NumExplod(90030114) || NumExplod(90030016))))
trigger1 = NumExplod(90000210)  || NumExplod(90000215) 
var(3) = 5
[State 800, VarSet]
type = VarSet
trigger1 = time > 15 && !AILevel
trigger1 = ((ifElse(P2DisT x < -12, Facing = -1, Facing = 1) && (NumExplod(90030016) || NumExplod(90030114))) || (ifElse(P2DisT x < -12, Facing = 1, Facing = -1) && (NumExplod(90030114) || NumExplod(90030016))))
trigger1 = NumExplod(90000220)  || NumExplod(90000225) 
var(3) = 6

[State 800, VarSet]
type = VarSet
trigger1 = time > 15 && !AILevel
trigger1 = ((ifElse(P2DisT x < -12, Facing = -1, Facing = 1) && (NumExplod(90030101) || NumExplod(90030114))) || (ifElse(P2DisT x < -12, Facing = 1, Facing = -1) && (NumExplod(90030016) || NumExplod(90030003))))
trigger1 = NumExplod(90000200)  || NumExplod(90000210) ||  NumExplod(90000220) 
var(3) = 7

[State 800, VarSet]
type = VarSet
trigger1 = time > 15 && !AILevel
trigger1 = ((ifElse(P2DisT x < -12, Facing = -1, Facing = 1) && (NumExplod(90030101) || NumExplod(90030114))) || (ifElse(P2DisT x < -12, Facing = 1, Facing = -1) && (NumExplod(90030016) || NumExplod(90030003))))
trigger1 = (ifElse(NumExplod(90000200), 1, 0) + ifElse(NumExplod(90000210), 1, 0) + ifElse(NumExplod(90000220), 1, 0) >= 2) || (ifElse(NumExplod(90000205), 1, 0) + ifElse(NumExplod(90000215), 1, 0) + ifElse(NumExplod(90000225), 1, 0) >= 2)
var(3) = 8

[State 800, VarSet]
type = VarSet
trigger1 = time > 15 && !AILevel
trigger1 = ((ifElse(P2DisT x < -12, Facing = -1, Facing = 1) && (NumExplod(90030101) || NumExplod(90030114))) || (ifElse(P2DisT x < -12, Facing = 1, Facing = -1) && (NumExplod(90030016) || NumExplod(90030003))))
trigger1 = (NumExplod(90000200) && NumExplod(90000210) && NumExplod(90000220)) || (NumExplod(90000205) && NumExplod(90000215) && NumExplod(90000225)) 
var(3) = 9

[State 800, VarSet]
type = VarSet
triggerall = Ailevel && time > 15 && numenemy && (random < 230 * (AIlevel ** 2 / 64.0))  && (P2MoveType = A || P2BodyDist X >160)
trigger1 = P2Movetype=H
trigger2 = P2Stateno!=[1000,4999]
var(3) = 3
[State 800, VarSet]
type = VarSet
triggerall = Ailevel && time > 15 && numenemy && (random < 230 * (AIlevel ** 2 / 64.0))  && (P2MoveType = A || (P2BodyDist X = [120,160]))
trigger1 = P2Movetype=H
trigger2 = P2Stateno!=[1000,4999]
var(3) = 2
[State 800, VarSet]
type = VarSet
triggerall = Ailevel && time > 15 && numenemy && (random < 230 * (AIlevel ** 2 / 64.0))  && P2MoveType != A && P2BodyDist X <120
trigger1 = P2Movetype=H
trigger2 = P2Stateno!=[1000,4999]
var(3) = 1
[State 800, VarSet]
type = VarSet
triggerall = Ailevel>=1 && time > 15 && numenemy
trigger1 = power>1500 && (random < 150 * (AIlevel ** 2 / 64.0))
var(3) = 4+random%3

[State 200, 1]
type = PlaySnd
trigger1 = AnimElemtime(5)=0
value = 10,0

[State 1000, mkb]
type = Helper
helpertype = normal
trigger1 = AnimElemtime(5)=0
name = "kiblastM1"
postype = P1
pos = 55,-113
ownpal = 1
stateno = cond(var(43) = 0, 1011, 1021)
id = 1014

[State 1000, 6]
type = ChangeState
triggerall = var(51) = 0
triggerall = roundstate = 2
triggerall = Var(3) = 9
triggerall = AnimElem = 4, >= 10
;trigger1 = numhelper(1011)
trigger1 = power>=1000 && var(18)=0
value = 3102
ctrl = 0

[State 1000, 6]
type = ChangeState
triggerall = var(51) = 0
triggerall = roundstate = 2
triggerall = Var(3) = 8
triggerall = AnimElem = 4, >= 10
;trigger1 = numhelper(1011)
trigger1 = power>=1000 && var(18)=0
value = 3101
ctrl = 0

[State 1000, 6]
type = ChangeState
triggerall = var(51) = 0
triggerall = roundstate = 2
triggerall = Var(3) = 7
triggerall = AnimElem = 4, >= 10
;trigger1 = numhelper(1011)
trigger1 = power>=1000 && var(18)=0
value = 3100
ctrl = 0

[State 1000, 6]
type = ChangeState
triggerall = roundstate = 2
triggerall = Var(3) = 4
triggerall = AnimElem = 6, >= 3
;trigger1 = numhelper(1013)
trigger1 = power>=1000 && var(18)=0
value = 2000
ctrl = 0
[State 1000, 6]
type = ChangeState
triggerall = roundstate = 2
triggerall = Var(3) = 5
triggerall = AnimElem = 6, >= 3
;trigger1 = numhelper(1013)
trigger1 = power>=1000 && var(18)=0
value = 2000
ctrl = 0
[State 1000, 6]
type = ChangeState
triggerall = roundstate = 2
triggerall = Var(3) = 6
triggerall = AnimElem = 6, >= 3
;trigger1 = numhelper(1013)
trigger1 = power>=1000 && var(18)=0
value = 2000
ctrl = 0
[State 1000, 6]
type = ChangeState
triggerall = roundstate = 2
triggerall = AnimElem = 6, >= 4
trigger1 = Var(3) = 1
trigger2 = Var(3) = 4 && power < 1000
trigger3 = Var(3) = 4 && var(18)=1
value = 1002
ctrl = 0
[State 1000, 6]
type = ChangeState
triggerall = roundstate = 2
triggerall = AnimElem = 6, >= 4
trigger1 = Var(3) = 2
trigger2 = Var(3) = 5 && power < 1000
trigger3 = Var(3) = 5 && var(18)=1
value = 1005
ctrl = 0
[State 1000, 6]
type = ChangeState
triggerall = roundstate = 2
triggerall = AnimElem = 6, >= 4
trigger1 = Var(3) = 3
trigger2 = Var(3) = 6 && power < 1000
trigger3 = Var(3) = 6 && var(18)=1
value = 1008
ctrl = 0


[State 1000, 7]
type = ChangeState
trigger1 = AnimTime = 0
value = 0
ctrl = 1

;------------------------------------
;MEDIUM KI BLAST, 3rd STRIKE
[Statedef 1005]
type    = S
movetype= A
physics = N
juggle  = 7
velset = 0,0
anim = 1802
ctrl = 0
sprpriority = 2
poweradd = 10

[State 0, RemoveExplod]
type = RemoveExplod
trigger1 = !Time
id = 90010006

[State 0, RemoveExplod]
type = RemoveExplod
trigger1 = !Time
id = 90010104

[State 220, gethit gut ?]
type = VarSet
trigger1 = AnimElemtime(4)=0
var(14) = 0

[State 220, snd]
type = playsnd
trigger1 = animelem=4
value = 3,100+random%6
channel = 0

[state 1215, Smoke FX]
type = explod
trigger1 = animelemtime(4)=0
anim = 1206+(var(2)=0)
id = 1206
pos = -25,3
postype = P1
sprpriority = 3
ownpal = 1
removetime = -2
persistent = 0
ignorehitpause = 1
scale = .8,.8

[State 200, 1]
type = PlaySnd
trigger1 = AnimElemtime(5)=0
value = 10,0

[State 1000, mkb]
type = Helper
helpertype = normal
trigger1 = AnimElemtime(5)=0
name = "kiblastM3"
postype = P1
pos = 65,-105  ;-66
ownpal = 1
stateno = cond(var(43) = 0, 1011, 1021)
id = 1015

[State 1000, 7]
type = ChangeState
trigger1 = AnimTime = 0
value = 0
ctrl = 1

;=======================================
;STRONG KI BLAST, 1st STRIKE
[Statedef 1006]
type    = S
movetype= A
physics = N
juggle  = 7
velset = 0,0
anim = 1800
ctrl = 0
sprpriority = 2
poweradd = 35

[State 0, RemoveExplod]
type = RemoveExplod
trigger1 = !Time
id = 90010006

[State 0, RemoveExplod]
type = RemoveExplod
trigger1 = !Time
id = 90010104

[State 220, gethit gut ?]
type = VarSet
trigger1 = AnimElemtime(4)=0
var(14) = 0

[State 220, snd]
type = playsnd
trigger1 = animelem=4
value = 3,100+random%6
channel = 0

[state 1215, Smoke FX]
type = explod
trigger1 = animelemtime(4)=0
anim = 1206+(var(2)=0)
id = 1206
pos = -25,3
postype = P1
sprpriority = 3
ownpal = 1
removetime = -2
persistent = 0
ignorehitpause = 1
scale = .9,.9

[State 800, VarSet]
type = VarSet
trigger1 = !time
var(3) = 0
[State 800, VarSet]
type = VarSet
trigger1 = time > 3 && !AILevel
trigger1 = ifelse(facing = 1,NumExplod(90010006),NumExplod(90010104))
trigger1 =  command = "x" 
var(3) = 1
[State 800, VarSet]
type = VarSet
trigger1 = time > 3 && !AILevel
trigger1 = ifelse(facing = 1,NumExplod(90010006),NumExplod(90010104))
trigger1 =  command = "y" 
var(3) = 2
[State 800, VarSet]
type = VarSet
trigger1 = time > 3 && !AILevel
trigger1 = ifelse(facing = 1,NumExplod(90010006),NumExplod(90010104))
trigger1 =  command = "z"  
var(3) = 3
[State 800, VarSet]
type = VarSet
trigger1 = time > 15 && !AILevel
trigger1 = ((ifElse(P2DisT x < -12, Facing = -1, Facing = 1) && (NumExplod(90030016) || NumExplod(90030114))) || (ifElse(P2DisT x < -12, Facing = 1, Facing = -1) && (NumExplod(90030114) || NumExplod(90030016))))
trigger1 = NumExplod(90000200)  
var(3) = 4
[State 800, VarSet]
type = VarSet
trigger1 = time > 15 && !AILevel
trigger1 = ((ifElse(P2DisT x < -12, Facing = -1, Facing = 1) && (NumExplod(90030016) || NumExplod(90030114))) || (ifElse(P2DisT x < -12, Facing = 1, Facing = -1) && (NumExplod(90030114) || NumExplod(90030016))))
trigger1 = NumExplod(90000210) 
var(3) = 5
[State 800, VarSet]
type = VarSet
trigger1 = time > 15 && !AILevel
trigger1 = ((ifElse(P2DisT x < -12, Facing = -1, Facing = 1) && (NumExplod(90030016) || NumExplod(90030114))) || (ifElse(P2DisT x < -12, Facing = 1, Facing = -1) && (NumExplod(90030114) || NumExplod(90030016))))
trigger1 = NumExplod(90000220) 
var(3) = 6

[State 800, VarSet]
type = VarSet
trigger1 = time > 15 && !AILevel
trigger1 = ((ifElse(P2DisT x < -12, Facing = -1, Facing = 1) && (NumExplod(90030101) || NumExplod(90030114))) || (ifElse(P2DisT x < -12, Facing = 1, Facing = -1) && (NumExplod(90030016) || NumExplod(90030003))))
trigger1 = NumExplod(90000200)  || NumExplod(90000210) ||  NumExplod(90000220) 
var(3) = 7

[State 800, VarSet]
type = VarSet
trigger1 = time > 15 && !AILevel
trigger1 = ((ifElse(P2DisT x < -12, Facing = -1, Facing = 1) && (NumExplod(90030101) || NumExplod(90030114))) || (ifElse(P2DisT x < -12, Facing = 1, Facing = -1) && (NumExplod(90030016) || NumExplod(90030003))))
trigger1 = (ifElse(NumExplod(90000200), 1, 0) + ifElse(NumExplod(90000210), 1, 0) + ifElse(NumExplod(90000220), 1, 0) >= 2) || (ifElse(NumExplod(90000205), 1, 0) + ifElse(NumExplod(90000215), 1, 0) + ifElse(NumExplod(90000225), 1, 0) >= 2)
var(3) = 8

[State 800, VarSet]
type = VarSet
trigger1 = time > 15 && !AILevel
trigger1 = ((ifElse(P2DisT x < -12, Facing = -1, Facing = 1) && (NumExplod(90030101) || NumExplod(90030114))) || (ifElse(P2DisT x < -12, Facing = 1, Facing = -1) && (NumExplod(90030016) || NumExplod(90030003))))
trigger1 = (NumExplod(90000200) && NumExplod(90000210) && NumExplod(90000220)) || (NumExplod(90000205) && NumExplod(90000215) && NumExplod(90000225)) 
var(3) = 9
[State 800, VarSet]
type = VarSet
triggerall = Ailevel && time > 15 && numenemy && (random < 230 * (AIlevel ** 2 / 64.0))  && (P2MoveType = A || P2BodyDist X >160)
trigger1 = P2Movetype=H
trigger2 = P2Stateno!=[1000,4999]
var(3) = 3
[State 800, VarSet]
type = VarSet
triggerall = Ailevel && time > 15 && numenemy && (random < 230 * (AIlevel ** 2 / 64.0))  && (P2MoveType = A || (P2BodyDist X = [120,160]))
trigger1 = P2Movetype=H
trigger2 = P2Stateno!=[1000,4999]
var(3) = 2
[State 800, VarSet]
type = VarSet
triggerall = Ailevel && time > 15 && numenemy && (random < 230 * (AIlevel ** 2 / 64.0))  && P2MoveType != A && P2BodyDist X <120
trigger1 = P2Movetype=H
trigger2 = P2Stateno!=[1000,4999]
var(3) = 1
[State 800, VarSet]
type = VarSet
triggerall = Ailevel>=1 && time > 15 && Ailevel>4 && numenemy
trigger1 = power>1500 && (random < 150 * (AIlevel ** 2 / 64.0))
var(3) = 4+random%3

[State 200, 1]
type = PlaySnd
trigger1 = AnimElemtime(5)=0
value = 10,0

[State 1000, lkb]
type = Helper
helpertype = normal
trigger1 = AnimElemtime(5)=0
name = "kiblastL1"
postype = P1
pos = 65,-105
ownpal = 1
stateno = cond(var(43) = 0, 1012, 1022)
id = 1016

[state 1000, attackdist]
type = attackdist
trigger1 = animelemtime(6) >= 0
value = 0

[State 1000, 6]
type = ChangeState
triggerall = var(51) = 0
triggerall = roundstate = 2
triggerall = Var(3) = 9
triggerall = AnimElem = 4, >= 10
;trigger1 = numhelper(1011)
trigger1 = power>=1000 && var(18)=0
value = 3102
ctrl = 0

[State 1000, 6]
type = ChangeState
triggerall = var(51) = 0
triggerall = roundstate = 2
triggerall = Var(3) = 8
triggerall = AnimElem = 4, >= 10
;trigger1 = numhelper(1011)
trigger1 = power>=1000 && var(18)=0
value = 3101
ctrl = 0

[State 1000, 6]
type = ChangeState
triggerall = var(51) = 0
triggerall = roundstate = 2
triggerall = Var(3) = 7
triggerall = AnimElem = 4, >= 10
;trigger1 = numhelper(1011)
trigger1 = power>=1000 && var(18)=0
value = 3100
ctrl = 0

[State 1000, 6]
type = ChangeState
triggerall = var(51) = 0
triggerall = roundstate = 2
triggerall = Var(3) = 4
triggerall = AnimElem = 8, >= 0
;trigger1 = numhelper(1010)
trigger1 = power>=1000 && var(18)=0
value = 2000
ctrl = 0
[State 1000, 6]
type = ChangeState
triggerall = var(51) = 0
triggerall = roundstate = 2
triggerall = Var(3) = 5
triggerall = AnimElem = 8, >= 0
;trigger1 = numhelper(1010)
trigger1 = power>=1000 && var(18)=0
value = 2000
ctrl = 0
[State 1000, 6]
type = ChangeState
triggerall = var(51) = 0
triggerall = roundstate = 2
triggerall = Var(3) = 6
triggerall = AnimElem = 8, >= 0
;trigger1 = numhelper(1010)
trigger1 = power>=1000 && var(18)=0
value = 2000
ctrl = 0
[State 1000, 6]
type = ChangeState
triggerall = roundstate = 2
triggerall = AnimElem = 8, >= 1
trigger1 = Var(3) = 1
trigger2 = Var(3) = 4 && power < 1000
trigger3 = Var(3) = 4 && var(18)=1
value = 1001
ctrl = 0
[State 1000, 6]
type = ChangeState
triggerall = roundstate = 2
triggerall = AnimElem = 8, >= 1
trigger1 = Var(3) = 2
trigger2 = Var(3) = 5 && power < 1000
trigger3 = Var(3) = 5 && var(18)=1
value = 1004
ctrl = 0
[State 1000, 6]
type = ChangeState
triggerall = roundstate = 2
triggerall = AnimElem = 8, >= 1
trigger1 = Var(3) = 3
trigger2 = Var(3) = 6 && power < 1000
trigger3 = Var(3) = 6 && var(18)=1
value = 1007
ctrl = 0

[State 1000, 7]
type = ChangeState
trigger1 = AnimTime = 0
value = 0
ctrl = 1

;------------------------------------
;STRONG KI BLAST, 2nd STRIKE
[Statedef 1007]
type    = S
movetype= A
physics = N
juggle  = 7
velset = 0,0
anim = 1801
ctrl = 0
sprpriority = 2
poweradd = 10

[State 0, RemoveExplod]
type = RemoveExplod
trigger1 = !Time
id = 90010006

[State 0, RemoveExplod]
type = RemoveExplod
trigger1 = !Time
id = 90010104

[State 220, gethit gut ?]
type = VarSet
trigger1 = AnimElemtime(4)=0
var(14) = 1

[State 220, snd]
type = playsnd
trigger1 = animelem=4
value = 3,100+random%6
channel = 0

[state 1215, Smoke FX]
type = explod
trigger1 = animelemtime(4)=0
anim = 1206+(var(2)=0)
id = 1206
pos = -25,3
postype = P1
sprpriority = 3
ownpal = 1
removetime = -2
persistent = 0
ignorehitpause = 1
scale = .9,.9

[State 800, VarSet]
type = VarSet
trigger1 = !time
var(3) = 0
[State 800, VarSet]
type = VarSet
trigger1 = time > 15 && !AILevel
trigger1 = ifelse(facing = 1,NumExplod(90010006),NumExplod(90010104))
trigger1 =  command = "x" 
var(3) = 1
[State 800, VarSet]
type = VarSet
trigger1 = time > 15 && !AILevel
trigger1 = ifelse(facing = 1,NumExplod(90010006),NumExplod(90010104))
trigger1 =  command = "y" 
var(3) = 2
[State 800, VarSet]
type = VarSet
trigger1 = time > 15 && !AILevel
trigger1 = ifelse(facing = 1,NumExplod(90010006),NumExplod(90010104))
trigger1 =  command = "z"  
var(3) = 3
[State 800, VarSet]
type = VarSet
trigger1 = time > 15 && !AILevel
trigger1 = ((ifElse(P2DisT x < -12, Facing = -1, Facing = 1) && (NumExplod(90030016) || NumExplod(90030114))) || (ifElse(P2DisT x < -12, Facing = 1, Facing = -1) && (NumExplod(90030114) || NumExplod(90030016))))
trigger1 = NumExplod(90000200)  
var(3) = 4
[State 800, VarSet]
type = VarSet
trigger1 = time > 15 && !AILevel
trigger1 = ((ifElse(P2DisT x < -12, Facing = -1, Facing = 1) && (NumExplod(90030016) || NumExplod(90030114))) || (ifElse(P2DisT x < -12, Facing = 1, Facing = -1) && (NumExplod(90030114) || NumExplod(90030016))))
trigger1 = NumExplod(90000210) 
var(3) = 5
[State 800, VarSet]
type = VarSet
trigger1 = time > 15 && !AILevel
trigger1 = ((ifElse(P2DisT x < -12, Facing = -1, Facing = 1) && (NumExplod(90030016) || NumExplod(90030114))) || (ifElse(P2DisT x < -12, Facing = 1, Facing = -1) && (NumExplod(90030114) || NumExplod(90030016))))
trigger1 = NumExplod(90000220) 
var(3) = 6

[State 800, VarSet]
type = VarSet
trigger1 = time > 15 && !AILevel
trigger1 = ((ifElse(P2DisT x < -12, Facing = -1, Facing = 1) && (NumExplod(90030101) || NumExplod(90030114))) || (ifElse(P2DisT x < -12, Facing = 1, Facing = -1) && (NumExplod(90030016) || NumExplod(90030003))))
trigger1 = NumExplod(90000200)  || NumExplod(90000210) ||  NumExplod(90000220) 
var(3) = 7

[State 800, VarSet]
type = VarSet
trigger1 = time > 15 && !AILevel
trigger1 = ((ifElse(P2DisT x < -12, Facing = -1, Facing = 1) && (NumExplod(90030101) || NumExplod(90030114))) || (ifElse(P2DisT x < -12, Facing = 1, Facing = -1) && (NumExplod(90030016) || NumExplod(90030003))))
trigger1 = (ifElse(NumExplod(90000200), 1, 0) + ifElse(NumExplod(90000210), 1, 0) + ifElse(NumExplod(90000220), 1, 0) >= 2) || (ifElse(NumExplod(90000205), 1, 0) + ifElse(NumExplod(90000215), 1, 0) + ifElse(NumExplod(90000225), 1, 0) >= 2)
var(3) = 8

[State 800, VarSet]
type = VarSet
trigger1 = time > 15 && !AILevel
trigger1 = ((ifElse(P2DisT x < -12, Facing = -1, Facing = 1) && (NumExplod(90030101) || NumExplod(90030114))) || (ifElse(P2DisT x < -12, Facing = 1, Facing = -1) && (NumExplod(90030016) || NumExplod(90030003))))
trigger1 = (NumExplod(90000200) && NumExplod(90000210) && NumExplod(90000220)) || (NumExplod(90000205) && NumExplod(90000215) && NumExplod(90000225)) 
var(3) = 9

[State 800, VarSet]
type = VarSet
triggerall = Ailevel && time > 15 && numenemy && (random < 230 * (AIlevel ** 2 / 64.0))  && (P2MoveType = A || P2BodyDist X >160)
trigger1 = P2Movetype=H
trigger2 = P2Stateno!=[1000,4999]
var(3) = 3
[State 800, VarSet]
type = VarSet
triggerall = Ailevel && time > 15 && numenemy && (random < 230 * (AIlevel ** 2 / 64.0))  && (P2MoveType = A || (P2BodyDist X = [120,160]))
trigger1 = P2Movetype=H
trigger2 = P2Stateno!=[1000,4999]
var(3) = 2
[State 800, VarSet]
type = VarSet
triggerall = Ailevel && time > 15 && numenemy && (random < 230 * (AIlevel ** 2 / 64.0))  && P2MoveType != A && P2BodyDist X <120
trigger1 = P2Movetype=H
trigger2 = P2Stateno!=[1000,4999]
var(3) = 1
[State 800, VarSet]
type = VarSet
triggerall = Ailevel>=1 && time > 15 && numenemy
trigger1 = power>1500 && (random < 150 * (AIlevel ** 2 / 64.0))
var(3) = 4+random%3

[State 200, 1]
type = PlaySnd
trigger1 = AnimElemtime(5)=0
value = 10,0

[State 1000, mkb]
type = Helper
helpertype = normal
trigger1 = AnimElemtime(5)=0
name = "kiblastM1"
postype = P1
pos = 55,-113
ownpal = 1
stateno = cond(var(43) = 0, 1012, 1022)
id = 1017

[State 1000, 6]
type = ChangeState
triggerall = var(51) = 0
triggerall = roundstate = 2
triggerall = Var(3) = 9
triggerall = AnimElem = 4, >= 10
;trigger1 = numhelper(1011)
trigger1 = power>=1000 && var(18)=0
value = 3102
ctrl = 0

[State 1000, 6]
type = ChangeState
triggerall = var(51) = 0
triggerall = roundstate = 2
triggerall = Var(3) = 8
triggerall = AnimElem = 4, >= 10
;trigger1 = numhelper(1011)
trigger1 = power>=1000 && var(18)=0
value = 3101
ctrl = 0

[State 1000, 6]
type = ChangeState
triggerall = var(51) = 0
triggerall = roundstate = 2
triggerall = Var(3) = 7
triggerall = AnimElem = 4, >= 10
;trigger1 = numhelper(1011)
trigger1 = power>=1000 && var(18)=0
value = 3100
ctrl = 0

[State 1000, 6]
type = ChangeState
triggerall = roundstate = 2
triggerall = Var(3) = 4
triggerall = AnimElem = 6, >= 3
;trigger1 = numhelper(1013)
trigger1 = power>=1000 && var(18)=0
value = 2000
ctrl = 0
[State 1000, 6]
type = ChangeState
triggerall = roundstate = 2
triggerall = Var(3) = 5
triggerall = AnimElem = 6, >= 3
;trigger1 = numhelper(1013)
trigger1 = power>=1000 && var(18)=0
value = 2000
ctrl = 0
[State 1000, 6]
type = ChangeState
triggerall = roundstate = 2
triggerall = Var(3) = 6
triggerall = AnimElem = 6, >= 3
;trigger1 = numhelper(1013)
trigger1 = power>=1000 && var(18)=0
value = 2000
ctrl = 0
[State 1000, 6]
type = ChangeState
triggerall = roundstate = 2
triggerall = AnimElem = 6, >= 4
trigger1 = Var(3) = 1
trigger2 = Var(3) = 4 && power < 1000
trigger3 = Var(3) = 4 && var(18)=1
value = 1002
ctrl = 0
[State 1000, 6]
type = ChangeState
triggerall = roundstate = 2
triggerall = AnimElem = 6, >= 4
trigger1 = Var(3) = 2
trigger2 = Var(3) = 5 && power < 1000
trigger3 = Var(3) = 5 && var(18)=1
value = 1005
ctrl = 0
[State 1000, 6]
type = ChangeState
triggerall = roundstate = 2
triggerall = AnimElem = 6, >= 4
trigger1 = Var(3) = 3
trigger2 = Var(3) = 6 && power < 1000
trigger3 = Var(3) = 6 && var(18)=1
value = 1008
ctrl = 0

[State 1000, 7]
type = ChangeState
trigger1 = AnimTime = 0
value = 0
ctrl = 1

;------------------------------------
;STRONG KI BLAST, 3rd STRIKE
[Statedef 1008]
type    = S
movetype= A
physics = N
juggle  = 7
velset = 0,0
anim = 1802
ctrl = 0
sprpriority = 2
poweradd = 10

[State 0, RemoveExplod]
type = RemoveExplod
trigger1 = !Time
id = 90010006

[State 0, RemoveExplod]
type = RemoveExplod
trigger1 = !Time
id = 90010104

[State 220, gethit gut ?]
type = VarSet
trigger1 = AnimElemtime(4)=0
var(14) = 0

[State 220, snd]
type = playsnd
trigger1 = animelem=4
value = 3,100+random%6
channel = 0

[state 1215, Smoke FX]
type = explod
trigger1 = animelemtime(4)=0
anim = 1206+(var(2)=0)
id = 1206
pos = -25,3
postype = P1
sprpriority = 3
ownpal = 1
removetime = -2
persistent = 0
ignorehitpause = 1
scale = .8,.8

[State 200, 1]
type = PlaySnd
trigger1 = AnimElemtime(5)=0
value = 10,0

[State 1000, mkb]
type = Helper
helpertype = normal
trigger1 = AnimElemtime(5)=0
name = "kiblastM3"
postype = P1
pos = 65,-105  ;-66
ownpal = 1
stateno = cond(var(43) = 0, 1012, 1022)
id = 1018

[State 1000, 7]
type = ChangeState
trigger1 = AnimTime = 0
value = 0
ctrl = 1


;===========================================================================
; SLASH DOWN KICK
;===========================================================================

;Slash Down Kick
[Statedef 1100]
type = A
physics = N
movetype = A
anim = 1100
velset = .3*vel x,.6*vel y
ctrl = 0
poweradd = 35
sprpriority = -1

[State 282, VarSet]
type=VarSet
trigger1 =Ailevel>=1&& !time
var(39)=ifelse(random<300,2,3)
ignorehitpause=1

[state 1100, varset]
type = varset
triggerall = !AILEVEL
trigger1 = !time
var(39) = cond(NumExplod(90000230) || NumExplod(90000235),1,cond(NumExplod(90000240)|| NumExplod(90000245),2,3))

[State 282, vel];30
type = velset
triggerall = var(39) = 1
trigger1 = animelemtime(6)>0
x = 6
y = 11

[State 282, vel];45
type = velset
triggerall = var(39) = 2
trigger1 = animelemtime(6)>0
x = 8.4
y = 9.6

[State 282, vel];60
type = velset
triggerall = var(39) >= 3
trigger1 = animelemtime(6)>0
x = 10
y = 8

[State 220, snd]
type = playsnd
trigger1 = animelem = 5
value = 3,108
channel = 0

[State 250, 1];Dragon Roar
type = PlaySnd
trigger1 = AnimElem = 4
value = 1100,0

[State 250, 1]
type = PlaySnd
trigger1 = AnimElem = 6
value = 21,1

[State 282, hit]
type = hitdef
triggerall = !NumTarget(440)
trigger1 = !movecontact && !movereversed
attr = A,SA
;damage = 61,8
damage = ceil(ifElse(fvar(11) * 61 < 7, 7, fvar(11) * 61)), 8
animtype = Hard
guardflag = HA
hitflag = MAFD
priority = 4,Hit
pausetime = 11,12 ;12,12 for winM, 11,12 for 1.0
sparkno = s7030
guard.sparkno = s7000
sparkxy = 0,-18
hitsound = s5,5
guardsound = S6,0
ground.type = High
guard.slidetime = 15 
guard.hittime = 6
ground.hittime = 15;17
ground.slidetime = 15;17
ground.velocity = -4, 0
ground.cornerpush.veloff = -8
guard.velocity = -7.5
guard.cornerpush.veloff = -10
air.type = Low
air.velocity = -3,floor(vel Y/2)
down.hittime = 24
down.velocity = 0,0
air.cornerpush.veloff = 0
getpower = ifelse(p2movetype=H,40,140), 35
givepower = 35,35
yaccel = .5
airguard.velocity = -8, -1.5
airguard.cornerpush.veloff = 0
air.fall = 1
fall.recovertime = 30
ID = Cond(P2StateType = L,440,1098)

[state 3000, veladd]
type = posadd
trigger1 = movecontact = 1
trigger1 = var(43) > 0
x = 30

[state 3000, playerpush]
type = playerpush
trigger1 = movecontact
trigger1 = var(43) > 0
value = 0

[state 3000, transperancy]
type = trans
trigger1 = movecontact
trigger1 = var(43) > 0
trans = addalpha
alpha = 127,127


; Avoid infinites with a.LP
[State 3000, basics limiter]
type = helper
triggerall = !NumHelper(15999)
trigger1 = movehit
helpertype = normal
stateno = 15999
ID = 15999
name = "basics"
postype = p1
pos = 0,0
ownpal = 1

[State 282, end]
type = changestate
trigger1 = pos y>=0
value = 52



;===========================================================================
; DRAGON FIST (multi-step combo)
; 1st part (Left Roundhouse Hook Punch) = 1200
; 2nd part (Backspin Elbow Smash) = 1201
; 3rd part (Dragon Blast Uppercut) = 1202
; 3rd part (snap kick) = 1210
; Snap Kick Custom state = 1211
; 4th part (dragon Kick) = 1215
; EX 4th part (EX Dragon Kick) = 1255
; EX 1st part (Left Roundhouse Hook Punch) = 1250 (see ex.cns)
;===========================================================================

;Dragon Fist Light - 1st part (Left Roundhouse Hook Punch)
[Statedef 1200]
type = S
movetype = A
physics = N
poweradd = 35
ctrl = 0
anim = 1200
velset = 0,0
juggle = 8
sprpriority = 2
facep2 = 1

[State 0, RemoveExplod]
type = RemoveExplod
trigger1 = !Time
id = 90010104

[State 0, RemoveExplod]
type = RemoveExplod
trigger1 = !Time
id = 90010006

[State 1200, VarSet]
type=VarSet
trigger1 =Ailevel>=1&& time =0
var(5)=ifelse(random<300,1,2)
ignorehitpause=1

[State 100, A must for dashes everywhere]
type = Assertspecial
trigger1 = 1
flag = nowalk
[State 100, No Turn]
type = AssertSpecial
trigger1 = 1
flag = NoAutoTurn

[State -2, Width]
type = Width
trigger1 = animelemtime(2)>=0 && animelemtime(4) < 0
value = -20,20

[State 220, snd]
type = playsnd
trigger1 = animelem = 1
value = 3,106
channel = 0

[State 250, 1];Dragon Roar
type = PlaySnd
trigger1 = AnimElem = 1
value = 1100,0


[State 200, woosh]
type = PlaySnd
trigger1 = animelem = 1
value = 0, 2

[state 1215, Smoke FX]
type = explod
trigger1 = animelemtime(1)=0
anim = 1206+(var(2)=0)
id = 1206
pos = 0,3
postype = P1
sprpriority = -3
ownpal = 1
removetime = -2
persistent = 0
ignorehitpause = 1
scale = .8,.8

[State -2, Accel]
type = VelSet
trigger1 = animelemtime(1)>=0 && animelemtime(4) < 0
x = 4*(var(5)=1)+7*(var(5)=2)+10*(var(5)=3)  ;10,7,4

[State -2, Accel]
type = PosAdd
trigger1 = animelemtime(2)=0
x = 15

[State -2, Accel]
type = VelSet
trigger1 = animelemtime(4)=0
x = 0

[State -2, Accel]
type = PosAdd
trigger1 = animelemtime(7)=0
x = 20

[State -2, Accel]
type = PosAdd
trigger1 = animelemtime(11)=0
x = 20

[State -2, Accel]
type = PosAdd
trigger1 = animelemtime(13)=0
x = 16

[State 800, VarSet]
type = VarSet
trigger1 = !time
var(4) = 0
[State 801, VarSet]
type = VarSet
trigger1 = time > 7 && !AILevel
trigger1 = ifElse(Facing = 1,(NumExplod(90010104)),NumExplod(90010006))
trigger1 = NumExplod(90000200) || NumExplod(90000210) || NumExplod(90000220) 
var(4) = 1
[State 802, VarSet]
type = VarSet
trigger1 = time > 7 && !AILevel
trigger1 = ifElse(Facing = 1,(NumExplod(90010104)),NumExplod(90010006))
trigger1 = NumExplod(90000230) && !(NumExplod(90000240)) && !(NumExplod(90000250)) || NumExplod(90000240) && !(NumExplod(90000230)) && !(NumExplod(90000250))|| NumExplod(90000250) && !(NumExplod(90000240)) && (!NumExplod(90000230))
var(4) = 2
[State 803, VarSet]
type = VarSet
trigger1 = time > 7 && !AILevel
trigger1 = ifElse(Facing = 1,(NumExplod(90010104)),NumExplod(90010006))
trigger1 = (ifElse(NumExplod(90000230), 1, 0) + ifElse(NumExplod(90000240), 1, 0) + ifElse(NumExplod(90000250), 1, 0) >= 2)
var(4) = 3

[State 800, VarSet]
type = VarSet
triggerall=Ailevel>=1 && numenemy
trigger1 = movecontact=1
var(4) = Ifelse(power>1500&&random<200,3,Ifelse(random<250,2,1))
ignorehitpause=1

[State 200, 1]
type = PlaySnd
trigger1 = animelem = 5
value = 20,0

[State 0, AttackDist]
type = AttackDist
;trigger1 = Anim = 200
trigger1 = AnimElemTime(11) >= 0
value = 0

[State 210, 1]
type = HitDef
trigger1 = !time
attr = S, SA
;damage = 28+5*(var(5)=2)+9*(var(5)=3),2+(var(5)=2)+2*(var(5)=3)
damage = ceil(ifElse(fvar(11) * (28+5*(var(5)=2)+9*(var(5)=3)) < 7, 7, fvar(11) * (28+5*(var(5)=2)+9*(var(5)=3)))), 2+(var(5)=2)+2*(var(5)=3)
animtype = Hard
air.animtype = back
guardflag = MA
hitflag = MAF
priority = 4, Hit
sparkno = s7030
guard.sparkno = s7000
sparkxy = -10, -33
hitsound = s5,2
guardsound = S6,0
ground.type = High
pausetime = 9,9
guard.slidetime = 15 ;added, but used the value of ground.slidetime
guard.hittime = 20 ;added so he can be punished if guarded
guard.pausetime = 8,5
ground.slidetime = 15
ground.hittime = 18
guard.hittime = 10
guard.slidetime = 15
guard.ctrltime = 20
ground.velocity = -7
air.type = High
air.velocity = -4.6,-6.5
air.hittime = 13
getpower = ifelse(p2movetype=H,40,140), 0
givepower = 35,35
air.fall = 1
fall.recover = 0
ground.cornerpush.veloff = 0
guard.cornerpush.veloff = 0
air.cornerpush.veloff = 0
yaccel = .5
envshake.time = 14
envshake.ampl = 5

[State 1000, 6]
type = ChangeState
triggerall = roundstate = 2
trigger1 = Var(4) = 1
trigger1 = AnimElem = 11, >= 1
value = 1201
ctrl = 0
[State 1000, Go to Snap Kick]
type = ChangeState
triggerall = roundstate = 2
trigger1 = Var(4) = 2
trigger1 = AnimElem = 11, >= 1
value = 1210
ctrl = 0
[State 1000, Go to EX Snap Kick]
type = ChangeState
triggerall = roundstate = 2
trigger1 = Var(4) = 3
trigger1 = !AnimTime
value = ifelse(power >= 500, 1260, 1210)
ctrl = 0

[State 1000, 6]
type = ChangeState
trigger1 = AnimTime = 0
value = 0
ctrl = 1

;--------------------------------------------------
;Dragon fist Light - 2nd part (Backspin Elbow Smash)
[Statedef 1201]
type = S
movetype = A
physics = N
poweradd = 35
ctrl = 0
anim = 1201
velset = 0,0
sprpriority = 2

[State 0, RemoveExplod]
type = RemoveExplod
trigger1 = !Time
id = 90010104
ignorehitpause = 1

[State 0, RemoveExplod]
type = RemoveExplod
trigger1 = !Time
id = 90010006
ignorehitpause = 1

[State 100, A must for dashes everywhere]
type = Assertspecial
trigger1 = 1
flag = nowalk
[State 100, No Turn]
type = AssertSpecial
trigger1 = 1
flag = NoAutoTurn

[State 220, snd]
type = playsnd
trigger1 = animelem = 1
value = 3,109
channel = 0

[State 250, 1];Dragon Roar
type = PlaySnd
trigger1 = AnimElem = 1
value = 1100,1


[State 200, woosh]
type = PlaySnd
trigger1 = animelem = 1
value = 0, 2

[state 1215, Smoke FX]
type = explod
trigger1 = animelemtime(1)=0
anim = 1206+(var(2)=0)
id = 1206
pos = 0,3
postype = P1
sprpriority = -3
ownpal = 1
removetime = -2
persistent = 0
ignorehitpause = 1
scale = .8,.8

[State -2, Accel]
type = VelSet
trigger1 = animelemtime(1)>=0 && animelemtime(3)<0
x = 7*(var(5)=1)+7*(var(5)=2)+10*(var(5)=3)

[State -2, Accel]
type = PosAdd
trigger1 = animelemtime(1)=0
x = 20

[State -2, Accel]
type = PosAdd
trigger1 = animelemtime(3)=0
x = 15

[State -2, Accel]
type = VelSet
trigger1 = animelemtime(3)=0
x = 0

[State -2, Accel]
type = PosAdd
trigger1 = animelemtime(10)=0
x = -25

[State -2, Accel]
type = PosAdd
trigger1 = animelemtime(11)=0
x = -30

[State 800, VarSet]
type = VarSet
trigger1 = time < 7
var(4) = 0
[State 800, VarSet]
type = VarSet
trigger1 = time > 7 && !AILevel
trigger1 = ifElse(Facing = 1,(NumExplod(90010104)),NumExplod(90010006))
trigger1 = command = "x" || command = "y" || command = "z";NumExplod(90000200) || NumExplod(90000220) || NumExplod(90000210) ;|| NumExplod(90000215) || NumExplod(90000220) || NumExplod(90000225)
var(4) = 1
[State 800, VarSet]
type = VarSet
trigger1 = time > 7 && !AILevel
trigger1 = ifElse(Facing = 1,(NumExplod(90010104)),NumExplod(90010006))
trigger1 = NumExplod(90000230) && !(NumExplod(90000240)) && !(NumExplod(90000250)) || NumExplod(90000240) && !(NumExplod(90000230)) && !(NumExplod(90000250))|| NumExplod(90000250) && !(NumExplod(90000240)) && (!NumExplod(90000230))
var(4) = 2
[State 800, VarSet]
type = VarSet
trigger1 = time > 7 && !AILevel
trigger1 = ifElse(Facing = 1,(NumExplod(90010104)),NumExplod(90010006))
trigger1 = (ifElse(NumExplod(90000230), 1, 0) + ifElse(NumExplod(90000240), 1, 0) + ifElse(NumExplod(90000250), 1, 0) >= 2)
var(4) = 3

[State 800, VarSet]
type = VarSet
triggerall=Ailevel>=1 && numenemy
trigger1 = movecontact=1
;var(4) = Ifelse(power>500 && moveguarded && random<500,3,Ifelse(random<200,2,1))
var(4) = Ifelse(movehit && random<800,1,ifelse(power>500 && (random < 230 * (AIlevel ** 2 / 64.0)),3,2))
ignorehitpause=1

[State 200, 1]
type = PlaySnd
trigger1 = animelem = 5
value = 20,1

[State 0, AttackDist]
type = AttackDist
;trigger1 = Anim = 200
trigger1 = AnimElemTime(8) >= 0
value = 0

[State 210, 1]
type = HitDef
trigger1 = !time
attr = S, SA
;damage = 28+5*(var(5)=2)+9*(var(5)=3),2+(var(5)=2)+2*(var(5)=3)
damage = ceil(ifElse(fvar(11) * (28+5*(var(5)=2)+9*(var(5)=3)) < 7, 7, fvar(11) * (28+5*(var(5)=2)+9*(var(5)=3)))), 2+(var(5)=2)+2*(var(5)=3)
animtype = Hard
air.animtype = back
guardflag = MA
hitflag = MAF
priority = 4, Hit
sparkno = s7030
guard.sparkno = s7000
sparkxy = -10, -45
hitsound = s5,10
guardsound = s6,0
ground.type = Low  ;High
pausetime = 7,9
guard.pausetime = 8,5
ground.slidetime = 17
ground.hittime = 22
guard.hittime = 26
guard.slidetime = 15
guard.ctrltime = 26
ground.velocity = -3
air.type = High
air.velocity = -3,-3.5
air.hittime = 13
air.juggle = 0
getpower = ifelse(p2movetype=H,40,140), 0
givepower = 35,35
air.fall = 1
fall.recover = 0
ground.cornerpush.veloff = 0
guard.cornerpush.veloff = 0
air.cornerpush.veloff = 0
yaccel = .5
envshake.time = 14
envshake.ampl = 5
forcestand = 1

[State 1000, Go to Dragon Fist]
type = ChangeState
triggerall = roundstate = 2
trigger1 = Var(4) = 1
trigger1 = AnimElem = 9, >= 1
value = 1202
ctrl = 0
[State 1000, Go to Snap Kick]
type = ChangeState
triggerall = roundstate = 2
trigger1 = Var(4) = 2
trigger1 = AnimElem = 9, >= 1
value = 1210
ctrl = 0
[State 1000, Go to EX Snap Kick]
type = ChangeState
triggerall = roundstate = 2
trigger1 = Var(4) = 3
trigger1 = AnimElem = 9, >= 1
value = ifelse(power >= 500, 1260, 1210)
ctrl = 0

[State 800, VarSet]
type = null;VarSet
trigger1 = MoveContact<4
var(4) = 0
ignorehitpause = 1

[State 1000, 6]
type = ChangeState
trigger1 = AnimTime = 0
value = 0
ctrl = 1

;--------------------------------------------------
;Dragon fist - 3rd part (Dragon Blast Uppercut)
[StateDef 1202];On ground
type = S
movetype = A
physics = S
ctrl = 0
anim = 1202
poweradd = 35
velset = 0,0

[State 0, RemoveExplod]
type = RemoveExplod
trigger1 = !Time
id = 90010104

[State 0, RemoveExplod]
type = RemoveExplod
trigger1 = !Time
id = 90010006

[State 100, A must for dashes everywhere]
type = Assertspecial
trigger1 = 1
flag = nowalk
[State 100, No Turn]
type = AssertSpecial
trigger1 = 1
flag = NoAutoTurn

[State 250, 1];Dragon Roar
type = PlaySnd
trigger1 = !time
value = 1100,0


[State 200, woosh]
type = PlaySnd
trigger1 = !time
value = 0, 2

[State 4000, Invincible]
type = NotHitBy
trigger1 = 1
value = SCA

[State 4000, ToAir]
type = ChangeState
trigger1 = AnimTime = 0
value = 1203
ctrl = 0

[StateDef 1203];Rising
type = A
movetype = A
physics = N
ctrl = 0
anim = 1203
velset = 8,-9

[State 220, snd]
type = playsnd
trigger1 = !time
value = 3,108
channel = 0

[state 1215, Rising Effect]
type = explod
trigger1 = !time
anim = 1216+var(2)
id = 1216
pos = 10,12
postype = P1
sprpriority = -3
ownpal = 1
removetime = -2
persistent = 0
ignorehitpause = 1

[State 6100, snd]
type = playsnd
trigger1 = !time
value = 20,2

[State 4001, Pos]
type = PosAdd
trigger1 = time=0
x = 10

[State 4001, Invincible]
type = NotHitBy
trigger1 = (Anim = 1203) && animelemtime(5)<0
value = SCA

[State 4001, AirFriction]
type = VelMul
trigger1 = Vel X != 0
X = .9

[State 800, VarSet]
type = VarSet
trigger1 = time <=3
var(4) = 0
[State 800, VarSet]
type = VarSet
trigger1 = time > 3 && !AILevel
trigger1 = ifElse(Facing = 1,(NumExplod(90010104)),NumExplod(90010006))
trigger1 = NumExplod(90000230) || NumExplod(90000240) || NumExplod(90000250)
var(4) = 1
[State 800, VarSet]
type = VarSet
trigger1 = time > 3 && !AILevel
trigger1 = ifElse(Facing = 1,(NumExplod(90010104)),NumExplod(90010006))
trigger1 = NumExplod(90000230) && NumExplod(90000240) || NumExplod(90000230) && NumExplod(90000250) || NumExplod(90000240) && NumExplod(90000250)
var(4) = 2
[State 800, VarSet]
type = VarSet
trigger1 = time > 3 && !AILevel
trigger1 = ifElse(Facing = 1,(NumExplod(90030016)),NumExplod(90030114))
trigger1 = NumExplod(90000200) || NumExplod(90000210) || NumExplod(90000220) 
var(4) = 3
[State 800, VarSet]
type = VarSet
trigger1 = time > 3 && !AILevel
trigger1 = ifElse(Facing = 1,(NumExplod(90030016)),NumExplod(90030114))
trigger1 = NumExplod(90000230) || NumExplod(90000240) || NumExplod(90000250) 
var(4) = 4
[State 800, VarSet]
type = VarSet
trigger1 = time > 3 && !AILevel
trigger1 = ifElse(Facing = 1,(NumExplod(90030016)),NumExplod(90030114))
trigger1 = NumExplod(90000230) && NumExplod(90000240) || NumExplod(90000230) && NumExplod(90000250) || NumExplod(90000240) && NumExplod(90000250) 
var(4) = 5
[State 800, VarSet]
type = VarSet
trigger1 = time > 3 && !AILevel
trigger1 = ifElse(Facing = 1,(NumExplod(90030016)),NumExplod(90030114))
trigger1 = NumExplod(90000230) && NumExplod(90000240) && NumExplod(90000250) 
var(4) = 6

[State 800, VarSet]
type = VarSet
triggerall=Ailevel>=1 && numenemy
trigger1 = movehit
var(4) = Ifelse(power>1500&&random<350,3+random%4,Ifelse(power>500&&random<750,2,1))
ignorehitpause=1

[State 4001, 3rd Hit]
type = HitDef
trigger1 = Anim = 1203
trigger1 = !time
ID = 4001
attr = A, SA
hitflag = MAF
guardflag = MA
animtype = Back
priority = 7, Hit
;damage = 28+5*(var(5)=2)+9*(var(5)=3),2+(var(5)=2)+2*(var(5)=3)
damage = ceil(ifElse(fvar(11) * (28+5*(var(5)=2)+9*(var(5)=3)) < 7, 7, fvar(11) * (28+5*(var(5)=2)+9*(var(5)=3)))), 2+(var(5)=2)+2*(var(5)=3)
pausetime = 11,14
sparkno = s7030
guard.sparkno = s7000
sparkxy = -10, -75
hitsound = s5,6
guardsound = s6,0
p2facing = 1
ground.type = High
ground.slidetime = 12
ground.hittime = 12
ground.velocity = -2,-9
air.velocity = -2,-8
fall = 1
fall.recover = 0
getpower = ifelse(p2movetype=H,40,140), 35
givepower = 35,35
envshake.time = 16
envshake.freq = 60
envshake.ampl = 4
yaccel = 0.5

[State 0, AttackDist]
type = AttackDist
trigger1 = Anim = 1203
trigger1 = AnimElemTime(4) >= 0
trigger2 = Anim = 1204
value = 0

[State 4001, Fall]
type = VelAdd
trigger1 = Anim = 1203
trigger1 = Pos Y < -30
trigger2 = Anim = 1204
Y = .55

[State 1000, Go to Dragon Kick]
type = ChangeState
triggerall = roundstate = 2
trigger1 = anim = 1203
trigger1 = Var(4) = 1 && movehit
trigger1 = AnimElem = 8, >= 2
value = 1215
ctrl = 0

[State 1000, Go to EX Dragon Kick]
type = ChangeState
triggerall = roundstate = 2
trigger1 = anim = 1203
trigger1 = Var(4) = 2 && movehit
trigger1 = AnimElem = 8, >= 2
value = ifelse(power >= 500, 1255, 1215)
ctrl = 0

[State 1000, Go to Air Kamehameha]
type = ChangeState
triggerall = roundstate = 2
triggerall = power >= 1000
trigger1 = anim = 1203
trigger1 = Var(4) = 3 && movehit
trigger1 = AnimElem = 8, >= 2
value = 2200
ctrl = 0

[State 1000, Go to Super Meteor Kick]
type = ChangeState
triggerall = roundstate = 2
triggerall = power >= 1000
trigger1 = anim = 1203
trigger1 = Var(4) = 6 && movehit
trigger1 = AnimElem = 8, >= 2
value = ifelse(power = 3000, 2651, ifelse(power >= 2000, 2601, 2301))
ctrl = 0

[State 1000, Go to Meteor Kick]
type = ChangeState
triggerall = roundstate = 2
triggerall = power >= 1000
trigger1 = anim = 1203
trigger1 = Var(4) = 5 && movehit
trigger1 = AnimElem = 8, >= 2
value = ifelse(power >= 2000, 2601, 2301)
ctrl = 0

[State 1000, Go to Bicycle Kick]
type = ChangeState
triggerall = roundstate = 2
triggerall = power >= 1000
trigger1 = anim = 1203
trigger1 = Var(4) = 4 && movehit
trigger1 = AnimElem = 8, >= 2
value = 2301
ctrl = 0

[State 4001, Return&Landing]
type = ChangeAnim
trigger1 = Anim = 1203
trigger1 = Vel Y >= 0.0
trigger2 = Anim = 1204
trigger2 = Pos Y = 0
value = Anim+1

[State 4001, StopFwd]
type = VelSet
trigger1 = Vel X = (0,0.4]
X = 0

[State 4001, Stop]
type = VelSet
trigger1 = Vel Y > abs(Pos Y)
Y = 0

[State 4001, Replace]
type = PosSet
trigger1 = Vel Y = 0
Y = 0

[State 4001, ToGround]
type = StateTypeSet
trigger1 = Anim = 1205
persistent = 0
statetype = S
physics = S

[State 17100, Landing Sound]
type = PlaySnd
trigger1 = anim=1205
value = 40, 0
persistent = 0

[state 17100, Landing Effect]
type=explod
trigger1 = Anim = 1205
anim=17100
id=17100
pos=-15,0
postype=P1
sprpriority=-3
ownpal=1
supermovetime=-1
removetime = -2
persistent = 0

[State 4001, End]
type = ChangeState
trigger1 = Anim = 1205
trigger1 = AnimTime = 0
value = 0
ctrl = 1

;--------------------------------------------------
;Snap Kick (3rd part V2)
[Statedef 1210]
type = S
movetype = A
physics = N
poweradd = 35
ctrl = 0
anim = 1210
velset = 0,0
sprpriority = 2

[state 1215, Smoke FX]
type = explod
trigger1 = animelemtime(4)=0
anim = 1206+(var(2)=0)
id = 1206
pos = 0,3
postype = P1
sprpriority = -3
ownpal = 1
removetime = -2
persistent = 0
ignorehitpause = 1
scale = .8,.8

[State 100, A must for dashes everywhere]
type = Assertspecial
trigger1 = 1
flag = nowalk
[State 100, No Turn]
type = AssertSpecial
trigger1 = 1
flag = NoAutoTurn

[State 220, snd]
type = playsnd
trigger1 = animelem = 3
value = 3,110
channel = 0

[State 250, woosh]
type = PlaySnd
trigger1 = AnimElem = 3
value = 0,5

[State 250, 1]
type = PlaySnd
trigger1 = AnimElem = 3
value = 21,2

[State 4001, StopFwd]
type = VelSet
trigger1 = animelemtime(1)>=0 && animelemtime(4)<0
x = 4.5

[State -2, Accel]
type = VelSet
trigger1 = animelemtime(4)>=0
x = 0

[State 250, 2]
type = HitDef
trigger1 = AnimElem = 5
attr = S, SA
animtype  = Hard
;damage    = 55,11
damage = ceil(ifElse(fvar(11) * 55 < 7, 7, fvar(11) * 55)), 11
priority = 4, Hit
guardflag = MA
pausetime = 15,16
guard.pausetime = 20,15
sparkno = s7030
guard.sparkno = s7000
sparkxy = -15,-80
hitsound   = s5,5
guardsound = S6,0
p2facing = 1
ground.type = high
ground.slidetime = 15
ground.hittime = 20
ground.velocity = -7
air.velocity = -4,-4
air.animtype = back
getpower = ifelse(p2movetype=H,40,140), 35
givepower = 35,35
yaccel = 0.5
envshake.time = 16
envshake.freq = 60
envshake.ampl = 4
forcestand = 1
;p2stateno = 1211 ; <- Opponent sent to flying state
ID = 1210

[State 3025, p2state - sent to flying state]
type = targetstate
trigger1 = movehit && numtarget(1210)
trigger1 = (target(1210), stateno = 5000) || (target(1210), stateno = 5010) || (target(1210), stateno = 5020)
;trigger1 = !(target, ishelper)
value = 1211
ID = 1210
ignorehitpause = 1

[State 0, AttackDist]
type = AttackDist
;trigger1 = Anim = 1203
trigger1 = AnimElemTime(6) >= 0
value = 0

[State 240, 1]
type = PosAdd
trigger1 = animelem = 1
X = 20
[State 240, 1]
type = PosAdd
trigger1 = animelem = 8
X = -20

[State 250, 3]
type = ChangeState
trigger1 = AnimTime = 0
value = 0
ctrl = 1

;-------------------------------------
;P2 custom state, sent away
[Statedef 1211]
type = A
movetype = H
physics = N
anim = ifelse(selfanimexist(5052),5052,5030)
ctrl = 0
velset = -10, -5
facep2 = 1

[State 9011, VelAdd]
type = VelAdd
trigger1 = (Pos Y < 0)
y = 0.35
 
[State 9011, NotHitBy]
type = NotHitBy
trigger1 = 1
value = SCA
 
[State 9011, ChangeState]
type = SelfState
trigger1 = (Pos Y >= 0) && (Vel Y > 0)
value = 5100

;--------------------------------------------------
;Dragon fist - 4th part (Dragon Kick)
[StateDef 1215]
type = A
movetype = A
physics = A
anim = 1215
ctrl = 0
poweradd = 35
sprpriority = 2

[State 250, 1];Dragon Roar
type = PlaySnd
trigger1 = !time
value = 1100,2


[State 220, snd]
type = playsnd
trigger1 = animelem = 2
value = 3,112
channel = 0

[State 650, 2]
type = PlaySnd
trigger1 = AnimElem = 3
value = 0, 5

[State 650, 3]
type = HitDef
trigger1 = animelem = 3
trigger2 = animelem = 5 && !movecontact
attr = A, SA
;damage = 49,5
damage = ceil(ifElse(fvar(11) * 49 < 7, 7, fvar(11) * 49)), 5
hitflag = MAF
guardflag = HA
animtype = Hard
priority = 4, Hit
pausetime = 15,16
sparkno = s7030
guard.sparkno = s7000
sparkxy = -30,-55
hitsound   = s5,5
guardsound = S6,0
ground.type = High
ground.slidetime = 12
ground.hittime  = 15
ground.velocity = -5
air.velocity = -12,8
envshake.time = 12
envshake.freq = 60
envshake.ampl = 3
fall = 1
fall.recover = 0
airguard.cornerpush.veloff= 0
air.animtype = Back
fall.animtype = Back
getpower = ifelse(p2movetype=H,40,140), 35
givepower = 35,35
yaccel = 0.5

[State 0, AttackDist]
type = AttackDist
;trigger1 = Anim = 1203
trigger1 = AnimElemTime(6) >= 0
value = 0

[State 1400, EndState]
type = ChangeState
trigger1 = !animtime
value = 50
ctrl = 0

;===========================================================================
; <<<<< SLASHING CHOP >>>>>
; Charge state 1 = 1300
; Charge state 2 (when hit) = 1301
; Actual attack = 1302
; Helper for repel = 1305
; Destroyed helper = 1306
; Reflect with random projectile = 1308
; Reflected projectile = 1315
; Reflected projectile explods = 1316
; Custom state when hit by slashing chop max charge = 1320
;===========================================================================

;Focus Strike - charge state 1
;This state covers the charging aspect of the Focus Strike attack at the start.
[Statedef 1300]
type = S
movetype = I
physics = S
juggle = 10
anim = 1300
ctrl = 0
poweradd = 0
velset = 0,0
 
; These next two sctrls cover initial charge value and building it up
[State 900, starting value]
type = VarSet
trigger1 = time = 1 && var(20)
fvar(9) = 0
 
[State 900, adding to value]
type = VarAdd
trigger1 = time >= 1
fv = 9
value = 1
persistent = 1

[State 8000, flash]
type = PalFX
trigger1 = time =10 
add = 40, 30, -40
sinadd = 50,50,50,16
time = 40
 
[State 900, dash cancel back]
type = ChangeState
trigger1 = time >= 8 && !AILevel && (ifElse(P2DisT x < -12, Facing = -1, Facing = 1) && NumExplod(90001064)) || (ifElse(P2DisT x < -12, Facing = 1, Facing = -1) && NumExplod(90001016)) && !AILevel
trigger2 = time >= 8 && AILevel>0 && numenemy && (enemynear,vel x>=1)
trigger3 = time >= 8 && AILevel>0 && numenemy && (P2Dist X >50) && P2MoveType = A && P2StateType = A
value = Cond(P2Dist X < -12, 100, 105)
 
[State 900, dash cancel forward]
type = ChangeState
trigger1 = time >= 8 && !AILevel && (ifElse(P2DisT x < -12, Facing = -1, Facing = 1) && NumExplod(90001016)) || (ifElse(P2DisT x < -12, Facing = 1, Facing = -1) && NumExplod(90001064)) && !AILevel
trigger2 = time >= 8 && AILevel>0 && numenemy && (enemynear,vel x<=1) 
value = Cond(P2Dist X < -12, 105, 100)
 
[State 900, stopping early]
type = ChangeState
trigger1 = time >= 8 && command != "holdc" && command !="holdz"
trigger2 = Ailevel>=1&&numenemy&&(enemynear,inguarddist)&&Movetype=A
value = 1302
 
[State 900, fully charged]
type = ChangeState
trigger1 = fvar(9)>=60
value = 1302
 
;---------------------------------------------
;Focus Strike - charge state 2
;This state covers the charging aspect of the Focus Strike attack if hit
[Statedef 1301]
type = S
movetype = I
physics = S
juggle = 10
ctrl = 0
poweradd = 0
velset = 0,0
 
; This part covers the after effects of getting hit from earlier.
[state 901, no more saving hit]
type = varset
trigger1 = time = 1
var(20) = 0

[State 8000, hitsnd]
type = Playsnd
trigger1 = time = 0
value = 1301,0

[State 8000, flash]
type = PalFX
trigger1 = time%10=0
add = 150, 30, 30
sinadd = 50,50,50,16
time = 10
 
[State 901, life removal]
type = LifeAdd
trigger1 = time = 1 && !var(20)
value = -(gethitvar(damage))
kill = 1

[State 901, Killed]
type = ChangeState
trigger1 = life <= 0
value = 5950
 
; This ctrl changes the animframe back to the last active one
[State 901, ChangeAnim]
type = ChangeAnim
trigger1 = time = 0
value = 1300
elem = var(23)
 
; This varset is the continuation of charging
[State 901, adding to charge]
type = VarAdd
trigger1 = time >= 1
fv = 9
value = 1
persistent = 1
 
; These change states control dash cancels and moving into the attack portion
[State 900, dash cancel back]
type = ChangeState
trigger1 = time >= 8 && !AILevel && (ifElse(P2DisT x < -12, Facing = -1, Facing = 1) && NumExplod(90001064)) || (ifElse(P2DisT x < -12, Facing = 1, Facing = -1) && NumExplod(90001016)) && !AILevel
trigger2 = time >= 8 && AILevel>0 && numenemy && (enemynear,vel x>=1)
trigger3 = time >= 8 && AILevel>0 && numenemy && (P2Dist X >50) && P2MoveType = A && P2StateType = A
value = Cond(P2Dist X < -12, 100, 105)
 
[State 900, dash cancel forward]
type = ChangeState
trigger1 = time >= 8 && !AILevel && (ifElse(P2DisT x < -12, Facing = -1, Facing = 1) && NumExplod(90001016)) || (ifElse(P2DisT x < -12, Facing = 1, Facing = -1) && NumExplod(90001064)) && !AILevel
trigger2 = time >= 8 && AILevel>0 && numenemy && (enemynear,vel x<=1) 
value = Cond(P2Dist X < -12, 105, 100)

[State 900, stopping early]
type = ChangeState
trigger1 = time >= 8 && command != "holdc" && command !="holdz"
trigger2 = Ailevel>=1&&numenemy&&(enemynear,inguarddist)&&Movetype=A
value = 1302
 
[State 901, fully charged]
type = ChangeState
trigger1 = fvar(9)>=60
value = 1302
 
;----------------------------------------
;Focus Attack - actual attack
[Statedef 1302]
type = S
movetype = A
physics = S
juggle = 10
anim = 1301
ctrl = 0
velset = 0,0
 
;PalFX sctrls; the first removes any earlier stuff, and the second the white flash that appears if you have maxed out focus
[state 901, cancel earlier fx flash]
type = PalFx
trigger1 = time = 0
add = 0,0,0
time = 0
 
[state 901, bright flash if maxed out]
type = PalFx
triggerall = FVar(9) = 60
trigger1 = time = 1
add = 128,128,128
sinadd = -128,-128,-128,32
time = 8

[State 220, snd]
type = playsnd
trigger1 = animelem = 2
value = 3,110
channel = 0

[State 1302, 2]
type = PlaySnd
trigger1 = AnimElem = 2 && (FVar(9) < 60)
value = 0,2 ;20,1

[State 1302, 2]
type = PlaySnd
trigger1 = AnimElem = 2 && (FVar(9) = 60)
value = 0,2 ;20,2

[State 4000, Invincible]
type = NotHitBy
trigger1 = animelemtime(2) >= 0 && animelemtime(8) < 0
value = ,NP, SP

[State 1300, repel helper]
type = helper
trigger1 = animelemtime(2) = 0
helpertype = normal
stateno = 1305
ID = 1305
name = "repel"
postype = p1
pos = 50, -40

[state 1215, Smoke FX]
type = explod
trigger1 = animelemtime(2)=1
anim = 1206+(var(2)=0)
id = 1206
pos = 30,0
postype = P1
sprpriority = -3
ownpal = 1
removetime = -2
persistent = 0
ignorehitpause = 1

; The hitdef used depends on the how long you've been charging. In case you are wondering why there are 2 versions of each lvl's
; hitdef, the second one has been refined to compensate for hitting air opponents.
; LV 1
[State 902, 0-30]
type = HitDef
triggerall = P2stateno != [5020,5040]
triggerall = p2stateno != [154,155]
trigger1 = AnimElem = 2 && (FVar(9) < 60)
attr = S, NA
damage = 32,0
animtype = Hard
guardflag = M
hitflag = M
priority = 4, Hit
pausetime = 9, 9
sparkno = s7020
guard.sparkno = s7000
sparkxy = -17,-73
hitsound   = s5, 5
guardsound = S6,1
ground.type = Low
ground.slidetime = 20  ;14
ground.hittime  = 20   ;14
ground.velocity = -8.95
guard.slidetime = 18
guard.hittime = 18
guard.ctrltime = 12
airguard.velocity = -3.5,-4
air.type = High
air.velocity = -3.5,-6
air.hittime = 9
getpower = 101,101
givepower = 35,35
ground.cornerpush.veloff = -7.25
air.cornerpush.veloff = 0
yaccel = .55
air.fall = 1
air.juggle = 15
fall = (p2movetype=H)
 
[State 902, 0-30]
type = HitDef
triggerall = P2stateno != [5020,5040]
triggerall = p2stateno != [154,155]
triggerall = p2statetype = A
trigger1 = AnimElem = 2 && (FVar(9) < 60)
attr = S, NA
damage= 32,0
animtype = Hard
guardflag = A
hitflag = A
priority = 4, Hit
pausetime = 9, 9
sparkno = s7020
guard.sparkno = s7000
sparkxy = -17,-73
hitsound   = s5, 5
guardsound = S6,0
ground.type = Low
ground.slidetime = 20  ;14
ground.hittime  = 20   ;14
ground.velocity = -6.95
guard.slidetime = 18
guard.hittime = 18
guard.ctrltime = 12
airguard.velocity = -3.5,-4
air.type = High
air.velocity = -3.5,-6
air.hittime = 9
getpower = 101,101
givepower = 35,35
ground.cornerpush.veloff = -7.25
air.cornerpush.veloff = 0
yaccel = .55
air.fall = 1
air.juggle = 15
fall = (p2movetype=H)
 
;LV 2 MAX 1-limiter
[State 902, max-charge] 
type = HitDef 
triggerall = P2stateno != [5020,5040]
triggerall = p2stateno != [154,155]
triggerall = ifelse(enemy,time <= 10,enemy, prevstateno != 5300,1) ;Checks if the opponent has been in the dizzy state for the past 10 ticks 
triggerall = p2stateno != 5300 ;Checks if the opponent is in the dizzy state
trigger1 = AnimElem = 2 && FVar(9) = 60
attr = S, NA
damage = 59,0
animtype = Hard
;guardflag = MA ;<-- Commented out as you will not be blocking this. This will hurt, and you will fall!
hitflag = MAF
priority = 4, Hit
pausetime = 14, 14
sparkno = s7030
guard.sparkno = s7000
sparkxy = -17,-73
hitsound   = s5, 6
guardsound = S6,0
ground.type = Low
ground.slidetime = 20  ;14
ground.hittime  = 20   ;14
ground.velocity = -4.95
guard.slidetime = 18
guard.hittime = 18
guard.ctrltime = 12
airguard.velocity = -3.5,-4
air.type = High
air.velocity = -3.5,-6
air.hittime = 9
getpower = 101,101
givepower = 35,35
ground.cornerpush.veloff = -7.25
air.cornerpush.veloff = 0
yaccel = .55
;p2stateno = 1320 ; <- Opponent sent to flying state
ID = 1320

; LV 2 MAX
[State 902, max-charge]
type = HitDef
triggerall = AnimElem = 2 && FVar(9) = 60
trigger1 = p2stateno = 5300 ;Checks if the opponent is in the dizzy state
trigger2 = ifelse(enemy,time <= 10,enemy, prevstateno = 5300,0)
trigger3 = NumExplod(1302)
trigger4 = P2MoveType = H 
attr = S, NA
damage = 59,0
animtype = Hard
;guardflag = MA ;<-- Commented out as you will not be blocking this. This will hurt, and you will fall!
hitflag = MAF
priority = 4, Hit
pausetime = 14, 14
sparkno = s7030
guard.sparkno = s7000
sparkxy = -17,-73
hitsound   = s5, 6
guardsound = S6,0
ground.type = Low
ground.slidetime = 20  ;14
ground.hittime  = 20   ;14
ground.velocity = -4.95
guard.slidetime = 18
guard.hittime = 18
guard.ctrltime = 12
airguard.velocity = -3.5,-4
air.type = High
air.velocity = -3.5,-6
air.hittime = 9
getpower = 101,101
givepower = 35,35
ground.cornerpush.veloff = -7.25
air.cornerpush.veloff = 0
yaccel = .55
air.fall = 1
air.juggle = 15
;p2stateno = 1320 ; <- Opponent sent to flying state
ID = 1322

;Focus Limiter 2 Limiter
[State 0, Explod]
type = Explod
trigger1 = !NumExplod(1302)
trigger1 = NumTarget(1302)
anim = 15999
ID = 1302
removetime = -1
removeongethit = 1
ignorehitpause = 1

[State 0, TargetState]  ;Limiter state
type = TargetState
triggerall = Numtarget(1322)
trigger1 = !(Target,ishelper)
trigger1 = movehit = 1
value = 1322
ID = 1322
ignorehitpause = 1
persistent = 0

[State 0, TargetState]  ;New state
type = TargetState
triggerall = Numtarget(1320)
trigger1 = !(Target,ishelper)
trigger1 = movehit = 1
value = 1320
ID = 1320
ignorehitpause = 1
persistent = 0
 
[State 902, fvar reset]
type = VarSet
trigger1 = !AnimTime
fvar(9) = 0

[State 0, AttackDist]
type = AttackDist
;trigger1 = Anim = 1203
trigger1 = AnimElemTime(3) >= 0
value = 0
 
;Dash Cancels upon movecontact
[State 902, dash cancel]
type = ChangeState
trigger1 = !AILevel && Movecontact 
trigger1 = (ifElse(P2DisT x < -12, Facing = -1, Facing = 1) && NumExplod(90001016)) || (ifElse(P2DisT x < -12, Facing = 1, Facing = -1) && NumExplod(90001064))
trigger2 = AILevel>=8 && movehit
trigger3 = AILevel>=1 && moveHit && random < 355*(AIlevel ** 2 / 64.0)
value = Cond(P2Dist X < -12, 105, 100)
ignorehitpause = 1

[State 902, dash cancel]
type = ChangeState
trigger1 = !AILevel &&Movecontact 
trigger1 = (ifElse(P2DisT x < -12, Facing = -1, Facing = 1) && NumExplod(90001064)) || (ifElse(P2DisT x < -12, Facing = 1, Facing = -1) && NumExplod(90001016))
trigger2 = AILevel>=8 && moveguarded 
trigger3 = AILevel>=1 && moveguarded && random < 425*(AIlevel ** 2 / 64.0)
value = Cond(P2Dist X < -12, 100, 105)
ignorehitpause = 1
 
[State 902, end]
type = ChangeState
trigger1 = AnimTime = 0
value = 0
ctrl = 1

;-------------------------------------
;Hit by Focus
[Statedef 1320]
type = A
movetype = H
physics = N
ctrl = 0
velset = 0,0 ;Update
facep2 = 1
 
[state 1320, changeanim2]
type = changeanim2
trigger1 = !time
value = 651
ignorehitpause = 1

[state 1320, velset]
type = velset    ;Add this
trigger1 = time = 1
x = -20

[state 1320, ScreenBound]
type = ScreenBound ;Falling out of the screen
trigger1 = !alive
value  = 0

[State 9011, ChangeState]
type = changeState
triggerall = alive
triggerall = Vel X != 0 ;Update
trigger1 = BackEdgeBodyDist <= 20
trigger2 = FrontEdgeBodyDist <= 20
value = 1321

[State 9011, ChangeState]
type = changeState
triggerall = !alive
triggerall = Vel X != 0 ;Update
trigger1 = BackEdgeBodyDist <= 20
trigger2 = FrontEdgeBodyDist <= 20
value = 1323
;-------------------------------------
;Hit Wall
[Statedef 1321]
type = A
movetype = H
physics = N
velset = 0,0 
ctrl = 0
facep2 = 1

[state 1321, envshake]
type = envshake
trigger1 = !time
time = 10
ampl = 4
freq = 60


[state 1321, changeanim]
type = changeanim
trigger1 = time = 2
value = 5051

[state 1321, changeanim]
type = changeanim 
triggerall = anim = 5051
trigger1 = animtime = -1 ;Freezes opponent in last frame of animation
value = anim
elem = animelemno(0)

[state 1321, velset]
type = velset
trigger1 = time = 3
x = 1
y = -5

[state 1321, veladd]
type = veladd
trigger1 = time >= 3
y = .35

[state 1321, posset]
type = posset
trigger1 = pos y > 0
y = 0


[State 9011, ChangeState]
type = changeState
triggerall = anim = 5051
trigger1 = pos y >= 0 && vel y > 0
value = 5300
;-------------------------------------
;Focus Limiter
[Statedef 1322]
type = A
movetype = H
physics = N
anim = ifelse(selfanimexist(5937),5937,5030)
ctrl = 0
velset = -6, -5
facep2 = 1


[State 0, SelfState]
type = SelfState
trigger1 = Time >= 10
trigger1 = command = "recovery"
value = 5210

[State 0, SelfState]
type = SelfState
trigger1 = (Vel y > 0) && (Pos y >= -3)
trigger1 = command = "recovery"
value = 5200
 
[State 9011, VelAdd]
type = VelAdd
trigger1 = (Pos Y < 0)
y = 0.55
 
[State 9011, NotHitBy]
type = NotHitBy
trigger1 = 1
value = SCA
 
[State 9011, ChangeState]
type = SelfState
trigger1 = (Pos Y >= 0) && (Vel Y > 0)
value = 5100
;---------------------------------------------------------------------
;Wallbounce Kill
[Statedef 1323]
type = A
movetype = H
physics = N

[state 1323, nothitby]
type = nothitby
trigger1 = 1
value = SCA
ignorehitpause = 1

[State 0, VelSet]
type = VelSet
trigger1 = Vel X = 0
x = -5

[state 1320, ScreenBound]
type = ScreenBound ;Falling out of the screen
trigger1 = Pos X =[-640,640]
value  = 0

;----------------Prevent Freezing after Ko----------------------------
[state 1321, envshake]
type = envshake
triggerall = !alive
trigger1 = Pos X !=[-640,640]
trigger2 = pos y >= 0 && vel y > 0
time = 20
ampl = 6
freq = 60

[State 182, 1]
type = screenbound
trigger1 = Pos X !=[-640,640]
trigger2 = pos y >= 0 && vel y > 0 
movecamera = 0,0
value = 1

[State 49999, 1]
type = LifeSet
trigger1 = Pos X !=[-640,640]
trigger2 = pos y >= 0 && vel y > 0 
value = 0

[State 49999, 1]
type = PosSet
trigger1 = Pos X !=[-640,640]
trigger2 = pos y >= 0 && vel y > 0 
y = 9000

[State 49999, 5]
type = ChangeAnim2
triggerall = anim != 15999
trigger1 = Pos X !=[-640,640]
trigger2 = pos y >= 0 && vel y > 0 
value = 15999

[State 182, 1]
type = screenbound
trigger1 = Pos X !=[-640,640]
trigger2 = pos y >= 0 && vel y > 0 
movecamera = 0,0
value = 1

[State 49999, 1]
type = PosSet
trigger1 = Pos X !=[-640,640]
trigger2 = pos y >= 0 && vel y > 0 
y = 9000

[State 49999, 5]
type = ChangeAnim2
trigger1 = Pos X !=[-640,640]
trigger2 = pos y >= 0 && vel y > 0 
value = 15999

[State 9011, SelfState]
type = ChangeState
triggerall = !alive
trigger1 = Pos X !=[-640,640]
trigger2 = pos y >= 0 && vel y > 0 
value = 5150



;===========================================================================
; <<<<< HURRICANE KICK >>>>>
; On ground : 1400
; Rising : 1401
; Following Kick : 1405
;===========================================================================

;Hurricane Kick, on ground
[Statedef 1400];on ground
type = S
movetype = A
physics = N
ctrl = 0
anim = 1400
velset = 0,0
sprpriority = 2
facep2 = 1

[state 1100, varset]
type = varset
triggerall = !AILEVEL
trigger1 = !time
var(15) = cond(NumExplod(90000230) || NumExplod(90000235),1,cond(NumExplod(90000240)|| NumExplod(90000245),2,3))



[State 0, ChangeAnim]
type = ChangeAnim
trigger1 = Anim != 1405
trigger1 = Var(15) = 1
value = 1405
[State 0, ChangeAnim]
type = ChangeAnim
trigger1 = Anim != 1406
trigger1 = Var(15) = 2
value = 1406

[State 4000, Invincible]
type = NotHitBy
trigger1 = 1
value = SCA

[State 4000, ToAir]
type = ChangeState
trigger1 = AnimTime = 0
value = 1401
ctrl = 0

;---------------------------
;Hurricane Kick, rising
[StateDef 1401]
type = U
movetype = A
physics = N
ctrl = 0
juggle = 2
anim = 1401
poweradd = 35

[State 1401, VarSet]
type = VarSet
trigger1 = Ailevel>=1 && !time
var(15) = ifelse(random<300,2,3)
ignorehitpause=1

[state 1100, varset]
type = varset
triggerall = !AILEVEL
triggerall = prevstateno != 1400
trigger1 = !time
var(15) = cond(NumExplod(90000230) || NumExplod(90000235),1,cond(NumExplod(90000240)|| NumExplod(90000245),2,3))



[state 1401, removeexplod]
type = removeexplod
trigger1 = !time
id = 90000230

[state 1401, removeexplod]
type = removeexplod
trigger1 = !time
id = 90000240

[state 1401, removeexplod]
type = removeexplod
trigger1 = !time
id = 90000250

[State 4001, Fall]	
type = VarSet
trigger1 = !time
var(12) = 0

[State 6000, VelIni]
type = VelSet
trigger1 = Time = 0
trigger1 = var(16):=(StateType != A)
X = 3
Y = -7


[State 6000, VelIni]
type = VelSet
trigger1 = Time = 0
trigger1 = !var(16)
X = (3+(var(15)=2)+2*(var(15)=3))-3*(Vel X = 0)-10*(Vel X < 0)
Y = (Vel Y)-2.5

[State 6000, ToAir]
type = StateTypeSet
trigger1 = Time = 0
statetype = A

[State 4001, Stop]
type = VelSet
trigger1 = !time
trigger1 = var(15) = 1
trigger1 = var(16)
X = 5
Y = -7

[State 4001, Stop]
type = VelSet
trigger1 = !time
trigger1 = var(15) = 2
trigger1 = var(16)
X = 6
Y = -7

[State 4001, Stop]
type = VelSet
trigger1 = !time
trigger1 = var(15) >= 3
trigger1 = var(16)
X = 7
Y = -7

[State 4001, Stop]
type = VelAdd
trigger1 = time>5 && time<10 && (vel Y > -9)
trigger1 = vel X > 5		;no 3 hit LK Hurricane Kick
trigger1 = var(15) >= 2
trigger1 = var(16)
Y = -0.7

[state 1215, Rising Effect]
type = explod
trigger1 = !time
trigger1 = var(16)
anim = 1216+var(2)
id = 1216
pos = -50,12
postype = P1
sprpriority = -3
ownpal = 1
removetime = -2
persistent = 0
ignorehitpause =1

[State 220, snd];bonzai voice
type = playsnd
trigger1 = !time
value = 1400,2
channel = 0

[State 6100, turning snd];woosh
type = playsnd
trigger1 = anim=1401 && animelem=3
value = 1400,0
channel = 2
persistent = 0

[State 6100, turning snd]
type = playsnd
trigger1 = anim=1401 && animelem=5
value = 0,5   ;21,1
channel = 1

[State 0, Explod]
type = Explod
trigger1 = !Time
anim = 9741
ID = 1405
bindtime = -1
removetime = -1
removeongethit = 1

[State 250, 2]
type = HitDef
trigger1 = anim=1401 && animelem=5
trigger1 = var(43) = 0
attr = S, SA
id=1400
animtype  = Hard
;damage    = 35+6*(var(15)=2)+9*(var(15)=3),3
;damage = ceil(ifElse(fvar(11) * (35+6*(var(15)=2)+9*(var(15)=3)) < 7, 7, fvar(11) * (35+6*(var(15)=2)+9*(var(15)=3)))),3
damage = ceil(ifElse(fvar(11) * 20 < 7, 7, fvar(11) * 20)), 3
priority = 4, Hit
guardflag = MA
pausetime = 13,14
guard.pausetime = 15,15
guard.slidetime = 15 ;added, but used the value of ground.slidetime
guard.hittime = 1 ;added so he can be punished if guarded
sparkno = s7030
guard.sparkno = s7000
sparkxy = -15,-65
hitsound   = s5,5
guardsound = S6,0
ground.type = high
ground.slidetime = 20
ground.hittime = 20
ground.velocity = -4,ifelse(time<9 && var(15)!=1,-3,ifelse(var(15) = 1,ifelse(vel y > 0,-3,0),-3))
air.velocity = -6,ifelse(prevstateno = 1400, -2 , -1)
air.animtype = back
getpower = ifelse(p2movetype=H,30,140), 35
givepower = 35,35
fall = (time<9 && var(15)!=1) || (vel y > 0 ) ;&& var(15)!=1)
air.fall = 1
fall.recover = 0
ground.cornerpush.veloff = 0
guard.cornerpush.veloff = 0
air.cornerpush.veloff = 0
yaccel = .5
envshake.time = 14
envshake.ampl = 5
forcestand = 1

[State 250, 2]
type = HitDef
trigger1 = anim=1401 && animelem=5
trigger1 = var(43) > 0
attr = S, SA
id=1400
animtype  = Hard
;damage    = 35+6*(var(15)=2)+9*(var(15)=3),3
;damage = ceil(ifElse(fvar(11) * (35+6*(var(15)=2)+9*(var(15)=3)) < 7, 7, fvar(11) * (35+6*(var(15)=2)+9*(var(15)=3)))),3
damage = ceil(ifElse(fvar(11) * 30 < 10, 10, fvar(11) * 30)), 5
priority = 4, Hit
guardflag = MA
pausetime = 13,14
guard.pausetime = 15,15
guard.slidetime = 15 ;added, but used the value of ground.slidetime
guard.hittime = 1 ;added so he can be punished if guarded
sparkno = s7030
guard.sparkno = s7000
sparkxy = -15,-65
hitsound   = s5,5
guardsound = S6,0
ground.type = high
ground.slidetime = 20
ground.hittime = 20
ground.velocity = -4,ifelse(time<9 && var(15)!=1,-4,ifelse(var(15) = 1,ifelse(vel y > 0,-4,0),-4))
air.velocity = -6,ifelse(prevstateno = 1400, -4, -4)
air.animtype = back
getpower = ifelse(p2movetype=H,30,140), 35
givepower = 35,35
fall = (time<9 && var(15)!=1) || (vel y > 0) ;&& var(15)!=1)
air.fall = 1
fall.recover = 0
ground.cornerpush.veloff = 0
guard.cornerpush.veloff = 0
air.cornerpush.veloff = 0
yaccel = .5
envshake.time = 14
envshake.ampl = 5
forcestand = 1
ID = 1550

[state 1401, targetstate]
type = targetstate
triggerall = Numtarget
trigger1 = !(target, ishelper)
trigger1 = movehit = 1
trigger1 = (vel y > 0 && var(15) = 1)
value = 1550
ignorehitpause = 1


[State 250, Go to Boomerang Kick]
type = ChangeState
trigger1 = Ailevel<=0
trigger1 = anim=1401 
trigger1 = ifelse(facing = 1,NumExplod(90000024) || NumExplod(90000021),NumExplod(90000026) || NumExplod(90000023))
trigger1 = NumExplod(90000230) || NumExplod(90000240) || NumExplod(90000250)
trigger1 = (pos Y < -60 || vel y > 0) + 25*(var(15)=1) + 20*(var(15)=2)
value = 650

[State 250, Go to Boomerang Kick]
type = ChangeState
trigger1 = Ailevel>=1 && random<500
trigger1 = anim=1401 && movehit
trigger1 = pos Y < -60 + 25*(var(15)=1) + 20*(var(15)=2)
trigger1 = (random < 300 * (AIlevel ** 2 / 64.0))
value = 650

[State 4001, AirFriction]
type = VelMul
trigger1 = Vel X !=0 && time%2
trigger1 = var(16)
x = 0.95

[State 4001, Fall]
type = VelAdd
trigger1 = Anim = 1401 && (vel Y < 0) && var(15)<3
Y = .55
[State 4001, Fall]
type = VelAdd
trigger1 = Anim = 1401 && (vel Y < 0) && var(15)>=3
Y = .40

[State 4001, Fall]
type = VelAdd
trigger1 = (Vel Y > 0) && var(15)<3
Y = .4
[State 4001, Fall]
type = VelAdd
trigger1 = (Vel Y > 0) && var(15)>=3
Y = .35  ;.3

[State 4001, Return&Landing]
type = ChangeAnim
trigger1 = Anim = 1401
trigger1 = Pos Y >= 0 && time>6
value = Anim+1

[State 4001, Stop]
type = VelSet
trigger1 = Vel Y > abs(Pos Y)
Y = 0

[State 4001, Stop]
type = VelSet
trigger1 = anim = 1402
X = 0

[State 4001, Replace]
type = PosSet
trigger1 = Vel Y = 0
trigger2 = pos Y > 10
Y = 0

[State 4001, ToGround]
type = StateTypeSet
trigger1 = Anim = 1402
persistent = 0
statetype = S
physics = S

[State 17100, Landing Sound]
type = PlaySnd
trigger1 = anim=1402
value = 40, 0
persistent = 0

[state 17100, twirl FX]
type=explod
trigger1 = Anim = 1402
anim=17200
id=17200
pos=7,0
postype=P1
sprpriority=-2
ownpal=1
supermovetime=-1
removetime = -2
persistent = 0
scale = 1,0.8

[State 4001, follow up]
type = ChangeState
trigger1 = Anim = 1402 
trigger1 = ifelse(facing = 1,NumExplod(90000026) || NumExplod(90000023),NumExplod(90000024) || NumExplod(90000021))
trigger1 = NumExplod(90000230) || NumExplod(90000240) || NumExplod(90000250)
value = 1405
ctrl = 0

[State 4001, End]
type = ChangeState
trigger1 = Anim = 1402
trigger1 = AnimTime = 0
value = 0
ctrl = 1

;---------------------------------------------------------------------------
;BLUR KICK(STAND STRONG KICK)
[Statedef 1405]
type = S
movetype = A
physics = S
anim = 250
ctrl = 0
velset = 0,0
;poweradd = 20
sprpriority = 3
juggle = 1

[State 250, 1]
type = Turn
trigger1 = !time && p2Dist X < 0

[state 1215, Smoke FX]
type = explod
trigger1 = animelemtime(5)=0
anim = 1206+(var(2)=0)
id = 1206
pos = 0,3
postype = P1
sprpriority = 3
ownpal = 1
removetime = -2
persistent = 0
ignorehitpause = 1
scale = .7,.7

[State 220, snd]; voice
type = playsnd
trigger1 = animelem = 3
value = 3,110
channel = 0

[State 250, 1]
type = PlaySnd
trigger1 = AnimElem = 5
value = 0, 5

[State 250, 2]
type = HitDef
trigger1 = AnimElem = 6
attr = S, SA
animtype  = Hard
;damage    = 40,4
damage = ceil(ifElse(fvar(11) * 40 < 7, 7, fvar(11) * 40)), 4
priority = 4, Hit
guardflag = MA
pausetime = 12,13
guard.pausetime = 13,13
sparkno = s7030
guard.sparkno = s7000
sparkxy = -20,-80
hitsound   = s5,5
guardsound = S6,0
p2facing = 1
ground.type = high
ground.slidetime = 15
ground.hittime = 24
ground.velocity = -9
air.velocity = -4,-4
air.animtype = back
getpower= ifelse(p2movetype=H,40,210), 35
givepower = 35,35
yaccel = 0.5
;p2stateno = 1320 ; <- Opponent sent to flying state
forcestand = 1
ID = 1302   ;add this line

[State 0, AttackDist]
type = AttackDist
;trigger1 = Anim = 1203
trigger1 = AnimElemTime(9) >= 0
value = 0

[State 0, TargetState]  ;New state
type = TargetState
trigger1 = Numtarget(1302)
trigger1 = movehit = 1
value = 1450
ID = 1302
ignorehitpause = 1
persistent = 0

[State 240, 1]
type = PosAdd
trigger1 = animelem = 2
X = 9
[State 240, 1]
type = PosAdd
trigger1 = animelem = 3
X = 15
[State 240, 1]
type = PosAdd
trigger1 = animelem = 6
X = 7
[State 240, 1]
type = PosAdd
trigger1 = animelem = 14
X = 27

[State 250, 3]
type = ChangeState
trigger1 = AnimTime = 0
value = 0
ctrl = 1

;-------------------------------------
[Statedef 1450]
type = A
movetype = H
physics = N
anim = ifelse(selfanimexist(5052),5052,5030)
ctrl = 0
velset = -7.5, -6.5
facep2 = 1

[State 9011, VelAdd]
type = VelAdd
trigger1 = (Pos Y < 0)
y = 0.35
 
 
[State 9011, ChangeState]
type = SelfState
trigger1 = (Pos Y >= 0) && (Vel Y > 0)
value = 5100


;%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
;===========|| BEGINNING OF EX STUFF ||===========
;%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

;========================================================
;=====| RESUME |=====
; Ex Dragon Fist : 1250
; Ex Dragon Kick : 1255
; Ex Dragon Kick P2 stateno : 1256
; Ex Slash Down Kick : 1110
; Ex slash down kick back dash : 1111
; Ex Snap kick : 1260 > 1264
;========================================================

; EX Dragon Fist - 1st part (Left Roundhouse Hook Punch *3)
[Statedef 1250]
type = S
movetype = A
physics = N
poweradd = -500
ctrl = 0
anim = 1250
velset = 0,0
juggle = 8
sprpriority = 2
facep2 = 1

[State 0, RemoveExplod]
type = RemoveExplod
trigger1 = !Time
id = 90010104

[State 0, RemoveExplod]
type = RemoveExplod
trigger1 = !Time
id = 90010006

[State 100, A must for dashes everywhere]
type = Assertspecial
trigger1 = 1
flag = nowalk
[State 100, No Turn]
type = AssertSpecial
trigger1 = 1
flag = NoAutoTurn

[State 220, snd]; voice
type = playsnd
trigger1 = animelem = 1
value = 3,113
channel = 0

[state 1215, Smoke FX]
type = explod
trigger1 = animelemtime(1)=0
anim = 1206+(var(2)=0)
id = 1206
pos = 0,3
postype = P1
sprpriority = -3
ownpal = 1
removetime = -2
persistent = 0
ignorehitpause = 1
scale = .9,.9

[State 6100, snd]
type = playsnd
trigger1 = !time
value = 7,0
channel = 1

[State 8000, flash]
type = PalFX
trigger1 = anim=1250
add = 40, 30, -40
time=1
ignorehitpause = 1

[State 8000, Train]
type = AfterImage
triggerall = var(43) = 0
trigger1 = Time = 0
time = 20
palbright = 40,30,-40
palcontrast = 256,206,206
trans = add1
ignorehitpause = 1

[State -2, Accel]
type = PosAdd
trigger1 = animelemtime(2)=0
x = 30

[State -2, Accel]
type = VelSet
trigger1 = animelemtime(1)>=0 && animelemtime(4) < 0
trigger2 = animelemtime(11)>=0 && animelemtime(14) < 0
trigger3 = animelemtime(20)>=0 && animelemtime(24) < 0
x = 2

[State -2, Accel]
type = PosAdd
trigger1 = animelemtime(7)=0
trigger2 = animelemtime(17)=0
trigger3 = animelemtime(27)=0
trigger4 = animelemtime(11)=0
trigger5 = animelemtime(21)=0
trigger6 = animelemtime(31)=0
x = 20

[State -2, Accel]
type = PosAdd
trigger1 = animelemtime(12)=0
trigger2 = animelemtime(22)=0
x = 15

[State -2, Accel]
type = VelSet
trigger1 = animelemtime(4)=0
trigger2 = animelemtime(14)=0
trigger3 = animelemtime(24)=0
x = 0

[State -2, Accel]
type = PosAdd
trigger1 = animelemtime(13)=0
trigger2 = animelemtime(20)=0
trigger3 = animelemtime(33)=0
x = 8

[State 800, VarSet]
type = VarSet
trigger1 = !time
var(4) = 0

[State 800, VarSet]
type = VarSet
triggerall=Ailevel<=0
trigger1 = animelemtime(27)>0
trigger1 = ((ifElse(P2DisT x < -12, Facing = -1, Facing = 1) && NumExplod(90010104)) || (ifElse(P2DisT x < -12, Facing = 1, Facing = -1) && NumExplod(90010006)))
triggerall = (ifElse(NumExplod(90000230), 1, 0) + ifElse(NumExplod(90000240), 1, 0) + ifElse(NumExplod(90000250), 1, 0) >= 2) || (ifElse(NumExplod(90000235), 1, 0) + ifElse(NumExplod(90000245), 1, 0) + ifElse(NumExplod(90000255), 1, 0) >= 2)
var(4) = 3
[State 800, VarSet]
type = VarSet
triggerall=Ailevel<=0
trigger1 = animelemtime(27)>0
trigger1 = ((ifElse(P2DisT x < -12, Facing = -1, Facing = 1) && NumExplod(90010104)) || (ifElse(P2DisT x < -12, Facing = 1, Facing = -1) && NumExplod(90010006)))
trigger1 = NumExplod(90000200) || NumExplod(90000205) || NumExplod(90000210) || NumExplod(90000215) || NumExplod(90000220) || NumExplod(90000225)
var(4) = 1
[State 800, VarSet]
type = VarSet
triggerall=Ailevel<=0
trigger1 = animelemtime(27)>0
trigger1 = ((ifElse(P2DisT x < -12, Facing = -1, Facing = 1) && NumExplod(90010104)) || (ifElse(P2DisT x < -12, Facing = 1, Facing = -1) && NumExplod(90010006)))
triggerall = NumExplod(90000230) || NumExplod(90000235) || NumExplod(90000240) || NumExplod(90000245) || NumExplod(90000250) || NumExplod(90000255)
var(4) = 2

[State 800, VarSet]
type = VarSet
triggerall=Ailevel>=1 && numenemy
trigger1 = animelemtime(27)>0
trigger1=movecontact=1
var(4) = Ifelse(power>500&&random<250,3,Ifelse(random<500,2,1))
ignorehitpause=1

[State 200, 1]
type = PlaySnd
trigger1 = animelem = 5
trigger2 = animelem = 15
trigger3 = animelem = 25
value = 20,1+random%2

[State 200, woosh]
type = PlaySnd
trigger1 = animelem = 5
trigger2 = animelem = 15
trigger3 = animelem = 25
value = 0, 2

[State 0, AttackDist]
type = AttackDist
;trigger1 = Anim = 1203
trigger1 = AnimElemTime(31) >= 0
value = 0

[State 210, 1]
type = HitDef
trigger1 = animelem=8
trigger2 = animelem=18
attr = S, SA
;damage = 31,3
damage = ceil(ifElse(fvar(11) * 31 < 7, 7, fvar(11) * 31)), 3
animtype = Hard
air.animtype = back
guardflag = MA
hitflag = MAF
priority = 4, Hit
sparkno = s7030
guard.sparkno = s7000
sparkxy = -10, -33
hitsound = s5,1
guardsound = s6,0
ground.type = High
pausetime = 6,7
guard.pausetime = 10,9
ground.slidetime = 10;17
ground.hittime = 10;17
guard.hittime = 10;17
guard.slidetime = 10;17
guard.ctrltime = 15;24
ground.velocity = -3
air.type = High
air.velocity = -2,-4
air.hittime = 13
air.juggle = 0
getpower = 0,0
givepower = 35,35
air.fall = 1
fall.recover = 0
ground.cornerpush.veloff = 0
guard.cornerpush.veloff = 0
air.cornerpush.veloff = 0
yaccel = .5
envshake.time = 12
envshake.ampl = 3
forcestand = 1

[State 210, 1]
type = HitDef
trigger1 = animelem=28
attr = S, SA
;damage = 31,3
damage = ceil(ifElse(fvar(11) * 31 < 7, 7, fvar(11) * 31)), 3
animtype = Hard
air.animtype = back
guardflag = MA
hitflag = MAF
priority = 4, Hit
sparkno = s7030
guard.sparkno = s7000
sparkxy = -10, -33
hitsound = s5,1
guardsound = s6,0
ground.type = High
pausetime = 9,11
guard.pausetime = 9,8
ground.slidetime = 15
ground.hittime = 15
guard.hittime = 15
guard.slidetime = 15
guard.ctrltime = 24
ground.velocity = -3
air.type = High
air.velocity = -2,-4
air.hittime = 13
air.juggle = 0
getpower = 0,0
givepower = 35,35
air.fall = 1
ground.cornerpush.veloff = 0
guard.cornerpush.veloff = 0
air.cornerpush.veloff = 0
yaccel = .5
envshake.time = 14
envshake.ampl = 5
forcestand = 1

[State 1000, 6]
type = ChangeState
triggerall = roundstate = 2
trigger1 = Var(4) = 1
trigger1 = AnimElem = 29, >= 1
value = 1201
ctrl = 0
[State 1000, Go to Snap Kick]
type = ChangeState
triggerall = roundstate = 2
trigger1 = Var(4) = 2
trigger1 = AnimElem = 29, >= 1
value = 1210
ctrl = 0
[State 1000, Go to EX Snap Kick]
type = ChangeState
triggerall = roundstate = 2
trigger1 = Var(4) = 3
trigger1 = AnimElem = 29, >= 1
value = ifelse(power >= 500, 1260, 1210)
ctrl = 0

[State 1000, 6]
type = ChangeState
trigger1 = AnimTime = 0
value = 0
ctrl = 1

;===========================================================================
; EX DRAGON KICK
;===========================================================================

;EX Dragon Kick
[StateDef 1255]
type = A
movetype = A
physics = A
anim = 1215
ctrl = 0
sprpriority = 2
poweradd = -500

[State varset];juggle limiter
type = VarSet
trigger1 = MoveHit
triggerall = Var(7) < 1
;trigger1 = !time && var(6)>0
var(7) = 1
ignorehitpause = 1

[State 800, VarSet]
type = VarSet
trigger1 = !time
var(4) = 0
[State 800, VarSet]
type = VarSet
triggerall=Ailevel<=0
trigger1 = time > 1
trigger1 = ((ifElse(P2DisT x < -12, Facing = -1, Facing = 1) && NumExplod(90030016)) || (ifElse(P2DisT x < -12, Facing = 1, Facing = -1) && NumExplod(90030114)))
var(4) = 1
[State 800, VarSet]
type = VarSet
triggerall=Ailevel>=1 && numenemy
trigger1 = time>1
trigger1=movecontact=1
var(4) = 1
ignorehitpause=1

[State 6100, snd]
type = playsnd
trigger1 = !time
value = 7,0
channel = 1

[State 8000, flash]
type = PalFX
trigger1 = anim=1215
add = 40, 30, -40
time=1
ignorehitpause = 1

[State 8000, Train]
type = AfterImage
triggerall = var(43) = 0
trigger1 = Time = 0
time = 20
palbright = 40,30,-40
palcontrast = 256,206,206
trans = add1
ignorehitpause = 1

[State 220, snd]; voice
type = playsnd
trigger1 = animelem = 2
value = 3,112
channel = 0

[State 650, 2]
type = PlaySnd
trigger1 = AnimElem = 3
value = 0, 5

[State 650, 3]
type = HitDef
triggerall = p2statetype != A
trigger1 = animelem = 3
trigger2 = animelem = 5 && !movecontact
attr = A, SA
;damage = 46,7
damage = ceil(ifElse(fvar(11) * 46 < 7, 7, fvar(11) * 46)), 7
hitflag = MAF
guardflag = HA
animtype = Hard
priority = 4, Hit
pausetime = 15,16
sparkno = s7030
guard.sparkno = s7000
sparkxy = -30,-55
hitsound   = s5,5
guardsound = S6,0
ground.type = High
ground.slidetime = 12
ground.hittime  = 15
ground.velocity = -5
air.velocity = -3,10
envshake.time = 12
envshake.freq = 60
envshake.ampl = 3
fall = 1
fall.recover = 0
getpower = 0,0
givepower = 35,35
airguard.cornerpush.veloff= 0
air.animtype = Back
fall.animtype = Back
yaccel = 0.5
id = 1254

[State 650, 3]
type = HitDef
triggerall = p2statetype = A && var(7)=0
trigger1 = animelem = 3
trigger2 = animelem = 5 && !movecontact
attr = A, SA
;damage = 46,7
damage = ceil(ifElse(fvar(11) * 46 < 7, 7, fvar(11) * 46)), 7
hitflag = MAF
guardflag = HA
animtype = Hard
priority = 4, Hit
pausetime = 15,16
sparkno = s7030
guard.sparkno = s7000
sparkxy = -30,-55
hitsound   = s5,5
guardsound = S6,0
ground.type = High
ground.slidetime = 12
ground.hittime  = 15
ground.velocity = -5
air.velocity = -3,10
envshake.time = 12
envshake.freq = 60
envshake.ampl = 3
fall = 1
fall.recover = 0
getpower = 0,0
givepower = 35,35
airguard.cornerpush.veloff= 0
air.animtype = Back
fall.animtype = Back
yaccel = 0.35
;p2stateno = 1256
id = 1255

[State 902, TargetState]
type = TargetState
trigger1 = movehit
trigger1 = numtarget(1255)
trigger1 = !(target(1255), ishelper)
value = 1256
ignorehitpause = 1
persistent = 0
id = 1255

[State 650, 3]
type = HitDef
triggerall = p2statetype = A && var(7)=1
trigger1 = animelem = 3
trigger2 = animelem = 5 && !movecontact
attr = A, SA
;damage = 46,7
damage = ceil(ifElse(fvar(11) * 46 < 7, 7, fvar(11) * 46)), 7
hitflag = MAF
guardflag = HA
animtype = Hard
priority = 4, Hit
pausetime = 15,16
sparkno = s7030
guard.sparkno = s7000
sparkxy = -30,-55
hitsound   = s5,5
guardsound = S6,0
ground.type = High
ground.slidetime = 12
ground.hittime  = 15
ground.velocity = -5
air.velocity = -3,10
envshake.time = 12
envshake.freq = 60
envshake.ampl = 3
fall = 1
fall.recover = 0
getpower = 0,0
givepower = 35,35
airguard.cornerpush.veloff= 0
air.animtype = Back
fall.animtype = Back
yaccel = 0.5
id = 1257

[State 0, AttackDist]
type = AttackDist
;trigger1 = Anim = 1203
trigger1 = AnimElemTime(6) >= 0
value = 0

[State varset]
type = VarSet
trigger1 = p2stateno = 1256
var(6) = 1

[State 1000, Go to Air Kamehameha]
type = ChangeState
triggerall = roundstate = 2
triggerall = power >= 1000
trigger1 = anim = 1215
trigger1 = Var(4) = 1 && var(7) = 0 && movehit
trigger1 = AnimElem = 7, >= 0
value = 2200
ctrl = 0

[State 1400, EndState]
type = ChangeState
trigger1 = !animtime
value = 50
ctrl = 0


;===========================================================================
; EX SLASH DOWN KICK
;===========================================================================

;EX Slash Down Kick
[Statedef 1110]
type = A
physics = N
movetype = A
anim = 1100
velset = .4*vel x,.6*vel y
ctrl = 0
poweradd = -500
sprpriority = -1

;Limiter
[State 0, Explod]
type = Explod
trigger1 = NumExplod(1110)<5
trigger1 = !Time
anim = 15999
ID = 1110
bindtime = -1
removeongethit = 1
removetime = -1

[State 282, vel]
type = velset
trigger1 = animelemtime(6)>0
x = 10.92
y = 12.5

[state 1215, Slash FX front]
type = explod
trigger1 = animelemtime(7)=0
anim = 1115
id = 1115
pos = 0,0
postype = P1
sprpriority = 3
ownpal = 1
removetime = -1
bindtime = -1
persistent = 0
ignorehitpause = 0

[State 6100, snd]
type = playsnd
trigger1 = !time
value = 7,0
channel = 1

[State 8000, flash]
type = PalFX
trigger1 = anim=1100
add = 40, 30, -40
time=1
ignorehitpause = 1

[State 8000, Train]
type = AfterImage
triggerall = var(43) = 0
trigger1 = Time = 0
time = 20
palbright = 40,30,-40
palcontrast = 256,206,206
trans = add1
ignorehitpause = 1

[State 220, snd]; voice
type = playsnd
trigger1 = animelem = 5
value = 3,108
channel = 0

[State 250, 1];Dragon Roar
type = PlaySnd
trigger1 = AnimElem = 4
value = 1100,0

[State 250, 1]
type = PlaySnd
trigger1 = AnimElem = 6
value = 21,1

[State 282, varset]
type = varset
trigger1 = !time
var(9)=0

[State 282, varadd]
type = varadd
trigger1 = movecontact
var(9) = 1

[State 282, hit]
type = hitdef
triggerall = !NumTarget(440)
trigger1 = var(9)<3
attr = A,SA
;damage = 33,6
damage = ceil(ifElse(fvar(11) * 33 < 7, 7, fvar(11) * 33)), 6
animtype = Hard
guardflag = HA
hitflag = MAFD
priority = 4,Hit
pausetime = 10,11
sparkno = s7020
guard.sparkno = s7000
sparkxy = 0,-18
hitsound   = s5,5
guardsound = S6,0
ground.type = High
ground.hittime = 17
ground.slidetime = 17
ground.velocity = -4, 0
ground.cornerpush.veloff = -8
guard.velocity = -7.5
guard.cornerpush.veloff = -10
air.type = Low
air.velocity = -5,-3
down.hittime = 24
down.velocity = 0,0
air.cornerpush.veloff = 0
getpower = 0,0
givepower = 35,35
yaccel = .5
airguard.velocity = -8, -1.5
airguard.cornerpush.veloff = 0
fall.recover = 0
fall = 0
air.fall = 1
ID = Cond(P2StateType = L,440,1098)

[state 3000, playerpush]
type = playerpush
trigger1 = movecontact
trigger1 = var(43) > 0
value = 0

[state 3000, transperancy]
type = trans
trigger1 = movecontact
trigger1 = var(43) > 0
trans = addalpha
alpha = 127,127

[state 52, Land FX]
type = helper
trigger1 = pos y>=0 && moveguarded
name = "LandFX"
helpertype = normal
stateno = 17100
id = 17100
postype = P1
ownpal = 1
keyctrl = 0
supermovetime = 99999
pausemovetime = 99999
pos = 100,0

[State 282, dash back when guarded]
type = null
trigger1 = pos y>=0 && p2dist x >=0
trigger1 = moveguarded
value = 1111

[State 282, end]
type = changestate
trigger1 = pos y>=0 
value = 52

;---------------------------------------
;Dash back from EX dragon kick
[Statedef 1111]
type    = S
physics = S
movetype = I
ctrl = 0
anim = 47
velset = 0,0

[State 52, 1]
type = VelSet
trigger1 = Time = 0
y = 0

[State 52, 2]
type = PosSet
trigger1 = Time = 0
y = 0

[State 52, 4]
type = ChangeState
trigger1 = AnimTime = 0
value = 105
ctrl = 0

;===========================================================================
; EX SNAP KICK (FLIP KICK)
;===========================================================================

;EX Snap Kick, on ground
[Statedef 1260];on ground
type = S
movetype = A
physics = N
poweradd = -500
ctrl = 0
anim = 1260
velset = 0,0
sprpriority = 2

[State 100, A must for dashes everywhere]
type = Assertspecial
trigger1 = 1
flag = nowalk
[State 100, No Turn]
type = AssertSpecial
trigger1 = 1
flag = NoAutoTurn

[State 220, snd]; voice
type = playsnd
trigger1 = !time
value = 3,110
channel = 0

[State 4000, Invincible]
type = NotHitBy
trigger1 = 1
value = SCA

[State 6100, snd]
type = playsnd
trigger1 = !time
value = 7,0
channel = 1

[State 8000, flash]
type = PalFX
trigger1 = anim=1260
add = 40, 30, -40
time=1
ignorehitpause = 1

[State 8000, Train]
type = AfterImage
triggerall = var(43) = 0
trigger1 = Time = 0
time = 20
palbright = 40,30,-40
palcontrast = 256,206,206
trans = add1
ignorehitpause = 1

[State 4000, ToAir]
type = ChangeState
trigger1 = AnimTime = 0
value = 1261
ctrl = 0

;-------------------------
;EX Snap Kick, rising
[StateDef 1261]
type = A
movetype = A
physics = N
ctrl = 0
anim = 1261
velset = 13,-7

[State 8000, flash]
type = PalFX
trigger1 = anim=1261
trigger2 = anim=1262
trigger3 = anim=1263
add = 40, 30, -40
time=1
ignorehitpause = 1

[State 8000, Train]
type = AfterImage
triggerall = var(43) = 0
trigger1 = Time = 0
time = 30
palbright = 40,30,-40
palcontrast = 256,206,206
trans = add1
ignorehitpause = 1

[State 6100, woosh snd]
type = playsnd
trigger1 = anim=1261 && animelemtime(4)=0
value = 0,5

[state 1215, Rising Effect]
type = explod
trigger1 = !time
anim = 1216+var(2)
id = 1216
pos = 10,12
postype = P1
sprpriority = -3
ownpal = 1
removetime = -2
persistent = 0
ignorehitpause = 1

[State 0, NotHitBy]
type = NotHitBy
trigger1 = anim=1261 && animelemtime(4)=1
value = SCA,NA,SA,HA,NP,SP,HP,NT,ST,HT
time = 1

[State 250, 2]
type = HitDef
trigger1 = anim=1261 && animelemtime(4)=1
attr = S, SA
animtype  = Hard
damage = 0, 0
priority = 4, Hit
pausetime = 0,12
guard.pausetime = 20,20
sparkno = s7030
guard.sparkno = s7000
sparkxy = -15,-60
hitsound   = s5,6
guardsound = S6,0
p2facing = 1
ground.type = high
ground.slidetime = 15
ground.hittime = 20
ground.velocity = 0,0 ;-7,0
air.velocity = 0,0 ;-4,-4
air.animtype = back
getpower = 0,0
givepower = 0,0
;p2stateno = 1264 ; <- Opponent sent to flying state
ID = 1261
fall = 1
numhits = 0

[State 250, 2]
type = HitDef
trigger1 = anim=1261 && animelem=4
attr = S, SA
animtype  = Hard
;damage    = 70
damage = ceil(ifElse(fvar(11) * 70 < 7, 7, fvar(11) * 70)), 0
priority = 4, Hit
pausetime = 11,12
guard.pausetime = 20,20
sparkno = s7030
guard.sparkno = s7000
sparkxy = -15,-60
hitsound   = s5,6
guardsound = S6,0
p2facing = 1
ground.type = high
ground.slidetime = 15
ground.hittime = 20
ground.velocity = -7,-7 ;-7,0
air.velocity = -4,-7 ;-4,-4
air.animtype = back
getpower = 0,0
givepower = 35,35
;p2stateno = 1264 ; <- Opponent sent to flying state
ID = 1261
fall = 1

[State 3025, p2state - sent to flying state]
type = targetstate
trigger1 = movehit && numtarget(1261)
trigger1 = (target(1261), stateno = 5000) || (target(1261), stateno = 5010) || (target(1261), stateno = 5020)
trigger1 = !(target, ishelper)
value = 1264
ID = 1261
ignorehitpause = 1

[State 0, AttackDist]
type = AttackDist
;trigger1 = Anim = 1203
trigger1 = AnimElemTime(6) >= 0
value = 0

[State 4001, AirFriction]
type = VelAdd
trigger1 = Vel X >-3
x = -1.3

[State 4001, Fall]
type = VelAdd
trigger1 = Anim = 1261 && animelemtime(4)<0
trigger1 = Pos Y < -30
Y = .55

[State 4001, Fall]
type = VelAdd
trigger1 = Anim = 1261 && animelemtime(4)>=0 && animelemtime(5)<0
trigger1 = Pos Y < -30
Y = .4

[State 4001, Fall]
type = VelAdd
trigger1 = Anim = 1261 && animelemtime(5)>=0
trigger1 = Pos Y < -30
Y = .3

[State 4001, Gain CTRL]
type = CtrlSet
trigger1 = Anim = 1261 && animelemtime(7)=1
value = 1

[State 4001, Fall]
type = VelAdd
trigger1 = Anim = 1262
Y = .4

[State 4001, Return&Landing]
type = ChangeAnim
trigger1 = Anim = 1261
trigger1 = Vel Y >= 0.0
trigger2 = Anim = 1262
trigger2 = Pos Y = 0
value = Anim+1

[State 4001, StopFwd]
type = VelSet
trigger1 = Vel X = [-3,-1.7]
X = 0

[State 4001, Stop]
type = VelSet
trigger1 = Vel Y > abs(Pos Y)
Y = 0

[State 4001, Stop]
type = VelSet
trigger1 = anim = 1263
X = 0

[State 4001, Replace]
type = PosSet
trigger1 = Vel Y = 0
Y = 0

[State 4001, ToGround]
type = StateTypeSet
trigger1 = Anim = 1263
persistent = 0
statetype = S
physics = S

[State 17100, Landing Sound]
type = PlaySnd
trigger1 = anim=1263
value = 40, 0
persistent = 0

[state 17100, Landing Effect]
type=explod
trigger1 = Anim = 1263
anim=17100
id=17100
pos=-15,0
postype=P1
sprpriority=-3
ownpal=1
supermovetime=-1
removetime = -2
persistent = 0

[State 4001, End]
type = ChangeState
trigger1 = Anim = 1263
trigger1 = AnimTime = 0
value = 0
ctrl = 1

;-------------------------------------
;P2 custom state, sent away
[Statedef 1264]
type = A
movetype = H
physics = N
anim = ifelse(selfanimexist(5937),5937,ifelse(selfanimexist(5052),5052,5030))
ctrl = 0
facep2 = 1

[State 4005, vel]
type = velset
trigger1 = animelemtime(2)=0
x = -4
y = -10
persistent = 0
 
[State 9011, VelAdd]
type = VelAdd
trigger1 = Pos Y < 0
y = 0.35
 
[State 9011, ChangeState]
type = SelfState
trigger1 = (Pos Y >= 0) && (Vel Y > 0)
value = 5100


;===========================================================================
; <<<<< EX HURRICANE KICK >>>>>
; On ground : 1410
; Rising : 1411
;===========================================================================

; EX Hurricane Kick, on ground
[Statedef 1410]
type = S
movetype = A
physics = N
poweradd = -500
ctrl = 0
anim = 1405
velset = 0,0
sprpriority = 2
facep2 = 1

[State 6100, snd]
type = playsnd
trigger1 = !time
value = 7,0
channel = 1

[State 8000, flash]
type = PalFX
trigger1 = anim=1405
add = 40, 30, -40
time=1
ignorehitpause = 1

[State 8000, Train]
type = AfterImage
triggerall = var(43) = 0
trigger1 = Time = 0
time = 20
palbright = 40,30,-40
palcontrast = 256,206,206
trans = add1
ignorehitpause = 1

[State 4000, ToAir]
type = ChangeState
trigger1 = AnimTime = 0
value = 1411
ctrl = 0

;---------------------------
; EX Hurricane Kick, rising
[StateDef 1411]
type = U
movetype = A
physics = N
ctrl = 0
juggle = 2
poweradd = ifelse(prevstateno=1410,0,-500)
anim = 1410

[State 4001, Fall]
type = VarSet
trigger1 = !time
var(12) = 0

[State 6000, VelIni]
type = Velset
trigger1 = Time = 0
trigger1 = var(16):=(StateType != A)
x = 7
y = -10

[State 6000, VelIni]
type = VelSet
trigger1 = Time = 0
trigger1 = !var(16)
X = 7-3*(Vel X = 0)-10*(Vel X < 0)
Y = (Vel Y)-3.5

[State 6000, ToAir]
type = StateTypeSet
trigger1 = Time = 0
statetype = A

[State 8000, flash]
type = PalFX
trigger1 = anim=1410
add = 40, 30, -40
time=1
ignorehitpause = 1

[State 8000, Train]
type = AfterImage
triggerall = var(43) = 0
trigger1 = Time = 0
time = 40
palbright = 40,30,-40
palcontrast = 256,206,206
trans = add1
ignorehitpause = 1

[State 6100, snd]
type = playsnd
triggerall = prevstateno!=1410
trigger1 = !time
value = 7,0
channel = 1

[State 220, snd];bonzai voice
type = playsnd
trigger1 = !time
value = 1400,2
channel = 0

[state 1215, Rising Effect]
type = explod
triggerall = prevstateno=1410
trigger1 = !time
anim = 1216+var(2)
id = 1216
pos = -50,12
postype = P1
sprpriority = -3
ownpal = 1
removetime = -2
persistent = 0
ignorehitpause = 1

[state 17100, Turning Effect front]
type=explod
trigger1 = Anim = 1410 && animelemtime(5)=0
anim = 1403
id = 1403
pos=25,-70
postype=P1
sprpriority=3
ownpal=1
supermovetime=-1
removetime = -2
persistent = 1
bindtime = -1
ignorehitpause = 0
scale = 0.75,0.75

[state 17100, Turning Effect back]
type=explod
trigger1 = Anim = 1410 && animelemtime(5)=0
anim = 1404
id = 1404
pos=25,-70
postype=P1
sprpriority=-3
ownpal=1
supermovetime=-1
removetime = -2
persistent = 1
bindtime = -1
ignorehitpause = 0
scale = 0.75,0.75

[State 6100, turning snd];woosh
type = playsnd
trigger1 = anim=1410 && animelem=4
value = 1400,0
channel = 2
persistent = 0

[State 6100, turning snd]
type = playsnd
trigger1 = anim=1410 && animelem=4 && time>7
value = 0,5  ;21,2
channel = 1

[State 0, Explod]
type = Explod
trigger1 = !Time
anim = 9741
ID = 1405
bindtime = -1
removetime = -1
removeongethit = 1

[State 250, 2]
type = HitDef
triggerall = NumHelper(1405) <4
trigger1 = anim=1410 && animelem=4
trigger2 = anim=1410 && animelem=6
attr = S, SA
animtype  = Hard
;damage    = 20,2
damage = ceil(ifElse(fvar(11) * 15 < 7, 7, fvar(11) * 15)), 2
priority = 4, Hit
guardflag = MA
pausetime = 8,12
guard.pausetime = 12,12
sparkno = s7030
guard.sparkno = s7000
sparkxy = -15,-65
hitsound   = s5,5
guardsound = S6,0
ground.type = high
ground.slidetime = 15
ground.hittime = 20
ground.velocity = -7
air.velocity = -4,-4
air.animtype = back
getpower = 0,0
givepower = 35,35
air.fall = 1
fall.recover = 0
ground.cornerpush.veloff = 0
guard.cornerpush.veloff = 0
air.cornerpush.veloff = 0
yaccel = .5
envshake.time = 14
envshake.ampl = 5
forcestand = 1

[State 4001, AirFriction]
type = VelMul
trigger1 = Vel X !=0 && time%2
trigger1 = var(16)
x = 0.95

[State 4001, Fall]
type = VelAdd
trigger1 = (vel Y < 0)
Y = .40

[State 4001, Fall]
type = VelAdd
trigger1 = (Vel Y > 0)
Y = .3

[State 4001, Fall]
type = VarSet
trigger1 = Anim = 1410 && Vel Y > 0
trigger1 = prevstateno=1410 ;on ground
trigger1 = ifelse(facing = 1,NumExplod(90000026) || NumExplod(90000023),NumExplod(90000024) || NumExplod(90000021))
trigger1 = NumExplod(90000230) || NumExplod(90000240) || NumExplod(90000250)
var(12) = 1

[State 4001, Return&Landing]
type = ChangeAnim
trigger1 = Anim = 1410
trigger1 = Pos Y >= 0 && time>6
value = 1402

[State 4001, Stop]
type = VelSet
trigger1 = Vel Y > abs(Pos Y)
Y = 0

[State 4001, Stop]
type = VelSet
trigger1 = anim = 1402
X = 0

[State 4001, Replace]
type = PosSet
trigger1 = Vel Y = 0
trigger2 = pos Y > 10
Y = 0

[State 4001, ToGround]
type = StateTypeSet
trigger1 = Anim = 1402
persistent = 0
statetype = S
physics = S

[State 17100, Landing Sound]
type = PlaySnd
trigger1 = anim=1402
value = 40, 0
persistent = 0

[state 17100, twirl FX]
type=explod
trigger1 = Anim = 1402
anim=17200
id=17200
pos=7,0
postype=P1
sprpriority=-2
ownpal=1
supermovetime=-1
removetime = -2
persistent = 0
scale = 1,0.8

[State 4001, follow up]
type = ChangeState
trigger1 = Anim = 1402 && animelemtime(3)>=1
trigger1 = var(12) = 1
value = 1405
ctrl = 0

[State 0, CtrlSet]
type = CtrlSet
trigger1 = Anim = 1402
trigger1 = AnimElemTime(5)>= 0
value = 1

[State 4001, End]
type = ChangeState
trigger1 = Anim = 1402
trigger1 = AnimTime = 0
value = 0
ctrl = 1

;--------------------------------------------------
;Dragon Rush
[Statedef 1500]
type = S
movetype = A
physics = N
ctrl = 0
anim = 1502

[State -2, Width]
type = Width
trigger1 = anim = 1502
value = 30,-30

[state 1500, attackdist]
type = attackdist
trigger1 = 1
value = 0

[state 1215, Smoke FX]
type = explod
trigger1 = !time
anim = 1206
id = 1206
pos = -10,0
postype = P1
sprpriority = 3
ownpal = 1
removetime = -2
persistent = 0
ignorehitpause = 1
scale = .8,.8

[State 100, steps]
type = playsnd
trigger1 = !time
value = 1500,0


[state 1500, velset]
type = velset
trigger1 = anim = 1502
x = 7

[state 1500, stop]
type = changeanim
triggerall = !AILevel
triggerall = anim = 1502 && time > 4 
triggerall = anim != 1500
trigger1 = (command = "a" || command = "b" || command = "c") 
trigger2 = time = 70
value = 1500

[state 1500, stop]
type = changeanim
triggerall = AILevel
triggerall = anim = 1502 && time > 4 
triggerall = anim != 1500
trigger1 = random < 15 * (AIlevel ** 2 / 64.0)
trigger1 = P2BodyDist X >80
trigger2 = time = 70
trigger3 = P2BodyDist X <0
value = 1500

[State 100, snd]
type = playsnd
triggerall = anim = 1500
trigger1 = animelem = 1
value = 5,8
persistent = 0

[state 1500, velmul]
type = velmul
trigger1 = anim = 1500
x = .90


;Dragon Tail
[State -1, Dragon Tail]
type = ChangeState
triggerall= !AIlevel
triggerall = command = "x"
triggerall = anim != 1500
trigger1 = time > 2
value = cond(var(43) = 0, 1501, 1511)

;Dragon Tail
[State -1, Dragon Tail]
type = ChangeState
triggerall= AIlevel
triggerall = anim != 1500
triggerall = time > 2
trigger1 = random < 255 * (AIlevel ** 2 / 64.0)
trigger1 = P2BodyDist X = [0,80]
trigger1 = (P2StateNo = [120,155]) && P2StateType = S
value = cond(var(43) = 0, 1501, 1511)

;Dragon Fist
[State -1, Dragon Fist]
type = ChangeState
triggerall= !AIlevel
triggerall = command = "y" 
triggerall = anim != 1500
trigger1 = time > 2
value = cond(var(43) = 0, 1502, 1512) ;Normal vs Kaioken

;Dragon Fist
[State -1, Dragon Fist]
type = ChangeState
triggerall= AIlevel
triggerall = anim != 1500
triggerall = time > 2
trigger1 = random < 355 * (AIlevel ** 2 / 64.0)
trigger1 = P2BodyDist X = [0,80]
trigger1 = (P2StateNo = [120,155]) && P2StateType = C
trigger2 = random < 255 * (AIlevel ** 2 / 64.0)
trigger2 = P2BodyDist X = [0,80]
trigger2 = (P2StateNo != [120,155]) && P2StateType != A
value = cond(var(43) = 0, 1502, 1512) ;Normal vs Kaioken

;Dragon Blast Upper
[State -1, Dragon Blast]
type = ChangeState
triggerall= !AIlevel
triggerall = command = "z" 
triggerall = anim != 1500
trigger1 = time > 2
value = cond(var(43) = 0, 1503,1513)

;Dragon Blast Upper
[State -1, Dragon Blast]
type = ChangeState
triggerall= AIlevel
triggerall = anim != 1500
triggerall = time > 2
trigger1 = random < 355 * (AIlevel ** 2 / 64.0)
trigger1 = P2BodyDist X = [0,120]
trigger1 = (P2StateNo != [120,155]) && P2StateType = A
trigger2 = random < 355 * (AIlevel ** 2 / 64.0)
trigger2 = P2BodyDist X = [0,80]
trigger2 = (P2StateNo != [120,155]) && P2StateType != A
value = cond(var(43) = 0, 1503,1513)

[State 1500, changestate]
type = changestate
triggerall = anim = 1500
trigger1 = !animtime
value = 0
ctrl = 1
;-----------------------------------------------------------------
;Dragon Tail
[Statedef 1501]
type = S
movetype = A
physics = N
ctrl = 0
juggle  = 1
poweradd = ifelse(prevstateno != 1520,35,0)
anim = 1503

[state 1500, autocorrect]
type = velset
triggerall = prevstateno = 1520
triggerall = P2DisT x < 0
trigger1 = time < 3
x = -ceil(Vel X/2)

[state 1500, autocorrect]
type = turn
triggerall = prevstateno = 1520
triggerall = P2DisT x < 0
trigger1 = time < 3

[State 250, 1];Dragon Roar
type = PlaySnd
trigger1 = !time
value = 1100,0

[state 1501, velmul]
type = velmul
trigger1 = Vel X != 0
x = .96

[State 200, 1];voice
type = PlaySnd
trigger1= animelem=2
value=3,102+random%3
channel = 0

[State 440, 1]
type = PlaySnd
trigger1 = AnimElem = 5
value = 0, 4

[State 440, 2]
type = HitDef
triggerall = !NumTarget(440)
trigger1 = AnimElem = 6
attr = C, SA
;damage = 26+7*var(37),0
damage = ceil(ifElse(fvar(11) * 38 < 7, 7, fvar(11) * 38)), 3
animtype  = Medium
hitflag = MAFD
guardflag = L
pausetime = 9,10
guard.pausetime = 9,9
sparkno = s7030
guard.sparkno = s7000
sparkxy = -20,-10
hitsound   = s5,5
guardsound = S6,0
ground.type = Trip
ground.slidetime = 12;8
ground.hittime  = 12;8
ground.velocity = -1,-6
guard.velocity = -6
air.type = Trip
air.velocity = -1,-6
down.velocity = -3,0 ;-3,-1 
down.hittime = 12
down.cornerpush.veloff = -16
air.cornerpush.veloff = 0
envshake.time = 9
envshake.freq = 60
envshake.ampl = 3
getpower= ifelse(prevstateno != 1520,ifelse(p2movetype=H,40,140),0), ifelse(prevstateno != 1520,35,0)
givepower = 35,35
fall = 1
fall.recover = 0
air.animtype = back
air.hittime = 4
yaccel = 0.5
ID = Cond(P2StateType = L,440,1098)


[State 0, AttackDist]
type = AttackDist
;trigger1 = Anim = 200
trigger1 = AnimElemTime(8) >= 0
value = 0

[State 1500, changestate]
type = changestate
trigger1 = !animtime
value = 11+(!NumExplod(90000001) && !NumExplod(90000002) && !NumExplod(90000003))
ctrl = 1

;--------------------------------------------------------------------------------
;Dragon Fist
[Statedef 1502]
type = S
movetype = A
physics = N
ctrl = 0
juggle = 0
poweradd = ifelse(prevstateno != 1520,35,0)
anim = 1200

[state 1500, autocorrect]
type = velset
triggerall = prevstateno = 1520
triggerall = P2DisT x < 0
trigger1 = time < 3
x = -ceil(Vel X/2)

[state 1500, autocorrect]
type = turn
triggerall = prevstateno = 1520
triggerall = P2DisT x < 0
trigger1 = time < 3

[state 1501, velmul]
type = velmul
trigger1 = Vel X != 0
x = .93

[State -2, Width]
type = width
trigger1 = 1
value = -12,12

[State 220, snd]
type = playsnd
trigger1 = animelem = 8
value = 3,106
channel = 0

[State 250, 1];Dragon Roar
type = PlaySnd
trigger1 = AnimElem = 8
value = 1100,1


[State 200, woosh]
type = PlaySnd
trigger1 = animelem = 1
value = 0, 2


[State -2, Accel]
type = PosAdd
trigger1 = animelemtime(2)=0
x = 15

[State 200, Aura SFX]
type = PlaySnd
trigger1 = animelemtime(7) = 0
value = 300,0
[State 200, Burst Aura SFX]
type = PlaySnd
trigger1 = animelemtime(7) = 0
value = 300,1

[state 1215, FX front]
type = null
trigger1 = !time
stateno = 150100
id = 150100
pos = 0,0
postype = P1
sprpriority = 3
ownpal = 1
persistent = 0


[State -2, Accel]
type = PosAdd
trigger1 = animelemtime(7)=0
x = 20

[State -2, Accel]
type = PosAdd
trigger1 = animelemtime(11)=0
x = 20

[State -2, Accel]
type = PosAdd
trigger1 = animelemtime(13)=0
x = 16

[State 200, 1]
type = PlaySnd
trigger1 = animelem = 5
value = 20,0

[State 0, AttackDist]
type = AttackDist
;trigger1 = Anim = 200
trigger1 = AnimElemTime(11) >= 0
value = 0


[State 210, 1]
type = HitDef
triggerall = !movecontact
triggerall = enemy,statetype != C
trigger1 = animelemtime(8) = 0
attr = S, SA
;damage = 28+5*(var(5)=2)+9*(var(5)=3),2+(var(5)=2)+2*(var(5)=3)
damage = ceil(ifElse(fvar(11) * 32 < 7, 7, fvar(11) * 32)), 3
animtype = Hard
air.animtype = back
guardflag = MA
hitflag = MAF
priority = 4, Hit
sparkno = s7030
guard.sparkno = s7000
sparkxy = -10, -33
hitsound = s5,2
guardsound = S6,0
ground.type = High
pausetime = 10,10
guard.slidetime = 15 ;added, but used the value of ground.slidetime
guard.hittime = 20 ;added so he can be punished if guarded
guard.pausetime = 8,5
ground.slidetime = 15
ground.hittime = 26
guard.hittime = 10
guard.slidetime = 15
guard.ctrltime = 20
ground.velocity = -7
air.type = High
air.velocity = -4.6,-6.5
air.hittime = 20
getpower = ifelse(prevstateno != 1520,ifelse(p2movetype=H,40,140),0), ifelse(prevstateno != 1520,35,0)
givepower = 35,35
air.fall = 1
fall.recover = 0
ground.cornerpush.veloff = 0
guard.cornerpush.veloff = 0
air.cornerpush.veloff = 0
yaccel = .5
envshake.time = 14
envshake.ampl = 5
ID = 1550

[State 210, 1]
type = HitDef
triggerall = !movecontact
trigger1 = animelemtime(10) = 0
attr = S, SA
;damage = 28+5*(var(5)=2)+9*(var(5)=3),2+(var(5)=2)+2*(var(5)=3)
damage = ceil(ifElse(fvar(11) * 52 < 7, 7, fvar(11) * 52)), 3
animtype = Hard
air.animtype = back
guardflag = HA
hitflag = MAF
priority = 4, Hit
sparkno = s7030
guard.sparkno = s7000
sparkxy = -10, -33
hitsound = s5,2
guardsound = S6,0
ground.type = High
pausetime = 10,10
guard.slidetime = 15 ;added, but used the value of ground.slidetime
guard.hittime = 20 ;added so he can be punished if guarded
guard.pausetime = 8,5
ground.slidetime = 15
ground.hittime = 24
guard.hittime = 10
guard.slidetime = 15
guard.ctrltime = 20
ground.velocity = -7
air.type = High
air.velocity = -4.6,-6.5
air.hittime = 20
getpower = ifelse(prevstateno != 1520,ifelse(p2movetype=H,40,140),0), ifelse(prevstateno != 1520,35,0)
givepower = 35,35
air.fall = 1
fall.recover = 0
ground.cornerpush.veloff = 0
guard.cornerpush.veloff = 0
air.cornerpush.veloff = 0
yaccel = .5
envshake.time = 14
envshake.ampl = 5
ID = 1550

[State 1502, targetstate]
type = targetstate
triggerall = Numtarget(1550)
triggerall = !(Target, ishelper)
trigger1 = movehit = 1
value = 1550
ID = 1550
ignorehitpause = 1
persistent = 0

[State 1500, changestate]
type = changestate
trigger1 = !animtime
value = 0
ctrl = 1
;---------------------------------------------------------------
;Dragon Blast Upper
[Statedef 1503]
type = S
movetype = A
physics = N
ctrl = 0
anim = 1202
juggle = 2
poweradd = ifelse(prevstateno != 1520,35,0)

[state 1500, autocorrect]
type = velset
triggerall = prevstateno = 1520
triggerall = P2DisT x < 0
trigger1 = time < 3
x = -ceil(Vel X/2)

[state 1500, autocorrect]
type = turn
triggerall = prevstateno = 1520
triggerall = P2DisT x < 0
trigger1 = time < 3

[state 1501, velmul]
type = velmul
trigger1 = Vel X != 0
x = .93

[State 250, 1];Dragon Roar
type = PlaySnd
trigger1 = !time
value = 1100,2


[State 200, woosh]
type = PlaySnd
trigger1 = !time
value = 0, 2


[state 1503, changeanim]
type = changeanim
triggerall = anim = 1202
trigger1 = !animtime
value = 1203

[state 1503, velset]
type = veladd
triggerall = anim = 1203
trigger1 = animelemtime(1) = 0
x = 6
y = -9

[State 4001, ToGround]
type = StateTypeSet
triggerall = anim = 1203
trigger1 = animelemtime(1) = 0
persistent = 0
statetype = A
physics = N

[State 220, snd]
type = playsnd
triggerall = anim = 1203
trigger1 = animelemtime(1) = 0
value = 3,108
channel = 0

[state 1215, Rising Effect]
type = explod
triggerall = anim = 1203
trigger1 = animelemtime(1) = 0
anim = 1216+var(2)
id = 1216
pos = 10,12
postype = P1
sprpriority = -3
ownpal = 1
removetime = -2
persistent = 0
ignorehitpause = 1

[State 6100, snd]
type = playsnd
triggerall = anim = 1203
trigger1 = animelemtime(1) = 0
value = 20,2

[State 4001, Pos]
type = PosAdd
triggerall = anim = 1203
trigger1 = animelemtime(1) = 0
x = 10

[State 4001, Invincible]
type = NotHitBy
trigger1 = (Anim = 1203) && animelemtime(5)<0
trigger2 = anim = 1202 && animelemtime(2) >= 0
value = SCA

[State 4001, 3rd Hit]
type = HitDef
triggerall = anim = 1203
trigger1 = animelemtime(1) = 0
ID = 4001
attr = A, SA
hitflag = MAF
guardflag = MA
animtype = Back
priority = 7, Hit
;damage = 28+5*(var(5)=2)+9*(var(5)=3),2+(var(5)=2)+2*(var(5)=3)
damage = ceil(ifElse(fvar(11) * 32 < 7, 7, fvar(11) * 32))
pausetime = 11,11
sparkno = s7030
guard.sparkno = s7000
sparkxy = -10, -75
hitsound = s5,6
guardsound = s6,0
p2facing = 1
ground.type = High
ground.slidetime = 12
ground.hittime = 80
fall.recovertime = 45
guard.ctrltime = 1
airguard.ctrltime = 1
ground.velocity = -2,-11
air.velocity = -2,-10
airguard.velocity = -3,0
fall = 1
getpower = ifelse(prevstateno != 1520,ifelse(p2movetype=H,40,140),0), ifelse(prevstateno != 1520,35,0)
givepower = 35,35
envshake.time = 16
envshake.freq = 60
envshake.ampl = 4
yaccel = 0.5

[state 1520, lift on block]
type = targetstate
triggerall = Numtarget
trigger1 = !(target,ishelper)
trigger1 = target, statetype != A
trigger1 = moveguarded = 1
value = 1551
ignorehitpause = 1


[State 0, AttackDist]
type = AttackDist
trigger1 = Anim = 1203
trigger1 = AnimElemTime(4) >= 0
trigger2 = Anim = 1204
value = 0

[State 4001, Fall]
type = VelAdd
trigger1 = Anim = 1203
trigger1 = Pos Y < -30
trigger2 = Anim = 1204
Y = .55

[state 1503, ctrlset]
type = ctrlset
trigger1 = Anim = 1204
trigger1 = Pos Y = 0
value = 0

[State 4001, Return&Landing]
type = ChangeAnim
trigger1 = Anim = 1203
trigger1 = Vel Y >= 0.0
trigger2 = Anim = 1204
trigger2 = Pos Y = 0
value = Anim+1

[state 1503, ctrlset]
type = ctrlset
triggerall = movecontact
trigger1 = anim = 1204 && animelemtime(1) = 0
value = 1

[State 100, too cheap]
type = Assertspecial
trigger1 = 1
flag = noairguard

[State 4001, StopFwd]
type = VelSet
trigger1 = Vel X = (0,0.4]
X = 0

[State 4001, Stop]
type = VelSet
trigger1 = Vel Y > abs(Pos Y)
Y = 0

[State 4001, Replace]
type = PosSet
trigger1 = Vel Y = 0
Y = 0

[State 4001, ToGround]
type = StateTypeSet
trigger1 = Anim = 1205
persistent = 0
statetype = S
physics = S

[State 17100, Landing Sound]
type = PlaySnd
trigger1 = anim=1205
value = 40, 0
persistent = 0

[state 17100, Landing Effect]
type=explod
trigger1 = Anim = 1205
anim=17100
id=17100
pos=-15,0
postype=P1
sprpriority=-3
ownpal=1
supermovetime=-1
removetime = -2
persistent = 0

[State 4001, End]
type = ChangeState
trigger1 = Anim = 1205
trigger1 = AnimTime = 0
value = 0
ctrl = 1
;-----------------------------------------------------------------
;Kaioken Dragon Tail
[Statedef 1511]
type = S
movetype = A
physics = N
ctrl = 0
juggle  = 1
poweradd = ifelse(prevstateno != 1520,35,0)
anim = 1511

[state 1500, autocorrect]
type = velset
triggerall = prevstateno = 1520
triggerall = P2DisT x < 0
trigger1 = time < 3
x = -ceil(Vel X/2)

[state 1500, autocorrect]
type = turn
triggerall = prevstateno = 1520
triggerall = P2DisT x < 0
trigger1 = time < 3

[State 250, 1];Dragon Roar
type = PlaySnd
trigger1 = !time
value = 1100,0

[state 1501, velmul]
type = velmul
trigger1 = Vel X != 0
x = .96

[State 200, 1];voice
type = PlaySnd
trigger1= animelem=2
value=3,102+random%3
channel = 0

[State 440, 1]
type = PlaySnd
trigger1 = AnimElem = 5
value = 0, 4

[State 440, 2]
type = HitDef
triggerall = !NumTarget(440)
trigger1 = AnimElemtime(6) = 0 || animelemtime(16) = 0
attr = C, SA
;damage = 26+7*var(37),0
damage = ceil(ifElse(fvar(11) * 20 < 7, 7, fvar(11) * 20)), 3
animtype  = Medium
hitflag = MAFD
guardflag = L
pausetime = 3,3
guard.pausetime = 3,3
sparkno = s7020
guard.sparkno = s7000
sparkxy = -20,-10
hitsound   = s5,4
guardsound = S6,0
ground.type = Low
ground.slidetime = 12;8
ground.hittime  = 19;8
ground.velocity = -3,0
guard.velocity = -6
air.type = Low
air.velocity = -2,-3
down.velocity = -3,0 ;-3,-1 
down.hittime = 12
down.cornerpush.veloff = -16
air.cornerpush.veloff = 0
envshake.time = 9
envshake.freq = 60
envshake.ampl = 3
getpower= ifelse(prevstateno != 1520,ifelse(p2movetype=H,20,120),0), ifelse(prevstateno != 1520,15,0)
givepower = 35,35
;fall.recover = 0
air.animtype = back
air.hittime = 4
yaccel = 0.5


[State 440, 2]
type = HitDef
triggerall = !NumTarget(440)
trigger1 = animelemtime(26) = 0
attr = C, SA
;damage = 26+7*var(37),0
damage = ceil(ifElse(fvar(11) * 28 < 10, 10, fvar(11) * 28)), 3
animtype  = Medium
hitflag = MAFD
guardflag = L
pausetime = 9,10
guard.pausetime = 9,9
sparkno = s7030
guard.sparkno = s7000
sparkxy = -20,-10
hitsound   = s5,5
guardsound = S6,0
ground.type = Trip
ground.slidetime = 12;8
ground.hittime  = 19;8
ground.velocity = -1,-10
fall.recover = 0
guard.velocity = -10
air.type = Trip
air.velocity = -1,-6
down.velocity = -3,0 ;-3,-1 
down.hittime = 12
down.cornerpush.veloff = -16
air.cornerpush.veloff = 0
envshake.time = 9
envshake.freq = 60
envshake.ampl = 3
getpower= ifelse(prevstateno != 1520,ifelse(p2movetype=H,40,140),0), ifelse(prevstateno != 1520,35,0)
givepower = 35,35
fall = 1
fall.recover = 0
air.animtype = back
air.hittime = 4
yaccel = 0.5
ID = Cond(P2StateType = L,440,1098)


[State 0, AttackDist]
type = AttackDist
;trigger1 = Anim = 200
trigger1 = AnimElemTime(27) >= 0
value = 0

[State 1500, changestate]
type = changestate
trigger1 = !animtime
value = 11+(!NumExplod(90000001) && !NumExplod(90000002) && !NumExplod(90000003))
ctrl = 1
;--------------------------------------------------------------------------------
;Kaioken Dragon Fist
[Statedef 1512]
type = S
movetype = A
physics = N
ctrl = 0
juggle = 0
poweradd = ifelse(prevstateno != 1520,35,0)
anim = 1250

[state 1500, autocorrect]
type = velset
triggerall = prevstateno = 1520
triggerall = P2DisT x < 0
trigger1 = time < 3
x = -ceil(Vel X/2)

[state 1500, autocorrect]
type = turn
triggerall = prevstateno = 1520
triggerall = P2DisT x < 0
trigger1 = time < 3

[state 1501, velmul]
type = velmul
trigger1 = Vel X != 0
x = .93

[State -2, Width]
type = null
trigger1 = animelemtime(2)>=0 && animelemtime(13) <= 0
value = -12,12

[State 220, snd]
type = playsnd
trigger1 = animelem = 8
value = 3,106
channel = 0

[State 250, 1];Dragon Roar
type = PlaySnd
trigger1 = AnimElem = 8
value = 1100,1


[State 200, woosh]
type = PlaySnd
trigger1 = animelem = 1
value = 0, 2


[State -2, Accel]
type = PosAdd
trigger1 = animelemtime(2)=0
trigger2 = animelemtime(12) = 0
trigger3 = animelemtime(22) = 0
x = 15



[State 200, Aura SFX]
type = PlaySnd
trigger1 = animelemtime(7) = 0
trigger2 = animelemtime(17) =0
trigger3 = animelemtime(27) = 0
value = 300,0
[State 200, Burst Aura SFX]
type = PlaySnd
trigger1 = animelemtime(7) = 0
trigger2 = animelemtime(17) = 0
trigger3 = animelemtime(27) = 0
value = 300,1

[state 1215, FX front]
type = null
trigger1 = !time
stateno = 150100
id = 150100
pos = 0,0
postype = P1
sprpriority = 3
ownpal = 1
persistent = 0


[State -2, Accel]
type = PosAdd
trigger1 = animelemtime(7)=0
trigger2 = animelemtime(17) = 0
trigger3 = animelemtime(27) = 0
x = 20

[State -2, Accel]
type = PosAdd
trigger1 = animelemtime(11)=0
trigger2 = animelemtime(21) = 0
trigger3 = animelemtime(31) = 0
x = 20

[State -2, Accel]
type = PosAdd
trigger1 = animelemtime(32) = 0
x = 16

[State 200, 1]
type = PlaySnd
trigger1 = animelem = 5
value = 20,0

[State 0, AttackDist]
type = AttackDist
;trigger1 = Anim = 200
trigger1 = AnimElemTime(11) >= 0
value = 0


[State 210, 1]
type = HitDef
triggerall = cond(movecontact < 1, 1, movecontact > 10)
triggerall = enemy,statetype != C
trigger1 = animelemtime(8) = 0 || animelemtime(18) = 0 || animelemtime(28) = 0
attr = S, SA
;damage = 28+5*(var(5)=2)+9*(var(5)=3),2+(var(5)=2)+2*(var(5)=3)
damage = ceil(ifElse(fvar(11) * 15 < 4, 4, fvar(11) * 15)), 3
animtype = Hard
air.animtype = back
guardflag = MA
hitflag = MAF
priority = 4, Hit
sparkno = s7030
guard.sparkno = s7000
sparkxy = -10, -33
hitsound = s5,2
guardsound = S6,0
ground.type = High
pausetime = 3,3
guard.slidetime = 15 ;added, but used the value of ground.slidetime
guard.hittime = 20 ;added so he can be punished if guarded
guard.pausetime = 8,5
ground.slidetime = 15
ground.hittime = 26
guard.hittime = 10
guard.slidetime = 15
guard.ctrltime = 20
ground.velocity = -4
air.type = High
air.velocity = -4.6,-6.5
air.hittime = 20
getpower = ifelse(prevstateno != 1520,ifelse(p2movetype=H,40,140),0), ifelse(prevstateno != 1520,35,0)
givepower = 35,35
air.fall = 1
fall.recover = 0
ground.cornerpush.veloff = 0
guard.cornerpush.veloff = 0
air.cornerpush.veloff = 0
yaccel = .5
envshake.time = 14
envshake.ampl = 5
ID = 1550

[State 210, 1]
type = HitDef
triggerall = cond(movecontact < 1, 1, movecontact > 10)
trigger1 = animelemtime(10) = 0 || animelemtime(20) = 0 || animelemtime(30) = 0
attr = S, SA
;damage = 28+5*(var(5)=2)+9*(var(5)=3),2+(var(5)=2)+2*(var(5)=3)
damage = ceil(ifElse(fvar(11) * 15 < 4, 4, fvar(11) * 15)), 3
animtype = Hard
air.animtype = back
guardflag = HA
hitflag = MAF
priority = 4, Hit
sparkno = s7030
guard.sparkno = s7000
sparkxy = -10, -33
hitsound = s5,2
guardsound = S6,0
ground.type = High
pausetime = 3,3
guard.slidetime = 15 ;added, but used the value of ground.slidetime
guard.hittime = 20 ;added so he can be punished if guarded
guard.pausetime = 8,5
ground.slidetime = 15
ground.hittime = 24
guard.hittime = 10
guard.slidetime = 15
guard.ctrltime = 20
ground.velocity = -4
air.type = High
air.velocity = -4.6,-6.5
air.hittime = 20
getpower = ifelse(prevstateno != 1520,ifelse(p2movetype=H,40,140),0), ifelse(prevstateno != 1520,35,0)
givepower = 35,35
air.fall = 1
fall.recover = 0
ground.cornerpush.veloff = 0
guard.cornerpush.veloff = 0
air.cornerpush.veloff = 0
yaccel = .5
envshake.time = 14
envshake.ampl = 5
ID = 1550

[State 1502, targetstate]
type = targetstate
triggerall = Numtarget(1550)
triggerall = !(Target, ishelper)
trigger1 = movehit = 1
value = 1550
ID = 1550
ignorehitpause = 1
persistent = 0

[State 1500, changestate]
type = changestate
trigger1 = !animtime
value = 0
ctrl = 1
;---------------------------------------------------------------
;Kaioken Dragon Blast Upper
[Statedef 1513]
type = S
movetype = A
physics = N
ctrl = 0
anim = 1513
juggle = 2
poweradd = ifelse(prevstateno != 1520,35,0)

[state 1500, autocorrect]
type = velset
triggerall = prevstateno = 1520
triggerall = P2DisT x < 0
trigger1 = time < 3
x = -ceil(Vel X/2)

[state 1500, autocorrect]
type = turn
triggerall = prevstateno = 1520
triggerall = P2DisT x < 0
trigger1 = time < 3

[state 1501, velmul]
type = velmul
trigger1 = Vel X != 0
x = .93

[State 250, 1];Dragon Roar
type = PlaySnd
trigger1 = !time
value = 1100,2


[State 200, woosh]
type = PlaySnd
trigger1 = !time
value = 0, 2

[state 1503, velset]
type = veladd
triggerall = anim = 1513
trigger1 = animelemtime(3) = 0
trigger2 = animelemtime(9) = 0
trigger3 = animelemtime(15) = 0
x = 3
y = -9

[State 4001, ToGround]
type = StateTypeSet
triggerall = anim = 1513
trigger1 = animelemtime(3) = 0
trigger2 = animelemtime(9) = 0
trigger3 = animelemtime(15) = 0
statetype = A
physics = N

[State 220, snd]
type = playsnd
triggerall = anim = 1513
trigger1 = animelemtime(3) = 0
value = 3,108
channel = 0

[state 1215, Rising Effect]
type = explod
triggerall = anim = 1513
trigger1 = animelemtime(3) = 0
trigger2 = animelemtime(9) = 0
trigger3 = animelemtime(15) = 0
anim = 1216+var(2)
id = 1216
pos = 10,12
postype = P1
sprpriority = -3
ownpal = 1
removetime = -2
ignorehitpause = 1


[State 6100, snd]
type = playsnd
triggerall = anim = 1513
trigger1 = animelemtime(3) = 0
trigger2 = animelemtime(9) = 0
trigger3 = animelemtime(15) = 0
value = 20,2

[State 4001, Pos]
type = PosAdd
triggerall = anim = 1513
trigger1 = animelemtime(3) = 0
trigger2 = animelemtime(9) = 0
trigger3 = animelemtime(15) = 0
x = 10

[State 4001, Invincible]
type = NotHitBy
trigger1 = time < 13
value = SCA

[State 4001, 3rd Hit]
type = HitDef
triggerall = anim = 1513
trigger1 = animelemtime(3) = 0
trigger2 = animelemtime(9) = 0
trigger3 = animelemtime(15) = 0
attr = A, SA
hitflag = MAF
guardflag = MA
animtype = Back
priority = 7, Hit
;damage = 28+5*(var(5)=2)+9*(var(5)=3),2+(var(5)=2)+2*(var(5)=3)
damage = ceil(ifElse(fvar(11) * 30 < 10, 10, fvar(11) * 30))
pausetime = 3,3
sparkno = s7030
guard.sparkno = s7000
sparkxy = -10, -75
hitsound = s5,6
guardsound = s6,0
p2facing = 1
ground.type = High
ground.slidetime = 12
ground.hittime = 80
fall.recovertime = 45
guard.ctrltime = 3
ground.velocity = -2,-4
air.velocity = -2,-8
airguard.velocity = -3,0
fall = 1
getpower = ifelse(prevstateno != 1520,ifelse(p2movetype=H,15,115),0), ifelse(prevstateno != 1520,15,0)
givepower = 35,35
envshake.time = 16
envshake.freq = 60
envshake.ampl = 4
yaccel = 0.5
ID = cond(animelemtime(13) < 0, 4001, 1551)


[state 1520, lift on block]
type = targetstate
triggerall = Numtarget(1551)
trigger1 = !(target,ishelper)
trigger1 = target, statetype != A
trigger1 = moveguarded = 1
value = 1551
ignorehitpause = 1

[State 0, AttackDist]
type = AttackDist
trigger1 = Anim = 1513
trigger1 = AnimElemTime(18) = 0
value = 0

[state 0, teleport]
type = velset
triggerall = anim = 1513
trigger1 = animelemtime(7) = 0
trigger2 = animelemtime(13) = 0
y = 0

[state 0, teleport] 
type = posset
triggerall = anim = 1513
trigger1 = animelemtime(7) = 0
trigger2 = animelemtime(13) = 0
y = 0


[state 1513, teleport]
type = statetypeset
triggerall = anim = 1513
trigger1 = animelemtime(7) = 0
trigger2 = animelemtime(13) = 0
statetype = S

[state 52, Fake]
type = helper
triggerall = anim = 1513
trigger1 = animelemtime(6) = 0
trigger2 = animelemtime(12) = 0
name = "Fake"
helpertype = normal
pos = 0,0
stateno = 15130
id = 15130
postype = P1
ownpal = 1
keyctrl = 0
supermovetime = 99999
pausemovetime = 99999

[state 1520, reappear]
type = trans
trigger1 = animelemtime(7) >= 0 && animelemtime(12) < 0 ;Second Loop
trans = addalpha
alpha = (animelemtime(7))*30,256-(animelemtime(7))*30

[state 1520, reappear second time]
type = trans
trigger1 = animelemtime(13) >= 0 && animelemtime(22) < 0 ;Third Loop 
trans = addalpha
alpha = (animelemtime(13))*30,256-(animelemtime(13))*30

[State 4001, Fall]
type = VelAdd
triggerall = Anim = 1513 
triggerall = Pos Y < -30
trigger1 = animelemtime(6) < 0 ;First Loop 
trigger2 = animelemtime(7) >= 0 && animelemtime(12) < 0 ;Second Loop
trigger3 = animelemtime(13) >= 0 && animelemtime(22) < 0 ;Third Loop 
trigger4 = Anim = 1513 && animelemtime(22) >= 0
Y = .55

[State 4001, Fall]
type = VelAdd
trigger1 = anim = 1204
Y = .55

[state 1503, ctrlset]
type = ctrlset
trigger1 = anim = 1204 
trigger1 = Pos Y = 0
value = 0


[state 1513, Return]
type = changeanim
trigger1 = vel y > 0
trigger1 = Anim = 1513 && animelemtime(22) >= 0
value = 1204

[State 4001, Landing]
type = ChangeAnim
trigger1 = pos y >= 0 && vel y > 0
trigger1 = anim = 1204
value = 1205

[state 1503, ctrlset]
type = ctrlset
triggerall = movecontact
trigger1 = anim = 1204 && animelemtime(1) = 0
value = 1

[State 100, too cheap]
type = Assertspecial
trigger1 = 1
flag = noairguard

[State 4001, StopFwd]
type = VelSet
trigger1 = Vel X = (0,0.4]
X = 0

[State 4001, Stop]
type = VelSet
trigger1 = Vel Y > abs(Pos Y)
Y = 0

[State 4001, Replace]
type = PosSet
trigger1 = Vel Y = 0
Y = 0

[State 4001, ToGround]
type = StateTypeSet
trigger1 = Anim = 1205
persistent = 0
statetype = S
physics = S

[State 17100, Landing Sound]
type = PlaySnd
trigger1 = anim=1205
value = 40, 0
persistent = 0

[state 17100, Landing Effect]
type=explod
trigger1 = Anim = 1205
anim=17100
id=17100
pos=-15,0
postype=P1
sprpriority=-3
ownpal=1
supermovetime=-1
removetime = -2
persistent = 0

[State 4001, End]
type = ChangeState
trigger1 = Anim = 1205
trigger1 = AnimTime = 0
value = 0
ctrl = 1
;--------------------------------------------------
;Ex Dragon Rush
[Statedef 1520]
type = S
movetype = A
physics = N
ctrl = 0
velset = 0,0
poweradd = -500
anim = 1520

[state 1100, varset]
type = varset
trigger1 = !time
var(39) =2

[state 1603, input buffer]
type = varset
trigger1 = !time
var(4) = 0

[State 6100, snd]
type = playsnd
trigger1 = !time
value = 7,0
channel = 1

[State 8000, flash]
type = PalFX
trigger1 = anim = 1520
add = 40, 30, -40
time=1
ignorehitpause = 1


[state 1520, attackdist]
type = attackdist
trigger1 = 1
value = 0

[state 52, Fake]
type = helper
triggerall = anim = 1520
trigger1 = animelemtime(5) = 0
name = "Fake"
helpertype = normal
stateno = 15200
id = 15200
postype = P1
ownpal = 1
keyctrl = 0
supermovetime = 99999
pausemovetime = 99999

[State 100, steps]
type = playsnd
trigger1 =  anim = 1520 && animelemtime(6) = 0
value = 1500,0

[state 1520, playerpush]
type = playerpush
trigger1 = anim = 1520 && animelemtime(6) >= 0
trigger1 = p2bodydist x > -35
value = 0

[State -2, Width]
type = Width
trigger1 = anim = 1520 && animelemtime(6) >= 0
trigger1 = p2bodydist x < -35
value = -12,12

[State 0, Helper]
type = Helper
triggerall = !IsHelper
trigger1 = AnimElemTime(6) >= 0
trigger1 = P2Dist X = [-40,40]
trigger1 = enemynear, backedgebodydist <= 20
name = "Push"
ID = 15220
stateno = 15220

[state 1520, velset]
type = velset
triggerall = anim = 1520
trigger1 = animelemtime(6) = 0
x = 16


[state 1520, posadd]
type = posadd
triggerall = anim = 1520
trigger1 = animelemtime(6) = 0
x = -25


[state 1520, reappear]
type = trans
triggerall = var(39) = 1
triggerall = (time-10)*30 <= 256
trigger1 = anim = 1520 && animelemtime(6) >= 0
trigger2 = anim = 1500
trans = addalpha
alpha = (time-10)*30,256-(time-10)*30

[state 1520, reappear]
type = trans
triggerall = var(39) = 2
triggerall = (time-10)*20 <= 256
trigger1 = anim = 1520 && animelemtime(6) >= 0
trigger2 = anim = 1500
trans = addalpha
alpha = (time-10)*20,256-(time-10)*20

[state 1520, reappear]
type = trans
triggerall = var(39) >= 3
triggerall = (time-10)*15 <= 256
trigger1 = anim = 1520 && animelemtime(6) >= 0
trigger2 = anim = 1500
trans = addalpha
alpha = (time-10)*15,256-(time-10)*15

[state 1520, new stop]
type = changeanim
triggerall = anim = 1520
trigger1 = p2bodydist x <= -35
trigger2 = time = 70
value = 1500

[State 100, snd]
type = playsnd
triggerall = anim = 1500
trigger1 = animelem = 1
value = 5,8
persistent = 0

[state 1500, velmul]
type = velmul
trigger1 = anim = 1500
x = .80

[state 1603, tail input buffer]
type = varset
triggerall = !AIlevel
triggerall = command = "x"
trigger1 = time > 7 && p2dist x < 150
var(4) = 1

[state 1603, fist input buffer]
type = varset
triggerall = !AIlevel
triggerall = command = "y"
trigger1 = time > 7 && p2dist x < 150
var(4) = 2

[state 1603, upper input buffer]
type = varset
triggerall = !AIlevel
triggerall = command = "z"
triggerall = time > 7
trigger1 = p2dist x < 150
var(4) = 3

;Dragon Tail
[State -1, Dragon Tail]
type = ChangeState
triggerall= !AIlevel
triggerall = command = "x" || var(4) = 1
triggerall = time > 20
trigger1 = p2bodydist x < -35 
trigger2 = time = 50
value = cond(var(43) = 0, 1501, 1511) ;Normal vs Kaioken

;Dragon Tail
[State -1, Dragon Tail]
type = ChangeState
triggerall= AIlevel
triggerall = anim != 1500
triggerall = time > 20
;trigger1 = random < 255 * (AIlevel ** 2 / 64.0)
trigger1 = P2BodyDist X < -35
trigger1 = (P2StateNo = [120,155]) && P2StateType = S
value = cond(var(43) = 0, 1501, 1511)

;Dragon Fist
[State -1, Dragon Fist]
type = ChangeState
triggerall= !AIlevel
triggerall = command = "y" || var(4) = 2
triggerall = time > 20
trigger1 = p2bodydist x < -35
trigger2 = time = 50
value = cond(var(43) = 0, 1502, 1512) ;Normal vs Kaioken

;Dragon Fist
[State -1, Dragon Fist]
type = ChangeState
triggerall= AIlevel
triggerall = anim != 1500
triggerall = time > 20
trigger1 = p2bodydist x < -35 
;trigger1 = random < 355 * (AIlevel ** 2 / 64.0)
trigger1 = (P2StateNo = [120,155]) && P2StateType = C
trigger2 = p2bodydist x < -35 
;trigger2 = random < 255 * (AIlevel ** 2 / 64.0)
trigger2 = (P2StateNo != [120,155]) && P2StateType != A
value = cond(var(43) = 0, 1502, 1512) ;Normal vs Kaioken

;Dragon Blast Upper
[State -1, Dragon Blast]
type = ChangeState
triggerall= !AIlevel
triggerall = command= "z" || var(4) = 3
triggerall = time > 20 
trigger1 = p2bodydist x < -35
trigger2 = time = 50
value = cond(var(43) = 0, 1503, 1513) ;Normal vs Kaioken

;Dragon Blast Upper
[State -1, Dragon Blast]
type = ChangeState
triggerall= AIlevel
triggerall = anim != 1500
triggerall = time > 20 
trigger1 = p2bodydist x < -35
;trigger1 = random < 355 * (AIlevel ** 2 / 64.0)
trigger1 = (P2StateNo != [120,155]) && P2StateType = A
;trigger2 = random < 355 * (AIlevel ** 2 / 64.0)
trigger2 = p2bodydist x < -35
trigger2 = (P2StateNo != [120,155]) && P2StateType != A
value = cond(var(43) = 0, 1503,1513)


[State 1500, changestate]
type = changestate
triggerall = anim = 1500
trigger1 = !animtime
value = 0
ctrl = 1
;----------------------------
;Hit by Dragon Fist
[statedef 1550]
type = C
movetype = H
physics = C
ctrl = 0


[state 1060, changestate]
type = selfstate
trigger1 = !time
value = 5010

;-------------------------------------------------------
;Blocked Dragon Blast Upper
[statedef 1551]
type = A
movetype = H
physics = N
ctrl = 0
velset = 0,0

[state 1551, muteki]
type = nothitby
trigger1 = 1
value = SCA


[State 154, ChangeAnim]
type = ChangeAnim
trigger1 = 1
value = 152
 
[State 154, End]
type = ChangeState
trigger1 = HitShakeOver
value = 1552

;Knocked Back while Guarding (Jumping)
[StateDef 1552]
type = A
moveType = H
physics = N
anim = 152

[state 1551, muteki]
type = nothitby
trigger1 = 1
value = SCA
 
[State 155, HitVelSet]
type = VelSet
trigger1 = !Time
x = -1
y = -11
 
[State 155, VelAdd]
type = VelAdd
trigger1 = 1
y = const(movement.yAccel)
 
[State 155, CtrlSet]
type = Selfstate
trigger1 = time = 15
value = 155
;------------------------------------------------------------------
;Turtle Flip
[Statedef 1600]
type = S
movetype = A
physics = N
anim = 1600
ctrl = 0
velset = 0,0


[State 41, Train]
type = AfterImage
triggerall = var(43) = 0
trigger1 = Time = 0
time= 20
timegap= 1
framegap= 2
length= 12
palbright= 0,0,0
paladd= 0,0,0
palmul= .9,.9,.9
palcontrast= 120,120,120
palpostbright= 0,0,0
trans= add1

[state 1100, varset]
type = varset
triggerall = !AILEVEL
trigger1 = !time
var(39) = cond(NumExplod(90000230) || NumExplod(90000235),1,cond(NumExplod(90000240)|| NumExplod(90000245),2,3))

[state 1100, varset]
type = varset
triggerall = AILEVEL
trigger1 = !time
var(39) =Cond(P2BodyDist X > 90,2, Cond(P2BodyDist X > 170,3,1))

[state 1603, varset]
type = varset
triggerall = var(4) = 1
trigger1 = !time
var(4) = 0

[state 1500, attackdist]
type = attackdist
trigger1 = 1
value = 0

[state 1600, changeanim]
type = changeanim
triggerall = anim = 1600
trigger1 = !animtime
value = 1601

[state 1600, start leap]
type = statetypeset
triggerall = anim = 1601
trigger1 = animelemtime(1) = 0
statetype = A

[state 1600, start leap]
type = velset
triggerall = var(39) = 1
trigger1= anim = 1601
trigger1 = animelemtime(1) = 0
x = 3
y = -10

[state 1600, start leap]
type = velset
triggerall = var(39) = 2
trigger1= anim = 1601
trigger1 = animelemtime(1) = 0
x = 5
y = -10

[state 1600, start leap]
type = velset
triggerall = var(39) >= 3
trigger1= anim = 1601
trigger1 = animelemtime(1) = 0
x = 7
y = -10

[state 1600, leap sound]
type = playsnd
trigger1= anim = 1601
trigger1 = animelemtime(1) = 0
value = 1600,4+ifelse(var(39) <= 3,var(39),3)

[state 1600, gravity]
type = veladd
trigger1 = pos y < 0
y = .55

[state 1600, changeanim]
type = null
triggerall = anim = 1601
trigger1 = vel y > 0
value = 1602

[state 1600, changeanim]
type = changeanim
triggerall = anim != 1205
trigger1 = pos y >= 0 && vel y > 0
value = 1205

[state 1600, velset]
type = velset
trigger1 = anim = 1205
y = 0

[state 1600, posset]
type = posset
trigger1 = pos y > 0
y = 0

[State 4001, ToGround]
type = StateTypeSet
trigger1 = Anim = 1205
persistent = 0
statetype = S
physics = S

[State 17100, Landing Sound]
type = PlaySnd
trigger1 = anim=1205
value = 40, 0
persistent = 0

[state 17100, Landing Effect]
type=explod
trigger1 = Anim = 1205
anim=17100
id=17100
pos=-15,0
postype=P1
sprpriority=-3
ownpal=1
supermovetime=-1
removetime = -2
persistent = 0

[state 1603, divekick buffer]
type = varset
triggerall = !AILevel
triggerall = var(4) = 0
trigger1 = NumExplod(90000001) || NumExplod(90000002) || NumExplod(90000003) 
trigger1 = (command = "a" || command = "b" || command = "c") 
var(4) = 1

;DiveKick
[State -1,DiveKick]
type = ChangeState
triggerall= !AIlevel
triggerall = NumExplod(90000001) || NumExplod(90000002) || NumExplod(90000003) || var(4) = 1
triggerall = (command = "a" || command = "b" || command = "c") || var(4) = 1
triggerall = (anim = 1601 || anim = 1602)
trigger1 = pos y < -60 || vel y >= 0
value = 1601

;DiveKick
[State -1,DiveKick]
type = ChangeState
triggerall= AIlevel
triggerall = random < 145 * (AIlevel ** 2 / 64.0) 
triggerall = (anim = 1601 || anim = 1602)
triggerall = pos y < -60 || vel y >= 0
trigger1 = P2BodyDist X = [-30,70]
trigger1 = P2StateType = C
trigger1 = (P2StateNo != [120,155]) 
value = 1601

;Flip Kick
[State -1, Flip Kick]
type = ChangeState
triggerall= !AIlevel
triggerall = (!NumExplod(90000001) && !NumExplod(90000002) && !NumExplod(90000003))
triggerall = command = "a" || command = "b" || command = "c"
trigger1 = (anim = 1601 || anim = 1602)
value = cond(var(43) = 0, 1602, 1612)

;Flip Kick
[State -1, Flip Kick]
type = ChangeState
triggerall= AIlevel
triggerall = random < 145 * (AIlevel ** 2 / 64.0) 
triggerall = (anim = 1601 || anim = 1602)
trigger1 = P2BodyDist X = [-30,70]
trigger1 = P2StateType = A
trigger1 = (P2StateNo != [120,155]) 
value = cond(var(43) = 0, 1602, 1612)

;Bite
[State -1, Bite]
type = ChangeState
triggerall= !AIlevel
triggerall = command = "x" || command = "y" || command = "z"
trigger1 = (anim = 1601 || anim = 1602)
value = cond(var(43) = 0, 1603, 1613)

;Bite
[State -1, Bite]
type = ChangeState
triggerall = random < 145 * (AIlevel ** 2 / 64.0) 
triggerall = (anim = 1601 || anim = 1602)
triggerall = (P2BodyDist X = [0,50]) && (P2BodyDist Y = [-40,50])
trigger1 = P2StateType != C
trigger1 = (P2StateNo != [120,155]) 
value = cond(var(43) = 0, 1603, 1613)


[state 1600, changestate]
type = changestate
triggerall = anim = 1205
trigger1 = !animtime
value = 0
ctrl = 1 
;-----------------------------------------------------------------
;Turtle Slash Down Kick
[Statedef 1601]
type = A
physics = N
movetype = A
anim = 1100
velset = 0,0
ctrl = 0
poweradd = 35
sprpriority = -1

[State 282, vel];45
type = velset
trigger1 = animelemtime(6)>0
x = 8.4
y = 9.6

[State 220, snd]
type = playsnd
trigger1 = animelem = 5
value = 3,108
channel = 0

[State 250, 1];Dragon Roar
type = PlaySnd
trigger1 = AnimElem = 4
value = 1100,0

[State 250, 1]
type = PlaySnd
trigger1 = AnimElem = 6
value = 21,1

[State 282, hit]
type = hitdef
triggerall = !NumTarget(440)
trigger1 = !movecontact && !movereversed
attr = A,SA
;damage = 61,8
damage = ceil(ifElse(fvar(11) * 61 < 7, 7, fvar(11) * 61)), 8
animtype = Hard
guardflag = HA
hitflag = MAFD
priority = 4,Hit
pausetime = 11,12 ;12,12 for winM, 11,12 for 1.0
sparkno = s7030
guard.sparkno = s7000
sparkxy = 0,-18
hitsound = s5,5
guardsound = S6,0
ground.type = High
guard.slidetime = 15 
guard.hittime = 6
ground.hittime = 15;17
ground.slidetime = 15;17
ground.velocity = -4, 0
ground.cornerpush.veloff = -8
guard.velocity = -7.5
guard.cornerpush.veloff = -10
air.type = Low
air.velocity = -3,floor(vel Y/2)
down.hittime = 24
down.velocity = 0,0
air.cornerpush.veloff = 0
getpower = ifelse(p2movetype=H,40,140), 35
givepower = 35,35
yaccel = .5
airguard.velocity = -8, -1.5
airguard.cornerpush.veloff = 0
air.fall = 1
fall.recovertime = 30
ID = Cond(P2StateType = L,440,1098)

[state 3000, veladd]
type = posadd
trigger1 = movecontact = 1
trigger1 = var(43) > 0
x = 30


[state 3000, playerpush]
type = playerpush
trigger1 = movecontact
trigger1 = var(43) > 0
value = 0

[state 3000, transperancy]
type = trans
trigger1 = movecontact
trigger1 = var(43) > 0
trans = addalpha
alpha = 127,127


[State 282, end]
type = changestate
trigger1 = pos y>=0 && vel y > 0
value = 52

;-------------------------------------------------------------------
;Flip Kick
[Statedef 1602]
type = A
movetype = A
physics = N
anim = 1603
ctrl = 0
juggle = 2


[state 1600, gravity]
type = veladd
trigger1 = pos y < 0
y = .55

[state 16.01, velset]
type = velset
trigger1 = animelemtime(4) = 0
y = -9

[State 250, woosh]
type = PlaySnd
trigger1 = AnimElem = 4
value = 0,5

[State 210, 1]
type = HitDef
trigger1 = animelemtime(5) = 0
attr = A, SA
;damage = 28+5*(var(5)=2)+9*(var(5)=3),2+(var(5)=2)+2*(var(5)=3)
damage = ceil(ifElse(fvar(11) * 52 < 7, 7, fvar(11) * 52)), 3
animtype = Hard
air.animtype = back
guardflag = HA
hitflag = MAF
priority = 4, Hit
sparkno = s7030
guard.sparkno = s7000
sparkxy = -10, -33
hitsound = s5,5
guardsound = S6,0
ground.type = High
pausetime = 9,9
guard.slidetime = 15 
guard.hittime = 20 
guard.pausetime = 8,5
ground.slidetime = 15
ground.hittime = 24
guard.hittime = 10
guard.slidetime = 15
guard.ctrltime = 20
ground.velocity = -Vel X,-13
air.type = High
air.velocity = -Vel X,-13
air.hittime = 20
getpower = ifelse(p2movetype=H,40,140), 0
givepower = 35,35
fall = 1
fall.recover = 0
ground.cornerpush.veloff = 0
guard.cornerpush.veloff = 0
air.cornerpush.veloff = 0
yaccel = .5
envshake.time = 14
envshake.ampl = 5

[state 1602, block fix]
type = attackdist
trigger1 = animelemtime(6) >= 0
value = 0

[State 282, end]
type = changestate
trigger1 = pos y>=0 && vel y > 0
value = 52

[state 1601, changestate]
type = ctrlset
trigger1 = animelemtime(8) = 0 && movecontact
value = 1
;-------------------------------------------------------------------
;Primal Intinct
[Statedef 1603]
type = A
movetype = A
physics = N
anim = 1604
ctrl = 0

[state 1613, varset]
type = varset
trigger1 = !time
var(4) = 0


[state 1500, attackdist]
type = attackdist
trigger1 = 1
value = 0

[state 1600, gravity]
type = veladd
trigger1 = pos y < 0
y = .55


[State 282, hit]
type = hitdef
triggerall = p2movetype = H
triggerall = p2stateno != [150,155]
triggerall = !movecontact
trigger1 = !time
attr = A,ST
;damage = 61,8
damage = 0, 0
animtype = Hard
hitflag = MAF
guardflag = MA
priority = 4,Hit
pausetime = 1,1 
sparkno = -1
guard.sparkno = -1
sparkxy = 0,-18
hitsound = s800,1
guardsound = S6,0
ground.type = Low
guard.slidetime = 15 
guard.hittime = 1 
ground.hittime = 15;17
ground.slidetime = 15;17
ground.velocity = -4, 0
ground.cornerpush.veloff = -8
guard.velocity = -7.5
guard.cornerpush.veloff = -10
air.type = Low
air.velocity = -3,floor(vel Y/2)
down.hittime = 24
numhits = 0
down.velocity = 0,0
air.cornerpush.veloff = 0
getpower = ifelse(p2movetype=H,40,140), 35
givepower = 35,35
yaccel = .5
airguard.velocity = -8, -1.5
airguard.cornerpush.veloff = 0
air.fall = 1
fall.recovertime = 30

[State 282, hit]
type = hitdef
triggerall = p2movetype != H 
triggerall = anim = 1604 && animelemtime(1) = 0
triggerall = !movecontact
trigger1 = vel y < 0 || p2statetype = C
attr = A,ST
;damage = 61,8
damage = 0, 0
animtype = Hard
hitflag = AF-
priority = 4,Miss
pausetime = 1,1 
sparkno = -1
guard.sparkno = -1
sparkxy = 0,-18
hitsound = s800,1
guardsound = S6,0
ground.type = Low
guard.slidetime = 15 
guard.hittime = 1 
ground.hittime = 15;17
ground.slidetime = 15;17
ground.velocity = -4, 0
ground.cornerpush.veloff = -8
guard.velocity = -7.5
guard.cornerpush.veloff = -10
numhits = 0
air.type = Low
air.velocity = -3,floor(vel Y/2)
down.hittime = 24
down.velocity = 0,0
air.cornerpush.veloff = 0
getpower = ifelse(p2movetype=H,40,140), 35
givepower = 35,35
yaccel = .5
airguard.velocity = -8, -1.5
airguard.cornerpush.veloff = 0
air.fall = 1
fall.recovertime = 30


[State 282, hit]
type = hitdef
triggerall = p2movetype != H 
triggerall = anim = 1604 && animelemtime(1) = 0
triggerall = !movecontact
trigger1 = vel y >= 0 && var(4) = 0 && p2statetype != C
attr = A,ST
;damage = 61,8
damage = 0, 0
animtype = Hard
hitflag = MAF-
priority = 4,Miss
pausetime = 1,1
sparkno = -1
guard.sparkno = -1
sparkxy = 0,-18
hitsound = s800,1
guardsound = S6,0
ground.type = Low
guard.slidetime = 15 
guard.hittime = 1 
ground.hittime = 15;17
ground.slidetime = 15;17
ground.velocity = -4, 0
ground.cornerpush.veloff = -8
guard.velocity = -7.5
numhits = 0
guard.cornerpush.veloff = -10
air.type = Low
air.velocity = -3,floor(vel Y/2)
down.hittime = 24
down.velocity = 0,0
air.cornerpush.veloff = 0
getpower = ifelse(p2movetype=H,40,140), 35
givepower = 35,35
yaccel = .5
airguard.velocity = -8, -1.5
airguard.cornerpush.veloff = 0
fall = 1
fall.recovertime = 30

[state 1605, hit]
type = targetstate
triggerall = Numtarget
triggerall = !(target,ishelper)
trigger1 = movehit = 1
value = 1650
ignorehitpause = 1

[state 1604, bindtotarget]
type = targetbind
triggerall = Numtarget
triggerall = !(target,ishelper)
trigger1 = movehit = 1
pos = target,const(size.head.pos.x)-6,target,const(size.head.pos.y)
ignorehitpause = 1

[state 1605, hit]
type = changestate
triggerall = Numtarget
triggerall = !(target,ishelper)
trigger1 = movehit = 1
value = 1604
ignorehitpause = 1

[state 1603, changeanim]
type = changeanim
triggerall = anim = 1604
trigger1 = pos y >= 0 && vel y > 0
value = 1205

[state 1603, posset]
type = posset
trigger1 = pos y > 0
y = 0

[state 1603, velset]
type = velset
trigger1 = pos y >= 0 && vel y > 0
y = 0


[State 4001, ToGround]
type = StateTypeSet
trigger1 = Anim = 1205
persistent = 0
statetype = S
physics = S

[State 17100, Landing Sound]
type = PlaySnd
trigger1 = anim=1205
value = 40, 0
persistent = 0

[state 17100, Landing Effect]
type=explod
trigger1 = Anim = 1205
anim=17100
id=17100
pos=-15,0
postype=P1
sprpriority=-3
ownpal=1
supermovetime=-1
removetime = -2
persistent = 0

[State 4001, End]
type = ChangeState
trigger1 = Anim = 1205
trigger1 = AnimTime = 0
value = 0
ctrl = 1
;-------------------------------------------------------------------
;Primal Intinct Success
[Statedef 1604]
type = A
movetype = A
physics = N
anim = 1605
velset = 0,0
ctrl = 0
sprpriority = 1

[state 1604, Bite Face]
type=explod
trigger1 = !time
anim=16050
id=16050
pos= 0,0
postype=P1
sprpriority= 3
ownpal=0
removetime = -2
bindtime = -1
persistent = 0

[state 1604, bite sound]
type = playsnd
trigger1 = !time
value = 1600,1

[state 1604, bindtotarget]
type = targetbind
triggerall = Numtarget
trigger1 = anim = 1605 && animelemtime(7) < 0
pos = 3,-73
ignorehitpause = 1


[state 1604, bite sound]
type = playsnd
triggerall = anim = 1605
trigger1 = animelemtime(2) = 0
trigger2 = animelemtime(4) = 0
trigger3 = animelemtime(6) = 0
value = 1600,3

[state 1604, bite sound]
type = playsnd
triggerall = anim = 1605
trigger1 = animelemtime(2) = 0
trigger2 = animelemtime(4) = 0
trigger3 = animelemtime(6) = 0
value = 1600,4

[state 1650, lifeadd]
type = targetlifeadd
triggerall = Numtarget
triggerall = anim = 1605
trigger1 = animelemtime(2) = 0
trigger2 = animelemtime(4) = 0
trigger3 = animelemtime(6) = 0
value = -ceil(ifElse(fvar(11) * 30 < 7, 7, fvar(11) * 30))

;Damage Dampener Variable (by POTS)
[State -2, Hit Count] 
type = VarAdd 
triggerall = anim = 1605
trigger1 = animelemtime(2) = 0
trigger2 = animelemtime(4) = 0
trigger3 = animelemtime(6) = 0
fvar(13) = 1 


[state 1604. hitadd]
type = hitadd
triggerall = anim = 1605
trigger1 = animelemtime(2) = 0
trigger2 = animelemtime(4) = 0
trigger3 = animelemtime(6) = 0
value = 1

[state 1604, hop off]
type = velset
trigger1 = anim = 1605 && animelemtime(7) = 0
x = -3
y = -2-ceil(pos y /10)

[state 1604, gravity]
type = veladd
trigger1 = anim = 1605 && animelemtime(7) >= 0
y = .35

[state 1603, changeanim]
type = changeanim
triggerall = anim = 1605
trigger1 = pos y >= 0 && vel y > 0
value = 1606

[state 1603, posset]
type = posset
trigger1 = pos y > 0
y = 0

[State 4001, ToGround]
type = StateTypeSet
trigger1 = Anim = 1606
persistent = 0
statetype = S
physics = S

[State 17100, Landing Sound]
type = PlaySnd
trigger1 = Anim = 1606
value = 40, 0
persistent = 0

[state 17100, Landing Effect]
type=explod
trigger1 = Anim = 1606 && animelemtime(1) = 0
anim=17100
id=17100
pos=-15,0
postype=P1
sprpriority=-3
ownpal=1
supermovetime=-1
removetime = -2
persistent = 0

[State 105, 1]
type = PosAdd
triggerall = anim = 1606
trigger1 = animelemtime(3) = 0
X = -18

[State 105, 1]
type = VelSet
triggerall = anim = 1606
trigger1 = animelemtime(3) = 0
x = const(velocity.run.back.x)
y = const(velocity.run.back.y)

[State 5201, 2]
type = Statetypeset
triggerall = anim = 1606
trigger1 = Animelemtime(3) = 0
physics = N
statetype = A

[state 1604, veladd]
type = veladd
triggerall = anim = 1606
trigger1 = pos y < 0
y = .71

[State 17100, Landing Sound]
type = PlaySnd
trigger1 = Anim = 1606 && animelemtime(6) = 0
value = 40, 0
persistent = 0

[state 52, Land FX]
type = helper
trigger1 = Anim = 1606 || anim = 47
trigger1 = pos y >= 0 && vel y > 0
name = "LandFX"
helpertype = normal
stateno = 17100
id = 17100
postype = P1
ownpal = 1
keyctrl = 0
supermovetime = 99999
pausemovetime = 99999

[state 1603, velset]
type = velset
trigger1 = pos y >= 0 && vel y > 0
y = 0

[state 1604, changeanim]
type = changeanim
triggerall = anim = 1606
trigger1 = !animtime
value = 47

[state 1604, velset]
type = velset
trigger1 = anim = 47 && vel X != 0
x = 0

[State 4001, End]
type = ChangeState
trigger1 = Anim = 47
trigger1 = AnimTime = 0
value = 0
ctrl = 1
;-------------------------------------------------------------------
;Kaioken Flip Kick
[Statedef 1612]
type = A
movetype = A
physics = N
anim = 1613
ctrl = 0
juggle = 2


[state 1600, gravity]
type = veladd
trigger1 = pos y < 0
y = .55

[state 16.01, velset]
type = velset
trigger1 = animelemtime(4) = 0
y = -13

[State 250, woosh]
type = PlaySnd
trigger1 = AnimElem = 4 || animelem = 11
value = 0,5

[State 210, 1]
type = HitDef
trigger1 = animelemtime(5) = 0 
attr = A, SA
;damage = 28+5*(var(5)=2)+9*(var(5)=3),2+(var(5)=2)+2*(var(5)=3)
damage = ceil(ifElse(fvar(11) * 32 < 7, 7, fvar(11) * 32)), 3
animtype = Hard
air.animtype = back
guardflag = HA
hitflag = MAF
priority = 4, Hit
sparkno = s7030
guard.sparkno = s7000
sparkxy = -10, -33
hitsound = s5,5
guardsound = S6,0
ground.type = High
pausetime = 6,6
guard.slidetime = 15 
guard.hittime = 20 
guard.pausetime = 8,5
ground.slidetime = 15
ground.hittime = 24
guard.hittime = 10
guard.slidetime = 15
guard.ctrltime = 20
ground.velocity = -Vel X / 2,-11
air.type = High
air.velocity = -Vel X / 2 ,-11
air.hittime = 20
getpower = ifelse(p2movetype=H,20,120), 0
givepower = 35,35
fall = 1
fall.recover = 0
ground.cornerpush.veloff = 0
guard.cornerpush.veloff = 0
air.cornerpush.veloff = 0
yaccel = .5
envshake.time = 14
envshake.ampl = 5

[State 210, 1]
type = HitDef
trigger1 = animelemtime(12) = 0
attr = A, SA
;damage = 28+5*(var(5)=2)+9*(var(5)=3),2+(var(5)=2)+2*(var(5)=3)
damage = ceil(ifElse(fvar(11) * 32 < 7, 7, fvar(11) * 32)), 3
animtype = Hard
air.animtype = back
guardflag = HA
hitflag = MAF
priority = 4, Hit
sparkno = s7030
guard.sparkno = s7000
sparkxy = -10, -33
hitsound = s5,5
guardsound = S6,0
ground.type = High
pausetime = 9,9
guard.slidetime = 15 
guard.hittime = 20 
guard.pausetime = 8,5
ground.slidetime = 15
ground.hittime = 24
guard.hittime = 10
guard.slidetime = 15
guard.ctrltime = 20
ground.velocity = -Vel X,-10
air.type = High
air.velocity = -Vel X,-10
air.hittime = 20
getpower = ifelse(p2movetype=H,20,120), 0
givepower = 35,35
fall = 1
fall.recover = 0
ground.cornerpush.veloff = 0
guard.cornerpush.veloff = 0
air.cornerpush.veloff = 0
yaccel = .5
envshake.time = 14
envshake.ampl = 5

[state 1602, block fix]
type = attackdist
trigger1 = animelemtime(13) >= 0
value = 0

[State 282, end]
type = changestate
trigger1 = pos y>=0 && vel y > 0
value = 52

[state 1601, changestate]
type = ctrlset
trigger1 = animelemtime(16) = 0 && movecontact
value = 1
;-------------------------------------------------------------------
;Kaioken Primal Intinct
[Statedef 1613]
type = A
movetype = A
physics = N
juggle = 0
anim = 1604
ctrl = 0

[state 1613, varset]
type = varset
trigger1 = !time
var(4) = 0

[state 1500, attackdist]
type = attackdist
trigger1 = 1
value = 0

[state 1600, gravity]
type = veladd
trigger1 = pos y < 0
y = .55


[State 282, hit]
type = hitdef
triggerall = p2movetype = H
triggerall = p2stateno != [150,155]
triggerall = !movecontact
trigger1 = !time
attr = A,ST
;damage = 61,8
damage = 0, 0
animtype = Hard
hitflag = MAF
guardflag = MA
priority = 4,Hit
pausetime = 1,1 
sparkno = -1
guard.sparkno = -1
sparkxy = 0,-18
hitsound = s800,1
guardsound = S6,0
ground.type = Low
guard.slidetime = 15 
guard.hittime = 1 
ground.hittime = 15;17
ground.slidetime = 15;17
ground.velocity = -4, 0
ground.cornerpush.veloff = -8
guard.velocity = -7.5
guard.cornerpush.veloff = -10
air.type = Low
air.velocity = -3,floor(vel Y/2)
down.hittime = 24
numhits = 0
down.velocity = 0,0
air.cornerpush.veloff = 0
getpower = ifelse(p2movetype=H,40,140), 35
givepower = 35,35
yaccel = .5
airguard.velocity = -8, -1.5
airguard.cornerpush.veloff = 0
air.fall = 1
fall.recovertime = 30

[State 282, hit]
type = hitdef
triggerall = p2movetype != H 
triggerall = anim = 1604 && animelemtime(1) = 0
triggerall = !movecontact
trigger1 = vel y < 0 || p2statetype = C
attr = A,ST
;damage = 61,8
damage = 0, 0
animtype = Hard
hitflag = AF-
priority = 4,Miss
pausetime = 1,1 
sparkno = -1
guard.sparkno = -1
sparkxy = 0,-18
hitsound = s800,1
guardsound = S6,0
ground.type = Low
guard.slidetime = 15 
guard.hittime = 1 
ground.hittime = 15;17
ground.slidetime = 15;17
ground.velocity = -4, 0
ground.cornerpush.veloff = -8
guard.velocity = -7.5
guard.cornerpush.veloff = -10
numhits = 0
air.type = Low
air.velocity = -3,floor(vel Y/2)
down.hittime = 24
down.velocity = 0,0
air.cornerpush.veloff = 0
getpower = ifelse(p2movetype=H,40,140), 35
givepower = 35,35
yaccel = .5
airguard.velocity = -8, -1.5
airguard.cornerpush.veloff = 0
air.fall = 1
fall.recovertime = 30


[State 282, hit]
type = hitdef
triggerall = p2movetype != H  
triggerall = anim = 1604 && animelemtime(1) = 0
triggerall = !movecontact
trigger1 = vel y >= 0 && var(4) = 0 && p2statetype != C
attr = A,ST
;damage = 61,8
damage = 0, 0
animtype = Hard
hitflag = MAF-
priority = 4,Miss
pausetime = 1,1
sparkno = -1
guard.sparkno = -1
sparkxy = 0,-18
hitsound = s800,1
guardsound = S6,0
ground.type = Low
guard.slidetime = 15 
guard.hittime = 1 
ground.hittime = 15;17
ground.slidetime = 15;17
ground.velocity = -4, 0
ground.cornerpush.veloff = -8
guard.velocity = -7.5
numhits = 0
guard.cornerpush.veloff = -10
air.type = Low
air.velocity = -3,floor(vel Y/2)
down.hittime = 24
down.velocity = 0,0
air.cornerpush.veloff = 0
getpower = ifelse(p2movetype=H,40,140), 35
givepower = 35,35
yaccel = .5
airguard.velocity = -8, -1.5
airguard.cornerpush.veloff = 0
fall = 1
fall.recovertime = 30

[state 1605, hit]
type = targetstate
triggerall = Numtarget
triggerall = !(target,ishelper)
trigger1 = movehit = 1
value = 1651
ignorehitpause = 1

[state 1604, bindtotarget]
type = targetbind
triggerall = Numtarget
triggerall = !(target,ishelper)
trigger1 = movehit = 1
pos = target,const(size.head.pos.x)-6,target,const(size.head.pos.y)
ignorehitpause = 1

[state 1605, hit]
type = changestate
triggerall = Numtarget
triggerall = !(target,ishelper)
trigger1 = movehit = 1
value = 1614
ignorehitpause = 1

[state 1603, changeanim]
type = changeanim
triggerall = anim = 1604
trigger1 = pos y >= 0 && vel y > 0
value = 1205

[state 1603, posset]
type = posset
trigger1 = pos y > 0
y = 0

[state 1603, velset]
type = velset
trigger1 = pos y >= 0 && vel y > 0
y = 0


[State 4001, ToGround]
type = StateTypeSet
trigger1 = Anim = 1205
persistent = 0
statetype = S
physics = S

[State 17100, Landing Sound]
type = PlaySnd
trigger1 = anim=1205
value = 40, 0
persistent = 0

[state 17100, Landing Effect]
type=explod
trigger1 = Anim = 1205
anim=17100
id=17100
pos=-15,0
postype=P1
sprpriority=-3
ownpal=1
supermovetime=-1
removetime = -2
persistent = 0

[State 4001, End]
type = ChangeState
trigger1 = Anim = 1205
trigger1 = AnimTime = 0
value = 0
ctrl = 1
;-------------------------------------------------------------------
;Primal Intinct Success
[Statedef 1614]
type = A
movetype = A
physics = N
anim = 1605
velset = 0,0
ctrl = 0
sprpriority = 1

[state 1604, Bite Face]
type=explod
trigger1 = !time
anim=16050
id=16050
pos= 0,0
postype=P1
sprpriority= 3
ownpal= 0
removetime = -2
bindtime = -1
persistent = 0

[state 1604, bite sound]
type = playsnd
trigger1 = !time
value = 1600,1

[state 1604, bindtotarget]
type = targetbind
triggerall = Numtarget
trigger1 = anim = 1605 && animelemtime(7) < 0
pos = 3,-73
ignorehitpause = 1


[state 1604, bite sound]
type = playsnd
triggerall = anim = 1605
trigger1 = animelemtime(2) = 0
trigger2 = animelemtime(4) = 0
trigger3 = animelemtime(6) = 0
value = 1600,3

[state 1604, bite sound]
type = playsnd
triggerall = anim = 1605
trigger1 = animelemtime(2) = 0
trigger2 = animelemtime(4) = 0
trigger3 = animelemtime(6) = 0
value = 1600,4


[state 1604. hitadd]
type = hitadd
triggerall = anim = 1605
trigger1 = animelemtime(2) = 0
trigger2 = animelemtime(4) = 0
trigger3 = animelemtime(6) = 0
value = 1

[state 1650, lifeadd]
type = targetlifeadd
triggerall = Numtarget
triggerall = anim = 1605
trigger1 = animelemtime(2) = 0
trigger2 = animelemtime(4) = 0
trigger3 = animelemtime(6) = 0
value = -ceil(ifElse(fvar(11) * 40 < 7, 7, fvar(11) * 40))

;Damage Dampener Variable (by POTS)
[State -2, Hit Count] 
type = VarAdd 
triggerall = anim = 1605
trigger1 = animelemtime(2) = 0
trigger2 = animelemtime(4) = 0
trigger3 = animelemtime(6) = 0
fvar(13) = 1 

[state 1604, hop off]
type = velset
trigger1 = anim = 1605 && animelemtime(7) = 0
x = -3
y = -2-ceil(pos y /10)

[state 1604, gravity]
type = veladd
trigger1 = anim = 1605 && animelemtime(7) >= 0
y = .35

[state 1603, changeanim]
type = changeanim
triggerall = anim = 1605
trigger1 = pos y >= 0 && vel y > 0
value = 1606

[state 1603, posset]
type = posset
trigger1 = pos y > 0
y = 0

[State 4001, ToGround]
type = StateTypeSet
trigger1 = Anim = 1606
persistent = 0
statetype = S
physics = S

[State 17100, Landing Sound]
type = PlaySnd
trigger1 = Anim = 1606
value = 40, 0
persistent = 0

[state 17100, Landing Effect]
type=explod
trigger1 = Anim = 1606 && animelemtime(1) = 0
anim=17100
id=17100
pos=-15,0
postype=P1
sprpriority=-3
ownpal=1
supermovetime=-1
removetime = -2
persistent = 0

[State 105, 1]
type = PosAdd
triggerall = anim = 1606
trigger1 = animelemtime(3) = 0
X = -18

[State 105, 1]
type = VelSet
triggerall = anim = 1606
trigger1 = animelemtime(3) = 0
x = const(velocity.run.back.x)
y = const(velocity.run.back.y)

[State 5201, 2]
type = Statetypeset
triggerall = anim = 1606
trigger1 = Animelemtime(3) = 0
physics = N
statetype = A

[state 1604, veladd]
type = veladd
triggerall = anim = 1606
trigger1 = pos y < 0
y = .71

[State 17100, Landing Sound]
type = PlaySnd
trigger1 = Anim = 1606 && animelemtime(6) = 0
value = 40, 0
persistent = 0

[state 52, Land FX]
type = helper
trigger1 = Anim = 1606 || anim = 47
trigger1 = pos y >= 0 && vel y > 0
name = "LandFX"
helpertype = normal
stateno = 17100
id = 17100
postype = P1
ownpal = 1
keyctrl = 0
supermovetime = 99999
pausemovetime = 99999

[state 1603, velset]
type = velset
trigger1 = pos y >= 0 && vel y > 0
y = 0

[state 1604, changeanim]
type = changeanim
triggerall = anim = 1606
trigger1 = !animtime
value = 47

[state 1604, velset]
type = velset
trigger1 = anim = 47 && vel X != 0
x = 0

[State 4001, End]
type = ChangeState
trigger1 = Anim = 47
trigger1 = AnimTime = 0
value = 0
ctrl = 1
;------------------------------------------------------------------
;Ex Turtle Flip
[Statedef 1620]
type = S
movetype = A
physics = N
anim = 1600
poweradd = -500
juggle = 2
ctrl = 0
velset = 0,0

[State 6100, snd]
type = playsnd
trigger1 = !time
value = 7,0
channel = 1

[State 8000, flash]
type = PalFX
trigger1 = 1
add = 40, 30, -40
time=1
ignorehitpause = 1

[State 8000, Train]
type = AfterImage
triggerall = var(43) = 0
trigger1 = Time = 0
time = 60
palbright = 40,30,-40
palcontrast = 256,206,206
trans = add1
ignorehitpause = 1


[state 1603, varset]
type = varset
triggerall = var(4) = 1
trigger1 = !time
var(4) = 0

[state 1600, changeanim]
type = changeanim
triggerall = anim = 1600
trigger1 = !animtime
value = 1621

[state 1600, start leap]
type = statetypeset
triggerall = anim = 1621
trigger1 = animelemtime(1) = 0
statetype = A

[state 1600, start leap]
type = velset
trigger1= anim = 1621
trigger1 = animelemtime(1) = 0
x = 8
y = -10

[state 1600, leap sound]
type = playsnd
trigger1= anim = 1621
trigger1 = animelemtime(1) = 0
value = 1600,7

[State 250, 2]
type = HitDef
trigger1 = animelem = 1 || animelem = 2 || animelem = 3 || animelem = 4 || animelem = 5
trigger1 = anim = 1621 
attr = S, SA
animtype  = Hard
;damage    = 55,11
damage = ceil(ifElse(fvar(11) * 20 < 6, 6, fvar(11) * 20)), 3
priority = 4, Hit
guardflag = MA
pausetime = 3,3
guard.pausetime = 3,3
sparkno = s7030
guard.sparkno = s7000
sparkxy = -15,-80
hitsound   = s5,5
guardsound = S6,0
p2facing = 1
ground.type = high
ground.slidetime = 15
ground.hittime = 20
ground.velocity = -2,-7
fall = 1
air.velocity = -2,-7
fall.recover = 0
air.animtype = back
getpower = 0, 0
givepower = 20,20
yaccel = 0.5
forcestand = 1

[state 1600, gravity]
type = veladd
trigger1 = pos y < 0
y = .55

[state 1600, changeanim]
type = changeanim
triggerall = anim = 1621
trigger1 = vel y > 0
value = 1602

[state 1500, attackdist]
type = attackdist
trigger1 = animelemtime(1) = 0
trigger1 = anim = 1602
value = 0

[state 1600, changeanim]
type = changeanim
triggerall = anim != 1205
trigger1 = pos y >= 0 && vel y > 0
value = 1205

[state 1600, velset]
type = velset
trigger1 = anim = 1205
y = 0

[state 1600, posset]
type = posset
trigger1 = pos y > 0
y = 0

[State 4001, ToGround]
type = StateTypeSet
trigger1 = Anim = 1205
persistent = 0
statetype = S
physics = S

[State 17100, Landing Sound]
type = PlaySnd
trigger1 = anim=1205
value = 40, 0
persistent = 0

[state 17100, Landing Effect]
type=explod
trigger1 = Anim = 1205
anim=17100
id=17100
pos=-15,0
postype=P1
sprpriority=-3
ownpal=1
supermovetime=-1
removetime = -2
persistent = 0

[state 1603, divekick buffer]
type = varset
triggerall = var(4) = 0
trigger1 = NumExplod(90000001) || NumExplod(90000002) || NumExplod(90000003) 
trigger1 = (command = "a" || command = "b" || command = "c") 
var(4) = 1

;DiveKick
[State -1,DiveKick]
type = ChangeState
triggerall= !AIlevel
triggerall = NumExplod(90000001) || NumExplod(90000002) || NumExplod(90000003) || var(4) = 1
triggerall = (command = "a" || command = "b" || command = "c") || var(4) = 1
triggerall = (anim = 1621 || anim = 1602)
trigger1 = pos y < -60 || vel y >= 0
value = 1601

;DiveKick
[State -1,DiveKick]
type = ChangeState
triggerall= AIlevel
triggerall = random < 145 * (AIlevel ** 2 / 64.0) 
triggerall = (anim = 1621 || anim = 1602)
triggerall = pos y < -60 || vel y >= 0
trigger1 = P2BodyDist X = [-30,70]
trigger1 = P2StateType = C
trigger1 = (P2StateNo != [120,155]) 
value = 1601

;Flip Kick
[State -1, Flip Kick]
type = ChangeState
triggerall= !AIlevel
triggerall = (!NumExplod(90000001) && !NumExplod(90000002) && !NumExplod(90000003))
triggerall = command = "a" || command = "b" || command = "c"
trigger1 = (anim = 1621 || anim = 1602)
value = cond(var(43) = 0, 1602, 1612)

;Flip Kick
[State -1, Flip Kick]
type = ChangeState
triggerall= AIlevel
triggerall = random < 145 * (AIlevel ** 2 / 64.0) 
triggerall = (anim = 1621 || anim = 1602)
trigger1 = P2BodyDist X = [-30,70]
trigger1 = P2StateType = A
trigger1 = (P2StateNo != [120,155]) 
value = cond(var(43) = 0, 1602, 1612)

;Bite
[State -1, Bite]
type = ChangeState
triggerall= !AIlevel
triggerall = command = "x" || command = "y" || command = "z"
trigger1 = (anim = 1621 || anim = 1602)
value = cond(var(43) = 0, 1603, 1613)

;Bite
[State -1, Bite]
type = ChangeState
triggerall = random < 145 * (AIlevel ** 2 / 64.0) 
triggerall = (anim = 1621 || anim = 1602)
triggerall = (P2BodyDist X = [0,50]) && (P2BodyDist Y = [-40,50])
trigger1 = P2StateType != C
trigger1 = (P2StateNo != [120,155]) 
value = cond(var(43) = 0, 1603, 1613)


[state 1600, changestate]
type = changestate
triggerall = anim = 1205
trigger1 = !animtime
value = 0
ctrl = 1 
;-------------------------------------------------------------
;Hit by Primal Instinct
[Statedef 1650]
type = A
movetype = H
physics = N
ctrl = 0
velset = 0,0
sprpriority = 2

[state 1650, turn]
type = turn
trigger1 = facing = enemy, facing


[state 1650, changeanim2]
type = changeanim2
trigger1 = !time
value = 1650
ignorehitpause = 1



[state 1650, shake]
type = offset
triggerall = anim = 1650
trigger1 = animelemtime(6) = 0
trigger2 = animelemtime(6) = 6
trigger3 = animelemtime(6) = 12
trigger4 = animelemtime(6) = 18
x = -2

[state 1650, shake]
type = offset
triggerall = anim = 1650
trigger1 = animelemtime(6) = 3
trigger2 = animelemtime(6) = 9
trigger3 = animelemtime(6) = 15
x = 2

[state 1650, envshake]
type = envshake
triggerall = anim = 1650
trigger1 = animelemtime(2) = 0
trigger2 = animelemtime(4) = 0
ampl = 2
freq = 60
time = 6

[state 1650, envshake]
type = envshake
triggerall = anim = 1650
trigger1 = animelemtime(6) = 0
ampl = 4
freq = 60
time = 20

[state 1650, posadd]
type = posadd
triggerall = anim = 1650
trigger1 = !animtime
y = 73

[state 1650, changeanim]
type = changeanim
triggerall = anim = 1650
trigger1 = !animtime
value = 5061

[state 1650, velset]
type = velset
triggerall = anim = 5061
trigger1 = animelemtime(1) = 0
x = -3
y = -9

[state 1650, gravity]
type = veladd
triggerall = anim = 5061
trigger1 = animelemtime(1) >= 0
y = .45

[state 1650, hit ground]
type = selfstate
trigger1 = pos y >= 0 && vel y > 0
value = 5100
;-------------------------------------------------------------
;Hit by Primal Instinct
[Statedef 1651]
type = A
movetype = H
physics = N
ctrl = 0
velset = 0,0
sprpriority = 2

[state 1650, turn]
type = turn
trigger1 = facing = enemy, facing


[state 1650, changeanim2]
type = changeanim2
trigger1 = !time
value = 1650
ignorehitpause = 1


[state 1650, shake]
type = offset
triggerall = anim = 1650
trigger1 = animelemtime(6) = 0
trigger2 = animelemtime(6) = 6
trigger3 = animelemtime(6) = 12
trigger4 = animelemtime(6) = 18
x = -2

[state 1650, shake]
type = offset
triggerall = anim = 1650
trigger1 = animelemtime(6) = 3
trigger2 = animelemtime(6) = 9
trigger3 = animelemtime(6) = 15
x = 2

[state 1650, envshake]
type = envshake
triggerall = anim = 1650
trigger1 = animelemtime(2) = 0
trigger2 = animelemtime(4) = 0
ampl = 2
freq = 60
time = 6

[state 1650, envshake]
type = envshake
triggerall = anim = 1650
trigger1 = animelemtime(6) = 0
ampl = 4
freq = 60
time = 20

[state 1650, posadd]
type = posadd
triggerall = anim = 1650
trigger1 = !animtime
y = 73

[state 1650, changeanim]
type = changeanim
triggerall = anim = 1650
trigger1 = !animtime
value = 5061

[state 1650, velset]
type = velset
triggerall = anim = 5061
trigger1 = animelemtime(1) = 0
x = -3
y = -9

[state 1650, gravity]
type = veladd
triggerall = anim = 5061
trigger1 = animelemtime(1) >= 0
y = .45

[state 1650, hit ground]
type = selfstate
trigger1 = pos y >= 0 && vel y > 0
value = 5100
;-----------------------------------------------------------------------
;Snap Kick
[Statedef 1700]
type = S
movetype = A
physics = N
anim = 1260
velset = 0,0
juggle = 2
ctrl = 0

[state 1700, posset]
type = posset
trigger1 = !time
y = 0

[state 1100, varset]
type = varset
triggerall = !AILEVEL
triggerall = prevstateno != 1710
trigger1 = !time
var(39) = cond(NumExplod(90000230) || NumExplod(90000235),1,cond(NumExplod(90000240)|| NumExplod(90000245),2,3))

[state 1100, varset]
type = varset
triggerall = AILEVEL
triggerall = prevstateno != 1710
trigger1 = !time
var(39) = 1+random%3

[State 4000, Invincible]
type = NotHitBy
triggerall = var(39) = 2
trigger1 = time <= 5
value = SCA

[State 4000, Invincible]
type = NotHitBy
triggerall = var(39) >= 3
trigger1 = time <= 9
value = SCA

[state 1700, ascend]
type = changeanim
triggerall = anim = 1260
trigger1 = !animtime
value = 1261

[state 1700, statetypeset]
type = statetypeset
triggerall = anim = 1261
trigger1 = animelemtime(1) = 0
statetype = A

[state 1215, Rising Effect]
type = explod
triggerall = anim = 1261
trigger1 = animelemtime(1) = 0
anim = 1216+var(2)
id = 1216
pos = 10,12
postype = P1
sprpriority = -3
ownpal = 1
removetime = -2
persistent = 0
ignorehitpause = 1

[state 1700, velset]
type = velset
triggerall = var(39) = 1
trigger1 = anim = 1261
trigger1 = animelemtime(1) = 0
x = 1.2
y = -4

[state 1700, velset]
type = velset
triggerall = var(39) = 2
trigger1 = anim = 1261
trigger1 = animelemtime(1) = 0
x = 2
y = -7

[state 1700, velset]
type = velset
triggerall = var(39) >= 3
trigger1 = anim = 1261
trigger1 = animelemtime(1) = 0
x = 3
y = -11


[State 250, woosh]
type = PlaySnd
triggerall = anim = 1260
trigger1 = AnimElem = 3
value = 0,5

[State 220, snd]
type = playsnd
triggerall = anim = 1261
trigger1 = animelem = 3
value = 3,110
channel = 0


[State 250, woosh]
type = PlaySnd
triggerall = anim = 1261
trigger1 = AnimElem = 3
value = 1700,0

[State 250, 1]
type = PlaySnd
triggerall = anim = 1261
trigger1 = AnimElem = 3
value = 21,2


[State 250, 2]
type = HitDef
triggerall = anim = 1260
triggerall = var(39) = 1
trigger1 = Animelemtime(4) = 0
attr = S, SA
animtype  = Hard
;damage    = 55,11
damage = ceil(ifElse(fvar(11) * 30 < 10, 10, fvar(11) * 30)), 2
priority = 4, Hit
guardflag = MA
pausetime = 6,6
guard.pausetime = 6,6
sparkno = s7030
guard.sparkno = s7000
sparkxy = -15,-80
hitsound   = s5,5
guardsound = S6,0
p2facing = 1
ground.type = high
ground.slidetime = 15
ground.hittime = 20
ground.velocity = -1,-11
fall = 1
air.velocity = -1,-11.5
fall.recover = 0
air.animtype = back
envshake.time = 7
envshake.freq = 60
envshake.ampl = 2
getpower = 20, 20
givepower = 20,20
yaccel = 0.5
forcestand = 1


[State 250, 2]
type = HitDef
triggerall = anim = 1260
triggerall = var(39) = 2
trigger1 = AnimElemTime(4) = 0
attr = S, SA
animtype  = Hard
;damage    = 55,11
damage = ceil(ifElse(fvar(11) * 20 < 6, 6, fvar(11) * 20)), 2
priority = 4, Hit
guardflag = MA
pausetime = 6,6
guard.pausetime = 6,6
sparkno = s7030
guard.sparkno = s7000
sparkxy = -15,-80
hitsound   = s5,5
guardsound = S6,0
p2facing = 1
ground.type = high
ground.slidetime = 15
ground.hittime = 20
ground.velocity = -2,-10.5
air.velocity = -2,-10.5
fall = 1
fall.recover = 0
air.animtype = back
envshake.time = 7
envshake.freq = 60
envshake.ampl = 2
getpower = 20,20
givepower = 20,20
yaccel = 0.5


[State 250, 2]
type = HitDef
triggerall = anim = 1261
triggerall = var(39) = 2
trigger1 = AnimElemtime(2) = 0
attr = A, SA
animtype  = Hard
;damage    = 55,11
damage = ceil(ifElse(fvar(11) * 20 < 6, 6, fvar(11) * 20)), 2
priority = 4, Hit
guardflag = MA
pausetime = 6,6
guard.pausetime = 6,6
sparkno = s7030
guard.sparkno = s7000
sparkxy = -15,-80
hitsound   = s5,5
guardsound = S6,0
p2facing = 1
ground.type = high
ground.slidetime = 15
ground.hittime = 20
ground.velocity = -1,-10.5
fall = 1
air.velocity = -1,-10.5
fall.recover = 0
air.animtype = back
getpower = 20, 20
givepower = 20,20
yaccel = 0.5
envshake.time = 7
envshake.freq = 60
envshake.ampl = 2
forcestand = 1

[State 250, 2]
type = HitDef
triggerall = anim = 1260
triggerall = var(39) >= 3
trigger1 = AnimElemTime(4) = 0
attr = S, SA
animtype  = Hard
;damage    = 55,11
damage = ceil(ifElse(fvar(11) * 20 < 6, 6, fvar(11) * 20)), 3
priority = 4, Hit
guardflag = MA
pausetime = 6,6
guard.pausetime = 6,6
sparkno = s7030
guard.sparkno = s7000
sparkxy = -15,-80
hitsound   = s5,5
guardsound = S6,0
p2facing = 1
ground.type = high
ground.slidetime = 15
ground.hittime = 20
ground.velocity = -2,-10
fall = 1
air.velocity = -2,-10
fall.recover = 0
air.animtype = back
getpower = 20, 20
givepower = 20,20
yaccel = 0.5
forcestand = 1

[State 250, 2]
type = HitDef
triggerall = anim = 1261
triggerall = var(39) >= 3
trigger1 = AnimElemTime(2) = 0
attr = A, SA
animtype  = Hard
;damage    = 55,11
damage = ceil(ifElse(fvar(11) * 20 < 6, 6, fvar(11) * 20)), 3
priority = 4, Hit
guardflag = MA
pausetime = 6,6
guard.pausetime = 6,6
sparkno = s7030
guard.sparkno = s7000
sparkxy = -15,-80
hitsound   = s5,5
guardsound = S6,0
p2facing = 1
ground.type = high
ground.slidetime = 15
ground.hittime = 20
ground.velocity = -2,-10
fall = 1
air.velocity = -2,-10
fall.recover = 0
air.animtype = back
getpower = 20, 20
givepower = 20,20
yaccel = 0.5
envshake.time = 7
envshake.freq = 60
envshake.ampl = 2
forcestand = 1

[State 250, 2]
type = HitDef
triggerall = anim = 1261
triggerall = var(39) >= 3
trigger1 = AnimElemTime(4) = 0
attr = A, SA
animtype  = Hard
;damage    = 55,11
damage = ceil(ifElse(fvar(11) * 20 < 6, 6, fvar(11) * 20)), 3
priority = 4, Hit
guardflag = MA
pausetime = 6,6
guard.pausetime = 6,6
sparkno = s7030
guard.sparkno = s7000
sparkxy = -15,-80
hitsound   = s5,5
guardsound = S6,0
p2facing = 1
ground.type = high
ground.slidetime = 15
ground.hittime = 20
ground.velocity = -2,-10
fall = 1
air.velocity = -2,-10
fall.recover = 0
air.animtype = back
getpower = 20, 20
givepower = 20,20
yaccel = 0.5
envshake.time = 7
envshake.freq = 60
envshake.ampl = 2
forcestand = 1


[state 1602, block fix]
type = attackdist
trigger1 = animelemtime(6) >= 0
trigger1 = anim = 1262 || anim = 1205
value = 0

[state 1700, veladd]
type = veladd
triggerall = var(39) = 1
trigger1 = pos y < 0
y = .35

[state 1700, veladd]
type = veladd
triggerall = var(39) = 2
trigger1 = pos y < 0
y = .40

[state 1700, veladd]
type = veladd
triggerall = var(39) >= 3
trigger1 = pos y < 0
y = .45

[state 1700, descend]
type = changeanim
triggerall = anim = 1261
trigger1 = vel y >0 
value = 1262

[State 1700, dragon crash]
type = changestate
triggerall = !AILevel
triggerall = var(39) > 1
triggerall = command = "a" || command = "b" || command = "c"
triggerall = NumExplod(90000021) || NumExplod(90000022) || NumExplod(90000023)
trigger1 = anim = 1262 && movehit
value = 1701

[State 1700, dragon crash]
type = changestate
triggerall = AILevel
triggerall = var(39) > 1
trigger1 = (random < 70 * (AIlevel ** 2 / 64.0))
trigger1 = anim = 1262 && movehit
value = 1701

[state 1603, changeanim]
type = changeanim
triggerall = anim = 1262
trigger1 = pos y >= 0 && vel y > 0
value = 1205

[state 1603, posset]
type = posset
trigger1 = pos y > 0
y = 0

[state 1603, velset]
type = velset
trigger1 = pos y >= 0 && vel y > 0
y = 0


[State 4001, ToGround]
type = StateTypeSet
trigger1 = Anim = 1205
persistent = 0
statetype = S
physics = S

[State 17100, Landing Sound]
type = PlaySnd
trigger1 = anim=1205
value = 40, 0
persistent = 0

[state 17100, Landing Effect]
type=explod
trigger1 = Anim = 1205
anim=17100
id=17100
pos=-15,0
postype=P1
sprpriority=-3
ownpal=1
supermovetime=-1
removetime = -2
persistent = 0

[State 4001, End]
type = ChangeState
trigger1 = Anim = 1205
trigger1 = AnimTime = 0
value = 0
ctrl = 1
;------------------------------------------------------------------------
;Dragon Crash
[Statedef 1701]
type = A
movetype = A
physics = N
anim = 1700
ctrl = 0
velset = 1,-3

[state 1700, veladd]
type = veladd
triggerall = animelemtime(3) >= 0
trigger1 = pos y < 0
y = .75

[state 1700, veladd]
type = veladd
trigger1 = animelemtime(8) = 0
y = 4

[State 220, snd]
type = playsnd
triggerall = prevstateno != 1720
trigger1 = animelem = 4
value = 3,112
channel = 0

[State 650, 2]
type = PlaySnd
trigger1 = AnimElem = 4
value = 0, 5

[State 650, 3]
type = HitDef
triggerall = !movecontact
trigger1 = animelem = 5
trigger2 = animelem = 7 
trigger3 = animelem = 9
attr = A, SA
;damage = 49,5
damage = ceil(ifElse(fvar(11) * 20 < 10, 10, fvar(11) * 20)), 3
hitflag = MAF
guardflag = HA
animtype = Hard
priority = 4, Hit
pausetime = 10,10
sparkno = s7030
guard.sparkno = s7000
sparkxy = -30,-55
hitsound   = s5,5
guardsound = S6,0
ground.type = High
ground.slidetime = 12
ground.hittime  = 15
ground.velocity = -5
air.velocity = -12,8
envshake.time = 12
envshake.freq = 60
envshake.ampl = 3
fall = 1
fall.recover = 0
airguard.cornerpush.veloff= 0
air.animtype = Back
fall.animtype = Back
getpower = ifelse(p2movetype=H,40,140), 35
givepower = 35,35
yaccel = 0.5

[State 0, AttackDist]
type = AttackDist
;trigger1 = Anim = 1203
trigger1 = AnimElemTime(8) >= 0
value = 0

[State 4001, End]
type = ChangeState
trigger1 = pos y >= 0 && vel y > 0
value = 52
;-----------------------------------------------------------------------
;Kaioken Snap Kick
[Statedef 1710]
type = S
movetype = A
physics = N
movehitpersist = 1
anim = 1260
velset = 0,0
juggle = 0
ctrl = 0

[state 1700, posset]
type = posset
trigger1 = !time
y = 0

[state 1100, varset]
type = varset
triggerall = !AILEVEL
trigger1 = !time
var(39) = cond(NumExplod(90000230) || NumExplod(90000235),1,cond(NumExplod(90000240)|| NumExplod(90000245),2,3))

[state 1100, EX varset]
type = varset
triggerall = !AILEVEL
trigger1 = !time && power >= 500
trigger1 = (ifElse(NumExplod(90000230), 1, 0) + ifElse(NumExplod(90000240), 1, 0) + ifElse(NumExplod(90000250), 1, 0) >= 2) || (ifElse(NumExplod(90000235), 1, 0) + ifElse(NumExplod(90000245), 1, 0) + ifElse(NumExplod(90000255), 1, 0) >= 2)
var(39) = 4

[state 1710, ex poweradd]
type = poweradd
trigger1 = !time
trigger1 = var(39) = 4
value = -500

[state 1100, varset]
type = varset
triggerall = AILEVEL
trigger1 = !time
var(39) = 1+random%4

[State 6100, snd]
type = playsnd
trigger1 = !time
trigger1 = var(39) = 4
value = 7,0
channel = 1

[State 8000, flash]
type = PalFX
trigger1 = var(39) = 4
add = 40, 30, -40
time=1
ignorehitpause = 1

[State 8000, Train]
type = AfterImage
triggerall = var(43) = 0
trigger1 = Time = 0
trigger1 = var(39) = 4
time = 60
palbright = 40,30,-40
palcontrast = 256,206,206
trans = add1
ignorehitpause = 1

[State 4000, Invincible]
type = NotHitBy
trigger1 = time <= 9
value = SCA

[state 1700, ascend]
type = changeanim
triggerall = anim = 1260
trigger1 = !animtime
value = 1261

[state 1700, statetypeset]
type = statetypeset
triggerall = anim = 1261
trigger1 = animelemtime(1) = 0
statetype = A

[state 1215, Rising Effect]
type = explod
triggerall = anim = 1261
trigger1 = animelemtime(1) = 0
anim = 1216+var(2)
id = 1216
pos = 10,12
postype = P1
sprpriority = -3
ownpal = 1
removetime = -2
persistent = 0
ignorehitpause = 1

[state 1700, velset]
type = velset
trigger1 = anim = 1261
trigger1 = animelemtime(1) = 0
x = 6
y = -4


[State 250, woosh]
type = PlaySnd
triggerall = anim = 1260
trigger1 = AnimElem = 3
value = 0,5

[State 220, snd]
type = playsnd
triggerall = anim = 1261
trigger1 = animelem = 3
value = 3,110
channel = 0


[State 250, woosh]
type = PlaySnd
triggerall = anim = 1261
trigger1 = AnimElem = 3
value = 1700,0

[State 250, 1]
type = PlaySnd
triggerall = anim = 1261
trigger1 = AnimElem = 3
value = 21,2


[State 250, 2]
type = HitDef
triggerall = anim = 1260
trigger1 = Animelemtime(4) = 0
attr = S, SA
animtype  = Hard
;damage    = 55,11
damage = ceil(ifElse(fvar(11) * 35 < 15, 15, fvar(11) * 35)), 2
priority = 4, Hit
guardflag = MA
pausetime = 6,6
guard.pausetime = 6,6
sparkno = s7030
guard.sparkno = s7000
sparkxy = -15,-80
hitsound   = s5,5
guardsound = S6,0
p2facing = 1
ground.type = high
ground.slidetime = 15
ground.hittime = 20
ground.velocity = -1,-7.5
fall = 1
air.velocity = -4,-7.5
fall.recover = 0
air.animtype = back
envshake.time = 7
envshake.freq = 60
envshake.ampl = 2
getpower = cond(var(39) = 4,0, 20),cond(var(39) = 4,0, 20)
givepower = 20,20
yaccel = 0.5
forcestand = 1


[state 1602, block fix]
type = attackdist
trigger1 = animelemtime(6) >= 0
trigger1 = anim = 1262 || anim = 1205
value = 0

[state 1700, veladd]
type = veladd
trigger1 = pos y < 0
y = .40



[state 1603, changeanim]
type = changeanim
triggerall = anim = 1261
trigger1 = pos y >= 0 && vel y > 0
value = 1205

[state 1603, posset]
type = posset
trigger1 = pos y > 0
y = 0

[state 1603, velset]
type = velset
trigger1 = pos y >= 0 && vel y > 0
y = 0


[State 4001, ToGround]
type = StateTypeSet
trigger1 = Anim = 1205
persistent = 0
statetype = S
physics = S

[State 17100, Landing Sound]
type = PlaySnd
trigger1 = anim=1205
value = 40, 0
persistent = 0

[state 17100, Landing Effect]
type=explod
trigger1 = Anim = 1205
anim=17100
id=17100
pos=-15,0
postype=P1
sprpriority=-3
ownpal=1
supermovetime=-1
removetime = -2
persistent = 0

[State 4001, End]
type = ChangeState
trigger1 = Anim = 1205
trigger1 = animelemtime(2) >= 0
value = cond(var(39) = 4, 1720, 1700)
ctrl = 1
;-----------------------------------------------------------------------
;Ex Snap Kick
[Statedef 1720]
type = S
movetype = A
physics = N
anim = 1720
poweradd = cond(prevstateno != 1710, -500,0)
velset = 0,0
juggle = 1
ctrl = 0

[state 1700, posset]
type = posset
trigger1 = !time
y = 0

[State 6100, snd]
type = playsnd
trigger1 = !time
trigger1 = prevstateno != 1710
value = 7,0
channel = 1

[State 8000, flash]
type = PalFX
trigger1 = anim=1720
trigger2 = anim=1262
trigger3 = anim=1205
add = 40, 30, -40
time=1
ignorehitpause = 1

[State 8000, Train]
type = AfterImage
triggerall = var(43) = 0
trigger1 = Time = 0
trigger1 = prevstateno != 1710
time = 60
palbright = 40,30,-40
palcontrast = 256,206,206
trans = add1
ignorehitpause = 1



[State 4000, Invincible]
type = NotHitBy
trigger1 = time <= 15
value = SCA

[state 1700, statetypeset]
type = statetypeset
triggerall = anim = 1720
trigger1 = animelemtime(6) = 0
statetype = A

[state 1215, Rising Effect]
type = explod
triggerall = anim = 1720
trigger1 = animelemtime(6) = 0
anim = 1216+var(2)
id = 1216
pos = 10,12
postype = P1
sprpriority = -3
ownpal = 1
removetime = -2
persistent = 0
ignorehitpause = 1

[state 1700, velset]
type = velset
trigger1 = anim = 1720
trigger1 = animelemtime(6) = 0
x = 3
y = -5

[State 220, snd]
type = playsnd
triggerall = anim = 1720
trigger1 = animelem = 8
value = 2501,1
channel = 0

[State 250, woosh]
type = PlaySnd
triggerall = anim = 1720
trigger1 = AnimElem = 4 || animelem = 14
value = 0,5

[State 250, woosh]
type = PlaySnd
triggerall = anim = 1720
trigger1 = AnimElem = 9 || animelem = 18
value = 1700,0

[state 1215, Slash Effect]
type = explod
triggerall = anim = 1720
trigger1 = animelemtime(9) = 0 || animelemtime(17) = 0
anim = 1272
id = 1216
pos = 1,-121
postype = P1
sprpriority = 7
ownpal = 1
removetime = -2
bindtime = 3
removeongethit = 1
ignorehitpause = 1

[State 250, 2]
type = HitDef
triggerall = anim = 1720
trigger1 = AnimElemTime(5) = 0
attr = S, SA
animtype  = Hard
;damage    = 55,11
damage = ceil(ifElse(fvar(11) * 20 < 10, 10, fvar(11) * 20)), 3
priority = 4, Hit
guardflag = MA
pausetime = 2,2
guard.pausetime = 2,2
sparkno = s7030
guard.sparkno = s7000
sparkxy = -15,-80
hitsound   = s5,5
guardsound = S6,0
ground.type = high
ground.slidetime = 15
ground.hittime = 20
ground.velocity = -2,-8
fall = 1
air.velocity = -2,-8
fall.recover = 0
air.animtype = back
getpower = 0,0
givepower = 20,20
yaccel = 0.5
forcestand = 1

[State 250, 2]
type = HitDef
triggerall = anim = 1720
trigger1 = AnimElemTime(7) = 0
attr = A, SA
animtype  = Hard
;damage    = 55,11
damage = ceil(ifElse(fvar(11) * 20 < 10, 10, fvar(11) * 20)), 3
priority = 4, Hit
guardflag = MA
pausetime = 2,2
guard.pausetime = 2,2
sparkno = s7030
guard.sparkno = s7000
sparkxy = -15,-80
hitsound   = s5,5
guardsound = S6,0
ground.type = high
ground.slidetime = 15
ground.hittime = 20
ground.velocity = -2,-8
fall = 1
air.velocity = -2,-8
fall.recover = 0
air.animtype = back
getpower = 0,0
givepower = 20,20
yaccel = 0.5
forcestand = 1

[State 250, 2]
type = HitDef
triggerall = anim = 1720
trigger1 = AnimElemTime(9) = 0
attr = A, SA
animtype  = Hard
;damage    = 55,11
damage = ceil(ifElse(fvar(11) * 20 < 10, 10, fvar(11) * 20)), 3
priority = 4, Hit
guardflag = MA
pausetime = 3,3
guard.pausetime = 3,3
sparkno = s7030
guard.sparkno = s7000
sparkxy = -15,-80
hitsound   = s5,5
guardsound = S6,0
ground.type = high
ground.slidetime = 15
ground.hittime = 20
ground.velocity = -2,-8
fall = 1
air.velocity = -2,-8
fall.recover = 0
air.animtype = back
getpower = 0,0
givepower = 20,20
yaccel = 0.5
envshake.time = 3
envshake.freq = 60
envshake.ampl = 2
forcestand = 1

[State 250, 2]
type = HitDef
triggerall = anim = 1720
trigger1 = AnimElemTime(14) = 0
attr = A, SA
animtype  = Hard
;damage    = 55,11
damage = ceil(ifElse(fvar(11) * 20 < 10, 10, fvar(11) * 20)), 3
priority = 4, Hit
guardflag = MA
pausetime = 2,2
guard.pausetime = 2,2
sparkno = s7030
guard.sparkno = s7000
sparkxy = -15,-80
hitsound   = s5,5
guardsound = S6,0
ground.type = high
ground.slidetime = 15
ground.hittime = 20
ground.velocity = -2,-8
fall = 1
air.velocity = -2,-8
fall.recover = 0
air.animtype = back
getpower = 0,0
givepower = 20,20
yaccel = 0.5
forcestand = 1

[State 250, 2]
type = HitDef
triggerall = anim = 1720
trigger1 = AnimElemTime(16) = 0
attr = A, SA
animtype  = Hard
;damage    = 55,11
damage = ceil(ifElse(fvar(11) * 20 < 10, 10, fvar(11) * 20)), 3
priority = 4, Hit
guardflag = MA
pausetime = 2,2
guard.pausetime = 2,2
sparkno = s7030
guard.sparkno = s7000
sparkxy = -15,-80
hitsound   = s5,5
guardsound = S6,0
ground.type = high
ground.slidetime = 15
ground.hittime = 20
ground.velocity = -2,-8
fall = 1
air.velocity = -2,-8
fall.recover = 0
air.animtype = back
getpower = 0,0
givepower = 20,20
yaccel = 0.5
forcestand = 1

[State 250, 2]
type = HitDef
triggerall = anim = 1720
trigger1 = AnimElemTime(18) = 0
attr = A, SA
animtype  = Hard
;damage    = 55,11
damage = ceil(ifElse(fvar(11) * 20 < 10, 10, fvar(11) * 20)), 3
priority = 4, Hit
guardflag = MA
pausetime = 3,3
guard.pausetime = 3,3
sparkno = s7030
guard.sparkno = s7000
sparkxy = -15,-80
hitsound   = s5,5
guardsound = S6,0
ground.type = high
ground.slidetime = 15
ground.hittime = 20
ground.velocity = -2,-8
fall = 1
air.velocity = -2,-8
fall.recover = 0
air.animtype = back
getpower = 0,0
givepower = 20,20
yaccel = 0.5
envshake.time = 3
envshake.freq = 60
envshake.ampl = 2
forcestand = 1

[state 1602, block fix]
type = attackdist
trigger1 = animelemtime(20) >= 0
trigger1 = anim = 1262 || anim = 1205
value = 0

[state 1700, veladd]
type = veladd
triggerall = !movehit
triggerall = pos y < 0
trigger1 = anim = 1720 && animelemtime(20) >= 0
trigger2 = anim = 1262
y = .55

[state 1700, descend]
type = changeanim
triggerall = anim = 1720
trigger1 = vel y >0 
value = 1262

[State 1700, dragon crash]
type = changestate
triggerall = movehit
trigger1 = anim = 1720 && animelemtime(22) >= 0
value = 1721

[state 1603, changeanim]
type = changeanim
triggerall = anim = 1262
trigger1 = pos y >= 0 && vel y > 0
value = 1205

[state 1603, posset]
type = posset
trigger1 = pos y > 0
y = 0

[state 1603, velset]
type = velset
trigger1 = pos y >= 0 && vel y > 0
y = 0


[State 4001, ToGround]
type = StateTypeSet
trigger1 = Anim = 1205
persistent = 0
statetype = S
physics = S

[State 17100, Landing Sound]
type = PlaySnd
trigger1 = anim=1205
value = 40, 0
persistent = 0

[state 17100, Landing Effect]
type=explod
trigger1 = Anim = 1205
anim=17100
id=17100
pos=-15,0
postype=P1
sprpriority=-3
ownpal=1
supermovetime=-1
removetime = -2
persistent = 0

[State 4001, End]
type = ChangeState
trigger1 = Anim = 1205
trigger1 = AnimTime = 0
value = 0
ctrl = 1
;------------------------------------------------------------------------
;Dragon Crash
[Statedef 1721]
type = A
movetype = A
physics = N
anim = 1721
ctrl = 0


[State 8000, flash]
type = PalFX
trigger1 = 1
add = 40, 30, -40
time=1
ignorehitpause = 1

[state 1700, veladd]
type = veladd
trigger1 = pos y < 0
y = .55


[State 650, 2]
type = PlaySnd
trigger1 = AnimElem = 4
value = 0, 5

[State 650, 3]
type = HitDef
triggerall = !movecontact
trigger1 = animelem = 7 
attr = A, SA
;damage = 49,5
damage = ceil(ifElse(fvar(11) * 30 < 15, 15, fvar(11) * 30)), 3
hitflag = MAF
guardflag = HA
animtype = Hard
priority = 4, Hit
pausetime = 10,10
sparkno = s7030
guard.sparkno = s7000
sparkxy = -30,-55
hitsound   = s5,5
guardsound = S6,0
ground.type = High
ground.slidetime = 12
ground.hittime  = 15
ground.velocity = -5
air.velocity = -12,8
envshake.time = 12
envshake.freq = 60
envshake.ampl = 3
fall = 1
fall.recover = 0
airguard.cornerpush.veloff= 0
air.animtype = Back
fall.animtype = Back
getpower = 0, 0
givepower = 35,35
yaccel = 0.5

[State 0, AttackDist]
type = AttackDist
;trigger1 = Anim = 1203
trigger1 = AnimElemTime(8) >= 0
value = 0

[State 4001, End]
type = ChangeState
trigger1 = pos y >= 0 && vel y > 0
value = 52