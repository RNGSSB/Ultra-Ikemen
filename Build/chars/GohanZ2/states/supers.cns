;=============================================
; CNS File for Gohan Z2 by Team Z2
; Supers file
;=============================================



;===========================================================================
; <<<<< MASENKO LVL 1>>>>>
; Charge		state	= 2000
; Launch straight	state	= 2010
; Launch up	state	= 2020
; Helper straight	Masenko	= 2011 
; Helper upwards	Masenko	= 2021
;===========================================================================

;LVL1 Masenko start-up
[Statedef 2000]
type = S
physics = S		
movetype = A
anim = 2000
ctrl = 0
velset = 0,0
sprpriority = 1
poweradd = -1000;IfElse(fvar(27)>0,0,-1000)

[State 3000, width]
type = width
trigger1 = 1
value = 25,0

[State 0, VarSet P2 not in hit state]
type = VarSet
trigger1 = P2MoveType !=H
fvar(30) = 0
[State 0, VarSet no dizzy if P2 in hit state]
type = VarSet
trigger1 = P2MoveType =H
fvar(30) = 1.0

[State 3000, remember Destiny mode]
type = null;VarSet
trigger1 = !time && fvar(27)>0
var(19) = 1
[State 3000, cancel Destiny mode]
type = null;VarSet
trigger1 = !time
fvar(27)=0

[State 800, VarSet];Charging time
type = VarSet
trigger1 = !time
var(26) = 0

[State 800, VarSet];Masenko limiter
type = VarSet
trigger1 = !time
var(28) = 1

[State 0, AssertSpecial]
type = AssertSpecial
trigger1 = time = [0,48]
flag = noFG

[State 200, BGPalFX]
type = BGPalFX
trigger1 = time>=48
time = 1
add	= ceil(-256+1.7*Var(26)),ceil(-256+1.7*Var(26)),ceil(-256+1.7*Var(26))
mul	= 256,256,256
invertall = 0
color = 256

[State 3000, nhb]
type = NotHitBy
trigger1 = anim = 2000 && var(26) = 0
time = 1
value = SCA

[State 200, Masenko voice] ;<<<<<<<<<<<<<<<<<
type = null;PlaySnd
triggerall = var(55)=0		;Voice=Japan
trigger1 = time = 0
value = 2000,5+random%3
volume = 355
channel = 0

[State 200, Masenko voice] ;<<<<<<<<<<<<<<<<<
type = null;PlaySnd
triggerall = var(55)=1		;Voice=English
trigger1 = time = 0
value = 2000,15+random%3
volume = 355
channel = 0

[State 200, 1];voice
type = PlaySnd
;triggerall = var(55)=2		;Voice=Custom Corey Holland
trigger1 = time = 0
value = 2000,20+random%2
channel = 0

[State 1000, shake]
type = EnvShake
triggerall = anim=2000
trigger1 = !(time%4)
time=4
freq=80
ampl=1.5+0.02*time

[State 200, Kmh charge]
type = PlaySnd
trigger1 = time = 10
trigger2 = time = 30
value = 2000,10
volume = 355

[State 3000, SuperPause]
type = SuperPause
trigger1 = time=5
time = 40
p2defmul = 1
unhittable = 1
anim = -1
sound = s2000,0
darken = 0
movetime = 40

[State 0, Super FX]
type = Explod
trigger1 = time = 5
anim = 2003
id = 2003
pos = -119,-2
postype = p1
supermovetime = 9999
pausemovetime = 9999
supermove = 1
removetime = -2
sprpriority = 8
ownpal = 1
bindtime = -1
scale = 1,1
persistent = 0

[State 0, Charge Ball FX]
type = Explod
trigger1 = time = 5
anim = 2015   ;2420+10000*(var(2)=0)
id = 2015     ;2420
pos = -7,-109
postype = p1
supermovetime = 9999
pausemovetime = 9999
supermove = 1
removetime = -1
sprpriority = 5
ownpal = 1
bindtime = -1
scale = 1,1
persistent = 0

[State 0, Charge lightning FX]
type = Explod
triggerall = var(19) = 1  ;if Destiny mode
trigger1 = time = 5
anim = 2006
id = 2006
pos = -10,0
postype = p1
supermovetime = 9999
pausemovetime = 9999
supermove = 1
removetime = -1
sprpriority = 5
ownpal = 1
bindtime = -1
scale = 1,1

[State 0, lightning sound]
type = PlaySnd
triggerall = var(19) = 1  ;if Destiny mode
triggerall = time>=5
trigger1 = gametime%(20) = 0
value = 2400,3
volume = -200
freqmul = .9 + (random/5000.0)

[state 17100, scale charge FX]
type = null;ModifyExplod
trigger1 = numexplod(2015)
scale = 1.0+0.003*(time-20),1.0+0.003*(time-20)
id = 2015

[State 0, Ki Gather FX]
type = Explod
trigger1 = time = 5
anim = 2016   ;2002+10000*(var(2)=0)
id = 2016     ;2002
pos = -7,-109
postype = p1
supermovetime = 9999
pausemovetime = 9999
supermove = 1
removetime = -2  ;43
sprpriority = 6
ownpal = 1
bindtime = -1
scale = 1,1
persistent = 0

[State 200, Masenko charge long]
type = PlaySnd
trigger1 = time = 5
channel = 7
value = 2000,1

[State 2500, bgpalfx1]
type = bgpalfx
trigger1 = !time
time = 48
color=0
mul=0,0,0

[State 800, VarSet]
type = VarAdd
triggerall = Anim=2000 && time>48
trigger1 = !AILevel && ((command = "holdx") || (command = "holdy") || (command = "holdz"))
trigger2 = AILevel
var(26) = 1

;Throw Masenko Up
[State 901, ChangeAnim]
type = ChangeState
triggerall = !AILevel
triggerall = Anim=2000 && time>=48
triggerall = NumExplod(90000008)|| NumExplod(90000007)|| NumExplod(90000009)
trigger1 = (command != "holdx") && (command != "holdy") && (command != "holdz")
trigger2 = time >= 200
value = 2020
ctrl = 0
[State 901, ChangeAnim]
type = ChangeState
triggerall = AILevel
triggerall = Anim=2000 && time>=48
triggerall = EnemyNear,statetype = A && ((EnemyNear,vel x>0)||(EnemyNear,Movetype=A) || (EnemyNear,Movetype=I))
triggerall = (p2bodydist x =[60,120]) && (p2bodydist y =[-180,-60])
trigger1 = random < (100 * (AIlevel ** 2 / 64.0))
trigger2 = time >= 200
value = 2020
ctrl = 0

;Throw Masenko Straight
[State 901, ChangeAnim]
type = ChangeState
triggerall = !AILevel
triggerall = Anim=2000 && time>=48
trigger1 = (command != "holdx") && (command != "holdy") && (command != "holdz")
trigger2 = time >= 200
value = 2010
ctrl = 0
[State 901, ChangeAnim]
type = ChangeState
triggerall = AILevel
triggerall = Anim=2000 && time>=48
trigger1 = random < (100 * (AIlevel ** 2 / 64.0))
trigger1 = ((EnemyNear,vel x>0)||(EnemyNear,Movetype=A)|| (EnemyNear,Movetype=I))
trigger2 = time >= 200
value = 2010
ctrl = 0

;-----------------------------

;Shoot straight
[Statedef 2010]
type = S
physics = S
movetype = A
anim = 2010
ctrl = 0
velset = 0,0
sprpriority = 1

[State 0, Charge lightning FX]
type = RemoveExplod
trigger1 = !time
ID = 2006

[State 3000, nhb]
type = NotHitBy
trigger1 = var(26)=0 && time<4
time = 1
value = SCA

[State 3000, width]
type=width
trigger1 = 1
value = 25,0

[state 1215, remove charge FX]
type = removeexplod
trigger1 = !time
ID = 2015

[state 1215, Smoke FX]
type = explod
trigger1 = !time
anim = 1206+(var(2)=0)
id = 1206
pos = -25,3
postype = P1
sprpriority = 3
ownpal = 1
removetime = -2
persistent = 0
ignorehitpause = 1


[State 3000, masenko]
type = helper
trigger1 = !time
helpertype = normal
stateno = 2011
ID = 2011
name = "masenko"
postype = p1
pos = 55,-60
ownpal = 1

[State 3000, end]
type = changestate
trigger1 = !animtime
value = 0
ctrl = 1

;-----------------------------

;Shoot up
[Statedef 2020]
type = S
physics = S
movetype = A
anim = 2020
ctrl = 0
velset = 0,0
sprpriority = 1

[State 0, Charge lightning FX]
type = RemoveExplod
trigger1 = !time
ID = 2006

[State 3000, nhb]
type = NotHitBy
trigger1 = var(26)=0 && time<4
time = 1
value = SCA

[State 3000, width]
type=width
trigger1 = 1
value = 25,0

[state 1215, remove charge FX]
type = removeexplod
trigger1 = !time
ID = 2015

[state 1215, Smoke FX]
type = explod
trigger1 = !time
anim = 1206+(var(2)=0)
id = 1206
pos = -25,3
postype = P1
sprpriority = 3
ownpal = 1
removetime = -2
persistent = 0
ignorehitpause = 1

[state 1215, Flash FX]
type = null ;explod
trigger1 = !time
anim = 2005
id = 2005
pos = 0,0
postype = P1
sprpriority = 3
ownpal = 1
removetime = -2
persistent = 0
ignorehitpause = 0

[State 3000, masenko]
type = helper
trigger1 = !time
helpertype = normal
stateno = 2021
ID = 2021
name = "masenko_up"
postype = p1
pos = 25,-105
ownpal = 1

[State 3000, end]
type = changestate
trigger1 = !animtime
value = 0
ctrl = 1

;===========================================================================
; <<<<< MASENKO LVL 2>>>>>
; Charge		state	= 2030
; Launch straight	state	= 2040
; Launch up	state	= 2050
; Helper straight	Masenko	= 2031 
; Helper upwards	Masenko	= 2041
;===========================================================================

;LVL2 Masenko start-up
[Statedef 2030]
type		= S
physics		= S
movetype		= A
anim		= 2000
ctrl		= 0
velset		= 0,0
sprpriority	= 1
poweradd		= -2000;IfElse(fvar(27)>0,0,-2000)

[State 0, VarSet P2 not in hit state]
type = VarSet
trigger1 = P2MoveType !=H
fvar(30) = 0
[State 0, VarSet no dizzy if P2 in hit state]
type = VarSet
trigger1 = P2MoveType =H
fvar(30) = 1.0

[State 2030, width]
type		= width
trigger1		= 1
value		= 25,0

[State 2030, AssertSpecial]
type		= AssertSpecial
trigger1		= time = [0,48]
flag		= noFG

[State 2030, BGPalFX1]
type		= BGPalFX
trigger1		= time >= 48
time		= 1
add		= ceil(-256+1.7*Var(26)/3),ceil(-256+1.7*Var(26)/3),ceil(-256+1.7*Var(26)/3)
mul		= 256,256,256
invertall		= 0
color		= 256
[State 2030, BGPalFX2]
type		= BGPalFX
trigger1		= !Time
time		= 48
color		= 0
mul		= 0,0,0

[State 2030, NotHitBy]
type		= NotHitBy
trigger1		= anim = 2000 && time = [0,48]
time		= 1
value		= SCA



[State 2030, EnvShake]
type		= EnvShake
triggerall	= Anim = 2000
trigger1		= !(time%4)
time		= 4
freq		= 80
ampl		= 1.5+0.02*time


[State 2030, SuperPause]
type		= SuperPause
trigger1		= time=5
time		= 40
p2defmul		= 1
unhittable	= 1
anim		= -1
sound		= s2350,0
darken		= 0
movetime		= 40

[State 2030, Hyper Charge FX]
type		= Explod
trigger1 = time = 5
anim = 2442
id = 2440
pos = -7,-109
postype = p1
supermovetime = 9999
pausemovetime = 9999
supermove = 1
removetime = -2
sprpriority = 6
ownpal = 1
bindtime = -1
scale = 1,1
persistent = 0
removeongethit = 1
[State 2030, Charge Ball FX]
type = Explod
trigger1 = time = 5
anim = 2015   ;2420+10000*(var(2)=0)
id = 20150     ;2420
pos = -7,-109
postype = p1
supermovetime = 9999
pausemovetime = 9999
supermove = 1
removetime = -1
sprpriority = 5
ownpal = 1
bindtime = -1
scale = 1,1 ;1.1,1.1
persistent = 0
removeongethit = 1
[State 2030, Charge lightning FX]
type = Explod
triggerall = var(19) = 1  ;if Destiny mode
trigger1 = time = 5
anim = 2006
id = 20060
pos = -10,0
postype = p1
supermovetime = 9999
pausemovetime = 9999
supermove = 1
removetime = -1
sprpriority = 5
ownpal = 1
bindtime = -1
scale = 1,1
removeongethit = 1
[State 2030, Ki Gather FX]
type = Explod
trigger1 = time = 5
anim = 2016   ;2002+10000*(var(2)=0)
id = 20160   ;2002
pos = -7,-109
postype = p1
supermovetime = 9999
pausemovetime = 9999
supermove = 1
removetime = -2  ;43
sprpriority = 6
ownpal = 1
bindtime = -1
scale = 1,1
persistent = 0
removeongethit = 1


[State 2030, VoiceCUSTOM];voice
type		= PlaySnd
triggerall	= var(55) = 2		;Voice=Custom Corey Holland
trigger1		= time = 0
value		= 2300,0
channel		= 0
[State 2030, Kmh charge]
type		= PlaySnd
trigger1		= time = 10
trigger2		= time = 30
value		= 2000,10
volumescale	= 100
[State 2030, Lightning sound]
type		= PlaySnd
triggerall	= var(19) = 1  ;if Destiny mode
triggerall	= time>=5
trigger1		= gametime%(20) = 0
value		= 2400,3
volumescale	= 50
[State 2030, Masenko charge long]
type		= PlaySnd
trigger1		= Time = 5
value		= 2000,1
channel		= 6

[state 2030, scale charge FX]
type		= null;ModifyExplod
trigger1		= numexplod(20150)
scale		= 1.1+0.003*(time-20),1.1+0.003*(time-20)
id		= 20150

[State 2030, VarSet];Charging time, set to 0 at start
type		= VarSet
trigger1	= !time
var(26)		= 0
[State 2030, VarSet];Masenko limiter
type		= VarSet
trigger1	= !time
var(28)		= 1
[State 2030, VarSet]
type		= VarAdd
triggerall	= Anim=2000 && Time > 48;62
trigger1	= !AILevel && (command = "holdx" || command = "holdy" || command = "holdz")
trigger2	= AILevel
var(26)		= 3

;Throw Masenko Up
[State 2030]
type = ChangeState
triggerall = !AILevel
triggerall = Anim=2000 && time>=48
triggerall = NumExplod(90000008)|| NumExplod(90000007)|| NumExplod(90000009)
;trigger1 = !numexplod(90000200) && !numexplod(90000210) && !numexplod(90000220)
trigger1 = (command != "holdx") && (command != "holdy") && (command != "holdz")
trigger2 = time >= 148;162;130;200
value = 2050
ctrl = 0
[State 2030, AI]
type = ChangeState
triggerall = AILevel
triggerall = Anim=2000 && time>=48
trigger1 = EnemyNear,statetype=A && ((EnemyNear,vel x>0)||(EnemyNear,Movetype=A) || (EnemyNear,Movetype=I))
trigger1 = (p2bodydist x =[60,120]) && (p2bodydist y =[-180,-60])
trigger2 = time >= 148
value = 2050
ctrl = 0

;Throw Masenko Straight
[State 2030]
type = ChangeState
triggerall = !AILevel
triggerall = Anim=2000 && time>=48
;trigger1 = !numexplod(90000200) && !numexplod(90000210) && !numexplod(90000220)
trigger1 = (command != "holdx") && (command != "holdy") && (command != "holdz")
trigger2 = time >= 148;162;130;200
value = 2040
ctrl = 0
[State 2030, AI]
type = ChangeState
triggerall = AILevel
triggerall = Anim=2000 && time>=48
trigger1 = ((EnemyNear,vel x>0)||(EnemyNear,Movetype=A) || (EnemyNear,Movetype=I))
trigger2 = time >= 148
value = 2040
ctrl = 0

;-----------------------------

;Shoot straight
[Statedef 2040]
type = S
physics = S
movetype = A
anim = 2040
ctrl = 0
velset = 0,0
sprpriority = 1
 
[State 2040, 1];voice
type = PlaySnd
;triggerall = var(55)=2		;Voice=Custom Corey Holland
trigger1 = time = 0
value = 2300,1
channel = 0

[State 2040, Charge lightning FX]
type = RemoveExplod
trigger1 = !time
ID = 20060

[State 2040, nhb]
type = NotHitBy
trigger1 = var(26)=0 && time<4
time = 1
value = SCA

[State 2040, width]
type=width
trigger1 = 1
value = 25,0

[state 2040, remove charge FX]
type = removeexplod
trigger1 = !time
ID = 20150

[state 2040, Smoke FX]
type = explod
trigger1 = !time
anim = 1206+(var(2)=0)
id = 1206
pos = -25,3
postype = P1
sprpriority = 3
ownpal = 1
removetime = -2
persistent = 0
ignorehitpause = 1

[State 2040, masenko]
type = helper
trigger1 = !time
helpertype = normal
stateno = 2031
ID = 2031
name = "masenko lvl 2"
postype = p1
pos = 43,-60
ownpal = 1
;size.xscale = 1.1
;size.yscale = 1.1

[State 2040, ChangeAnim]
type = ChangeAnim
trigger1 = Time >= 30
value = 2041
ignorehitpause = 1
persistent = 0

[State 2040, end]
type = changestate
triggerall = Anim = 2041
trigger1 = AnimTime = 0
value = 0
ctrl = 1

;-----------------------------
;Shoot up
[Statedef 2050]
type = S
physics = S
movetype = A
anim = 2050
ctrl = 0
velset = 0,0
sprpriority = 1

[State 2050, 1];voice
type = PlaySnd
;triggerall = var(55)=2		;Voice=Custom Corey Holland
trigger1 = time = 0
value = 2300,1
channel = 0

[State 2050, Charge lightning FX]
type = RemoveExplod
trigger1 = !time
ID = 20060

[State 2050, nhb]
type = NotHitBy
trigger1 = var(26)=0 && time<4
time = 1
value = SCA

[State 2050, width]
type=width
trigger1 = 1
value = 25,0

[state 2050, remove charge FX]
type = removeexplod
trigger1 = !time
ID = 20150

[state 2050, Smoke FX]
type = explod
trigger1 = !time
anim = 1206+(var(2)=0)
id = 1206
pos = -25,3
postype = P1
sprpriority = 3
ownpal = 1
removetime = -2
persistent = 0
ignorehitpause = 1

[state 2050, Flash FX]
type = null ;explod
trigger1 = !time
anim = 2005
id = 2005
pos = 0,0
postype = P1
sprpriority = 3
ownpal = 1
removetime = -2
persistent = 0
ignorehitpause = 0

[State 2050, masenko]
type = helper
trigger1 = !time
helpertype = normal
stateno = 2041
ID = 2041
name = "masenko_up lvl 2"
postype = p1
pos = 25,-105
ownpal = 1
;size.xscale = 1.1
;size.yscale = 1.1

[State 2050, ChangeAnim]
type = ChangeAnim
trigger1 = Time >= 30
value = 2051
ignorehitpause = 1
persistent = 0


[State 2050, end]
type = changestate
triggerall = Anim = 2051
trigger1 = AnimTime = 0
value = 0
ctrl = 1

;===========================================================================
; <<<<< CHOU MASENKO LVL 2>>>>>
; Charge		state	= 2300
; Launch straight	state	= 2310
; Launch up	state	= 2320
; Helper straight	Masenko	= 2311 
; Helper upwards	Masenko	= 2321
;===========================================================================

;LVL 2 Chou Masenko
[Statedef 2300]
type = S
physics = S
movetype = A
anim = 2000
ctrl = 0
velset = 0,0
sprpriority = 1
poweradd = -2000;IfElse(fvar(27)>0,0,-2000)	;if Destiny mode activated, 0, if not -2000

[State 2300]
type = nothitby
trigger1 = 1
value = SCA

[State 650, Fill Destiny Gauge - Hit - EX]
type		= null;VarAdd
trigger1		= fvar(27)>0
fvar(28)		= -200;IfElse(fvar(28)+30 > 300, 300-fvar(28), 30)
persistent	= 0
ignorehitpause	= 1
[State 3000, if Destiny bar = 0]
type = null;VarSet
trigger1 = fvar(28) <= 0
fvar(27)=0

[State 3000, Supermoves counter for Destiny mode] ;it counts for two moves instead of one
type = null;VarAdd
trigger1 = Time = 0 && fvar(27)>0
fvar(31)=1
persistent = 0
[State 3000, Three or more moves, Destiny mode ends]
type = null;VarSet
trigger1 = !time && fvar(31)>=3
fvar(27)=0

[State 3000, width]
type = width
trigger1 = 1
value = 25,0

[State 3000, reset var]
type = VarSet
trigger1 = !time
var(19) = 0
[State 3000, remember Destiny mode]
type = null;VarSet
trigger1 = !time && fvar(27)>0
var(19) = 1
;[State 3000, cancel Destiny mode]
;type = VarSet
;trigger1 = !time
;fvar(27)=0

[State 0, AssertSpecial]
type = AssertSpecial
trigger1 = time = [0,48]
flag = noFG

[State 200, 1];voice
type = PlaySnd
;triggerall = var(55)=2		;Voice=Custom Corey Holland
trigger1 = time = 0
value = 2300,0
channel = 0

[State 1000, shake]
type = EnvShake
trigger1 = !(time%4)
time=4
freq=80
ampl=1.5+0.02*time

[State 200, SuperPause sound]
type = PlaySnd
trigger1 = time=5
value = 2350,0

[State 3000, SuperPause]
type = SuperPause
trigger1 = time=5
time = 40
p2defmul = 1
unhittable = 1
anim = -1
darken = 0
movetime = 40

[State 0, Hyper Charge FX]
type = Explod
trigger1 = time = 5
anim = 2442
id = 2440
pos = -7,-109
postype = p1
supermovetime = 9999
pausemovetime = 9999
supermove = 1
removetime = -2
sprpriority = 6
ownpal = 1
bindtime = -1
scale = 1,1
persistent = 0

[State 2500, bgpalfx1]
type = bgpalfx
trigger1 = !time
time = 48
color=0
mul=0,0,0

[State 0, Charge Ball FX]
type = Explod
trigger1 = time = 5
anim = 2015
id = 2015
pos = -7,-109
postype = p1
supermovetime = 9999
pausemovetime = 9999
supermove = 1
removetime = -1
sprpriority = 5
ownpal = 1
bindtime = -1
scale = 1,1 ;1.5,1.5
persistent = 0

[State 0, Charge lightning FX]
type = Explod
triggerall = var(19) = 1  ;if Destiny mode
trigger1 = time = 5
anim = 2006
id = 2006
pos = -10,0
postype = p1
supermovetime = 9999
pausemovetime = 9999
supermove = 1
removetime = -1
sprpriority = 5
ownpal = 1
bindtime = -1
scale = 1,1

[State 0, lightning sound]
type = PlaySnd
triggerall = var(19) = 1  ;if Destiny mode
triggerall = time>=5
trigger1 = gametime%(20) = 0
value = 2400,3
volume = -200
freqmul = .9 + (random/5000.0)

[State 0, Ki Gather FX]
type = Explod
trigger1 = time = 5
anim = 2016   ;2002+10000*(var(2)=0)
id = 2016     ;2002
pos = -7,-109
postype = p1
supermovetime = 9999
pausemovetime = 9999
supermove = 1
removetime = -2  ;43
sprpriority = 6
ownpal = 1
bindtime = -1
scale = 1,1
persistent = 0

[State 200, Masenko charge long]
type = PlaySnd
trigger1 = time = 5
value = 2000,1
channel = 7

;Throw Chou Masenko Up
[State 901, ChangeAnim]
type = ChangeState
triggerall = time>=48 
trigger1 = !AILevel && command="holdup"
trigger2 = AILevel && random < (100 * (AIlevel ** 2 / 64.0))
trigger2 = ((EnemyNear,vel x>0)||(EnemyNear,Movetype=A)|| (EnemyNear,Movetype=I))
trigger2 = (p2bodydist x =[60,120]) && (p2bodydist y =[-180,-60])
value = 2320
ctrl = 0

;Throw Chou Masenko
[State 901, ChangeAnim]
type = ChangeState
triggerall = time>=48 
trigger1 = !AILevel
trigger2 = AILevel && random < (100 * (AIlevel ** 2 / 64.0))
value = 2310
ctrl = 0

;-------------------------------
;Shoot straight
[Statedef 2310]
type = S
physics = S
movetype = A
anim = 2310
ctrl = 0
velset = 0,0
sprpriority = 1

[State 0, Charge lightning FX]
type = RemoveExplod
trigger1 = !time
ID = 2006

[State 3000, nhb]
type = NotHitBy
trigger1 = time<11
;time = 1
value = SCA

[State 3000, width]
type = width
trigger1 = 1
value = 25,0

[state 1215, remove charge FX]
type = removeexplod
trigger1 = !time
ID = 2015

[state 1215, Smoke FX]
type = explod
trigger1 = !time
anim = 1206+(var(2)=0)
id = 1206
pos = -25,3
postype = P1
sprpriority = 3
ownpal = 1
removetime = -2
persistent = 0
ignorehitpause = 1

[State 200, 1];voice
type = PlaySnd
;triggerall = var(55)=2		;Voice=Custom Corey Holland
trigger1 = time = 0
value = 2300,1
channel = 0

[State 0, emo launch sound]
type = PlaySnd
triggerall = var(19) = 1  ;if Destiny mode
trigger1 = !time
value = 2310,0

[State 3000, masenko]
type = helper
trigger1 = !time
helpertype = normal
stateno = 2311
ID = 2311
name = "chou_masenko"
postype = p1
ownpal = 1
size.xscale = 1
;size.yscale = 1.3

[State 0, Charge lightning FX]
type = Explod
triggerall = var(19) = 1  ;if Destiny mode
trigger1 = time = 5
anim = 2312
id = 2312
pos = 35,-60
postype = p1
supermovetime = 9999
pausemovetime = 9999
ignorehitpause = 1
supermove = 1
removetime = -1
sprpriority = 6
ownpal = 1
bindtime = -1
scale = 1,1

[State 3000, end]
type = changeanim
trigger1 = anim=2310 && time>1 && !numhelper(2311)
value = 2315

[State 3000, end]
type = changestate
trigger1 = anim=2315 && !animtime
value = 0
ctrl = 1

;-------------------------------
;Shoot up
[Statedef 2320]
type = S
physics = S
movetype = A
anim = 2320
ctrl = 0
velset = 0,0
sprpriority = 1

[State 0, Charge lightning FX]
type = RemoveExplod
trigger1 = !time
ID = 2006

[State 3000, nhb]
type = NotHitBy
trigger1 = time<11
time = 1
value = SCA

[State 3000, width]
type = width
trigger1 = 1
value = 25,0

[state 1215, remove charge FX]
type = removeexplod
trigger1 = !time
ID = 2015

[state 1215, Smoke FX]
type = explod
trigger1 = !time
anim = 1206+(var(2)=0)
id = 1206
pos = -25,3
postype = P1
sprpriority = 3
ownpal = 1
removetime = -2
persistent = 0
ignorehitpause = 1

[State 200, 1];voice
type = PlaySnd
;triggerall = var(55)=2		;Voice=Custom Corey Holland
trigger1 = time = 0
value = 2300,1
channel = 0

[State 0, emo launch sound]
type = PlaySnd
triggerall = var(19) = 1  ;if Destiny mode
trigger1 = !time
value = 2310,0

[State 3000, masenko]
type = helper
trigger1 = !time
helpertype = normal
stateno = 2321
ID = 2321
name = "chou_masenko_up"
postype = p1
ownpal = 1

[State 0, Charge lightning Up FX]
type = Explod
triggerall = var(19) = 1  ;if Destiny mode
trigger1 = time = 5
anim = 2322
id = 2322
pos = 7,-96
postype = p1
supermovetime = 9999
pausemovetime = 9999
ignorehitpause = 1
supermove = 1
removetime = -1
sprpriority = 6
ownpal = 1
bindtime = -1
scale = 1,1

[State 3000, end]
type = changeanim
trigger1 = anim=2320 && time>1 && !numhelper(2321)
value = 2325

[State 3000, end]
type = changestate
trigger1 = anim=2325 && !animtime
value = 0
ctrl = 1


;===========================================================================
; <<<<< CHOU MASENKO LVL 1>>>>>
; Charge		state	= 2330
; Launch straight	state	= 2340
; Launch up	state	= 2350
; Helper straight	Masenko	= 2341 
; Helper upwards	Masenko	= 2351
;===========================================================================

;LVL 1 Chou Masenko
[Statedef 2330]
type = S
physics = S
movetype = A
anim = 2000
ctrl = 0
velset = 0,0
sprpriority = 1
poweradd = -1000;IfElse(fvar(27)>0,0,-1000)

[State 2330]
type = nothitby
trigger1 = 1
value = SCA

[State 650, Fill Destiny Gauge - Hit - EX]
type		= null;VarAdd
trigger1		= fvar(27)>0
fvar(28)		= -100;IfElse(fvar(28)+30 > 300, 300-fvar(28), 30)
persistent	= 0
ignorehitpause	= 1
[State 3000, if Destiny bar = 0]
type = null;VarSet
trigger1 = fvar(28) <= 0
fvar(27)=0

[State 3000, Supermoves counter for Destiny mode]
type = null;VarAdd
trigger1 = Time = 0 && fvar(27)>0
fvar(31)=1
persistent = 0
[State 3000, Three or more moves, Destiny mode ends]
type = null;VarSet
trigger1 = !time && fvar(31)>=3
fvar(27)=0

[State 3000, width]
type = width
trigger1 = 1
value = 25,0

[State 3000, reset var]
type = VarSet
trigger1 = !time
var(19) = 0
[State 3000, remember Destiny mode]
type = null;VarSet
trigger1 = !time && fvar(27)>0
var(19) = 1
;[State 3000, cancel Destiny mode]
;type = VarSet
;trigger1 = !time
;fvar(27)=0

[State 0, AssertSpecial]
type = AssertSpecial
trigger1 = time = [0,48]
flag = noFG

[State 200, 1];voice
type = PlaySnd
;triggerall = var(55)=2		;Voice=Custom Corey Holland
trigger1 = time = 0
value = 2000,20+random%2
channel = 0

[State 1000, shake]
type = EnvShake
trigger1 = !(time%4)
time=4
freq=80
ampl=1.5+0.02*time

[State 3000, SuperPause]
type = SuperPause
trigger1 = time=5
time = 40
p2defmul = 1
unhittable = 1
anim = -1
sound = s2000,0
darken = 0
movetime = 40

[State 0, Super FX]
type = Explod
trigger1 = time = 5
anim = 2003
id = 2003
pos = -119,-2
postype = p1
supermovetime = 9999
pausemovetime = 9999
supermove = 1
removetime = -2
sprpriority = 8
ownpal = 1
bindtime = -1
scale = 1,1
persistent = 0

[State 2500, bgpalfx1]
type = bgpalfx
trigger1 = !time
time = 48
color=0
mul=0,0,0

[State 0, Charge Ball FX]
type = Explod
trigger1 = time = 5
anim = 2015
id = 2015
pos = -7,-109
postype = p1
supermovetime = 9999
pausemovetime = 9999
supermove = 1
removetime = -1
sprpriority = 5
ownpal = 1
bindtime = -1
scale = 1,1 ;1.5,1.5
persistent = 0

[State 0, Charge lightning FX]
type = Explod
triggerall = var(19) = 1  ;if Destiny mode
trigger1 = time = 5
anim = 2006
id = 2006
pos = -10,0
postype = p1
supermovetime = 9999
pausemovetime = 9999
supermove = 1
removetime = -1
sprpriority = 5
ownpal = 1
bindtime = -1
scale = 1,1

[State 0, lightning sound]
type = PlaySnd
triggerall = var(19) = 1  ;if Destiny mode
triggerall = time>=5
trigger1 = gametime%(20) = 0
value = 2400,3
volume = -200
freqmul = .9 + (random/5000.0)

[State 0, Ki Gather FX]
type = Explod
trigger1 = time = 5
anim = 2016   ;2002+10000*(var(2)=0)
id = 2016     ;2002
pos = -7,-109
postype = p1
supermovetime = 9999
pausemovetime = 9999
supermove = 1
removetime = -2  ;43
sprpriority = 6
ownpal = 1
bindtime = -1
scale = 1,1
persistent = 0

[State 200, Masenko charge long]
type = PlaySnd
trigger1 = time = 5
value = 2000,1
channel = 6

;Throw Chou Masenko Up
[State 901, ChangeAnim]
type = ChangeState
triggerall = time>=48 
trigger1 = !AILevel && NumExplod(90000008)|| NumExplod(90000007)|| NumExplod(90000009)
trigger2 = AILevel && p2bodydist y = [100,300];random < (200 * (AIlevel ** 2 / 64.0))
trigger2 = ((EnemyNear,vel x>0)||(EnemyNear,Movetype=A)|| (EnemyNear,Movetype=I))
trigger2 = (p2bodydist x =[60,120]) && (p2bodydist y =[-180,-60])
value = 2350
ctrl = 0

;Throw Chou Masenko
[State 901, ChangeAnim]
type = ChangeState
triggerall = time>=48 
trigger1 = !AILevel
trigger2 = AILevel && p2bodydist y < 100;random < (200 * (AIlevel ** 2 / 64.0))
value = 2340
ctrl = 0

;-------------------------------
;Shoot straight
[Statedef 2340]
type = S
physics = S
movetype = A
anim = 2310
ctrl = 0
velset = 0,0
sprpriority = 1

[State 0, Charge lightning FX]
type = RemoveExplod
trigger1 = !time
ID = 2006

[State 3000, nhb]
type = NotHitBy
trigger1 = time<11
;time = 1
value = SCA

[State 3000, width]
type = width
trigger1 = 1
value = 25,0

[state 1215, remove charge FX]
type = removeexplod
trigger1 = !time
ID = 2015

[state 1215, Smoke FX]
type = explod
trigger1 = !time
anim = 1206+(var(2)=0)
id = 1206
pos = -25,3
postype = P1
sprpriority = 3
ownpal = 1
removetime = -2
persistent = 0
ignorehitpause = 1

;[State 200, 1];voice
;type = PlaySnd
;;triggerall = var(55)=2		;Voice=Custom Corey Holland
;trigger1 = time = 0
;value = 2300,1
;channel = 0

[State 0, emo launch sound]
type = PlaySnd
;triggerall = var(19) = 1  ;if Destiny mode
trigger1 = !time
value = 2310,0
channel = 13

[State 3000, masenko]
type = helper
trigger1 = !time
helpertype = normal
stateno = 2341
ID = 2341
name = "chou_masenko_lvl_1"
postype = p1
ownpal = 1
;size.xscale = 0.6
;size.yscale = 1

[State 0, Charge lightning FX]
type = Explod
triggerall = var(19) = 1  ;if Destiny mode
trigger1 = time = 5
anim = 2312
id = 2312
pos = 35,-60
postype = p1
supermovetime = 9999
pausemovetime = 9999
ignorehitpause = 1
supermove = 1
removetime = -1
sprpriority = 6
ownpal = 1
bindtime = -1
scale = 1,1

[State 3000, end]
type = changeanim
trigger1 = anim=2310 && time>1 && !numhelper(2341)
value = 2315

[State 3000, end]
type = changestate
trigger1 = anim=2315 && !animtime
value = 0
ctrl = 1

;-------------------------------
;Shoot up
[Statedef 2350]
type = S
physics = S
movetype = A
anim = 2320
ctrl = 0
velset = 0,0
sprpriority = 1

[State 0, Charge lightning FX]
type = RemoveExplod
trigger1 = !time
ID = 2006

[State 3000, nhb]
type = NotHitBy
trigger1 = time<11
time = 1
value = SCA

[State 3000, width]
type = width
trigger1 = 1
value = 25,0

[state 1215, remove charge FX]
type = removeexplod
trigger1 = !time
ID = 2015

[state 1215, Smoke FX]
type = explod
trigger1 = !time
anim = 1206+(var(2)=0)
id = 1206
pos = -25,3
postype = P1
sprpriority = 3
ownpal = 1
removetime = -2
persistent = 0
ignorehitpause = 1

;[State 200, 1];voice
;type = PlaySnd
;;triggerall = var(55)=2		;Voice=Custom Corey Holland
;trigger1 = time = 0
;value = 2300,1
;channel = 0

[State 0, emo launch sound]
type = PlaySnd
triggerall = var(19) = 1  ;if Destiny mode
trigger1 = !time
value = 2310,0
channel = 13

[State 3000, masenko]
type = helper
trigger1 = !time
helpertype = normal
stateno = 2351
ID = 2351
name = "chou_masenko_lvl_1_up"
postype = p1
ownpal = 1
;size.xscale = 0.6
;size.yscale = 1

[State 0, Charge lightning Up FX]
type = Explod
triggerall = var(19) = 1  ;if Destiny mode
trigger1 = time = 5
anim = 2322
id = 2322
pos = 7,-96
postype = p1
supermovetime = 9999
pausemovetime = 9999
ignorehitpause = 1
supermove = 1
removetime = -1
sprpriority = 6
ownpal = 1
bindtime = -1
scale = 1,1

[State 3000, end]
type = changeanim
trigger1 = anim=2320 && time>1 && !numhelper(2351)
value = 2325

[State 3000, end]
type = changestate
trigger1 = anim=2325 && !animtime
value = 0
ctrl = 1


;===========================================================================
; <<<<< SOARING DRAGON STRIKE >>>>>
; Charge = 2100
; Dash = 2105
; On ground = 2110
; P2 state = 2111 (not used)
; Rising and landing = 2115 (anims = 2115,2120,2125)
;===========================================================================

;Soaring DS Charge
[Statedef 2100]
type = S
physics = S
movetype = A
anim = 2100
ctrl = 0
velset = 0,0
sprpriority = 1
poweradd = -1000;IfElse(fvar(27)>0,0,-1000)

[State 650, Fill Destiny Gauge - Hit - EX]
type		= null;VarAdd
trigger1		= fvar(27)>0
fvar(28)		= -100;IfElse(fvar(28)+30 > 300, 300-fvar(28), 30)
persistent	= 0
ignorehitpause	= 1
[State 3000, if Destiny bar = 0]
type = null;VarSet
trigger1 = fvar(28) <= 0
fvar(27)=0

[State 3000, Supermoves counter for Destiny mode]
type = null;VarAdd
trigger1 = Time = 0 && fvar(27)>0
fvar(31)=1
persistent = 0
[State 3000, Three or more moves, Destiny mode ends]
type = null;VarSet
trigger1 = !time && fvar(31)>=3
fvar(27)=0

;[State 2100, HitCount reset (only for supermoves)] ;never use this
;type		= VarSet
;triggerall	= var(39)!=0
;trigger1		= Time = 0
;var(39)		= 0
;persistent	= 0
;ignorehitpause	= 1



[State 3000, width]
type = width
trigger1 = 1
value = 25,0


[State 0, AssertSpecial]
type = AssertSpecial
trigger1 = time = [0,48]
flag = noFG

[State 3000, nhb]
type = NotHitBy
trigger1 = 1
time = 1
value = SCA

[State 1000, shake]
type = EnvShake
trigger1 = !(time%4)
time=4
freq=80
ampl=1.5+0.02*time

[State 220, voice]
type = null ;PlaySnd
;triggerall = var(55)=2		;Voice=Custom Corey Holland
trigger1 = time = 5
value = 2101,3
channel = 0

[State 3000, SuperPause]
type = SuperPause
trigger1 = time=5
time = 40
p2defmul = 1
unhittable = 1
anim = -1
sound = s2000,0
darken = 0
movetime = 0

[State 0, Super FX]
type = Explod
trigger1 = time = 5
anim = 2003
id = 2003
pos = -118,31   ;-102,70
postype = p1
supermovetime = 9999
pausemovetime = 9999
supermove = 1
removetime = -2
sprpriority = 8
ownpal = 1
bindtime = -1
scale = 1,1
persistent = 0

[State 2500, bgpalfx1]
type = bgpalfx
trigger1 = !time
time = 48
color=0
mul=0,0,0

[State 4001, End]
type = ChangeState
trigger1 = !AnimTime
value = 2105
ctrl = 0

;-------------------------------
; Soaring DS Dash
[Statedef 2105]
type    = S
movetype= A
physics = N
ctrl = 0
anim = 2105

[State 2105, PlayerPush]
type = PlayerPush
trigger1 = 1
value = 0
ignorehitpause = 1
;persistent = 


[State 2105, voice]
type = PlaySnd
;triggerall = var(55)=2		;Voice=Custom Corey Holland
trigger1 = !time ;animelemtime(2)=0
value = 2101,4
channel = 0

[State 2105, 1];Speed SFX
type = PlaySnd
trigger1 = animelemtime(2)=0
value = 2100,0
persistent = 0

[State 2105, horizontal dash FX]
type = explod
trigger1 = animelemtime(2)=0
anim = 2704
id = 2704
pos = 40,-45
sprpriority = -1
bindtime = -1
ownpal = 1
removeongethit = 1
ignorehitpause = 1
facing = 1
removetime = -1
supermovetime = 99999
pausemovetime = 99999
scale = 1.2,1.2

[State 2105, 2]
type = VelSet
trigger1 = animelemtime(2)=0
x = 20

[State 2105, 3]
type = VelMul
trigger1 = Time > 5
x = .97

[State 2105, A must for dashes everywhere]
type = Assertspecial
trigger1 = 1
flag = nowalk
[State 2105, No Turn]
type = AssertSpecial
trigger1 = 1
flag = NoAutoTurn

[state 2105, Smoke FX]
type = explod
trigger1 = animelemtime(2)=0
anim = 1206+(var(2)=0)
id = 1206
pos = -25,3
postype = P1
sprpriority = 3
ownpal = 1
removetime = -2
persistent = 0
ignorehitpause = 1

[State 2105, HelpTrain]
type = null ;Helper
trigger1 = Time = 1
name = "Trainee"
ID = 2702
stateno = 2702
pausemovetime = 50

[State 2105, End]
type = ChangeState
trigger1 = abs(P2bodydist X) <= 25
value = 2110
ctrl = 0

[State 2105, NotHitBy]
type = NotHitBy
trigger1 = 1
value = SCA,NP,SP
;value2 = S,NA
time = 1
ignorehitpause = 1
;persistent = 


[State 4001, End]
type = ChangeState
trigger1 = time > 30
value = 101
ctrl = 1

;-------------------------------
; Soaring DS on ground
[Statedef 2110]
type    = S
movetype= A
physics = N
ctrl = 0
anim = 2110
velset = 0,0

[State 4000, pos]
type = PosAdd
trigger1 = !time
X = 20

[State 4000, Invincible]
type = NotHitBy
trigger1 = 1
value = SCA

[State 4000, ToAir]
type = ChangeState
trigger1 = AnimTime = 0
value = 2115
ctrl = 0

;----------------------------
;Enemy Thrown State (SDS)
[Statedef 2111]
type = S
movetype = H
physics = N
velset = 0,0
sprpriority = 1

[State 182, 1]
type = screenbound
trigger1 = 1
movecamera = 1,0
value = 1

[State 802, anim]
type = changeanim2
trigger1 = !time
value = 2111

[State 801, end]
type = selfstate
trigger1 = !animtime
value = 5100
ctrl = 0

;----------------------------
;Rising (actual attack)
[StateDef 2115]
type = A
movetype = A
physics = N
ctrl = 0
anim = 2114
velset = 7,-6

;[State 2115, HitCount add (only for supermoves)]
;type		= VarAdd
;trigger1		= MoveHit
;trigger1		= NumTarget
;trigger1		= Target, Time = 0
;var(39)		= 1
;persistent	= 1
;ignorehitpause	= 1


[state 2115, Rising Effect]
type = explod
trigger1 = !time
anim = 1216+var(2)
id = 1216
pos = 10,12
postype = P1
sprpriority = -3
ownpal = 1
removetime = -2
persistent = 0
ignorehitpause = 1

[State 2115, snd]
type = PlaySnd
trigger1 = !time
value = 40,1

[State 2115, 1];Dragon woosh sound
type = PlaySnd
trigger1 = !time
value = 2100,1

[State 2115, AirFriction]
type = VelMul
trigger1 = Vel X != 0
X = .95


;----------------------
[State 1100, hit]
type = hitdef
triggerall = fvar(27) = 0
triggerall = hitcount < 9
trigger1 = NumExplod(2100)<3
trigger1 = !NumExplod(801)
trigger1 = time%2=0
attr = A,HA
damage = Ceil(IfElse(fvar(11) * 22 < 10, 10, fvar(11) * 22)), 4
;Ceil(IfElse(fvar(11) * 22 < 7, 7, fvar(11) * 22)), 4
; 22,4
animtype = Back
guardflag = MA
hitflag = MAF
priority=4,Hit
pausetime= 3,4
guard.pausetime= 6,6
sparkno = s7020
guard.sparkno = s7000
sparkxy = -20+5*(random%4),-120+5*(random%5)
hitsound = s2100,3  ;s5,1
guardsound = s6,1
ground.type=High
ground.slidetime=16
ground.hittime=16
ground.velocity=-1.5,-8
air.type = Low
air.velocity=-1.5,-12
ground.cornerpush.veloff= 0
guard.velocity= -10.52
guard.cornerpush.veloff= -12.74
getpower = 0,0
givepower = 20,20
envshake.time=16
envshake.freq=60
envshake.ampl=4
fall=1
fall.recover=0
airguard.ctrltime= 16
airguard.velocity= -4, -1.5
forcestand=1
airguard.cornerpush.veloff= 0
;kill = hitcount > 5
;nochainid = 2115


[State 1100, last hit]
type = hitdef
triggerall = fvar(27) = 0
triggerall = hitcount = 9
trigger1 = !NumExplod(2100)
trigger1 = !NumExplod(801)
trigger1 = 1
attr = A,HA
damage = Ceil(IfElse(fvar(11) * 22 < 10, 10, fvar(11) * 22)), 4
;Ceil(IfElse(fvar(11) * 22 < 7, 7, fvar(11) * 22)), 4
; 22,4
animtype = Back
guardflag = MA
hitflag = MAF
priority=4,Hit
pausetime= 19,20
guard.pausetime= 12,12
sparkno = s7030
guard.sparkno = s7000
sparkxy = -20+5*(random%4),-120+5*(random%5)
hitsound = s5,2
guardsound = s6,1
ground.type=High
ground.slidetime=16
ground.hittime=16
ground.velocity=-3,-12
air.type = Low
air.velocity=-3,-11
ground.cornerpush.veloff= 0
guard.velocity= -10.52
guard.cornerpush.veloff= -12.74
getpower = 0,0
givepower = 20,20
envshake.time=20
envshake.freq=100
envshake.ampl=6
fall=1
fall.recover=0
airguard.ctrltime= 16
airguard.velocity= -4, -1.5
forcestand=1
airguard.cornerpush.veloff= 0
;id = 890

;------------------------
[State 1100, hit]
type = hitdef
triggerall = fvar(27) > 0
triggerall = hitcount < 9
trigger1 = !NumExplod(2100)
trigger1 = !NumExplod(801)
trigger1 = time%2=0
;trigger1 = fvar(28) := IfElse(MoveHit,fvar(28) + IfElse(fvar(31)=1, -6, -9), fvar(28)) ;Destiny bar when hitting
attr = A,HA
damage = Ceil(IfElse(fvar(11) * 15 < 7, 7, fvar(11) * 15)), 4
;Ceil(IfElse(fvar(11) * 22 < 7, 7, fvar(11) * 22)), 4
; 22,4
animtype = Back
guardflag = MA
hitflag = MAF
priority=4,Hit
pausetime= 3,4
guard.pausetime= 6,6
sparkno = s7020
guard.sparkno = s7000
sparkxy = -20+5*(random%4),-120+5*(random%5)
hitsound = s2100,3  ;s5,1
guardsound = s6,1
ground.type=High
ground.slidetime=16
ground.hittime=16
ground.velocity=-1.5,-80
air.type = Low
air.velocity=-1.5,-12
ground.cornerpush.veloff= 0
guard.velocity= -10.52
guard.cornerpush.veloff= -12.74
getpower = 0,0
givepower = 20,20
envshake.time=16
envshake.freq=60
envshake.ampl=4
fall=1
fall.recover=0
airguard.ctrltime= 16
airguard.velocity= -4, -1.5
forcestand=1
airguard.cornerpush.veloff= 0
;kill = hitcount > 5
;nochainid = 890

[State 1100, last hit]
type = hitdef
triggerall = fvar(27) > 0
;triggerall = hitcount = 9
trigger1 = !NumExplod(2100)
trigger1 = !NumExplod(801)
trigger1 = hitcount = 9
;trigger1 = fvar(28) := IfElse(MoveHit,fvar(28) + IfElse(fvar(31)=1, -6, -9), fvar(28))	;Destiny bar when hitting
attr = A,HA
damage = Ceil(IfElse(fvar(11) * 15 < 7, 7, fvar(11) * 15)), 4
;Ceil(IfElse(fvar(11) * 22 < 7, 7, fvar(11) * 22)), 4
; 22,4
animtype = Back
guardflag = MA
hitflag = MAF
priority=4,Hit
pausetime= 19,20
guard.pausetime= 12,12
sparkno = s7030
guard.sparkno = s7000
sparkxy = -20+5*(random%4),-120+5*(random%5)
hitsound = s5,2
guardsound = s6,1
ground.type=High
ground.slidetime=16
ground.hittime=16
ground.velocity=-3,-12
air.type = Low
air.velocity=-3,-11
ground.cornerpush.veloff= 0
guard.velocity= -10.52
guard.cornerpush.veloff= -12.74
getpower = 0,0
givepower = 20,20
envshake.time=20
envshake.freq=100
envshake.ampl=6
fall=1
fall.recover=0
airguard.ctrltime= 16
airguard.velocity= -4, -1.5
forcestand=1
airguard.cornerpush.veloff= 0
;id = 890

[State 3000, if Destiny bar = 0]
type = null;VarSet
trigger1 = fvar(28) <= 0
fvar(27)=0

[State 250, 1]
type = ChangeAnim
trigger1 = Anim=2114 && hitcount=9
trigger2 = Anim=2114 && Pos Y < -120
value = 2115
;ignorehitpause = 1

;----------------
; Falling

[State 4001, Fall]
type = VelAdd
trigger1 = Anim = [2114,2115]
trigger1 = Pos Y < -80
trigger2 = Anim = 2120
Y = .4

[State 0, AttackDist]
type = AttackDist
trigger1 = Anim = 2120
trigger1 = AnimElemTime(1) >= 0
value = 0

;Limiter
[State 0, Explod]
type = Explod
trigger1 = NumExplod(2100)<2
trigger1 = Vel Y >0
anim = 15999
ID = 2100
bindtime = -1
removeongethit = 1
removetime = -1

[State 4001, Return&Landing]
type = ChangeAnim
trigger1 = Anim = 2115
trigger1 = Vel Y >= 0.0
trigger2 = Anim = 2120
trigger2 = Pos Y = 0
value = Anim+5

[State 0, AttackDist]
type = AttackDist
trigger1 = Anim = 2125
trigger1 = AnimElemTime(1) >= 0
value = 0

[State 4001, StopFwd]
type = VelSet
trigger1 = Vel X = (0,0.4]
X = 0

[State 4001, Stop]
type = VelSet
trigger1 = Vel Y > abs(Pos Y)
Y = 0

[State 4001, Replace]
type = PosSet
trigger1 = Vel Y = 0
Y = 0

[State 4001, ToGround]
type = StateTypeSet
trigger1 = Anim = 2125
persistent = 0
statetype = S
physics = S

[State 17100, Landing Sound]
type = PlaySnd
trigger1 = anim=2125
value = 40, 0
persistent = 0

[state 17100, Landing Effect]
type=explod
trigger1 = Anim = 2125
anim=17100
id=17100
pos=-15,0
postype=P1
sprpriority=-3
ownpal=1
supermovetime=-1
removetime = -2
persistent = 0

[State 4001, End]
type = ChangeState
trigger1 = Anim = 2125
trigger1 = AnimTime = 0
value = 0
ctrl = 1

;===========================================================================
; <<<<< SOARING DRAGON UNLEASHED >>>>>
; Charge = 2200
; Dash = 2205
; On ground = 2210
; Rising and landing = 2215 (anims = 2115,2120,2125)
;===========================================================================

; Soaring DU Charge
[Statedef 2200]
type = S
physics = S
movetype = A
anim = 2100
ctrl = 0
velset = 0,0
sprpriority = 1
poweradd = -2000;IfElse(fvar(27)>0,0,-2000)

[State 650, Fill Destiny Gauge - Hit - EX]
type		= null;VarAdd
trigger1		= fvar(27)>0
fvar(28)		= -200;IfElse(fvar(28)+30 > 300, 300-fvar(28), 30)
persistent	= 0
ignorehitpause	= 1
[State 3000, if Destiny bar = 0]
type = null;VarSet
trigger1 = fvar(28) <= 0
fvar(27)=0

[State 3000, Supermoves counter for Destiny mode]
type = null;VarAdd
trigger1 = Time = 0 && fvar(27)>0
fvar(31)=1
persistent = 0
[State 3000, Three or more moves, Destiny mode ends]
type = null;VarSet
trigger1 = !time && fvar(31)>=3
fvar(27)=0

;[State 2100, HitCount reset (only for supermoves)]
;type		= VarSet
;triggerall	= var(39)!=0
;trigger1		= Time = 0
;var(39)		= 0
;persistent	= 0
;ignorehitpause	= 1

[State 3000, width]
type = width
trigger1 = 1
value = 25,0

[State 0, AssertSpecial]
type = AssertSpecial
trigger1 = time = [0,48]
flag = noFG

[State 3000, nhb]
type = NotHitBy
trigger1 = 1
time = 1
value = SCA

[State 1000, shake]
type = EnvShake
trigger1 = !(time%4)
time=4
freq=80
ampl=1.5+0.02*time

[State 220, voice]
type = null;PlaySnd
triggerall = var(55)=0		;Voice=Japan
trigger1 = time = 5
value = 2101,0
channel = 0

[State 220, voice]
type = null;PlaySnd
triggerall = var(55)=1		;Voice=English
trigger1 = time = 5
value = 2101,2
channel = 0

[State 220, voice]
type = null ;PlaySnd
;triggerall = var(55)=2		;Voice=Custom Corey Holland
trigger1 = time = 5
value = 2102,random%2
channel = 0

[State 200, SuperPause sound]
type = PlaySnd
trigger1 = time=5
value = 2350,0

[State 3000, SuperPause]
type = SuperPause
trigger1 = time=5
time = 40
p2defmul = 1
unhittable = 1
anim = -1
darken = 0
movetime = 0

[State 0, Hyper Charge FX]
type = Explod
trigger1 = time = 5
anim = 2442
id = 2440
pos = -6,-76    ;10,-37
postype = p1
supermovetime = 9999
pausemovetime = 9999
supermove = 1
removetime = -2
sprpriority = 6
ownpal = 1
bindtime = -1
scale = 1,1
persistent = 0

[State 2500, bgpalfx1]
type = bgpalfx
trigger1 = !time
time = 48
color=0
mul=0,0,0

[State 4001, End]
type = ChangeState
trigger1 = !AnimTime
value = 2205
ctrl = 0

;-------------------------------
; Soaring DU Dash
[Statedef 2205]
type    = S
movetype= A
physics = N
ctrl = 0
anim = 2105

[State 2105, PlayerPush]
type = PlayerPush
trigger1 = 1
value = 0
ignorehitpause = 1
;persistent = 

[State 220, voice]
type = PlaySnd
;triggerall = var(55)=2		;Voice=Custom Corey Holland
trigger1 = !time  ;animelemtime(3)=0
value = 2102,2+random%3
channel = 0

[State 4500, 1];Speed SFX
type = PlaySnd
trigger1 = animelemtime(2)=0
value = 2100,0
persistent = 0

[State 3000, nhb]
type = NotHitBy
trigger1 = 1
time = 1
value = SCA

[State 1900, horizontal dash FX]
type = explod
trigger1 = animelemtime(2)=0
anim = 2704
id = 2704
pos = 40,-45
sprpriority = -1
bindtime = -1
ownpal = 1
removeongethit = 1
ignorehitpause = 1
facing = 1
removetime = -1
supermovetime = 99999
pausemovetime = 99999
scale = 1.2,1.2

[State 3005, 2]
type = VelSet
trigger1 = animelemtime(2)=0
x = 25

[State 3005, 3]
type = VelMul
trigger1 = Time > 5
x = .97

[State 100, A must for dashes everywhere]
type = Assertspecial
trigger1 = 1
flag = nowalk
[State 100, No Turn]
type = AssertSpecial
trigger1 = 1
flag = NoAutoTurn

[state 1215, Smoke FX]
type = explod
trigger1 = animelemtime(2)=0
anim = 1206+(var(2)=0)
id = 1206
pos = -25,3
postype = P1
sprpriority = 3
ownpal = 1
removetime = -2
persistent = 0
ignorehitpause = 1

[State 13000, HelpTrain]
type = Helper
trigger1 = Time = 1
name = "Trainee"
ID = 2207
stateno = 2207 
pausemovetime = 50

[State 4001, End]
type = ChangeState
trigger1 = abs(P2bodydist X) <= 30
value = 2210
ctrl = 0

[State 4001, End]
type = ChangeState
trigger1 = time > 30
value = 101
ctrl = 1

;-------------------------------
; Soaring DU on ground
[Statedef 2210]
type    = S
movetype= A
physics = N
ctrl = 0
anim = 2110
velset = 0,0

[State 4000, pos]
type = PosAdd
trigger1 = !time
X = 30

[State 4000, Invincible]
type = NotHitBy
trigger1 = 1
value = SCA

[State 4000, ToAir]
type = ChangeState
trigger1 = AnimTime = 0
value = 2215
ctrl = 0

;----------------------------
;Rising (actual attack)
[StateDef 2215]
type = A
movetype = A
physics = N
ctrl = 0
anim = 2114
velset = 7,-5  ;4,-4

;[State 2215, HitCount add (only for supermoves)]
;type		= VarAdd
;trigger1		= MoveHit
;trigger1		= NumTarget
;trigger1		= Target, Time = 0
;var(39)		= 1
;persistent	= 1
;ignorehitpause	= 1


[State 2215, Invincible]
type = NotHitBy
trigger1 = time < 5
value = SCA

[state 2215, Rising Effect]
type = explod
trigger1 = !time
anim = 1216+var(2)
id = 1216
pos = 10,12
postype = P1
sprpriority = -3
ownpal = 1
removetime = -2
persistent = 0
ignorehitpause = 1

[State 2215, snd]
type = PlaySnd
trigger1 = !time
value = 40,1

[State 2215, 1];Dragon woosh Lv2 sound
type = PlaySnd
trigger1 = !time
value = 2100,2

[state 2215, SDU Aura FX]
type = explod
trigger1 = !time
anim = 2116+var(2)
id = 2116
pos = 0,0
postype = P1
sprpriority = 5
ownpal = 1
removetime = -1
persistent = 0
ignorehitpause = 1
removeongethit = 1

[State 2215, AirFriction]
type = VelMul
trigger1 = Vel X != 0
X = .95

;----------------------
[State 2215, hit]
type = hitdef
triggerall = fvar(27) = 0
triggerall = hitcount < 19
trigger1 = NumExplod(2101)<3
trigger1 = !NumExplod(801)
trigger1 = time%2=0
attr = A,HA
damage = Ceil(IfElse(fvar(11) * 19 < 10, 10, fvar(11) * 19)), 2
;Ceil(IfElse(fvar(11) * 19 < 7, 7, fvar(11) * 19)), 2
; 19,2
animtype = Back
guardflag = MA
hitflag = MAF
priority=4,Hit
pausetime= 3,4
guard.pausetime= 6,6
sparkno = s7020
guard.sparkno = s7000
sparkxy = -20+5*(random%4),-120+5*(random%5)
hitsound = s2100,3  ;s5,1
guardsound = s6,1
ground.type=High
ground.slidetime=16
ground.hittime=16
ground.velocity=-1.5,-10
air.type = Low
air.velocity=-1.5,IfElse(hitcount<10,-14,-9);check this out check this out check this out check this out
ground.cornerpush.veloff= 0
guard.velocity= -10.52
guard.cornerpush.veloff= -12.74
getpower = 0,0
givepower = 20,20
envshake.time=16
envshake.freq=60
envshake.ampl=4
fall=1
fall.recover=0
airguard.ctrltime= 16
airguard.velocity= -4, -1.5
forcestand=1
airguard.cornerpush.veloff= 0
kill = hitcount > 10 ;15
;nochainid = 2215

[State 2215, last hit]
type = hitdef
triggerall = fvar(27) = 0
triggerall = hitcount = 19
trigger1 = !NumExplod(2101)
trigger1 = !NumExplod(801)
trigger1 = 1
attr = A,HA
damage = Ceil(IfElse(fvar(11) * 27 < 13, 13, fvar(11) * 27)), 4
;Ceil(IfElse(fvar(11) * 27 < 7, 7, fvar(11) * 27)), 4
; 27,4
animtype = Back
guardflag = MA
hitflag = MAF
priority=4,Hit
pausetime= 19,20
guard.pausetime= 12,12
sparkno = s7030
guard.sparkno = s7000
sparkxy = -20+5*(random%4),-120+5*(random%5)
hitsound = s5,2
guardsound = s6,1
ground.type=High
ground.slidetime=16
ground.hittime=16
ground.velocity=-3,-12
air.type = Low
air.velocity=-3,-11
ground.cornerpush.veloff= 0
guard.velocity= -10.52
guard.cornerpush.veloff= -12.74
getpower = 0,0
givepower = 20,20
envshake.time=20
envshake.freq=100
envshake.ampl=6
fall=1
fall.recover=0
airguard.ctrltime= 16
airguard.velocity= -4, -1.5
forcestand=1
airguard.cornerpush.veloff= 0
;id = 2215

;-------------------------
[State 2215, hit];with Destiny mode activated
type = hitdef
triggerall = fvar(27) > 0
triggerall = hitcount < 19
trigger1 = !NumExplod(2101)
trigger1 = !NumExplod(801)
trigger1 = time%2=0
;trigger1 = fvar(28) := IfElse(MoveHit,fvar(28) + IfElse(fvar(31)=1, -6, -9), fvar(28))	;Destiny bar when hitting
attr = A,HA
damage = Ceil(IfElse(fvar(11) * 14 < 7, 7, fvar(11) * 14)), 2
;Ceil(IfElse(fvar(11) * 19 < 7, 7, fvar(11) * 19)), 2
; 19,2
animtype = Back
guardflag = MA
hitflag = MAF
priority=4,Hit
pausetime= 3,4
guard.pausetime= 6,6
sparkno = s7020
guard.sparkno = s7000
sparkxy = -20+5*(random%4),-120+5*(random%5)
hitsound = s2100,3  ;s5,1
guardsound = s6,1
ground.type=High
ground.slidetime=16
ground.hittime=16
ground.velocity=-1.5,-20
air.type = Low
air.velocity=-1.5,-10
ground.cornerpush.veloff= 0
guard.velocity= -10.52
guard.cornerpush.veloff= -12.74
getpower = 0,0
givepower = 20,20
envshake.time=16
envshake.freq=60
envshake.ampl=4
fall=1
fall.recover=0
airguard.ctrltime= 16
airguard.velocity= -4, -1.5
forcestand=1
airguard.cornerpush.veloff= 0
kill = hitcount > 10 ;15
;nochainid = 2215

[State 2215, last hit];with Destiny mode activated
type = hitdef
triggerall = fvar(27) > 0
;triggerall = hitcount = 19
trigger1 = !NumExplod(2101)
trigger1 = !NumExplod(801)
trigger1 = hitcount = 19
;trigger1 = fvar(28) := IfElse(MoveHit,fvar(28) + IfElse(fvar(31)=1, -6, -9), fvar(28))	;Destiny bar when hitting
attr = A,HA
damage = Ceil(IfElse(fvar(11) * 19 < 9, 9, fvar(11) * 19)), 4
;Ceil(IfElse(fvar(11) * 22 < 7, 7, fvar(11) * 22)), 4
; 22,4
animtype = Back
guardflag = MA
hitflag = MAF
priority=4,Hit
pausetime= 19,20
guard.pausetime= 12,12
sparkno = s7030
guard.sparkno = s7000
sparkxy = -20+5*(random%4),-120+5*(random%5)
hitsound = s5,2
guardsound = s6,1
ground.type=High
ground.slidetime=16
ground.hittime=16
ground.velocity=-3,-12
air.type = Low
air.velocity=-3,-11
ground.cornerpush.veloff= 0
guard.velocity= -10.52
guard.cornerpush.veloff= -12.74
getpower = 0,0
givepower = 20,20
envshake.time=20
envshake.freq=100
envshake.ampl=6
fall=1
fall.recover=0
airguard.ctrltime= 16
airguard.velocity= -4, -1.5
forcestand=1
airguard.cornerpush.veloff= 0
;id = 2215

[State 2215, if Destiny bar = 0]
type = null;VarSet
trigger1 = fvar(28) <= 0
fvar(27)=0

[State 2215, 1]
type = ChangeAnim
trigger1 = Anim=2114 && hitcount=19
trigger2 = Anim=2114 && Pos Y < -170
value = 2115
;ignorehitpause = 1

;----------------
; Falling

[State 4001, Fall]
type = VelAdd
trigger1 = Anim = [2114,2115]
trigger1 = Pos Y < -150
trigger2 = Anim = 2120
Y = .4

;Limiter
[State 0, Explod]
type = Explod
trigger1 = NumExplod(2101)<2
trigger1 = Vel Y >0
anim = 15999
ID = 2101
bindtime = -1
removeongethit = 1
removetime = -1

[State 4001, Return&Landing]
type = ChangeAnim
trigger1 = Anim = 2115
trigger1 = Vel Y >= 0.0
trigger2 = Anim = 2120
trigger2 = Pos Y = 0
value = Anim+5

; SDU Aura Remove
[State 2115]
type = removeexplod
trigger1 = numexplod(2116)
trigger1 = Anim != [2114,2115]
ID = 2116

[State 4001, StopFwd]
type = VelSet
trigger1 = Vel X = (0,0.4]
X = 0

[State 4001, Stop]
type = VelSet
trigger1 = Vel Y > abs(Pos Y)
Y = 0

[State 4001, Replace]
type = PosSet
trigger1 = Vel Y = 0
Y = 0

[State 4001, ToGround]
type = StateTypeSet
trigger1 = Anim = 2125
persistent = 0
statetype = S
physics = S

[State 17100, Landing Sound]
type = PlaySnd
trigger1 = anim=2125
value = 40, 0
persistent = 0

[state 17100, Landing Effect]
type=explod
trigger1 = Anim = 2125
anim=17100
id=17100
pos=-15,0
postype=P1
sprpriority=-3
ownpal=1
supermovetime=-1
removetime = -2
persistent = 0

[State 4001, End]
type = ChangeState
trigger1 = Anim = 2125
trigger1 = AnimTime = 0
value = 0
ctrl = 1


;===========================================================================
; <<<<< CHOU KAMEHAMEHA >>>>>
; Charge State = 2400
; Throw Kmh : 2400
; Beam helper : 2402
; stop and go to stance : 2403
; Beam counter charge state : 2480
; Beam counter thrown for both players : 2481
; Collision beam helper : 2482
; Both helpers have collided : 2483
;===========================================================================

;Chou Kame- charge
[Statedef 2400]
type = S
physics = S
movetype = A
anim = 2400
ctrl = 0
velset = 0,0
sprpriority = 1
poweradd = -2000;IfElse(fvar(27)>0,0,-2000)

[state 0] ;exit emo mode
type = null;varset
trigger1 = !time
fvar(27) = 0
ignorehitpause = 1

[State 0, HitDef]
type = null;HitDef
;trigger1 = fVar(28) = [100,199]
trigger1 = Time = 1
attr = S,HP        ;SCA,NA,SA,HA,NP,SP,HP,NT,ST,HT
hitflag = MAF        ;HLAFD+-
guardflag = MA         ;HLA
pausetime = 0,22
guard.pausetime = 0,0
sparkno		= s-1
guard.sparkno	= s-1
ground.hittime = 0
guard.hittime = 0
air.hittime = 0
guard.dist = 99999
p2facing = 1
id = 3301
kill = 0
;fall = 1
guard.kill = 0
numhits = 0

[State 0, HitDef]
type = null;HitDef
trigger1 = fVar(28) = [200,300]
trigger1 = Time = 1
attr = S,HP        ;SCA,NA,SA,HA,NP,SP,HP,NT,ST,HT
hitflag = MAF        ;HLAFD+-
guardflag = MA         ;HLA
pausetime = 0,22
guard.pausetime = 0,0
sparkno		= s-1
guard.sparkno	= s-1
ground.hittime = 0
guard.hittime = 0
air.hittime = 0
guard.dist = 99999
p2facing = 1
id = 3300
kill = 0
;fall = 1
guard.kill = 0
numhits = 0

[State 0, Projectile]
type = null;Projectile
trigger1 = fVar(28) = 300
trigger1 = Time = 1
ProjID = 2406
projanim = 2406
projremovetime = 1
offset = 40,-58
postype = p1         ;p2,front,back,left,right
attr = S,HP        ;SCA,NA,SA,HA,NP,SP,HP,NT,ST,HT
hitflag = MAF        ;HLAFD+-
guardflag = MA         ;HLA
pausetime = 0,22
guard.pausetime = 0,0
sparkno		= s-1
guard.sparkno	= s-1
ground.hittime = 0
guard.hittime = 0
air.hittime = 0
guard.dist = 99999
p2facing = 1
id = 3300
kill = 0
;fall = 1
guard.kill = 0
numhits = 0

[State 0, Projectile]
type = null;Projectile
trigger1 = fVar(28) = 300
trigger1 = Time = 2
ProjID = 2406
projanim = 2406
projremovetime = 1
offset = 40,-58
postype = p1         ;p2,front,back,left,right
attr = S,HT        ;SCA,NA,SA,HA,NP,SP,HP,NT,ST,HT
hitflag = MAF        ;HLAFD+-
guardflag = MA         ;HLA
pausetime = 0,22
sparkno		= s-1
guard.sparkno	= s-1
guard.pausetime = 0,0
ground.hittime = 0
guard.hittime = 0
air.hittime = 0
guard.dist = 99999
p2facing = 1
;fall = 1
id = 3300
kill = 0
guard.kill = 0
numhits = 0

[State 0, TargetState]
type = null;TargetState
triggerall = NumTarget(3300)
trigger1 = 1
value = 3202
ID = 3300
ignorehitpause = 1
persistent = 0

[State 0, ChangeState] ;go to lvl1 emo exit
type = ChangeState
trigger1 = NumTarget(3301)
trigger1 = !target(3301),IsHelper
value = 2405
ctrl = 0
ignorehitpause = 1

[State 0, ChangeState] ;go to lvl2 emo exit
type = null;ChangeState
trigger1 = NumTarget(3300)
trigger1 = !target(3300),IsHelper
value = 3201
ctrl = 0
ignorehitpause = 1

[State 0, VarSet]
type = null;VarSet
trigger1 = !Time
var(9) = Cond((fvar(28) = [100,199]),1, Cond((fvar(27) = [200,299]),2,3))

[state 0]
type = null;varset
trigger1 = fvar(28) = [200,299]
var(9) = 1

[State 0, for trial]
type = VarSet
trigger1 = !time
var(18) = 1

[State 3000, GOTEN]
type = null;helper
trigger1 = fVar(28) = [200,300]
trigger1 = time = 20
postype = p1
pos = 40,-60
stateno = 3210
ID = 3210
name = "goten"
supermovetime = 999999
pausemovetime = 999999

[State 3000, GOKU]
type = null;helper
trigger1 = fVar(28) = 300
trigger1 = time = 20
postype = p1
pos = 40,-60
stateno = 3211
ID = 3211
name = "goku"
supermovetime = 999999
pausemovetime = 999999

[State 0, remove Kmh Flash FX]
type = RemoveExplod
trigger1 = !time
ID = 2005
[State 0, remove Kmh Flash FX]
type = RemoveExplod
trigger1 = !time
ID = 2105

[State 3000, width]
type=width
trigger1 = 1
value = 25,0

[State 800, VarSet];Charging time
type = VarSet
trigger1 = !time
var(26) = 0

[State 0, AssertSpecial]
type = AssertSpecial
triggerall = anim = 2400
trigger1 = time = [0,200]
flag = noFG

[State 3000, nhb]
type = NotHitBy
trigger1 = anim = 2400 && var(26) = 0
trigger1 = Time <200
time = 1
value = SCA

[State 1000, shake]
type = EnvShake
triggerall = anim=2400
trigger1 = !(time%4)
time=4
freq=80
ampl=2+0.02*time

[State 200, 1];Voice (Kamehame)
type = null;PlaySnd
triggerall = var(55)=0		;Voice=Japan
triggerall = anim = 2400
trigger1 = time = 0
value = 2400,0
channel = 0
volume = 255

[State 200, 1];Voice (Kamehame)
type = null;PlaySnd
triggerall = var(55)=1		;Voice=English
triggerall = anim = 2400
trigger1 = time = 0
value = 2400,5
channel = 0
volume = 255

[State 200, 1];voice
type = PlaySnd
;triggerall = var(55)=2		;Voice=Custom Corey Holland
triggerall = anim = 2400
trigger1 = time = 0
value = 2400,6+random%2
channel = 0
volume = 255

[State 200, Kmh charge long]
type = PlaySnd
triggerall = anim = 2400
trigger1 = time = 60
value = 2400,1

[State 200, 1];charge power-up sound
type = PlaySnd
trigger1 = time = 5
value = 2400,20
channel = 5

[State 200, electricity]
type = PlaySnd
trigger1 = time > 60
trigger1 = (GameTime%40) = 20
value = 2400,2
volume = 10

[State 2500, bgpalfx1]
type = bgpalfx
triggerall = anim = 2400
trigger1 = time = [3,200]
time = 1
color=0
mul=0,0,0

[State 200, BGPalFX]
type = BGPalFX
trigger1 = time>=200
time = 1
add	= ceil(-256+1.7*Var(26)),ceil(-256+1.7*Var(26)),ceil(-256+1.7*Var(26))
mul	= 256,256,256
invertall = 0
color = 256

[State 200, SuperPause sound]
type = PlaySnd
trigger1 = time=5
value = 2350,0

[State 3000, SuperPause]
type = SuperPause
triggerall = anim = 2400
trigger1 = time=5
time = 192
p2defmul = 1
unhittable = 1
anim = -1
;sound = s2350,0
darken = 0
movetime = 192

[State 0, mouth LOL]
type = Explod
triggerall = anim = 2400
trigger1 = time = 5
anim = 24000
id = 24000
pos = 0,0
postype = p1
supermovetime = 9999
pausemovetime = 9999
supermove = 1
removetime = -1
sprpriority = 2
ownpal = 0
bindtime = -1
scale = 1,1
persistent = 0

[State 0, Hyper Charge FX]
type = Explod
triggerall = anim = 2400
trigger1 = time = 5
anim = 2442;2440
id = 2440
pos = -25,-57
postype = p1
supermovetime = 9999
pausemovetime = 9999
supermove = 1
removetime = -2
sprpriority = 6
ownpal = 1
bindtime = -1
scale = 1,1
persistent = 0

[State 0, Charge Ball FX]
type = Explod
triggerall = anim = 2400
trigger1 = time = 5
anim = 2420+10000*(var(2)=0)
id = 2420
pos = -25,-60
postype = p1
supermovetime = 9999
pausemovetime = 9999
supermove = 1
removetime = -1
sprpriority = 5
ownpal = 1
bindtime = -1
scale = 0.6,0.6
persistent = 0

[state 17100, scale charge FX]
type = ModifyExplod
trigger1 = numexplod(2420)
scale = 0.6+0.002*(time-20),0.6+0.002*(time-20)
id = 2420

[State 0, Charge lightning FX]
type = Explod
triggerall = anim = 2400
trigger1 = time = 5
anim = 2430
id = 2430
pos = -25,-57
postype = p1
supermovetime = 9999
pausemovetime = 9999
supermove = 1
removetime = -1
sprpriority = 5
ownpal = 1
bindtime = -1
scale = 1,1
persistent = 0

[State 0,from sky lightning]
type = explod
triggerall = anim = 2400 && time>=45
trigger1 = gametime%(40-var(26)/5) = 0
anim = 2450+random%6
sprpriority = 7
postype = p1
pos = 0,ceil(pos y)
facing = IfElse(random<500,-1,1)
random = 160,0
scale = 1,2
pausemovetime = -1
supermovetime = -1
ownpal = 1

[State 0, lightning sound]
type = PlaySnd
triggerall = anim = 2400 && time>=45
trigger1 = gametime%(40-var(26)/5) = 0
value = 2400,3
volume = -170-(32*numexplod)
freqmul = .9 + (random/5000.0)

[State 1211, BGPalFX]
type = BGPalFX
triggerall = anim = 2400 && time>=45
trigger1 = gametime%(40-var(26)/5) = 0
time = 3
color = 0
invertall = 1

[State 800, VarSet]
type = VarAdd
triggerall = Anim=2400 && time>200
trigger1 = !AILevel && ((command = "holdx") || (command = "holdy") || (command = "holdz"))
trigger2 = AILevel
var(26) = 1

;Throw Kmh
[State 901, ChangeAnim]
type = ChangeState
triggerall = !AILevel
trigger1 = Anim=2400 && time>=200
trigger1 = (command != "holdx") && (command != "holdy") && (command != "holdz")
trigger2 = time >= 350
value = 2401
ctrl = 0
[State 901, ChangeAnim]
type = ChangeState
triggerall = AILevel
trigger1 = Anim=2400 && time>=200
trigger1 = (EnemyNear,vel x>0)||(EnemyNear,Movetype=A)|| (EnemyNear,Movetype=I)
trigger1 = random < (100 * (AIlevel ** 2 / 64.0))
trigger2 = time >= 350
value = 2401
ctrl = 0

;-----------------------------
;Chou Kame- throwing
[Statedef 2401]
type = S
physics = S
movetype = A
anim = 2401
ctrl = 0
velset = 0,0
sprpriority = 5

[State 0, AttackDist]
type = AttackDist
trigger1 = 1
value = 1000

[state -2, remove charge ball FX Chou Kmh]
type = removeexplod
trigger1 = !time
id = 2420

[State 3000, nhb]
type = NotHitBy
trigger1 = var(26)=0 && time<6
time = 1
value = SCA

[State 800, VarSet];Charging time
type = VarSet
trigger1 = !time
var(25) = floor(var(26)/7.5)

[State 3000, width]
type=width
trigger1 = 1
value = 25,0

[State 200, 1];Voice (Haaa)
type = PlaySnd
trigger1 = time = 0
value = 2401,0
channel = 0
volume = 355

[State 200, 1];Voice (Haaa)
type = PlaySnd
trigger1 = time = 0
value = 2401,5
channel = 0
volume = 355

[State 200, 1];voice (Haaa)
type = PlaySnd
trigger1 = time = 0
value = 2401,6+random%2
channel = 0
volume = 255

[State 200, 1];Launching SFX
type = PlaySnd
trigger1 = time=4
value = 2401,1

[state 1215, Smoke FX]
type = explod
trigger1 = anim=2401 && animelem=3
anim = 1206+(var(2)=0)
id = 1206
pos = -25,3
postype = P1
sprpriority = 6
ownpal = 1
removetime = -2
persistent = 0
ignorehitpause = 1

[State 3000, Kamehameha]
type = helper
trigger1 = anim=2401 && animelem=3
helpertype = normal
stateno = 2402
ID = 2402
name = "ckameha"
postype = p1
pos = 40,-58
ownpal = 1

[State -2, Explod];On hands explod
type = Explod
triggerall = !numexplod(2403)
trigger1 = anim=2401 && animelem=3
anim = 2403
removetime = -1
sprpriority = 4
id = 2403
ownpal = 1
pos = 53,-58
ignorehitpause = 1
pausemovetime = 99999
supermovetime = 99999
bindtime = -1
;scale = 0.5,1

[State -2, Explod];On hands explod
type = ModifyExplod
trigger1 = anim=2401
trigger1 = WinKO && MatchOver
pos = 30,-58
scale = .6,1.5
ID = 2403

[State 3000, Kamehameha FX beam]
type = helper
trigger1 = anim=2401 && animelem=3
helpertype = normal
stateno = 2464
ID = 2464
name = "ckamehaFX_scale_beam"
postype = p1
pos = 47,-58
ownpal = 1

[State 200, 1];Dramatic SFX
type = PlaySnd
trigger1 = WinKO && (p2stateno=5941 || p2stateno=5943)
value = 5941,0
volume = 255
persistent = 0

;Stop
[State 901, ChangeAnim]
type = ChangeState
trigger1 = numhelper(2402)
trigger1 = helper(2402),var(2)=20+var(25)
trigger1 = Anim=2401
trigger2 = time>91 && !MatchOver
trigger3 = time>120 && WinKO && MatchOver
value = 2403
ctrl = 0

;-----------------------------
;Chou Kame- stop
[Statedef 2403]
type = S
physics = S
movetype = A
anim = 2410
ctrl = 0
velset = 0,0
sprpriority = 1

[state 17100,remove FX]
type = removeexplod
trigger1 = !time
id = 2405
[state 17100,remove overlay FX]
type = removeexplod
trigger1 = !time
id = 2908

[state 17100,scale FX]
type = ModifyExplod
trigger1 = numexplod(2403)
scale = 1, IfElse(1-0.05*time<0, 0, 1-0.05*time)
id = 2403
[state 17100,remove FX]
type = removeexplod
trigger1 = !animtime
id = 2403

[State 3000, end]
type = changestate
trigger1 = !animtime
value = 0
ctrl = 1

;---------------------------------------------------------------------------
;Emo Exit LVL1
[statedef 2405]
type = A
movetype = A
physics = N
ctrl = 0
anim = 3201
sprpriority = 2
facep2 = 1

[State 3000, nhb]
type = NotHitBy
trigger1 = 1
time = -1
value = SCA

[State 280, go]
type = VelSet
trigger1 = animelem = 1
y = -6

[State 200, 1];voice
type = PlaySnd
;triggerall = var(55)=2		;Voice=Custom Corey Holland
trigger1 = animelem=1
value = 3,220+random%9
channel = 0

[State 280, go]
type = VelAdd
trigger1 = animelemtime(1) > 0 && animelemtime(8) < 0
Y = 0.5
ignorehitpause = 1

[State 220, land]
type = statetypeset
trigger1 = animelem=8 
statetype = S

[State 280, go]
type = VelSet
trigger1 = animelem = 8
x = 0
y = 0

[State 1, land]
type = PosSet
trigger1 = animelem=8
y = 0

[State 1, go]
type = PosAdd
trigger1 = animelem=9
x = 20

[State 250, wheel kick SFX]
type = PlaySnd
trigger1 = AnimElem = 2
value = 270,0

[State 250, 1]
type = PlaySnd
trigger1 = AnimElem = 8
value = 0, 5

[State 250, 2]
type = HitDef
trigger1 = AnimElem = 9
attr = S, HA
animtype  = diagup
damage = Ceil(IfElse(fvar(11) * 44 < 22, 22, fvar(11) * 44)), 0
;Ceil(IfElse(fvar(11) * 44 < 7, 7, fvar(11) * 44)), 0
; 44,0
;priority = 4, Hit
guardflag = MAF
pausetime = 21,22
guard.pausetime = 22,22
sparkno = s7030
guard.sparkno = s7000
sparkxy = -30,-80
hitsound   = S2604,0
guardsound = S6,1
ground.type = low
ground.slidetime = 30
ground.hittime = 30
ground.velocity = ifelse(facing = enemy,facing,6,-6),-6
air.velocity = ifelse(facing = enemy,facing,4,-4),-4
air.animtype = diagup
getpower= 0,0
givepower = 35,35
yaccel = 0.5
p2facing = 1
fall = 1
fall.recovertime = 45
envshake.time = 40
envshake.freq = 200
envshake.ampl = 10 
kill = 0
;p2stateno = 3202
id = 2406

[State 0, TargetState]  ;New state
type = TargetState
trigger1 = Numtarget(2406)
trigger1 = movehit = 1
value = 2406
ID = 2406
ignorehitpause = 1
persistent = 0

[State 1, go]
type = PosAdd
trigger1 = animelem=15
x = -20

[State 250, 3]
type = ChangeState
triggerall = enemynear, StateNo = [2406,2408]
trigger1   = AnimTime = 0
value      = 2410
ctrl       = 0

[State 250, 3]
type = ChangeState
triggerall = enemynear, StateNo != [2406,2408]
trigger1   = AnimTime = 0
value      = 0
ctrl       = 1

;---------------------------------------------------------------------------
;P2 sent to wall by emo exit 1
[statedef 2406]
type = A
movetype = H
physics = N
ctrl = 0
sprpriority = -1
facep2 = 1 

[state 0]
type = velset
trigger1 = facing != enemy,facing
x = -9
y = ifelse(backedgebodydist <= 20,-5.7,-2)

[state 0]
type = velset
trigger1 = facing = enemy,facing
x = -9
y = ifelse(backedgebodydist <= 20,5.7,2)

[State 0, NotHitBy]
type = NotHitBy
trigger1 = 1
value = SCA

[State 13200, Anim]
type = ChangeAnim
trigger1 = Time = 0
value = IfElse(selfanimexist(5052),5052,5030)

[State 2406] ;hit wall
type = ChangeState
;triggerall = Pos y < -15
trigger1 = BackEdgeBodyDist <= 20
trigger2 = FrontEdgeBodyDist <= 20
value = 2407

;---------------------------------------------------------------------------
;P2 hitting wall
[statedef 2407]
type = A
movetype = H
physics = N

[State 0, NotHitBy]
type = NotHitBy
trigger1 = 1
value = SCA

[state 0]
type = turn
trigger1 = !time
trigger1 = frontedgebodydist <= 30

[State 1557, Pos]
type = PosAdd
trigger1 = Time = 0
x = 15 - BackEdgeBodyDist

[State 1557, Stop moving]
type = PosFreeze
trigger1 = 1
x = 1
y = 1

[State 1557, No scroll]
type = ScreenBound
trigger1 = 1
value = 1
movecamera = 0,1

[State 1557, Anim]
type = ChangeAnim2
trigger1 = Time = 0
value = 1557

[state 2407]
type = changestate
trigger1 = !animtime
value = 2408

;---------------------------------------------------------------------------
;P2 bouncing off wall
[Statedef 2408]
type    = A
movetype= H
physics = N

[State 1558, Vel Y]
type = VelSet
triggerall = p2bodydist x >= 35
trigger1 = !time
y = -6.7

[State 1558, Vel Y]
type = VelSet
triggerall = p2bodydist x < 35
trigger1 = !time
y = -8

[State 1558, Vel X]
type = VelSet
trigger1 = Time = 0
x = 1.6

[State 1558, Turn]
type = Turn
trigger1 = (Time = 0) && (BackEdgeDist < 30)

[State 1558, Gravity]
type = VelAdd
trigger1 = 1
y = .32

[State 1028, Anim 5050] ;Self falling animation
type = ChangeAnim
trigger1 = Time = 0
trigger1 = !SelfAnimExist(5052)
value = 5050

[State 1028, Anim 5052] ;Self falling animation (diagup type)
type = ChangeAnim
trigger1 = Time = 0
trigger1 = SelfAnimExist(5052)
value = 5052

[State 1028, Anim 5060] ;Coming down - normal
type = ChangeAnim
trigger1 = Vel Y > -2
trigger1 = Anim = 5050
trigger1 = SelfAnimExist(5060)
persistent = 0
value = 5060

[State 1028, Anim 5062] ;Coming down - diagup type
type = ChangeAnim
trigger1 = Vel Y > -2
trigger1 = Anim = 5052
trigger1 = SelfAnimExist(5062)
persistent = 0
value = 5062

[State 1028, Hit ground]
type = SelfState
trigger1 = (Vel y > 0) && (Pos y >= 0)
value = 5100

;---------------------------------------------------------------------------
;Gohan charging lvl1 emo exit
[statedef 2410]
type = S
physics = S
movetype = A
anim = 2400
ctrl = 0
velset = 0,0
sprpriority = 1

[State 3000, width]
type = width
trigger1 = 1
value = 25,0

[State 800, VarSet];Charging time
type = VarSet
trigger1 = !time
var(26) = 0

[State 0, AssertSpecial]
type = AssertSpecial
triggerall = anim = 2400
trigger1 = time = [0,200]
flag = noFG

[State 3000, nhb]
type = NotHitBy
trigger1 = anim = 2400 && var(26) = 0
trigger1 = Time <200
time = 1
value = SCA

[State 1000, shake]
type = EnvShake
triggerall = anim=2400
trigger1 = !(time%4)
time=4
freq=80
ampl=2+0.02*time

[State 200, 1];voice
type = PlaySnd
;triggerall = var(55)=2		;Voice=Custom Corey Holland
triggerall = anim = 2400
trigger1 = time = 0
value = 2400,6+random%2
channel = 0
volume = 255

[State 200, Kmh charge long]
type = PlaySnd
triggerall = anim = 2400
trigger1 = time = 60
value = 2400,1

[State 200, 1];charge power-up sound
type = PlaySnd
trigger1 = time = 5
value = 2400,20
channel = 5

[State 200, electricity]
type = PlaySnd
trigger1 = time > 60
trigger1 = (GameTime%40) = 20
value = 2400,2
volume = 10

[State 2500, bgpalfx1]
type = bgpalfx
triggerall = anim = 2400
trigger1 = time = [1,200]
time = 1
color=0
mul=0,0,0

[State 200, BGPalFX]
type = BGPalFX
trigger1 = time>=200
time = 1
add	= ceil(-256+1.7*Var(26)),ceil(-256+1.7*Var(26)),ceil(-256+1.7*Var(26))
mul	= 256,256,256
invertall = 0
color = 256

[State 200, SuperPause sound]
type = PlaySnd
trigger1 = time=3
value = 2350,0

[State 3000, SuperPause]
type = SuperPause
triggerall = anim = 2400
trigger1 = time=3
time = 200
p2defmul = 1
unhittable = 1
anim = -1
;sound = s2350,0
darken = 0
movetime = 200

[State 0, mouth LOL]
type = Explod
triggerall = anim = 2400
trigger1 = time = 3
anim = 24000
id = 24000
pos = 0,0
postype = p1
supermovetime = 9999
pausemovetime = 9999
supermove = 1
removetime = -1
sprpriority = 2
ownpal = 0
bindtime = -1
scale = 1,1
persistent = 0

[State 0, Hyper Charge FX]
type = null;Explod
triggerall = anim = 2400
trigger1 = time = 5
anim = 2440
id = 2440
pos = -25,-57
postype = p1
supermovetime = 9999
pausemovetime = 9999
supermove = 1
removetime = -2
sprpriority = 6
ownpal = 1
bindtime = -1
scale = 1,1
persistent = 0

[State 0, Charge Ball FX]
type = Explod
triggerall = anim = 2400
trigger1 = time = 3
anim = 2420+10000*(var(2)=0)
id = 2420
pos = -25,-60
postype = p1
supermovetime = 9999
pausemovetime = 9999
supermove = 1
removetime = -1
sprpriority = 5
ownpal = 1
bindtime = -1
scale = 0.6,0.6
persistent = 0

[state 17100, scale charge FX]
type = ModifyExplod
trigger1 = numexplod(2420)
scale = 0.6+0.002*(time-20),0.6+0.002*(time-20)
id = 2420

[State 0, Charge lightning FX]
type = Explod
triggerall = anim = 2400
trigger1 = time = 3
anim = 2430
id = 2430
pos = -25,-57
postype = p1
supermovetime = 9999
pausemovetime = 9999
supermove = 1
removetime = -1
sprpriority = 5
ownpal = 1
bindtime = -1
scale = 1,1
persistent = 0

[State 0,from sky lightning]
type = explod
triggerall = anim = 2400 && time>=45
trigger1 = gametime%(40-var(26)/5) = 0
anim = 2450+random%6
sprpriority = 7
postype = p1
pos = 0,ceil(pos y)
facing = IfElse(random<500,-1,1)
random = 160,0
scale = 1,2
pausemovetime = -1
supermovetime = -1
ownpal = 1

[State 0, lightning sound]
type = PlaySnd
triggerall = anim = 2400 && time>=45
trigger1 = gametime%(40-var(26)/5) = 0
value = 2400,3
volume = -170-(32*numexplod)
freqmul = .9 + (random/5000.0)

[State 1211, BGPalFX]
type = BGPalFX
triggerall = anim = 2400 && time>=45
trigger1 = gametime%(40-var(26)/5) = 0
time = 3
color = 0
invertall = 1

[State 800, VarSet]
type = null;VarAdd
triggerall = Anim=2400 && time>200
trigger1 = !AILevel && ((command = "holdx") || (command = "holdy") || (command = "holdz"))
trigger2 = AILevel
var(26) = 1

;Throw Kmh
[State 901, ChangeAnim]
type = ChangeState
triggerall = !AILevel
trigger1 = Anim=2400 && time>=200
;trigger1 = (command != "holdx") && (command != "holdy") && (command != "holdz")
;trigger2 = time >= 350
value = 2401
ctrl = 0
[State 901, ChangeAnim]
type = ChangeState
triggerall = AILevel
trigger1 = Anim=2400 && time>=200
trigger1 = (EnemyNear,vel x>0)||(EnemyNear,Movetype=A)|| (EnemyNear,Movetype=I)
trigger1 = random < (100 * (AIlevel ** 2 / 64.0))
;trigger2 = time >= 350
value = 2401
ctrl = 0

;===========================================================================
; <<<<< THUNDER FLURRY KICK >>>>>
; FIRST HITS: State = 3050
; FINAL HIT: State = 3051
;===========================================================================

;Thunder Flurry Kick
[StateDef 3050]
type		= A
movetype		= A
physics		= N
ctrl		= 0
anim		= 3050
juggle		= 0
poweradd		= -1000

[State 1000, VarSet]
type = null;VarSet
trigger1 = !AILEVEL
trigger1 = !time
var(9) = ifElse((NumExplod(90000250) || NumExplod(90000255)),2,ifElse((NumExplod(90000240) || NumExplod(90000245)),1,0)) 

[State 2500,voice]
type		= PlaySnd
trigger1		= !Time
value		= 2101,1+random%3
channel		= 0

[State 2500, bgpalfx1]
type		= BGPalFx
trigger1		= time=4
time		= 50
color		= 0
mul		= 0,0,0

[State 2500, SuperPause]
type		= SuperPause
trigger1		= time = 5
time		= 48
p2defmul		= 0
unhittable	= 1
anim		= -1
sound		= s2000,0
darken		= 0
movetime		= 0

[State 2500, Super FX]
type		= Explod
trigger1		= Time = 5
anim		= 2003
id		= 2003
pos		= -106,48
postype		= p1
supermovetime	= 9999
pausemovetime	= 9999
supermove		= 1
removetime	= -2
sprpriority	= 8
ownpal		= 1
bindtime		= -1
scale		= 1,1
persistent	= 0

[State 0, PlaySnd]
type = PlaySnd
trigger1 = AnimElemTime(2)>=0 && AnimElemTime(14)<0
value = 3050,0
persistent = 0


[State 2500, AssertSpecial]
type		= AssertSpecial
trigger1		= time = 5
flag		= noFG

[State 2500, VelIni]
type		= VelSet
trigger1		= Time = 0
X		= 0
Y		= 0

[State 2500, VelIni]
type		= null;VelSet
trigger1 = Var(9) = 1
trigger1		= AnimElem = 2
X		= 7
Y		= 0

[State 2500, VelIni]
type		= null;VelSet
trigger1 = Var(9) = 2
trigger1		= AnimElem = 2
X		= 7
Y		= -4

[State 2500, VelIni]
type		= VelSet
trigger1		= Pos Y < -270
Y		= 0

[State 2500, Last kick hit]
type		= HitDef
trigger1		= 1
attr		= S, HA
hitflag		= MAF
guardflag		= MA
animtype		= Hard
priority		= 5, Hit
damage = Ceil(IfElse(fvar(11) * 13 < 7, 7, fvar(11) * 13)), 3 ;Cond(fVar(27)>0,Ceil(IfElse(fvar(11) * 13 < 7, 7, fvar(11) * 16)),Ceil(IfElse(fvar(11) * 19 < 7, 7, fvar(11) * 19))),3
; 19,3   ;20,3
pausetime		= 2,2
sparkno		= s7030
guard.sparkno	= s7000
sparkxy		= -10,-55
hitsound		= s5,10;s5,5
guardsound	= s6,0
ground.type	= High
ground.slidetime	= 22
ground.hittime	= 22
guard.hittime 	= 10
p2facing		= 1
ground.velocity	= -3,-4
air.type		= Low
air.velocity	= -8,-4
getpower		= 0
envshake.time	= 15
envshake.freq	= 80
envshake.ampl	= 5
fall		= 1
air.fall		= 1
fall.recover	= 0
p2sprpriority	= -1
ground.cornerpush.veloff = 0
air.cornerpush.veloff = 0
persistent = 2
id = 3050

[State 0, PlayerPush]
type = PlayerPush
trigger1 = NumTarget(3050)
value = 1
ignorehitpause = 1

[State 0, TargetBind]
type = TargetBind
trigger1 = NumTarget(3050)
trigger1 = MoveHit
time = 1
id = 3050
pos = 70,0
ignorehitpause = 1

;[State 0, TargetDrop]
;type = TargetDrop
;trigger1 = NumTarget(3050)
;trigger1 = AnimElemTime(14) >= 0
;ignorehitpause = 1
;;persistent = 

[State 0, AttackDist]
type = AttackDist
trigger1 = AnimElemTime(14) >= 0
value = 0

[State 1400, EndState]
type = ChangeState
trigger1 = !animtime && !movehit
value = IfElse(vel X >= 0,50,116)
ctrl = 0

[State 1400]
type = changestate
trigger1 = movehit && animelemtime(14) >= 2
value = 3051
ctrl = 0

;===========================================================================
;TFK Final Hit
[StateDef 3051]
type = A
movetype = A
physics = N
anim = 1420
ctrl = 0
sprpriority = 2

[State 200, 1];voice
type = PlaySnd
;triggerall = var(55)=2		;Voice=Custom Corey Holland
trigger1 = AnimElem=2
value = 3,220+random%9
channel = 0

[State 200, 1]
type = PlaySnd
trigger1 = animelem = 5
value = 0, 2
channel = 1

[State 200, StateTypeSet]
type = StateTypeSet
trigger1 = AnimElem = 7
movetype = I

[State 640, 2]
type = HitDef
trigger1 = AnimElem = 4
attr = A, HA
damage = Ceil(IfElse(fvar(11) * (60.0+20.0*(fvar(27)>0)) < 7, 7, fvar(11) * (60.0+20.0*(fvar(27)>0)))), 6
guardflag = HA
hitflag = MAF
animtype  = Hard
priority = 4,Hit
pausetime = 11,12
sparkno = s7030
guard.sparkno = s7000
sparkxy = -30,-55
hitsound   = s5,6
guardsound = S6,0
ground.type = High
ground.slidetime = 12
ground.hittime  = 15
ground.velocity = -7,-6
air.velocity = -7,-6
envshake.time = 16
envshake.freq = 60
envshake.ampl = 4
pausetime = 10,13
guard.pausetime = 11,12
givepower = 35,35
yaccel = 0.5
fall = 1
fall.recover = 0
id = 3051

[State 802, TargetState]
type = TargetState
trigger1 = movehit
trigger1 = numtarget
trigger1 = !(target, ishelper)
value = 3052
ID = 3051
;ignorehitpause = 1
persistent = 0

[State 3051]
type = statetypeset
trigger1 = animelem >= 5
physics = A

[State 0, AttackDist]
type = AttackDist
;trigger1 = Anim = 1100
trigger1 = AnimElemTime(5) >= 0
value = 0

[State 1400, EndState]
type = ChangeState
trigger1 = !animtime
value = 1405
ctrl = 0

;-------------------------------------
;P2 custom state, sent away (Thunder Flurry Kick)
[Statedef 3052]
type = A
movetype = H
physics = N
anim = IfElse(selfanimexist(5052),5052,5030)
velset = -10,-5
ctrl = 0
facep2 = 1

[state 3052] ;pos set if too close to the ground
type = posadd
trigger1 = !time && pos y >= 1
y = -10
persistent = 0

[State 4005, vel]
type = null;velset
trigger1 = AnimElemtime(2)=0
x = -10
y = -5
persistent = 0
 
[State 9011, VelAdd]
type = VelAdd
trigger1 = Pos Y < 0
y = 0.35
 
[State 9011, ChangeState]
type = SelfState
trigger1 = (Pos Y >= 0) && (Vel Y > 0)
value = 5100

;===========================================================================
; <<<<< SUPER THUNDER FLURRY KICK >>>>>
; FIRST HITS: State = 3060
; FINAL HIT: State = 3061
; P2 CUSTOM STATE: State = 3062
;===========================================================================

;Super Thunder Flurry Kick
[statedef 3060]
type		= A
movetype	= A
physics		= N
ctrl		= 0
anim		= 3050
juggle		= 0
poweradd	= -2000

[State 2500,voice]
type		= PlaySnd
trigger1		= !Time
value		= 2101,1+random%3
channel		= 0

[State 2500, bgpalfx1]
type		= BGPalFx
trigger1		= time=4
time		= 50
color		= 0
mul		= 0,0,0

[State 2500, SuperPause]
type		= SuperPause
trigger1		= time = 5
time		= 48
p2defmul		= 0
unhittable	= 1
anim		= -1
sound		= s2000,0
darken		= 0
movetime		= 0

[State 2500, Super FX]
type		= Explod
trigger1		= Time = 5
anim		= 2442
id		= 2440
pos		= 10,-54;-106,48
postype		= p1
supermovetime	= 9999
pausemovetime	= 9999
supermove		= 1
removetime	= -2
sprpriority	= 8
ownpal		= 1
bindtime		= -1
scale		= 1,1
persistent	= 0

[State 0, PlaySnd]
type = PlaySnd
trigger1 = AnimElemTime(2)>=0 && AnimElemTime(14)<0
value = 3050,0
persistent = 0


[State 2500, AssertSpecial]
type		= AssertSpecial
trigger1		= time = 5
flag		= noFG

[State 2500, VelIni]
type		= VelSet
trigger1		= Time = 0
X		= 0
Y		= 0

[State 2500, VelIni]
type		= VelSet
trigger1		= AnimElem = 2
X		= 6
Y		= 0

[State 2500, VelIni]
type		= VelSet
trigger1		= Pos Y < -270
Y		= 0

[State 2500, Last kick hit]
type		= HitDef
trigger1		= 1
attr		= S, HA
hitflag		= MAF
guardflag		= MA
animtype		= Hard
priority		= 5, Hit
damage = Ceil(IfElse(fvar(11) * 31 < 7, 7, fvar(11) * 31)), 3 ;Cond(fVar(27)>0,Ceil(IfElse(fvar(11) * 13 < 7, 7, fvar(11) * 16)),Ceil(IfElse(fvar(11) * 19 < 7, 7, fvar(11) * 19))),3
; 19,3   ;20,3
pausetime		= 2,2
sparkno		= s7030
guard.sparkno	= s7000
sparkxy		= -10,-55
hitsound		= s5,10;s5,5
guardsound	= s6,0
ground.type	= High
ground.slidetime	= 22
ground.hittime	= 22
guard.hittime 	= 10
p2facing		= 1
ground.velocity	= -3,-4
air.type		= Low
air.velocity	= -8,-4
getpower		= 0
envshake.time	= 15
envshake.freq	= 80
envshake.ampl	= 5
fall		= 1
air.fall		= 1
fall.recover	= 0
p2sprpriority	= -1
ground.cornerpush.veloff = 0
air.cornerpush.veloff = 0
persistent = 2
id = 3060

[State 0, PlayerPush]
type = PlayerPush
trigger1 = NumTarget(3060)
value = 1
ignorehitpause = 1

[State 0, TargetBind]
type = TargetBind
trigger1 = NumTarget(3060)
trigger1 = MoveHit
time = 1
id = 3060
pos = 70,0
ignorehitpause = 1

[State 0, AttackDist]
type = AttackDist
trigger1 = AnimElemTime(14) >= 0
value = 0

[State 1400, EndState]
type = ChangeState
trigger1 = !animtime && !movehit
value = IfElse(vel X >= 0,50,116)
ctrl = 0

[State 1400]
type = changestate
trigger1 = movehit && animelemtime(14) >= 2
value = 3061
ctrl = 0

;---------------------------------------------------------------------------
;TFK LVL2 Final Hit 
[statedef 3061]
type = A
movetype = A
physics = N
anim = 1440
velset = 2,0
ctrl = 0
sprpriority = 2

[State 220, snd]
type = null;PlaySnd
triggerall = var(55)=0		;Voice=Japan
trigger1 = AnimElem=2
value = 3,4+random%4
channel = 0

[State 200, 1];voice
type = null;PlaySnd
triggerall = var(55)=1		;Voice=English
trigger1 = AnimElem=2
value = 3,104+random%4
channel = 0

[State 200, 1];voice
type = PlaySnd
;triggerall = var(55)=2		;Voice=Custom Corey Holland
trigger1 = AnimElem=2
value = 3,220+random%9
channel = 0

[State 650, 2]
type = PlaySnd
trigger1 = AnimElem = 4
value = 0, 5

[State 650, 3]
type = HitDef
trigger1 = AnimElem = 5
attr = A, SA
damage = Ceil(IfElse(fvar(11) * 40.0 < 7, 7, fvar(11) * 40.0)), 6
hitflag = MAF
guardflag = HA
animtype = Hard
priority = 4, Hit
pausetime = 16,17
sparkno = s7030
guard.sparkno = s7000
sparkxy = -30,-55
hitsound   = s5,6
guardsound = S6,0
ground.type = High
ground.slidetime = 12
ground.hittime  = 15
ground.velocity = -5
air.velocity = -2,10
envshake.time = 16
envshake.freq = 60
envshake.ampl = 4
fall = 1
fall.recover = 0
p2facing = 1
airguard.cornerpush.veloff= 0
air.animtype = Back
fall.animtype = Back
givepower = 35,35
yaccel = 0.35
;p2stateno = 1441
id = 3061

[State 802, TargetState]
type = TargetState
trigger1 = movehit
trigger1 = numtarget(3061)
trigger1 = !(target, ishelper)
value = 3062
;ignorehitpause = 1
persistent = 0

[State 200, StateTypeSet]
type = StateTypeSet
trigger1 = AnimElem = 6
movetype = I

[State 0, AttackDist]
type = AttackDist
trigger1 = AnimElemTime(6) >= 0
value = 0

[State 1400, Turn]
type = null;Turn
trigger1 = !animtime

[State 1400, EndState]
type = ChangeState
trigger1 = !animtime
value = 1405
ctrl = 0

;------------------------------------------
;P2 going to the ground from TFK LVL2
[Statedef 3062]
type = S
movetype = H
physics = N
ctrl = 0
sprpriority = -1
velset = -3,10

[State 0, NotHitBy]
type = NotHitBy
trigger1 = enemy,NumExplod(1400)>1
value = SCA
time = 1

[State 3020, 2]
type = changeanim2
trigger1 = !time && anim !=651
value = 651

[State 4005, vel Y]
type = null;velset
trigger1 = AnimElemtime(2)=0
y = 10
x = -3

[State 3052, Land]
type = changestate
trigger1 = Pos Y >= 0
trigger1 = Vel Y > 0
value = 652


;===========================================================================
; <<<<< SUPER HURRICANE KICK >>>>>
; State = 2500
;===========================================================================

;Super Hurricane Kick
[StateDef 2500]
type		= A
movetype		= A
physics		= N
ctrl		= 0
anim		= 2500
juggle		= 0
poweradd		= -1000;IfElse(fvar(27)>0,0,-1000)

[State 2500, HitCount add (only for supermoves)]
type		= VarAdd
trigger1		= MoveHit
trigger1		= NumTarget
trigger1		= Target, Time = 0
var(39)		= 1
persistent	= 1
ignorehitpause	= 1

[State 650, Fill Destiny Gauge - Hit - EX]
type		= null;VarAdd
trigger1		= fvar(27)>0
fvar(28)		= -100;IfElse(fvar(28)+30 > 300, 300-fvar(28), 30)
persistent	= 0
ignorehitpause	= 1
[State 3000, if Destiny bar = 0]
type		= null;VarSet
trigger1		= fvar(28) <= 0
fvar(27)		= 0

[State 3000, Supermoves counter for Destiny mode]
type		= null;VarAdd
trigger1		= Time = 0 && fvar(27)>0
fvar(31)		= 1
persistent	= 0
[State 3000, Three or more moves, Destiny mode ends]
type		= null;VarSet
trigger1		= !time && fvar(31)>=3
fvar(27)		= 0

;[State 2100, HitCount reset (only for supermoves)]
;type		= VarSet
;triggerall	= var(39)!=0
;trigger1		= Time = 0
;var(39)		= 0
;persistent	= 0
;ignorehitpause	= 1



[State 2500, AssertSpecial]
type		= AssertSpecial
trigger1		= time = 5
flag		= noFG

[State 2500, VelIni]
type		= VelSet
trigger1		= Time = 0
X		= 0
Y		= 0

[State 2500,voice]
type		= PlaySnd
trigger1		= !Time
value		= 2101,1
channel		= 0

[State 2500, bgpalfx1]
type		= BGPalFx
trigger1		= time=4
time		= 50
color		= 0
mul		= 0,0,0

[State 2500, SuperPause]
type		= SuperPause
trigger1		= time = 5
time		= 48
p2defmul		= 1
unhittable	= 1
anim		= -1
sound		= s2000,0
darken		= 0
movetime		= 0

[State 2500, Player Push]
type		= PlayerPush
trigger1		= 1
value		= 0
ignorehitpause	= 1

[State 2500, nhb]
type		= NotHitBy
trigger1		= Anim = 2500
time		= 1
value		= SCA
ignorehitpause	= 1

[State 2500, Super FX]
type		= Explod
trigger1		= Time = 5
anim		= 2003
id		= 2003
pos		= -136,48
postype		= p1
supermovetime	= 9999
pausemovetime	= 9999
supermove		= 1
removetime	= -2
sprpriority	= 8
ownpal		= 1
bindtime		= -1
scale		= 1,1
persistent	= 0

[State 2500, AnimUp]
type		= ChangeAnim
trigger1		= Anim = 2500
trigger1		= !AnimTime
trigger2		= Anim = 2501
trigger2		= !AnimTime
value		= Anim+1

[State 2500, Voice] ;Shinku Tatsumaki voice; it isn't used.
type		= PlaySnd
triggerall	= var(55) = 1		;Voice=English
trigger1		= Anim = 2501 && AnimElem = 1
value		= 2500,0
channel		= 0
persistent	= 0
volume		= 300

[State 2500, Dust]
type		= Explod
triggerall	= Pos Y > -60
trigger1		= anim = 2501 && AnimElem = 2
trigger2		= anim = 2501 && AnimElem = 14
trigger3		= anim = 2501 && AnimElem = 26
trigger4		= anim = 2501 && AnimElem = 38
anim		= 908+(var(2)=0)
id		= 2501
postype		= P1
pos		= 17, -ceil(pos Y)
sprpriority	= 4
bindtime		= 1
ownpal		= 1
removeongethit	= 1
ignorehitpause	= 1
facing		= -1
removetime	= -2


[State 2500, 1];"Front" kicks movement sound
type		= PlaySnd
triggerall	= Anim = 2501
trigger1		= AnimElem = 2;front
trigger2		= AnimElem = 8;front
trigger3		= AnimElem = 14;front
trigger4		= AnimElem = 20;front
trigger5		= AnimElem = 26;front
trigger6		= AnimElem = 32;front
trigger7		= AnimElem = 38;front
value		= 21, 2
volumescale	= 100
[State 2500, 1];"Back" kicks movement sound
type		= PlaySnd
triggerall	= Anim = 2501
trigger1		= AnimElem = 5	;back
trigger2		= AnimElem = 11	;back
trigger3		= AnimElem = 17	;back
trigger4		= AnimElem = 23	;back
trigger5		= AnimElem = 29	;back
trigger6		= AnimElem = 35	;back
trigger7		= AnimElem = 41	;back
value		= 21, 2
volumescale	= 100
[State 2500, 1];last kick movement sound
type		= PlaySnd
triggerall	= Anim = 2501
trigger1		= AnimElem = 45
value		= 0, 5 ;3+random%3
volumescale	= 85
[State 250, 1];Dragon Roar (last kick movement sound)
type		= PlaySnd
triggerall	= Anim = 2501
trigger1		= AnimElem = 45
value		= 1200,0
volumescale	= 35



[state 2500, Turning Effect front]
type		= Explod
triggerall	= Anim = 2501
trigger1		= AnimElem = 2
trigger2		= AnimElem = 8
trigger3		= AnimElem = 14
trigger4		= AnimElem = 20
trigger5		= AnimElem = 26
trigger6		= AnimElem = 32
trigger7		= AnimElem = 38
anim		= 2505
id		= 2505
pos		= 25,-70
postype		= p1
sprpriority	= 3
ownpal		= 1
supermovetime	= -1
removetime	= -2
persistent	= 1
bindtime		= -1
ignorehitpause	= 0
scale		= 0.8,1
[state 2500, Turning Effect back]
type		= Explod
triggerall	= Anim = 2501
trigger1		= AnimElem = 2
trigger2		= AnimElem = 8
trigger3		= AnimElem = 14
trigger4		= AnimElem = 20
trigger5		= AnimElem = 26
trigger6		= AnimElem = 32
trigger7		= AnimElem = 38
anim		= 2506
id		= 2506
pos		= 25,-70
postype		= p1
sprpriority	= -3
ownpal		= 1
supermovetime	= -1
removetime	= -2
persistent	= 1
bindtime		= -1
ignorehitpause	= 0
scale		= 0.8,1

[State 2500, "Front" kicks hits]
type		= HitDef
triggerall = !NumExplod(801)
triggerall	= Anim = 2501
trigger1		= AnimElem = 3
trigger2		= AnimElem = 9
trigger3		= AnimElem = 15
trigger4		= AnimElem = 21
trigger5		= AnimElem = 27
trigger6		= AnimElem = 33
trigger7		= AnimElem = 39
attr		= S, HA
hitflag		= MAF
guardflag		= MA
animtype		= Hard
priority		= 6, Hit
damage = Cond(fVar(27)>0,Ceil(IfElse(fvar(11) * 13 < 7, 7, fvar(11) * 16)),Ceil(IfElse(fvar(11) * 16 < 7, 7, fvar(11) * 16))),3
;Ceil(IfElse(fvar(11) * 16 < 7, 7, fvar(11) * 16)),3
; 16,3    ;20,3
pausetime		= 2,0
sparkno		= s(7020+10*(random%2))
guard.sparkno	= s7000
sparkxy		= -10,-55
hitsound		= s5,5
guardsound	= s6,0
ground.type	= High
ground.slidetime	= 22
ground.hittime	= 22
p2facing		= 1
ground.velocity	= IfElse((P2Dist x!=[-35,35]),20,15),0
air.type		= Low
air.velocity	= IfElse((P2Dist x!=[-35,35]),9,6),IfElse(P2Dist y<(enemy,const(size.mid.pos.y))+60,-1,-3)+vel y     
getpower		= 0
envshake.time	= 16
envshake.freq	= 60
envshake.ampl	= 4
air.fall		= 1
fall		= 0
fall.recover	= 0
p1sprpriority	= 3
forcestand	= 1
persistent	= 1

[State 2500, "Back" kicks hits]
type		= HitDef
triggerall = !NumExplod(801)
triggerall	= Anim = 2501
trigger1		= AnimElem = 6
trigger2		= AnimElem = 12
trigger3		= AnimElem = 18
trigger4		= AnimElem = 24
trigger5		= AnimElem = 30
trigger6		= AnimElem = 36
trigger7		= AnimElem = 42
attr		= S, HA
hitflag		= MAF
guardflag		= MA
animtype		= Hard
priority		= 5, Hit
damage = Cond(fVar(27)>0,Ceil(IfElse(fvar(11) * 13 < 7, 7, fvar(11) * 16)),Ceil(IfElse(fvar(11) * 16 < 7, 7, fvar(11) * 16))),3
;Ceil(IfElse(fvar(11) * 16 < 7, 7, fvar(11) * 16)), 3
; 16,3   ;20,3
pausetime		= 2,0
sparkno		= s(7020+10*(random%2))
guard.sparkno	= s7000
sparkxy		= -10,-55
hitsound		= s5,5
guardsound	= s6,0
ground.type	= High
ground.slidetime	= 22
ground.hittime	= 22
p2facing		= -1
ground.velocity	= IfElse((P2Dist x!=[-35,35]),-20,-15),0
air.type		= Low
air.velocity	= IfElse((P2Dist x!=[-35,35]),-9,-6),IfElse(P2Dist y<(enemy,const(size.mid.pos.y))+60,-1,-3)+vel y
getpower		= 0
envshake.time	= 16
envshake.freq	= 60
envshake.ampl	= 4
fall		= 0
air.fall		= 1
fall.recover	= 0
p1sprpriority	= -1
forcestand	= 1
persistent	= 1

[State 2500, Last kick hit]
type		= HitDef
triggerall = !NumExplod(801)
triggerall	= Anim = 2501
trigger1		= AnimElem = 46
attr		= S, HA
hitflag		= MAF
guardflag		= MA
animtype		= Hard
priority		= 5, Hit
damage = Cond(fVar(27)>0,Ceil(IfElse(fvar(11) * 13 < 7, 7, fvar(11) * 16)),Ceil(IfElse(fvar(11) * 19 < 7, 7, fvar(11) * 19))),3
;Ceil(IfElse(fvar(11) * 19 < 7, 7, fvar(11) * 19)), 3
; 19,3   ;20,3
pausetime		= 14,15
sparkno		= s7030
guard.sparkno	= s7000
sparkxy		= -10,-55
hitsound		= s5,5
guardsound	= s6,0
ground.type	= High
ground.slidetime	= 22
ground.hittime	= 22
p2facing		= 1
ground.velocity	= IfElse((P2Dist x!=[-35,35]),-20,-15),0
air.type		= Low
air.velocity	= IfElse((P2Dist x!=[-35,35]),-15,-8),IfElse(P2Dist y<(enemy,const(size.mid.pos.y))+60,-1,-3)+vel y
getpower		= 0
envshake.time	= 15
envshake.freq	= 80
envshake.ampl	= 5
fall		= 1
air.fall		= 1
fall.recover	= 0
p2sprpriority	= -1

[State 0, AttackDist]
type = AttackDist
trigger1 = Anim = 2501
trigger1 = AnimElemTime(47) >= 0
trigger2 = Anim = 2502
trigger2 = AnimElemTime(1) >= 0
value = 0

[State 2500, AirGravity]
type = StateTypeSet
trigger1 = Anim = 2502
trigger1 = AnimElem = 1
physics = A



;===========================================================================
; <<<<< AIR CHOU KAMEHAMEHA >>>>>
; State = 2600
; Throw state = 2601
;===========================================================================

;Air Chou Kame
[Statedef 2600]
type = A
physics = N
movetype = A
anim = 2600
ctrl = 0
velset = 0,0
sprpriority = 1
poweradd = -2000;IfElse(fvar(27)>0,0,-2000)

[State 2600, No Push Dummy]
type		= Helper
triggerall	= !NumHelper(2650)
trigger1		= !time
name		= "Air Chou Kame - No Push"
id		= 2650
stateno		= 2650
size.ground.back	= Const(size.ground.back) +20
size.ground.front	= Const(size.ground.front) +20
size.height	= Const(size.height) +60
pausemovetime	= 99999
supermovetime	= 99999

[State 2600, No Push]
type		= PlayerPush
trigger1		= 1
value		= 0
ignorehitpause	= 1

[State 650, Fill Destiny Gauge - Hit - EX]
type		= null;VarAdd
trigger1		= fvar(27)>0
fvar(28)		= -200;IfElse(fvar(28)+30 > 300, 300-fvar(28), 30)
persistent	= 0
ignorehitpause	= 1
[State 3000, if Destiny bar = 0]
type = null;VarSet
trigger1 = fvar(28) <= 0
fvar(27)=0

[State 3000, Supermoves counter for Destiny mode]
type = null;VarAdd
trigger1 = Time = 0 && fvar(27)>0
fvar(31)=1
persistent = 0
[State 3000, Three or more moves, Destiny mode ends]
type = null;VarSet
trigger1 = !time && fvar(31)>=3
fvar(27)=0

;[State 2100, HitCount reset (only for supermoves)]
;type		= VarSet
;trigger1		= var(39)!=0
;var(39)		= 0
;persistent	= 0
;ignorehitpause	= 1

[State 0, for trial]
type = VarSet
trigger1 = !time
var(18) = 1

[State 3000, width]
type = width
trigger1 = 1
value = 20,0

[State 800, VarSet];Charging time
type = VarSet
trigger1 = !time
var(26) = 0

[State 0, AssertSpecial]
type = AssertSpecial
triggerall = anim = 2600
trigger1 = time = [0,200]
flag = noFG

[State 3000, nhb]
type = NotHitBy
trigger1 = anim = 2600 && var(26) = 0
trigger1 = Time <200
time = 1
value = SCA

[State 1000, shake]
type = EnvShake
triggerall = anim=2600
trigger1 = !(time%4)
time=4
freq=80
ampl=2+0.02*time

[State 200, 1];Voice (Kamehame)
type = null;PlaySnd
triggerall = var(55)=0		;Voice=Japan
triggerall = anim = 2600
trigger1 = time = 0
value = 2400,0
channel = 0
volume = 255

[State 200, 1];Voice (Kamehame)
type = null;PlaySnd
triggerall = var(55)=1		;Voice=English
triggerall = anim = 2600
trigger1 = time = 0
value = 2400,5
channel = 0
volume = 255

[State 200, 1];voice
type = PlaySnd
;triggerall = var(55)=2		;Voice=Custom Corey Holland
triggerall = anim = 2600
trigger1 = time = 0
value = 2400,6+random%2
channel = 0
volume = 255

[State 200, Kmh charge long]
type = PlaySnd
triggerall = anim = 2600
trigger1 = time = 60
value = 2400,1

[State 200, 1];charge power-up sound
type = PlaySnd
trigger1 = time = 5
value = 2400,20
channel = 5

[State 200, electricity]
type = PlaySnd
trigger1 = time > 60
trigger1 = (GameTime%40) = 20
value = 2400,2
volume = 10

[State 2500, bgpalfx1]
type = bgpalfx
triggerall = anim = 2600
trigger1 = time = [1,200]
time = 1
color=0
mul=0,0,0

[State 200, BGPalFX]
type = BGPalFX
trigger1 = time>=200
time = 1
add	= ceil(-256+1.7*Var(26)),ceil(-256+1.7*Var(26)),ceil(-256+1.7*Var(26))
mul	= 256,256,256
invertall = 0
color = 256

[State 200, SuperPause sound]
type = PlaySnd
trigger1 = time=5
value = 2350,0

[State 3000, SuperPause]
type = SuperPause
triggerall = anim = 2600
trigger1 = time=5
time = 192
p2defmul = 1
unhittable = 1
anim = -1
darken = 0
movetime = 192

[State 0, mouth LOL]
type = Explod
triggerall = anim = 2600
trigger1 = time = 5
anim = 24000
id = 24000
pos = 7,-11
postype = p1
supermovetime = 9999
pausemovetime = 9999
supermove = 1
removetime = -1
sprpriority = 2
ownpal = 1
bindtime = -1
scale = 1,1
persistent = 0

[State 0, Hyper Charge FX]
type = Explod
triggerall = anim = 2600
trigger1 = time = 5
anim = 2442
id = 2440
pos = -21,-80
postype = p1
supermovetime = 9999
pausemovetime = 9999
supermove = 1
removetime = -2
sprpriority = 6
ownpal = 1
bindtime = -1
scale = 1,1
persistent = 0

[State 0, Charge Ball FX]
type = Explod
triggerall = anim = 2600
trigger1 = time = 5
anim = 2420+10000*(var(2)=0)
id = 2420
pos = -21,-81
postype = p1
supermovetime = 9999
pausemovetime = 9999
supermove = 1
removetime = -1
sprpriority = 5
ownpal = 1
bindtime = -1
scale = 0.6,0.6
persistent = 0

[state 17100, scale charge FX]
type = ModifyExplod
trigger1 = numexplod(2420)
scale = 0.6+0.002*(time-20),0.6+0.002*(time-20)
id = 2420

[State 0, Charge lightning FX]
type = Explod
triggerall = anim = 2600
trigger1 = time = 5
anim = 2430
id = 2430
pos = -17,-78  ;-25,-57
postype = p1
supermovetime = 9999
pausemovetime = 9999
supermove = 1
removetime = -1
sprpriority = 5
ownpal = 1
bindtime = -1
scale = 1,1
persistent = 0

[State 0,from sky lightning]
type = explod
triggerall = anim = 2600 && time>=45
trigger1 = gametime%(40-var(26)/5) = 0
anim = 2450+random%6
sprpriority = 7
postype = p1
pos = 0,-ceil(pos y)
facing = IfElse(random<500,-1,1)
random = 160,0
scale = 1,2+(pos Y < -200)
pausemovetime = -1
supermovetime = -1
ownpal = 1

[State 0, lightning sound]
type = PlaySnd
triggerall = anim = 2600 && time>=45
trigger1 = gametime%(40-var(26)/5) = 0
value = 2400,3
volume = -170-(32*numexplod)
freqmul = .9 + (random/5000.0)

[State 1211, BGPalFX]
type = BGPalFX
triggerall = anim = 2600 && time>=45
trigger1 = gametime%(40-var(26)/5) = 0
time = 3
color = 0
invertall = 1

[State 800, VarSet]
type = VarAdd
triggerall = Anim=2600 && time>200
trigger1 = !AILevel && ((command = "holdx") || (command = "holdy") || (command = "holdz"))
trigger2 = AILevel
var(26) = 1

;Throw Kmh
[State 901, ChangeAnim]
type = ChangeState
triggerall = !AILevel
triggerall = Anim=2600 && time>=200
trigger1 = (command != "holdx") && (command != "holdy") && (command != "holdz")
trigger2 = time >= 350
value = 2601
ctrl = 0
[State 901, ChangeAnim]
type = ChangeState
triggerall = AILevel
triggerall = Anim=2600 && time>=200
trigger1 = (EnemyNear,vel x>0)||(EnemyNear,Movetype=A)|| (EnemyNear,Movetype=I)
trigger1 = random < (150 * (AIlevel ** 2 / 64.0))
trigger2 = time >= 350
value = 2601
ctrl = 0
;-----------------------------
;Air Chou Kame- throw
[Statedef 2601]
type = A
physics = N
movetype = A
anim = 2601
ctrl = 0
velset = 0,0
sprpriority = 1

[State 2600, No Push]
type		= PlayerPush
trigger1		= 1
value		= 0
ignorehitpause	= 1

[state -2, remove charge ball FX Chou Kmh]
type = removeexplod
trigger1 = !time
id = 2420

[State 3000, nhb]
type = NotHitBy
trigger1 = var(26)=0 && time<6
time = 1
value = SCA

[State 800, VarSet];Charging time
type = VarSet
trigger1 = !time
var(25) = floor(var(26)/7.5)

[State 3000, width]
type = width
trigger1 = 1
value = 25,0

[State 200, 1];Voice (Haaa)
type = null;PlaySnd
triggerall = var(55)=0		;Voice=Japan
trigger1 = time = 0
value = 2401,0
channel = 0
volume = 355

[State 200, 1];Voice (Haaa)
type = null;PlaySnd
triggerall = var(55)=1		;Voice=English
trigger1 = time = 0
value = 2401,5
channel = 0
volume = 355

[State 200, 1];voice
type = PlaySnd
;triggerall = var(55)=2		;Voice=Custom Corey Holland
trigger1 = time = 0
value = 2401,6+random%2
channel = 0
volume = 255

[State 200, 1];Launching SFX
type = PlaySnd
trigger1 = time=4
value = 2401,1

[state 1215, Flash FX]
type = null;explod
trigger1 = !time
anim = 2611
id = 2611
pos = 0,0
postype = P1
sprpriority = 3
ownpal = 1
removetime = -1
persistent = 0
ignorehitpause = 1
bindtime = -1

[State 3000, Kamehameha]
type = helper
trigger1 = animelem=1
helpertype = normal
stateno = 2602
ID = 2602
name = "ckameha"
postype = p1
pos = 40,-54
ownpal = 1

[State 3000, Kamehameha FX on hands]
type = helper
trigger1 = animelem=1
helpertype = normal
stateno = 2603
ID = 2603
name = "ckamehaFX_hands"
postype = p1
pos = 47,-54
ownpal = 1

[State 3000, Kamehameha FX beam]
type = helper
trigger1 = animelem=1
helpertype = normal
stateno = 2604
ID = 2604
name = "ckamehaFX_scale_beam"
postype = p1
pos = 47,-54
ownpal = 1

[State 200, 1];Dramatic SFX
type = PlaySnd
trigger1 = WinKO && p2stateno=5946
value = 5941,0
persistent = 0

;Stop
[State 901, ChangeState]
type = ChangeState
trigger1 = numhelper(2602)
trigger1 = helper(2602),var(2)=20+var(25)
trigger1 = Anim=2601
trigger2 = time>91 && !MatchOver
trigger3 = time>120 && WinKO && MatchOver
value = 2610
ctrl = 0

;-----------------------------
;Air Chou Kame- stop
[Statedef 2610]
type = A
physics = A
movetype = I
anim = 2610
ctrl = 0
velset = 0,0
sprpriority = 1

[State 2600, No Push]
type		= PlayerPush
trigger1		= 1
value		= 0
ignorehitpause	= 1

[state 17100,remove FX]
type = removeexplod
trigger1 = !time
id = 2611

[State 2200, vel]
type = velset
trigger1 = !time
x = -1.5
y = -5

[State 4001, End]
type = ChangeState
trigger1 = !AnimTime
value = 50
ctrl = 0



;===========================================================================
; <<<<< GEKIRETSU RANBU >>>>>
; Counter State = 2700
; P1 counter sparks state : 2710
; P2 State - on ground hit : 2715
; 1st attack, SP punch : 2720
; 2nd attack, SK Kick : 2730
; 3rd attack, MK Kick : 2740
; 4th attack, SP punch : 2750
; 5th attack, Teleport then c.SK : 2760
; P2 State - Sent diagonal : 2761
; Gohan out of screen before air dash : 2770 [SEND TO FINISHER 2]
; P2 center of screen : 2775
; 6th attack, a.SP : 2773 [SEND TO FINISHER 1 or 3]
; P2 State - Sent down : 2779
; P2 goes back to ground : 2780
; P2 bouncing on the ground : 2781-2785
; Gohan state - Invisible and waiting : 2790
; Gohan Fall back to ground : 2791
; Ironman pose : 2795
;===========================================================================

; GEKIRETSU RANBU
[Statedef 2700]
type = S
movetype = I
physics = S
facep2 = 1
ctrl = 0
anim = 2700
velset = 0,0
poweradd = -3000


[State 1900, dust]
type = explod
trigger1 = animelemtime(4)=0
anim = 908+(var(2)=0)
;id = 908
pos = 17,5
sprpriority = 4
bindtime = -1
ownpal = 1
removeongethit = 1
ignorehitpause = 1
facing = -1
removetime = -2
persistent = 0

[State 3000, voice]
type = null ;PlaySnd
;triggerall = var(55)=2		;Voice=Custom Corey Holland
trigger1 = anim=2700 && animelemtime(3)=0
value = 2700,5
channel = 0

[State 3000, SFX]
type = PlaySnd
trigger1 = anim=2700 && animelemtime(4)=0
value = 2700,0

[State 3000, Effect]
type = palfx
trigger1 = anim=2700 && animelemtime(4)>=0
time = 1
add = 30,30,50
mul = 256,256,200
sinadd = -5,-5,-5,15

[State 3000, NotHitBy]
type = NotHitBy
trigger1 = anim = 2700
value = , A

[State 3000, Kill those hoes]
type = reversaldef
trigger1 = 1
reversal.attr = SCA, NA, SA, HA
attr = S,HT
hitflag = MAFD
guardflag = 
guard.dist = -1
priority = 7, hit
sparkno = -1
hitsound = s850,1
fall = 0
fall.recover = 0
yaccel = .68
getpower = 0,0
givepower = 0,0
p1stateno = 2710
;p2stateno = 2715
forcestand = 1
p2facing = 1
;pausetime = 0,20
numhits = 0

[State 0, AttackDist]
type = AttackDist
trigger1 = Anim = 2701
trigger1 = AnimElemTime(1) >= 0
value = 0

[State 3050, Off]
type = changeanim
trigger1 = animtime = 0
trigger1 = anim = 2700
value = 2701

[State 3050, End]
type = changestate
trigger1 = animtime = 0
trigger1 = anim = 2701
value = 0
ctrl = 1

;-------------------------------------
;Gohan's State - Counter sparks
[Statedef 2710]
type = S
movetype = A
physics = N
velset = 0, 0

[State 200, anim depending on distance]
type = Changeanim
trigger1 = !time
value = IfElse( abs(p2bodydist X) > 40, 2711, 2710)

[State 0, AssertSpecial]
type = AssertSpecial
trigger1 = time = [0,40]
flag = noFG

[State 3000, voice]
type = PlaySnd
;triggerall = var(55)=2		;Voice=Custom Corey Holland
trigger1 = !time
value = 2700,10+random%4
channel = 0

[State 200, SuperPause sound]
type = PlaySnd
trigger1 = !time
value = 2350,0

[State 0, Hyper Charge FX]
type = Explod
trigger1 = !time
anim = 2440
id = 2440
pos = -25,-57
postype = p1
supermovetime = 9999
pausemovetime = 9999
supermove = 1
removetime = -2
sprpriority = 6
ownpal = 1
bindtime = -1
scale = 1,1
persistent = 0

[State 2500, bgpalfx1]
type = bgpalfx
trigger1 = !time
time = 40
color=0
mul=0,0,0

[State 250, Pause]
type = Pause
trigger1 = !time
time = 48
movetime = 48
ignorehitpause = 1

[State 250, teleport sound]
type = PlaySnd
triggerall = anim = 2711
trigger1 = AnimElem = 2
trigger2 = AnimElem = 3
value = 2302, 0

[State 4001, Teleport]
type = PosAdd
triggerall = anim = 2711
trigger1 = AnimElemTime(3) = 0
X = (P2Dist X) - 40

[State 250, woosh]
type = PlaySnd
trigger1 = anim=2710 && animelem=6
trigger2 = anim=2711 && animelem=8
value = 0, 2

[State 3050, End]
type = changestate
trigger1 = time=48
value = 2720

;------------------------------------------------
;P2 State - Hit by GR
[Statedef 2715]
type = S
physics = S
movetype = H
ctrl = 0
velset = 0,0

[state 0, nothitby]
type = null;nothitby
trigger1 = 1
value = SCA
ignorehitpause = 1

[State 3020, 2]
type = PosSet
trigger1 = !time
Y = 0

[State 3020, 2] ;remove when we finish fixing up the finishers
type = changeanim2
trigger1 = !time && anim !=2715
value = 2715

[State 1050, 1]
type = sprpriority
trigger1 = 1
value = 1

[state 2700, changestate]
type = null;changestate
trigger1 = enemy, anim = 2720
value = 2716

[state 0, failed]
type = changestate
trigger1 = time = 100
value = 0
ctrl = 1

;-------------------------
; 1st attack, HP
[Statedef 2720]
type    = S
movetype = A
physics = S
anim = 2720
juggle = 0
ctrl = 0
velset = 0,0
facep2 = 1
sprpriority = 2

[state 0, nothitby]
type = nothitby
trigger1 = 1
value = SCA
ignorehitpause = 1

[state 0, no bars]
type = assertspecial
trigger1 = 1
flag = nobardisplay
[state 0, no timeover]
type = assertspecial
trigger1 = 1
flag = timerfreeze
flag2 = nobardisplay

[State 2720, Clones? Saibamen?] ;Piccolo's clones are not present, neither are Saibamen
type		= VarSet
triggerall	= !Time
trigger1		= enemy, name = "Piccolo Z2" && (enemy, numhelper(3501) = 0 || enemy, numhelper(3502) = 0)
trigger2		= enemy, name != "Saibamen Z2" && authorname = "Team Z2"
v		= 24
value		= 0
ignorehitpause	= 1
[State 2720, Clones? Saibamen?] ;Piccolo's clones or Saibamen are present
type		= VarSet
triggerall	= !Time
trigger1		= enemy, name = "Piccolo Z2" && (enemy, numhelper(3501) || enemy, numhelper(3502))
trigger2		= enemy, name = "Saibamen Z2" && authorname = "Team Z2"
v		= 24
value		= 1
ignorehitpause	= 1

[State -2, Fix dampener for fun]
type = VarSet
trigger1 = !time
fvar(12) = 1

[state 0]
type = width
trigger1 = 1
value = 50,0

[State -2, AssertSpecial]
type = AssertSpecial
trigger1 = 1
flag = nobardisplay
ignorehitpause = 1

[State 220, snd]
type = null;PlaySnd
triggerall = var(55)=0		;Voice=Japan
trigger1 = animelem=1
value = 3,5
channel = 0

[State 200, 1];voice
type = null;PlaySnd
triggerall = var(55)=1		;Voice=English
trigger1 = animelem=1
value = 3,105
channel = 0

[State 200, 1];voice
type = PlaySnd
;triggerall = var(55)=2		;Voice=Custom Corey Holland
trigger1 = animelem=1
value = 3,220
channel = 0

[State 1120, HitDef]
type = HitDef
triggerall = !NumExplod(801)
trigger1 = animelem=1
attr = S, HA
animtype  = Hard
damage = Ceil(IfElse(fvar(11) * 10 < 7, 7, fvar(11) * 10)), 0
priority = 6,Hit
getpower = 0,0
givepower = 100,0
hitflag = MAF
pausetime = 19,30  ;30,40
sparkno = s2719;-1
guard.sparkno = S8410
sparkxy = -40,-75
hitsound = S2720,0
ground.type = High
ground.slidetime = 20
ground.hittime  = 20
guard.hittime = 18
guard.slidetime = 13
guard.ctrltime = 18
ground.velocity = -3,0
guard.velocity = 0
fall = 0
fall.recover = 0
air.fall = 0
yaccel = .3
envshake.time = 20 ;40
envshake.freq = 100
envshake.ampl = 7 ;8
forcestand = 1
P2facing = 1
ground.cornerpush.veloff = 0
guard.cornerpush.veloff = 0
kill = 0
persistent = 0

[state 2720, hit sound]
type = null;playsnd
trigger1 = !time
value = s2720,0

[state 2720, hitadd]
type = null;hitadd
trigger1 = !time
value = 1

[state 2720, hit spark]
type = null;explod
trigger1 = !time
anim = 2719
postype = P1
pos = 70,-75
sprpriority = 7
removetime = -2

[state 2720, envshake]
type = null;envshake
trigger1 = !time
time = 20 ;40
freq = 100
ampl = 7 ;8

[State 902, TargetState]
type = TargetState
trigger1 = movehit
trigger1 = numtarget
trigger1 = !(target, ishelper)
value = 5000
ignorehitpause = 1
persistent = 0
id = 3000

[State 0, TargetBind]
type = TargetBind
trigger1 = MoveHit 
time = 1
id = 3000
pos = 70,0
ignorehitpause = 1

[State 3700, success]; Send Gohan to next state
type = changestate
triggerall = MoveHit
trigger1 = !animtime
value = 2730
ctrl = 0

[State 3700, failed]; Send Gohan to state 0
type = changestate
triggerall = !MoveHit
trigger1 = !animtime
value = 0
ctrl = 1

;-------------------------
; 2nd attack, HK
[Statedef 2730]
type    = S
movetype = A
physics = N
anim = 2730
juggle = 0
ctrl = 0
velset = 0,0
facep2 = 1
sprpriority = 2

[state 0, nothitby]
type = nothitby
trigger1 = 1
value = SCA
ignorehitpause = 1

[state 0, no bars]
type = assertspecial
trigger1 = 1
flag = nobardisplay
[state 0, no timeover]
type = assertspecial
trigger1 = 1
flag = timerfreeze
flag2 = nobardisplay

[State 2720, Clones? Saibamen?] ;Piccolo's clones are not present, neither are Saibamen
type		= VarSet
triggerall	= !Time
trigger1		= enemy, name = "Piccolo Z2" && (enemy, numhelper(3501) = 0 || enemy, numhelper(3502) = 0)
trigger2		= enemy, name != "Saibamen Z2" && authorname = "Team Z2"
v		= 24
value		= 0
ignorehitpause	= 1
[State 2720, Clones? Saibamen?] ;Piccolo's clones or Saibamen are present
type		= VarSet
triggerall	= !Time
trigger1		= enemy, name = "Piccolo Z2" && (enemy, numhelper(3501) || enemy, numhelper(3502))
trigger2		= enemy, name = "Saibamen Z2" && authorname = "Team Z2"
v		= 24
value		= 1
ignorehitpause	= 1

[state 0]
type = width
trigger1 = 1
value = 90,0

[State -2, AssertSpecial]
type = AssertSpecial
trigger1 = 1
flag = nobardisplay
ignorehitpause = 1

[State 220, snd]
type = null;PlaySnd
triggerall = var(55)=0		;Voice=Japan
trigger1 = animelem=3
value = 3,7
channel = 0

[State 200, 1];voice
type = null;PlaySnd
triggerall = var(55)=1		;Voice=English
trigger1 = animelem=3
value = 3,107
channel = 0

[State 200, 1];voice
type = PlaySnd
;triggerall = var(55)=2		;Voice=Custom Corey Holland
trigger1 = animelem=3
value = 3,222
channel = 0

[State 240, 1]
type = PosAdd
trigger1 = animelem = 2
X = 20
[State 240, 1]
type = PosAdd
trigger1 = animelem = 10
X = -20

[State 250, 1]
type = PlaySnd
trigger1 = AnimElem = 4
value = 0, 5

[State 1120, HitDef]
type = HitDef
trigger1 = animelem=5
attr = S, HA
animtype  = Hard
damage = Ceil(IfElse(fvar(11) * 70 < 35, 35, fvar(11) * 70)), 0
priority = 6,Hit
getpower = 0,0
givepower = 100,0
hitflag = MAF
pausetime = 19,30  ;30,40
sparkno = s2719;-1
guard.sparkno = S8410
sparkxy = -35,-80;-15, -60
hitsound = S2720,1
ground.type = High
ground.slidetime = 20
ground.hittime  = 20
guard.hittime = 18
guard.slidetime = 13
guard.ctrltime = 18
ground.velocity = -4,0
guard.velocity = 0
air.velocity = -1.0*const(size.xscale),-3
fall = 0
fall.recover = 0
down.bounce = 1
air.fall = 0
yaccel = .3
persistent = 0
envshake.time = 20 ;40
envshake.freq = 100
envshake.ampl = 7 ;8
forcestand = 1
P2facing = 1
ground.cornerpush.veloff = 0
guard.cornerpush.veloff = 0
kill = 0
id = 3000

[state 2720, hit spark]
type = null;explod
trigger1 = animelem = 5
anim = 2719
postype = P1
pos = 85,-85
sprpriority = 7
removetime = -2

[State 902, TargetState]
type = TargetState
trigger1 = movehit
trigger1 = numtarget
trigger1 = !(target, ishelper)
value = 5000
ignorehitpause = 1
persistent = 0
id = 3000

[State 0, TargetBind]
type = null;TargetBind
trigger1 = MoveHit 
time = 1
id = 3000
pos = 70,0
ignorehitpause = 1
;persistent = 

[State 3700]; Send Gohan to next state
type = changestate
triggerall = MoveHit
trigger1 = !animtime
value = 2740
ctrl = 0

[State 3700]; Send Gohan to state 0
type = changestate
triggerall = !MoveHit
trigger1 = !animtime
value = 0
ctrl = 1

;-------------------------
; 3rd attack, MK
[Statedef 2740]
type    = S
movetype = A
physics = N
anim = 2740
juggle = 0
ctrl = 0
velset = 0,0
facep2 = 1
sprpriority = 2

[state 0, nothitby]
type = nothitby
trigger1 = 1
value = SCA
ignorehitpause = 1

[state 0, no bars]
type = assertspecial
trigger1 = 1
flag = nobardisplay
[state 0, no timeover]
type = assertspecial
trigger1 = 1
flag = timerfreeze
flag2 = nobardisplay

[State 2720, Clones? Saibamen?] ;Piccolo's clones are not present, neither are Saibamen
type		= VarSet
triggerall	= !Time
trigger1		= enemy, name = "Piccolo Z2" && (enemy, numhelper(3501) = 0 || enemy, numhelper(3502) = 0)
trigger2		= enemy, name != "Saibamen Z2" && authorname = "Team Z2"
v		= 24
value		= 0
ignorehitpause	= 1
[State 2720, Clones? Saibamen?] ;Piccolo's clones or Saibamen are present
type		= VarSet
triggerall	= !Time
trigger1		= enemy, name = "Piccolo Z2" && (enemy, numhelper(3501) || enemy, numhelper(3502))
trigger2		= enemy, name = "Saibamen Z2" && authorname = "Team Z2"
v		= 24
value		= 1
ignorehitpause	= 1

[state 0]
type = width
trigger1 = 1
value = 90,0

[State -2, AssertSpecial]
type = AssertSpecial
trigger1 = 1
flag = nobardisplay
ignorehitpause = 1

[State 220, snd]
type = null;PlaySnd
triggerall = var(55)=0		;Voice=Japan
trigger1 = animelem=3
value = 3,6
channel = 0

[State 200, 1];voice
type = null;PlaySnd
triggerall = var(55)=1		;Voice=English
trigger1 = animelem=3
value = 3,106
channel = 0

[State 200, 1];voice
type = PlaySnd
;triggerall = var(55)=2		;Voice=Custom Corey Holland
trigger1 = animelem=3
value = 3,224
channel = 0

[State 240, 1]
type = PosAdd
trigger1 = animelem = 4
X = 35

[State 250, 1]
type = PlaySnd
trigger1 = AnimElem = 5
value = 0, 5

[State 1120, HitDef]
type = HitDef
trigger1 = animelem=6
attr = S, HA
animtype  = Hard
damage = Ceil(IfElse(fvar(11) * 70 < 35, 35, fvar(11) * 70)), 0
priority = 6,Hit
getpower = 0,0
givepower = 100,0
hitflag = MAF
pausetime = 19,30  ;30,40
sparkno = s2719;-1
guard.sparkno = S8410
sparkxy = -38,-90;-15, -60
hitsound = S2720,1
ground.type = High
ground.slidetime = 20
ground.hittime  = 20
guard.hittime = 18
guard.slidetime = 13
guard.ctrltime = 18
ground.velocity = 0;-3,0
guard.velocity = 0
air.velocity = -1.0*const(size.xscale),-3
fall = 0
fall.recover = 0
down.bounce = 1
air.fall = 0
yaccel = .3
persistent = 0
envshake.time = 20 ;40
envshake.freq = 100
envshake.ampl = 7 ;8
forcestand = 1
P2facing = 1
ground.cornerpush.veloff = 0
guard.cornerpush.veloff = 0
kill = 0
id = 3000

[state 2720, hit spark]
type = null;explod
trigger1 = animelem = 6
anim = 2719
postype = P1
pos = 80,-95
sprpriority = 7
removetime = -2

[State 902, TargetState]
type = TargetState
trigger1 = movehit
trigger1 = numtarget
trigger1 = !(target, ishelper)
value = 5000
ignorehitpause = 1
persistent = 0
id = 3000

[State 0, TargetBind]
type = null;TargetBind
trigger1 = MoveHit 
time = 1
id = 3000
pos = 80,0 
ignorehitpause = 1
;persistent = 

[State 3700]; Send Gohan to next state
type = changestate
triggerall = MoveHit
trigger1 = !animtime
value = 2750
ctrl = 0

[State 3700]; Send Gohan to state 0
type = changestate
triggerall = !MoveHit
trigger1 = !animtime
value = 0
ctrl = 1

;-------------------------
; 4th attack, MP
[Statedef 2750]
type    = S
movetype = A
physics = N
anim = 2750
juggle = 0
ctrl = 0
velset = 0,0
facep2 = 1
sprpriority = 2

[state 0, nothitby]
type = nothitby
trigger1 = 1
value = SCA
ignorehitpause = 1

[state 0, no bars]
type = assertspecial
trigger1 = 1
flag = nobardisplay
[state 0, no timeover]
type = assertspecial
trigger1 = 1
flag = timerfreeze
flag2 = nobardisplay

[State 2720, Saibamen not on screen]
type = VarSet
triggerall = !Time
trigger1 = enemy, name != "Saibamen Z2" && authorname = "Team Z2"
var(24) = 0
ignorehitpause = 1
[State 2720, Saibamen on screen]
type = VarSet
triggerall = !Time
trigger1 = enemy, name = "Saibamen Z2" && authorname = "Team Z2"
var(24) = 1
ignorehitpause	= 1

[state 0]
type = width
trigger1 = 1
value = 90,0

[State -2, AssertSpecial]
type = AssertSpecial
trigger1 = 1
flag = nobardisplay
ignorehitpause = 1

[State 220, snd]
type = null;PlaySnd
triggerall = var(55)=0		;Voice=Japan
trigger1 = animelem=2
value = 3,5
channel = 0

[State 200, 1];voice
type = null;PlaySnd
triggerall = var(55)=1		;Voice=English
trigger1 = animelem=2
value = 3,105
channel = 0

[State 200, 1];voice
type = PlaySnd
;triggerall = var(55)=2		;Voice=Custom Corey Holland
trigger1 = animelem=2
value = 3,226
channel = 0

[State 250, 1]
type = PlaySnd
trigger1 = AnimElem = 3
value = 0, 2

[State 1120, HitDef]
type = HitDef
trigger1 = animelem=4
attr = S, HA
animtype  = Hard
damage = Ceil(IfElse(fvar(11) * 70 < 35, 35, fvar(11) * 70)), 0
priority = 6,Hit
getpower = 0,0
givepower = 100,0
hitflag = MAF
pausetime = 19,50
sparkno = s2719;-1
guard.sparkno = S8410
sparkxy = -35,-65;-15, -60
hitsound = S2720,0
ground.type = Low
ground.slidetime = 20
ground.hittime  = 20
guard.hittime = 18
guard.slidetime = 13
guard.ctrltime = 18
ground.velocity = -5,0
guard.velocity = 0
fall = 0
fall.recover = 0
down.bounce = 1
air.fall = 0
yaccel = .3
persistent = 0
envshake.time = 20 ;40
envshake.freq = 100
envshake.ampl = 7 ;8
forcestand = 1
P2facing = 1
kill = 0

[state 2720, hit spark]
type = null;explod
trigger1 = animelem = 4
anim = 2719
postype = P1
pos = 75,-65
sprpriority = 7
removetime = -2

[State 902, TargetState]
type = TargetState
trigger1 = movehit
trigger1 = numtarget
trigger1 = !(target, ishelper)
value = 5000
ignorehitpause = 1
persistent = 0

[State 3700]; Send Gohan to next state (Piccolo clones workaround)
type = changestate
triggerall = NumTarget
triggerall = MoveHit
trigger1 = !animtime
value = IfElse(var(24)=1,2751,2760)
ctrl = 0

[State 3700]; Send Gohan to state 0
type = changestate
trigger1 = !MoveHit
triggerall = !animtime
trigger2 = !NumTarget
value = 105
ctrl = 0


;-------------------------
; PICCOLO SAIBAMEN 5th attack, Teleport then c.SK (Piccolo clones)
[Statedef 2751]
type    = S
movetype = A
physics = N
anim = 2760
juggle = 0
ctrl = 0
velset = 0,0
facep2 = 1
sprpriority = 2

[state 0, nothitby]
type = nothitby
trigger1 = 1
value = SCA
ignorehitpause = 1

[state 0, no bars]
type = assertspecial
trigger1 = 1
flag = nobardisplay
[state 0, no timeover]
type = assertspecial
trigger1 = 1
flag = timerfreeze
flag2 = nobardisplay

[State 2720, Clones? Saibamen? Var reset]
type		= VarSet
trigger1	= !Time
v		= 24
value		= 0
ignorehitpause	= 1

[State -2, AssertSpecial]
type = AssertSpecial
trigger1 = 1
flag = nobardisplay
ignorehitpause = 1

[State 250, teleport sound]
type = PlaySnd
trigger1 = AnimElem = 2
trigger2 = AnimElem = 3
value = 2302, 0

[State 4001, Teleport]
type = PosAdd
trigger1 = AnimElemTime(3) = 0
X = (P2Dist X) + 80

[State 4001, Teleport]
type = PosSet
trigger1 = AnimElemTime(3) = 0
Y = 0

[State 4001, Teleport]
type = Turn
trigger1 = AnimElemTime(3) = 0

[State 3700]; Send Gohan to Fatality 3
type = changestate
triggerall = var(33)=1 && fvar(28)>=300
trigger1 = AnimElemTime(4) = 0
value = 3201

[State 220, snd]
type = null;PlaySnd
triggerall = var(55)=0		;Voice=Japan
trigger1 = animelem=6
value = 260,0
channel = 0

[State 220, snd]
type = null;PlaySnd
triggerall = var(55)=1		;Voice=English
trigger1 = animelem=6
value = 1100,105
channel = 0

[State 200, 1];voice
type = PlaySnd
;triggerall = var(55)=2		;Voice=Custom Corey Holland
trigger1 = animelem=6
value = 3,228
channel = 0

[State 250, 1]
type = PlaySnd
trigger1 = AnimElem = 6
value = 0, 5


[State 1120, HitDef]
type = HitDef
trigger1 = animelem = 7
attr = S, HA
animtype  = Hard
damage = Ceil(IfElse(fvar(11) * 70 < 35, 35, fvar(11) * 70)), 0
;Ceil(IfElse(fvar(11) * 70 < 7, 7, fvar(11) * 70)), 0
; 70,0
priority = 6,Hit
getpower = 0,0
givepower = 100,0
hitflag = MAF
pausetime = 34,35
sparkno = s2719;-1
guard.sparkno = S8410
sparkxy = -20,-95;-15, -60
hitsound = S2720,1
ground.type = High
ground.slidetime = 13
ground.hittime  = 20
guard.hittime = 18
guard.slidetime = 13
guard.ctrltime = 18
ground.velocity = -5,-11.5
guard.velocity = 0
air.velocity = -2.0*const(size.xscale),0
fall = 1
fall.recover = 0
down.bounce = 1
air.fall = 1
yaccel = .80*const(size.yscale)
;persistent = 0
envshake.time = 40
envshake.freq = 100
envshake.ampl = 12
;forcestand = 1
P2facing = 1
ground.cornerpush.veloff = 0
guard.cornerpush.veloff = 0
kill = 1


[State 902, TargetState]
type = TargetState
trigger1 = movehit
trigger1 = numtarget
trigger1 = !(target, ishelper)
value = 5000
ignorehitpause = 1
persistent = 0

[State 3700]; Send Gohan to state 0
type = changestate
trigger1 = !animtime
value = 0
ctrl = 1


;-------------------------
; 5th attack, Teleport then c.SK
[Statedef 2760]
type    = S
movetype = A
physics = N
anim = 2760
juggle = 0
ctrl = 0
velset = 0,0
facep2 = 1
sprpriority = 2

[state 0, nothitby]
type = nothitby
trigger1 = 1
value = SCA
ignorehitpause = 1

[state 0, no bars]
type = assertspecial
trigger1 = 1
flag = nobardisplay
[state 0, no timeover]
type = assertspecial
trigger1 = 1
flag = timerfreeze
flag2 = nobardisplay

[State 2760, No clones Explod]
type = Explod
trigger1 = !NumExplod(991901)
trigger1 = MoveHit = 1
anim = 5939
ID = 991901
pos = 0,0
postype = p1  ;p2,front,back,left,right
bindtime = -1
removetime = -1
removeongethit = 1
	
[State -2, AssertSpecial]
type = AssertSpecial
trigger1 = 1
flag = nobardisplay
ignorehitpause = 1

[State 250, teleport sound]
type = PlaySnd
trigger1 = AnimElem = 2
trigger2 = AnimElem = 3
value = 2302, 0

[State 4001, Teleport]
type = PosAdd
trigger1 = AnimElemTime(3) = 0
X = (P2Dist X) + 80

[State 4001, Teleport]
type = PosSet
trigger1 = AnimElemTime(3) = 0
Y = 0

[State 4001, Teleport]
type = Turn
trigger1 = AnimElemTime(3) = 0

[State 3700]; Send Gohan to Fatality 3
type = null;changestate
triggerall = var(33)=1 && fvar(28)>=300
trigger1 = AnimElemTime(4) = 0
value = 3201

[State 220, snd]
type = null;PlaySnd
triggerall = var(55)=0		;Voice=Japan
trigger1 = animelem=6
value = 260,0
channel = 0

[State 220, snd]
type = null;PlaySnd
triggerall = var(55)=1		;Voice=English
trigger1 = animelem=6
value = 1100,105
channel = 0

[State 200, 1];voice
type = PlaySnd
;triggerall = var(55)=2		;Voice=Custom Corey Holland
trigger1 = animelem=6
value = 3,228
channel = 0

[State 250, 1]
type = PlaySnd
trigger1 = AnimElem = 6
value = 0, 5

[State 1120, HitDef]
type = HitDef
trigger1 = animelem = 7
attr = S, HA
animtype  = Hard
damage = Ceil(IfElse(fvar(11) * 70 < 35, 35, fvar(11) * 70)), 0
priority = 6,Hit
getpower = 0,0
givepower = 100,0
hitflag = MAF
pausetime = 19,20
sparkno = s2719;-1
guard.sparkno = S8410
sparkxy = -35,-100 ;-15, -60
hitsound = S2720,1
ground.type = High
ground.slidetime = 13
ground.hittime  = 20
guard.hittime = 18
guard.slidetime = 13
guard.ctrltime = 18
ground.velocity = -5
guard.velocity = 0
air.velocity = -2.0*const(size.xscale),0
fall = 0
fall.recover = 0
down.bounce = 1
air.fall = 0
yaccel = .80*const(size.yscale)
persistent = 0
envshake.time = 40
envshake.freq = 100
envshake.ampl = 8
forcestand = 1
P2facing = 1
kill = 0
id = 2761

[state 2720, hit spark]
type = null;explod
trigger1 = animelem = 7
anim = 2719
postype = P1
pos = 35,-105
sprpriority = 7
removetime = -2

[State 0, TargetState]  ;New state
type = TargetState
triggerall = !(target,IsHelper)
trigger1 = Numtarget(2761)
trigger1 = movehit = 1
value = 2761
ID = 2761
ignorehitpause = 1
persistent = 0

[State 3700]; Send Gohan to next state
type = changestate
triggerall = MoveHit
trigger1 = !animtime
value = 2770
ctrl = 0

[State 3700]; Send Gohan to state 0
type = changestate
triggerall = !MoveHit
trigger1 = !animtime
value = 0
ctrl = 1


;------------------------------------------------
;P2 State - Sent diagonal
[Statedef 2761]
type = A
physics = N
movetype = H
ctrl = 0
velset = 0,0

[state 0, nothitby]
type = nothitby
trigger1 = 1
value = SCA

[State 3020, 2]
type = velset
trigger1 = time=15
X = -16
Y = -16

[State 3020, 2]
type = changeanim2
trigger1 = !time && anim !=2761
value = 2761

[State 1050, 1]
type = sprpriority
trigger1 = 1
value = 1

[State 182, 1]
type = screenbound
trigger1 = 1
movecamera = 0,0
value = 0

[State 3000, state] ;go to center of screen
type = ChangeState
trigger1 = P2StateNo = 2770
value = 2775
ctrl = 0

;-------------------------
; Gohan out of screen before air dashing diagonally
[Statedef 2770]
type    = S
movetype = A
physics = N
;anim = 2770
ctrl = 0
velset = 0,0
facep2 = 1
sprpriority = 2

[state 0, nothitby]
type = nothitby
trigger1 = 1
value = SCA

[State 2201, helper]; Background lines
type = Helper
trigger1 = !time
;pos = -320, 350
pos = -170, 200
postype = back
stateno = 2774
helpertype = normal
name = "diagonal_lines_BG"
;id = 2774
ownpal = 1
supermovetime = 150
pausemovetime = 150

[State 2201, helper]; Background lines
type = Helper
trigger1 = !time
;pos = 0, 300
pos = 150, 150
postype = back
stateno = 2774
helpertype = normal
name = "diagonal_lines_BG"
;id = 2774
ownpal = 1
supermovetime = 150
pausemovetime = 150

[State 2260, bg]
type = assertspecial
trigger1 = 1
flag = noFG
flag2 = noBG
flag3 = nobardisplay
ignorehitpause = 1

[State 2260, bg]
type = assertspecial
trigger1 = 1
flag = globalnoshadow
flag2 = noshadow
ignorehitpause = 1

[State 3001, screen]
type = Screenbound
trigger1 = 1
movecamera = 0,0
value = 0

[state 2772, out of screen]
type = posset
trigger1 = !time
x = -300*facing
y = 190

[state 2772, P2 flying in the air]
type = PlaySnd
trigger1 = !time
value = 2907,0

[state 2772, dashing]
type = null;PlaySnd
trigger1 = time=20
value = 2700,2

[State 3000, sky belongs to me voice]
type = PlaySnd
;triggerall = var(55)=2		;Voice=Custom Corey Holland
;triggerall = (var(33)=1 && fvar(28)>=100 && fvar(28)<200)=0   ;Not finisher 1
;triggerall = (var(33)=1 && fvar(28)>=200 && fvar(28)<300)=0   ;Not finisher 2
triggerall = (var(33)=1 && fvar(28)>=100)=0   ;No finisher
trigger1 = time=44 ;55
value = 2700,20
channel = 0

[state 2772, dashing]
type = null;velset
trigger1 = time=90
x = 20
y = -20

[state 2772, dashing stop]
type = null;velset
trigger1 = time=104
x = 0
y = 0

[state 2772, teleport in]
type = changeanim
trigger1 = ifelse((var(33) = 1 && fvar(28) = [100,199]),time = 85,time = 90)
value = 2770

[state 2772, teleport sound]
type = playsnd
trigger1 = ifelse((var(33) = 1 && fvar(28) = [100,199]),time = 85,time = 90)
value = 2302,0

[state 2772, teleport to P2 for finisher 2]
type = posset
triggerall = var(33) = 1 && fvar(28) = [100,199]
trigger1 = time = 85 ;98
x = enemy, pos x - 100*facing
y = enemy, pos y + 10

[state 2772, teleport to P2]
type = posset
trigger1 = time = 90 ;104
x = enemy, pos x - 60*facing
y = enemy, pos y - 40

[state 2772, dashing stop if FATALITY 2]
type = null;velset
triggerall = var(33)=1 && fvar(28)>=100 && fvar(28)<200;var(33)=1 && fvar(28)>=200 && fvar(28)<300
trigger1 = time=101
x = 0
y = 0

[State 13100, FATALITY 2]
type = ChangeState
triggerall = var(33)=1 && fvar(28)>=100 && fvar(28)<200
;triggerall = var(33)=1 && fvar(28)>=200 && fvar(28)<300
trigger1 = Time = 87 ;101
value = 3100
ctrl = 0

[State 13100, End]
type = ChangeState
trigger1 = Time = 112 ;140
value = 2773
ctrl = 0

;------------------------------------
;P2 center of screen
[Statedef 2775]
type = A
movetype = H
physics = N
velset = 0,0
ctrl = 0
sprpriority = 2

[state 0, nothitby]
type = nothitby
trigger1 = 1
value = SCA

[State 2260, bg]
type = assertspecial
trigger1 = 1
flag = globalnoshadow
ignorehitpause = 1

[State 3001, screen]
type = Screenbound
trigger1 = 1
movecamera = 0,0
value = 1

[State 3001, sprpriority]
trigger1 = time = 0
type = SprPriority
value = 2

[State 3001, anim2]
type = Changeanim2
trigger1 = time = 0
value = 2761

[State 3001, PosSet]
type = PosSet
trigger1 = 1
x = (-30+15*(enemy,fvar(28)>=200 && enemy,fvar(28)<300))*facing
y = -30

[State 3001, shake]
type = EnvShake
trigger1 = time = 0
time = 150
freq = 100
ampl = 3

[state 2775, to finisher 1]
type = changestate
trigger1 = enemy, anim = 3100
trigger1 = enemy, animelem = 14
value = 3105

[state 2775]
type = changestate
trigger1 = enemy,anim = 2773
trigger1 = enemy,animelem = 5
value = 2779

;-------------------------
; 6th attack, a.SP
[Statedef 2773]
type    = A
movetype = A
physics = N
anim = 2773
juggle = 0
ctrl = 0
velset = 0,0
facep2 = 1
sprpriority = 2

[state 0, nothitby]
type = nothitby
trigger1 = 1
value = SCA

[State 2260, bg]
type = assertspecial
trigger1 = 1
flag = noFG
flag2 = noBG
flag3 = nobardisplay
ignorehitpause = 1

[State 2260, bg]
type = assertspecial
trigger1 = 1
flag = globalnoshadow
flag2 = noshadow
ignorehitpause = 1

[State 220, snd]
type = null;PlaySnd
triggerall = var(55)=0		;Voice=Japan
trigger1 = animelem=3
value = 260,1
channel = 0

[State 220, snd]
type = null;PlaySnd
triggerall = var(55)=1		;Voice=English
trigger1 = animelem=3
value = 1100,100+(random%5)
channel = 0

[State 200, 1];voice
type = PlaySnd
;triggerall = var(55)=2		;Voice=Custom Corey Holland
triggerall = animelem=3
trigger1 = var(33)=1 && fvar(28)>=100 && fvar(28)<200	;Finisher 1
trigger2 = var(33)=1 && fvar(28)>=300					;Finisher 3
value = 3,220+random%9
channel = 0

[State 250, 1]
type = PlaySnd
trigger1 = AnimElem = 4
value = 0, 2

[state 2773, hit sound]
type = playsnd
trigger1 = animelem = 5
value = s2720,2

[state 2773, hit spark]
type = explod
trigger1 = animelem = 5
anim = 2719
postype = P1
pos = 60,-30
sprpriority = 7

[state 0, envshake]
type = envshake
trigger1 = animelem = 5
time = 20 ;40
freq = 100
ampl = 7 ;8

[state 0]
type = hitadd
trigger1 = animelem = 5
value = 1

[state 2773, targetlifeadd]
type = targetlifeadd
trigger1 = animelem = 5
kill = ifelse((var(33) = 1 && fvar(28) = [100,300]),0,1) ;only kills if not in emo or emo lvl0
value = -Ceil(IfElse(fvar(11) * 100 < 50, 50, fvar(11) * 100))

[State 1120, HitDef]
type = null;HitDef
trigger1 = animelem = 5
attr = S, HA
animtype  = Hard
damage = Ceil(IfElse(fvar(11) * 100 < 50, 50, fvar(11) * 100)), 0
;Ceil(IfElse(fvar(11) * 100 < 7, 7, fvar(11) * 100)), 0
; 100,0
priority = 6,Hit
getpower = 0,0
givepower = 100,0
hitflag = MAF
pausetime = 29,70
sparkno = s2719
guard.sparkno = S8410
sparkxy = -25,-30;-15, -60
hitsound = S2720,2
ground.type = High
ground.slidetime = 13
ground.hittime  = 20
guard.hittime = 18
guard.slidetime = 13
guard.ctrltime = 18
ground.velocity = -5
guard.velocity = 0
air.velocity = -2.0*const(size.xscale),0
fall = 0
fall.recover = 0
down.bounce = 1
air.fall = 0
yaccel = .80*const(size.yscale)
envshake.time = 40
envshake.freq = 100
envshake.ampl = 8
forcestand = 1
P2facing = 1
ground.cornerpush.veloff = 0
guard.cornerpush.veloff = 0
kill = 1 - (var(33)=1 && fvar(28)>=100)
;p2stateno = 2779
id = 2779

[State 0, TargetState]  ;New state
type = null;TargetState
trigger1 = Numtarget(2779)
trigger1 = movehit = 1
value = 2779
ID = 2779
ignorehitpause = 1
persistent = 0

[State 13100, FATALITY 1]
type = ChangeState
triggerall = var(33)=1 && fvar(28)>=200 && fvar(28)<300
trigger1 = !animtime
value = 3000
ctrl = 0

;0 99    lvl 0
;100 199 lvl 1
;200 299 lvl 2
;300     lvl 3

[State 13100, FATALITY 3]
type = ChangeState
triggerall = var(33)=1 && fvar(28)>=300
trigger1 = !animtime
value = 3200
ctrl = 0

[State 3700]; Send Gohan to next state
type = changestate
trigger1 = !animtime
value = 2791
ctrl = 0

[State 3700]; Send Gohan to next state
type = changestate
triggerall = var(33)=1 && fvar(28)<100
trigger1 = !animtime
value = 2791
ctrl = 0

;------------------------------------------------
;P2 State - Sent down
[Statedef 2779]
type = A
physics = N
movetype = H
ctrl = 0
anim = 5030
velset = 0,0

[State 2260, bg]
type = assertspecial
trigger1 = 1
flag = noFG
flag2 = noBG
flag3 = nobardisplay
ignorehitpause = 1

[State 3020, 2]
type = changeanim2
trigger1 = time = 10;!time && anim !=2780
value = 2780

[State 3020, 2]
type = velset
trigger1 = time=10
X = -1
Y = 14

[State 181, 1]
type = NotHitBy
trigger1 = 1
value = SCA

[State 1050, 1]
type = sprpriority
trigger1 = 1
value = 1

[State 182, 1]
type = screenbound
trigger1 = 1
movecamera = 0,0
value = 0

[State 3020, 2]
type = velset
trigger1 = pos Y > 300
X = 0
Y = 0

[State 3000, state] ;go to ground
type = ChangeState
trigger1 = P2StateNo = 2791
trigger2 = P2StateNo = 3000
trigger3 = P2StateNo = 3200
value = 2780
ctrl = 0

;------------------------------------------------
; P2 goes back to ground
[StateDef 2780]
type = S
movetype = H
physics = N
ctrl = 0
sprpriority = -1
velset = -1, 14

[State 182, 1]
type = screenbound
trigger1 = 1
movecamera = 0,0
value = 0

[State 182, 1]
type = PosSet
trigger1 = !time
Y = -300

[State 182, move P2 X-wise if finisher 3]
type = PosAdd
triggerall = !time
trigger1 = enemy,stateno = [3200,3201]
X = 50

[State 182, 1]
type = ChangeAnim2
trigger1 = !time && anim!=2780
value = 2780

[State 181, 1]
type = null;NotHitBy
trigger1 = P2StateNo != 3000
value = SCA
time = 200

[State 13100, shake]
type = envshake
trigger1 = Pos Y >= 10
trigger1 = Vel Y > 0
time = 15
freq = 90
ampl = 6

[state 2780, to lvl2 finisher]
type = changestate
trigger1 = enemy,anim = 3000 && enemy,animelem = 6
value = 3001

[State 1200]
type = ChangeState
trigger1 = Pos Y >= 10
trigger1 = Vel Y > 0
value = 2781

;---------------------------------------------------------------------------
;P2 bouncing on the ground
[Statedef 2781]
type    = L
movetype= H
physics = N

[State 3000, nhb]
type = NotHitBy
trigger1 = 1
time = 1
value = SCA

[State 4005, vel Y]
type = varset
trigger1 = !time
var(6) = 1

[State 5100, 1]
type = VelSet
trigger1 = Time = 0
trigger1 = GetHitVar(fall.yvel) = 0
trigger1 = vel x > 1
x = 1

[State 5100, EnvShake]
type = FallEnvShake
trigger1 = Time = 0

[State 5100, Var] ;Save fall velocity
type = VarSet
trigger1 = Time = 0
sysvar(1) = floor(vel y)

[State 5100, 2] ;Hit ground anim (normal)
type = ChangeAnim
triggerall = time = 0
trigger1 = (anim != [5051,5059]) && (anim != [5061,5069])
trigger2 = !SelfAnimExist(5100 + (anim % 10))
value = 5100

[State 5100, 3] ;Hit ground anim (for hit up)
type = ChangeAnim
trigger1 = time = 0
trigger1 = (anim = [5051,5059]) || (anim = [5061,5069])
trigger1 = SelfAnimExist(5100 + (anim % 10))
value = 5100 + (anim % 10)

[State 5100, 4]
type = PosSet
trigger1 = Time = 0
y = 0

[State 5100, 5]
type = VelSet
trigger1 = Time = 0
y = 0

[State 5100, 6] ;Reduce speed
type = VelMul
trigger1 = Time = 0
x = 0.5

[State 5100, 5]
type = VelSet
trigger1 = AnimTime = 0
y = -7

[State 111, 1]
type = StateTypeSet
trigger1 = AnimTime = 0
physics = A

[State 5100, 12]
type = ChangeState
trigger1 = AnimTime = 0
value = 2782    ;=5050 modified
;---------------------------
; HITA_FALL (knocked up, falling)
[Statedef 2782]
type    = A
movetype= H
physics = N
ctrl = 0

[State 3000, nhb]
type = NotHitBy
trigger1 = 1
time = 1
value = SCA

[State 5050, 1] ;Change anim when done with transition
type = ChangeAnim
trigger1 = AnimTime = 0
trigger1 = Anim = 5035
trigger2 = Time = 0     ;If no transition anim
trigger2 = Anim != 5035
trigger2 = (Anim != [5051, 5059]) && (Anim != [5061, 5069])
trigger2 = Anim != 5090 ;Not if hit off ground anim
value = 5050

[State 5050, 2] ;Coming down anim
type = ChangeAnim
trigger1 = anim = [5050,5059]
trigger1 = Vel Y >= IfElse(anim = 5050, 1, -2)
trigger1 = SelfAnimExist(anim+10)
value = anim+10
persistent = 0

[State 5050, 3] ;Gravity
type = VelAdd
trigger1 = 1
y = GetHitVar(yaccel)

[State 5050, 6]
type = ChangeState
trigger1 = Vel Y > 0
trigger1 = Pos Y >= IfElse((anim = [5051,5059]) || (anim = [5061,5069]), 0, 25)
value = 2785  ;2783   ;=5100 modified

;---------------------------------------------------------------------------
; HIT_BOUNCE (hit ground)
[Statedef 2783]
type    = L
movetype= H
physics = N
ctrl = 0

[State 3000, nhb]
type = NotHitBy
trigger1 = 1
time = 1
value = SCA

[State 5100, 1]
type = VelSet
trigger1 = Time = 0
trigger1 = GetHitVar(fall.yvel) = 0
trigger1 = vel x > 1
x = 1

[State 5100, EnvShake]
type = FallEnvShake
trigger1 = Time = 0

[State 5100, Var] ;Save fall velocity
type = VarSet
trigger1 = Time = 0
sysvar(1) = floor(vel y)

[State 5100, 2] ;Hit ground anim (normal)
type = ChangeAnim
triggerall = time = 0
trigger1 = (anim != [5051,5059]) && (anim != [5061,5069])
trigger2 = !SelfAnimExist(5100 + (anim % 10))
value = 5100

[State 5100, 3] ;Hit ground anim (for hit up)
type = ChangeAnim
trigger1 = time = 0
trigger1 = (anim = [5051,5059]) || (anim = [5061,5069])
trigger1 = SelfAnimExist(5100 + (anim % 10))
value = 5100 + (anim % 10)

[State 5100, 4]
type = PosSet
trigger1 = Time = 0
y = 0

[State 5100, 5]
type = VelSet
trigger1 = Time = 0
y = 0

[State 5100, 6] ;Reduce speed
type = VelMul
trigger1 = Time = 0
x = 0.75

[State 5100, 10]
type = PlaySnd
trigger1 = Time = 1
;value = F7, (sysvar(1) > 5) + (sysvar(1) > 14)
value = F7,2

[State 5100, 11]
type = PosFreeze
trigger1 = 1

[State 5100, 12]
type = ChangeState
trigger1 = AnimTime = 0
value = 2784    ;=5101 modified

;---------------------------------------------------------------------------
; HIT_BOUNCE (bounce into air)
[Statedef 2784]
type    = L
movetype= H
physics = N

[State 3000, nhb]
type = NotHitBy
trigger1 = 1
time = 1
value = SCA

[State 5101, 1] ;Coming hit ground anim (normal)
type = ChangeAnim
triggerall = time = 0
trigger1 = anim != [5101,5109]
trigger2 = !SelfAnimExist(5160 + (anim % 10))
value = 5160

[State 5101, 2] ;Coming hit ground anim (for hit up)
type = ChangeAnim
triggerall = time = 0
trigger1 = anim = [5101,5109]
trigger1 = SelfAnimExist(5160 + (anim % 10))
value = 5160 + (anim % 10)

[State 5101, 3]
type = HitFallVel
trigger1 = Time = 0

[State 5101, 4]
type = PosSet
trigger1 = Time = 0
y = 20

[State 5101, 5] ;Acceleration
type = VelAdd
trigger1 = 1
y = .4

[State 5101, 6] ;Hit ground
trigger1 = Vel Y > 0
trigger1 = Pos Y >= 12
type = ChangeState
value = 2785   ;=5110 modified

;---------------------------------------------------------------------------
; HIT_LIEDOWN
[Statedef 2785]
type    = L
movetype= H
physics = N

[State 3000, nhb]
type = NotHitBy
trigger1 = 1
time = 1
value = SCA

[State 5110, EnvShake]
type = FallEnvShake
trigger1 = Time = 0

[State 5110, 2] ;Hit ground anim (normal)
type = ChangeAnim
triggerall = time = 0
triggerall = anim != [5110,5119] ;Not already changed anim
trigger1 = anim != [5161,5169]
trigger2 = !SelfAnimExist(5170 + (anim % 10))
value = 5170

[State 5110, 4]
type = HitFallDamage
trigger1 = Time = 0

[State 5110, 5]
type = PosSet
trigger1 = Time = 0
y = 0

[State 5110, Var] ;Get fall velocity
type = VarSet
trigger1 = Time = 0
trigger1 = GetHitVar(fall.yvel) != 0
sysvar(1) = floor(vel y)



[State 5110, 8]
type = VelSet
trigger1 = Time = 0
y = 0

[State 5110, 9] ;For hit up type
type = ChangeAnim
persistent = 0
triggerall = anim = [5171,5179]
triggerall = SelfAnimExist(5110 + (anim % 10))
trigger1 = AnimTime = 0
trigger2 = SysVar(0) ;SysVar(0) = 1 avoids hit ground anim
value = 5110 + (anim % 10)

[State 5110, 10] ;For normal
type = ChangeAnim
persistent = 0
triggerall = Anim != [5111,5119]
trigger1 = AnimTime = 0
trigger2 = SysVar(0) ;SysVar(0) = 1 avoids hit ground frame
value = 5110

[State 5110, 11] ;If just died
type = SelfState
triggerall = !alive
trigger1 = AnimTime = 0
trigger2 = SysVar(0) ;SysVar(0) = 1 avoids hit ground frame
trigger3 = Anim = [5110,5119]
value = 5150

[State 5110, 11] ;Alive
type = SelfState
triggerall = alive
trigger1 = time = 40
value = 5120

[State 5110, 12]
type = VarSet
trigger1 = SysVar(0)
trigger1 = Time = 0
sysvar(0) = 0

[State 5110, 13] ;Friction
type = VelMul
trigger1 = 1
x = 0.85

;-------------------------------------
;Gohan state - Invisible and waiting
[Statedef 2790]
type = A
physics = N
movetype = A
ctrl = 0
sprpriority = 1
anim = 15999
velset = 0,0

[State 2260, bg]
type = assertspecial
trigger1 = 1
flag = noFG
flag2 = noBG
flag3 = nobardisplay
ignorehitpause = 1

[State 182, 1]
type = screenbound
trigger1 = 1
movecamera = 0,0
value = 0

[State 3020, pos]
type = PosSet
trigger1 = !time
X = 0
Y = -240

[State 3000, state] ;go to ground
type = ChangeState
trigger1 = P2StateNo = 2780
value = 2791
ctrl = 0

;-------------------------
; Gohan Fall back to ground
[Statedef 2791]
type    = A
movetype = I
physics = N
anim = 2790
juggle = 0
ctrl = 0
velset = 0,0
facep2 = 1
sprpriority = 2

[State 3020, pos]
type = PosSet
trigger1 = !time
X = 0
Y = -300

[State 182, 1]
type = screenbound
trigger1 = 1
movecamera = 0,0
value = 0

[State -2, Vel]
type = VelAdd
trigger1 = 1
Y = 0.45

[State -2, AssertSpecial]
type = AssertSpecial
trigger1 = 1
flag = nobardisplay
ignorehitpause = 1

[State 3700]; Send Gohan to next state
type = changestate
trigger1 = pos Y >= -5
value = 2795
ctrl = 0

;-------------------------
; Ironman pose
[Statedef 2795]
type    = A
movetype = I
physics = N
anim = 2795
juggle = 0
ctrl = 0
velset = 0,0
facep2 = 1
sprpriority = 2

[State 17100, Landing Sound]
type = PlaySnd
trigger1 = !time
value = 40, 0

[state 17100, twirl FX]
type=explod
trigger1 = !time
anim=17200
id=17200
pos=7,0
postype=P1
sprpriority=-2
ownpal=1
supermovetime=-1
removetime = -2
persistent = 0
scale = 1,0.8

[State -2, AssertSpecial]
type = AssertSpecial
trigger1 = 1
flag = nobardisplay
ignorehitpause = 1

[State -2, pos]
type = PosSet
trigger1 = !time
Y = 0

[State 0, RemoveExplod]
type = RemoveExplod
trigger1 = !Time
id = 991901

[State 3700]; Send Gohan to next state
type = changestate
trigger1 = !animtime
value = 0
ctrl = 1




;===========================================================================
; <<<<< DESTINY MODE >>>>>
; Destiny Activation = 2800
;===========================================================================

;DESTINY Activation
[Statedef 2800]
type		= S
movetype		= I
physics		= S
anim		= 2800
ctrl		= 0
velset		= 0,0
sprpriority	= 1

[State 2800, PowerAdd]
type		= PowerAdd
trigger1		= AnimElemTime(4)=0
value		= -2000

[State 200, BGPalFX]
type = BGPalFX
trigger1 = animelemtime(4)>=0 && time<150
time = 1
add	= -100,-100,-100
mul	= 100,100,256
invertall = 0
color = 256

[State 3000, SuperPause]
type = SuperPause
trigger1 = animelemtime(4)=0
time = 144
p2defmul = 1
unhittable = 1
anim = -1
sound = s2350,0
darken = 0
movetime = 144

[State 3000, nhb]
type = NotHitBy
trigger1 = animelemtime(4)>=0 && time<=150
time = 1
value = SCA

[State 1000, shake]
type = EnvShake
trigger1 = animelemtime(4)>=0
trigger1 = !(time%12)
time=12
freq=100
ampl=ifelse(3+0.02*time > 4, 4, 3+0.02*time)

[State 4500, 1];Scream
type = null;PlaySnd
triggerall = var(55)=0		;Voice=Japan
trigger1 = animelemtime(4)=0
value = 8,2
volume = 500
channel = 0

[State 4500, 1];Scream
type = null;PlaySnd
triggerall = var(55)=1		;Voice=English
trigger1 = animelemtime(4)=0
value = 8,5
volume = 500
channel = 0

[State 200, 1];voice
type = PlaySnd
;triggerall = var(55)=2		;Voice=Custom Corey Holland
trigger1 = animelemtime(4)=0
value = 2800,5
channel = 0

[State 4500, 2];long sound
type = PlaySnd
trigger1 = animelemtime(5)=0
value = 8,0
loop = 1
pan = 1
volume = 25
channel = 3
[State 4500, 2];long sound
type = PlaySnd
trigger1 = time=130
value = 8,0
loop = 1
pan = 1
volume = 25
channel = 3

[State 4500, 1];Small sound
type = PlaySnd
trigger1 = animelemtime(4)=0
value = 8,1
volume = 255

[State 0, lightning sound]
type = PlaySnd
triggerall = animelemtime(4)>=0
trigger1 = gametime%(20) = 0
value = 2800,random%3

[State 1900, dust]
type = explod
trigger1 = animelemtime(4)=0
anim = 908+(var(2)=0)
id = 908
pos = 17,5
sprpriority = 4
bindtime = -1
ownpal = 1
removeongethit = 1
ignorehitpause = 1
facing = -1
removetime = -1
pausemovetime = 99999
supermovetime = 99999

[State 2800, lightning aura]
type = explod
trigger1 = animelemtime(4)>=0
trigger1 = gametime%(4) = 0
anim = 2810+(random%12);2805+(random%4)
id = 2805
pos = 38-(random%76),-105+(Random%80);10-5*(random%5),-55
sprpriority = 4
bindtime = -1
ownpal = 1
removeongethit = 1
ignorehitpause = 1
facing = IfElse(random%2=0,1,-1)
removetime = -2
scale = 0.5+0.1*(random%4), 0.5+0.1*(random%4)
pausemovetime = 99999
supermovetime = 99999

[State 1900, Aura helper]
type = Helper
trigger1 = animelemtime(4)=0 && !numhelper(907)
id = 907
name = "Charge"
pos = 0,-2
postype = P1
stateno = 907
helpertype = normal
keyctrl = 0
ownpal = 1
ignorehitpause = 1
pausemovetime = 99999
supermovetime = 99999

[State 1900, mouth closed]
type = explod
trigger1 = time=100
anim = 915
id = 915
sprpriority = 2
ownpal = 0
removeongethit = 1
ignorehitpause = 1
removetime = -1
pausemovetime = 99999
supermovetime = 99999

[State 3000, Activation var]
type = varset
trigger1 = animelemtime(7)=0
fvar(27) = 1

[State 3000, Destiny var]
type = varset
trigger1 = !time
fvar(28) = 0

[State 3000, SDS/SDU Counter]
type = varset
trigger1 = !time
fvar(31) = 0

[State 800, VarSet] ;this won't be checked, because I coded the changestate below (he goes to state 2810)
type = VarAdd
triggerall = !AILevel
triggerall = Anim=2800 && time>150 && fvar(28) < 300
trigger1 = (command = "holdy") && (command = "holdb")
fvar(28) = ifelse(fvar(28) + 0.8 > 300,300 - fvar(28),0.8) ;1
[State 800, VarSet] ;this won't be checked, because I coded the changestate below (he goes to state 2810)
type = VarAdd
triggerall = AILevel
trigger1 = Anim=2800 && time>150 && fvar(28) < 300
fvar(28) = ifelse(fvar(28) + 0.8 > 300,300 - fvar(28),0.8) ;1

[State 0, ChangeState] 
type = ChangeState
;triggerall = !AILevel
triggerall = Anim=2800 && time=150
trigger1 = (command = "holdy") && (command = "holdb")
value = 2810
ctrl = 0

;Stop charging Destiny
[State 901, Changestate]
type = ChangeState
triggerall = !AILevel
triggerall = Anim=2800 && time>150
trigger1 = (command != "holdy") || (command != "holdb")
trigger2 = fvar(28) >= 300 && power >= 3000
value = 2801
ctrl = 0
[State 901, Changestate]
type = ChangeState
triggerall = AILevel
triggerall = Anim=2800 && time>150
trigger1 = EnemyNear,statetype!=A && ((EnemyNear,vel x>0)||(EnemyNear,Movetype=A))
trigger2 = fvar(28) >= 300 && power >= 3000
value = 2801
ctrl = 0
;-----------------------------
; Stop charging Destiny Bar
[Statedef 2801]
type = S
physics = S
movetype = I
anim = 2801
ctrl = 0
velset = 0,0
sprpriority = 1

[state -2, remove mouth closed]
type = removeexplod
trigger1 = !time
id = 915

[State 1001, stop scream]
type = stopsnd
trigger1 = !time
channel = 0

[State 1001, PalFX max]
type = PalFX
trigger1 = fvar(28) >= 300
add = 60, 60, 60
sinadd = 60,60,60,10
time = 10

[State 1001, full power]
type = PlaySnd
trigger1 = anim = 2801 && fvar(28)>=300
value = 8,3
channel = 1
persistent = 0

[State 1001, full power voice]
type = null;PlaySnd
triggerall = var(55)=0		;Voice=Japan
trigger1 = anim = 2801 && fvar(28)>=300
value = 8,4
channel = 0
persistent = 0

[State 1001, full power voice]
type = null;PlaySnd
triggerall = var(55)=1		;Voice=English
trigger1 = anim = 2801 && fvar(28)>=300
value = 8,6
channel = 0
persistent = 0

[State 1001, full power voice]
type = PlaySnd
;triggerall = var(55)=2		;Voice=Custom Corey Holland
trigger1 = anim = 2801 && fvar(28)>=300
value = 2700,10+random%2
channel = 0
persistent = 0

[State 250, 3]
type = ChangeState
trigger1 = AnimTime = 0
value = 0
ctrl = 1

;-----------------------------
; Charging Destiny Bar
[Statedef 2810]
type = S
movetype = I
physics = S
anim = 2800
ctrl = 0
velset = 0,0
sprpriority = 1

[State 0, ChangeAnim]
type = ChangeAnim
trigger1 = prevstateno = 2800 && !Time
value = 2800
elem = 6
persistent = 0

[State 1000, shake]
type = EnvShake
trigger1 = animelemtime(4)>=0
trigger1 = !(time%12)
time=12
freq=100
ampl=ifelse(3+0.02*time > 4, 4,  3+0.02*time)

[State 4500, 1];Scream
type = null;PlaySnd
triggerall = var(55)=0		;Voice=Japan
trigger1 = animelemtime(4)=0
value = 8,2
volume = 500
channel = 0

[State 4500, 1];Scream
type = null;PlaySnd
triggerall = var(55)=1		;Voice=English
trigger1 = animelemtime(4)=0
value = 8,5
volume = 500
channel = 0

[State 200, 1];voice
type = PlaySnd
;triggerall = var(55)=2		;Voice=Custom Corey Holland
trigger1 = animelemtime(4)=0
value = 2800,5
channel = 0

[State 4500, 2];long sound
type = PlaySnd
trigger1 = animelemtime(5)=0
value = 8,0
loop = 1
pan = 1
volume = 25
channel = 3
[State 4500, 2];long sound
type = PlaySnd
trigger1 = time=130
value = 8,0
loop = 1
pan = 1
volume = 25
channel = 3

[State 4500, 1];Small sound
type = PlaySnd
trigger1 = animelemtime(4)=0
value = 8,1
volume = 255

[State 0, lightning sound]
type = PlaySnd
triggerall = animelemtime(4)>=0
trigger1 = gametime%(20) = 0
value = 2800,random%3


[State 1900, Dust helper (Power charge)]
type = Helper
trigger1 = animelemtime(4)=0
id = 909
stateno = 909
name = "Dust"
pos = -17,5
postype = P1
helpertype = normal
keyctrl = 0
ownpal = 1
ignorehitpause = 1

;[State 1900, lightning aura]
;type = explod
;trigger1 = animelemtime(4)>=0
;trigger1 = gametime%(4) = 0
;anim = 2805+(random%4)
;id = 2805
;pos = 15-5*(random%5),-55
;sprpriority = 4
;bindtime = -1
;ownpal = 1
;ignorehitpause = 1
;facing = IfElse(random%2=0,1,-1)
;removetime = -2
;scale = 0.5+0.1*(random%4), 0.5+0.1*(random%4)
;;pausemovetime = 99999
;;supermovetime = 99999

[State 1900, Lightning helper calling (Power charge)]
type		= Helper
trigger1		= animelemtime(4)>=0
trigger1		= gametime%(4) = 0
id		= 2805
stateno		= 2805
name		= "Lightning"
pos		= 38-(random%76),-105+(Random%80)
; Cond (Facing=1,0-5*(Random%5),5-5*(Random%5)),-55 very old
; Cond (Facing=1,-3*(Random%-10),3*(Random%-10)),-85+(Random%60)  if x and y scale is 1
postype		= P1
facing		= IfElse(random%2=0,1,-1)
helpertype	= normal
keyctrl		= 0
ownpal		= 1
ignorehitpause	= 1
size.xscale	= 0.5+0.1*(random%4)
size.yscale	= 0.5+0.1*(random%4)


;[State 1900, dust]
;type = explod
;trigger1 = animelemtime(4)=0
;anim = 908+(var(2)=0)
;id = 908
;pos = 17,5
;sprpriority = 4
;bindtime = -1
;ownpal = 1
;removeongethit = 1
;ignorehitpause = 1
;facing = -1
;removetime = -1
;;pausemovetime = 99999
;;supermovetime = 99999

[State 1900, Aura helper]
type = Helper
trigger1 = animelemtime(4)=0 && !numhelper(907)
id = 907
name = "Charge"
pos = 0,-2
postype = P1
stateno = 907
helpertype = normal
keyctrl = 0
ownpal = 1
ignorehitpause = 1
;pausemovetime = 99999
;supermovetime = 99999

[State 1900, mouth closed]
type = explod
trigger1 = time=100
anim = 915
id = 915
;pos = 0,0
sprpriority = 2
;bindtime = -1
ownpal = 0
removeongethit = 1
ignorehitpause = 1
removetime = -1
pausemovetime = 99999
supermovetime = 99999

[State 1000, Power]
type = PowerAdd
triggerall = (Anim = 2800) && (power < 3000)
triggerall = Time >= 12
trigger1 = !ailevel && (command = "holdb") && (command = "holdy")
trigger2 = ailevel
value = 5 + (time/20)

[State 800, VarAdd]
type = VarAdd
triggerall = !AILevel && fvar(28) < 300
trigger1 = (command = "holdy") && (command = "holdb")
fvar(28) = ifelse(fvar(28) + 0.85 > 300,300 - fvar(28),0.85) ;1
persistent = 2
[State 800, VarAdd]
type = VarAdd
trigger1 = AILevel && fvar(28) < 300
fvar(28) = ifelse(fvar(28) + 0.85 > 300,300 - fvar(28),0.85) ;1
persistent = 2

;Stop charging Destiny
[State 901, Changestate]
type = ChangeState
triggerall = !AILevel
trigger1 = (command != "holdy") || (command != "holdb")
trigger2 = fvar(28) >= 300 && Power >= 3000
trigger3 = roundstate != 2
value = 2801
ctrl = 0
[State 901, Changestate]
type = ChangeState
triggerall = AILevel
trigger1 = EnemyNear,statetype!=A && ((EnemyNear,vel x>0)||(EnemyNear,Movetype=A))
trigger2 = fvar(28) >= 300 && Power >= 3000
trigger3 = roundstate != 2
value = 2801
ctrl = 0

;===========================================================================
; <<<<< UNLEASHED GEKIRETSU RANBU >>>>>
; Counter State = 2900
;===========================================================================

; Unleashed Gekiretsu Ranbu
[Statedef 2900]
type = S
movetype = A
physics = S
facep2 = 1
ctrl = 0
anim = 2900
velset = 0,0
poweradd = -2000

[State 3000, remember Destiny mode]
type = VarSet
trigger1 = !time && fvar(27)>0
var(33) = 1
[State 3000, cancel Destiny mode]
type = VarSet
trigger1 = !time
fvar(27)=0
[State 3000, cancel Destiny mode]
type = VarSet
trigger1 = !time
var(9)=0

[State 1900, dust]
type = explod
trigger1 = animelemtime(4)=0
anim = 908+(var(2)=0)
;id = 908
pos = 17,5
sprpriority = 4
bindtime = -1
ownpal = 1
removeongethit = 1
ignorehitpause = 1
facing = -1
removetime = -2
persistent = 0
pausemovetime = 99999
supermovetime = 99999

[State 3000, SFX]
type = PlaySnd
trigger1 = anim=2900 && animelemtime(4)=0
value = 2700,0

[State 3000, Effect]
type = palfx
trigger1 = anim=2900 && animelemtime(4)>=0
time = 1
add = 30,30,50
mul = 256,256,200
sinadd = -5,-5,-5,15

[state 17100, wave power FX]
type = explod
trigger1 = anim=2900 && animelemtime(4)=0
anim = 18202
id = 18202
pos = 0,-70
postype = P1
sprpriority = 3
ownpal = 1
supermovetime = 999999
pausemovetime = 999999
removetime = -2
persistent = 0
scale = 1,1
ignorehitpause = 1

[State 3000, NotHitBy]
type = NotHitBy
trigger1 = anim = 2900
value = SCA, AA

[State 800, Kill those hoes]
type = hitdef
triggerall = anim=2900
triggerall = numenemy
triggerall = !enemy,ishelper
triggerall = p2bodydist x < 80
trigger1 = !NumExplod(801)
trigger1 = animelemno(0) = [4,15]
attr = S,HA
hitflag = MAFD
guardflag = MA
guard.dist = -1
pausetime = 4,5
priority = 7,Hit
sparkno = -1
hitsound = s850,1
fall = 0
fall.recover = 0
yaccel = .68
getpower = 0,0
givepower = 0,0
forcestand = 1
forcenofall = 1
p2facing = 1
numhits = 0
persistent = 0
;p1stateno = 2710
;p2stateno = 2715
id = 2900

[State 0, TargetState]  ;New state
type = TargetState
trigger1 = Numtarget(2900)
trigger1 = movehit = 1
value = 2715
ID = 2900
ignorehitpause = 1
persistent = 0

[State 0, ChangeState]
type = ChangeState
trigger1 = MoveHit=1
value = 2710
ignorehitpause = 1
persistent = 0

[State 200, 1];Voice
type = null;PlaySnd
triggerall = var(55)=0		;Voice=Japan
triggerall = anim=2900
trigger1 = animelemtime(5) = 0
value = 8,2
channel = 0
volume = 355

[State 200, 1];Voice
type = null;PlaySnd
triggerall = var(55)=1		;Voice=English
triggerall = anim=2900
trigger1 = animelemtime(5) = 0
value = 8,5
channel = 0
volume = 355

[State 200, 1];voice
type = PlaySnd
;triggerall = var(55)=2		;Voice=Custom Corey Holland
triggerall = anim=2900
trigger1 = animelemtime(5) = 0
value = 2800,5
channel = 0
volume = 255

[State 3050, Off]
type = changeanim
trigger1 = animtime = 0
trigger1 = anim = 2900
value = 2901

[State 0, AttackDist]
type = AttackDist
trigger1 = Anim = 2901
trigger1 = AnimElemTime(1) >= 0
value = 0

[State 3050, End]
type = changestate
trigger1 = animtime = 0
trigger1 = anim = 2901
value = 0
ctrl = 1



;===========================================================================
; <<<<< UNLEASHED GEKIRETSU RANBU - FATALITY 1 >>>>>
; Teleports in, then power gut punch : 3000
; Flurry punch : 3005
; Uppercut : 3010
; P2 state sent diagonal : 3011
; Mega Masenko up : 3015
; Gohan out of screen : 3020
; P2 center of screen : 3021
; Gohan back on screen : 3030
;===========================================================================


;FATALITY 1
[Statedef 3000] ; Gohan Teleports in, then power gut punch
type    = S
movetype = A
physics = N
anim = 3000
juggle = 0
ctrl = 0
velset = 0,0
facep2 = 1
sprpriority = 2

[state 0, nothitby]
type = nothitby
trigger1 = 1
value = SCA

[State 1010, VarAdd - for 'dmg dampening']
type = null;VarAdd
trigger1 = !Time
fvar(13) = -5
ignorehitpause = 1

[State 3020, pos]
type = PosSet
trigger1 = !time
X = enemy,pos X + 50*facing
Y = 0

[State 3020, pos]
type = Turn
trigger1 = !time

[State 182, 1]
type = screenbound
trigger1 = 1
movecamera = 0,0
value = 0

[State -2, AssertSpecial]
type = AssertSpecial
trigger1 = 1
flag = nobardisplay
ignorehitpause = 1

[State 250, teleport sound]
type = PlaySnd
trigger1 = AnimElem = 2
value = 2302, 0

[state 3000, hitadd]
type = hitadd
trigger1 = animelem = 6
value = 1

[state 3000, hit sound]
type = playsnd
trigger1 = animelem = 6
value = s2720,1

[state 2720, hit spark]
type = explod
trigger1 = animelem = 6
anim = 2719
postype = P1
pos = 45,-65
sprpriority = 7
removetime = -2

[state 3000, envshake]
type = envshake
trigger1 = animelem = 6
time = 15 ;40
freq = 100
ampl = 7 ;8

[State 1120, HitDef]
type = null;HitDef
trigger1 = animelem=6
attr = S, HA
animtype  = Hard
damage = Ceil(IfElse(fvar(11) * 2 < 2, 2, fvar(11) * 2)), 0
;Ceil(IfElse(fvar(11) * 2 < 7, 7, fvar(11) * 2)), 0
; 2,0
priority = 6,Hit
getpower = 0,0
givepower = 100,0
hitflag = MAF
pausetime = 19,25
sparkno = s7030
sparkxy = -15, -60
hitsound = S2720,1
ground.type = High
ground.slidetime = 20
ground.hittime  = 20
guard.hittime = 18
guard.slidetime = 13
guard.ctrltime = 18
ground.velocity = 0
guard.velocity = 0
air.velocity = 0,-3
fall = 1
fall.recover = 0
air.fall = 1
yaccel = .4
envshake.time = 40
envshake.freq = 100
envshake.ampl = 8
P2facing = 1
kill = 0

[State 3700]; Send Gohan to next state
type = changestate
trigger1 = !animtime
value = 3005
ctrl = 0

;------------------------------------------------
; P2 hit by flurry punch
[statedef 3001]
type = A
movetype = H
physics = N
velset = 0,0

[state 0, nothitby]
type = nothitby
trigger1 = 1
value = SCA

[state 3001, turn]
type = turn
trigger1 = !time
trigger1 = facing = enemy,facing

[state 3001, posset]
type = posset
trigger1 = !time
x = ifelse(facing = -1, enemy,pos x + 40, enemy,pos x - 40)
y = -22

[state 3001]
type = changeanim2
trigger1 = enemy,anim = 3000
trigger1 = enemy,animelem = 6
value = 5016

[state 3001]
type = changeanim2
trigger1 = enemy,anim = 3005 && enemy,animelem >= 2
value = 5017

[state 3001]
type = velset
trigger1 = anim = 5017
x = -0.1

[state 3001]
type = changestate
trigger1 = enemy,anim = 3010
trigger1 = enemy,animelem = 5
value = 3011

[state 0, failed]
type = changestate
trigger1 = time >= 100
trigger1 = enemy,anim != [3000,3005]
value = 0
ctrl = 1

;------------------------------------------------
; Gohan Flurry Punch
[Statedef 3005]
type    = S
movetype = A
physics = N
anim = 3005
juggle = 0
ctrl = 0
velset = 0,0
facep2 = 1
sprpriority = 2

[state 0, nothitby]
type = nothitby
trigger1 = 1
value = SCA

[State -2, AssertSpecial]
type = AssertSpecial
trigger1 = 1
flag = nobardisplay
ignorehitpause = 1

[state 0, changeanim]
type = changeanim
trigger1 = !time && stateno = prevstateno
value = 3005
elem = 2

[State 200, 1];voice
type = PlaySnd
triggerall = stateno != prevstateno ;so it doesn't play when anim loops
;triggerall = var(55)=2		;Voice=Custom Corey Holland
trigger1 = !time
value = 3005,0
channel = 0

[State 200, 1]
type = PlaySnd
trigger1 = animelem = 1
trigger2 = animelem = 3
trigger3 = animelem = 5
value = 0, random%3

[state 3005]
type = hitadd
trigger1 = animelemtime(2) >= 0
value = 1
persistent = 4

[state 3005, hit sound]
type = playsnd
trigger1 = animelem = 2
trigger2 = animelem = 3
trigger3 = animelem = 4
trigger4 = animelem = 5
trigger5 = animelem = 6
value = s5,random%2

[state 3000, hit spark]
type = explod
trigger1 = animelem = 2
trigger2 = animelem = 3
trigger3 = animelem = 4
trigger4 = animelem = 5
trigger5 = animelem = 6
anim = 7010+10*(random%3)
postype = P1
pos = 65,-60
sprpriority = 7

[state 3000, envshake]
type = envshake
trigger1 = animelem = 2
time = 20 ;40
freq = 100
ampl = 3 ;5

[State 200, 1]
type = null;HitDef
trigger1 = animelem = 2
attr = S, HA
damage = Ceil(IfElse(fvar(11) * 2 < 2, 2, fvar(11) * 2)), 0
;Ceil(IfElse(fvar(11) * 2 < 2, 2, fvar(11) * 2)), 0
; 2, 0
animtype = Hard	
hitflag = MAF
priority = 4, Hit
pausetime = 5,6
guard.pausetime = 6,6
sparkno = s7010+10*(random%3)
guard.sparkno = s7000
sparkxy = -17,-60
hitsound = s5, random%2
guardsound = S6,1
ground.type = Low
ground.slidetime = 10
ground.hittime  = 10
ground.velocity = 1
guard.velocity = -3
air.type = High	
air.velocity = -0.5,-1
air.hittime = 12
air.animtype = back
getpower= 0,0
givepower = 8,8
yaccel = 0.4
kill = 0

[State 200, 1]
type = null;HitDef
trigger1 = animelem = 3
attr = S, HA
damage = Ceil(IfElse(fvar(11) * 2 < 2, 2, fvar(11) * 2)), 0
;Ceil(IfElse(fvar(11) * 2 < 2, 2, fvar(11) * 2)), 0
; 2, 0
animtype = Hard	
hitflag = MAF
priority = 4, Hit
pausetime = 5,6 ;8,8
guard.pausetime = 6,6 ;8,8
sparkno = s7010+10*(random%3)
guard.sparkno = s7000
sparkxy = -17,-73
hitsound = s5, random%2
guardsound = S6,1
ground.type = High
ground.slidetime = 10
ground.hittime  = 10
ground.velocity = 1
guard.velocity = -3
air.type = High	
air.velocity = -0.5,-1
air.hittime = 12
air.animtype = back
getpower= 0,0
givepower = 8,8
yaccel = 0.4
kill = 0

[State 200, 1]
type = null;HitDef
trigger1 = animelem = 4
attr = S, HA
damage = Ceil(IfElse(fvar(11) * 2 < 2, 2, fvar(11) * 2)), 0
;Ceil(IfElse(fvar(11) * 2 < 2, 2, fvar(11) * 2)), 0
; 2, 0
animtype = Hard	
hitflag = MAF
priority = 4, Hit
pausetime = 5,6 ;8,8
guard.pausetime = 6,6 ;8,8
sparkno = s7010+10*(random%3)
guard.sparkno = s7000
sparkxy = -10,-70
hitsound = s5, random%2
guardsound = S6,1
ground.type = Low
ground.slidetime = 10
ground.hittime  = 10
ground.velocity = 1
guard.velocity = -3
air.type = High	
air.velocity = -0.5,-1
air.hittime = 12
air.animtype = back
getpower= 0,0
givepower = 8,8
yaccel = 0.4
kill = 0

[State 200, 1]
type = null;HitDef
trigger1 = animelem = 5
attr = S, HA
damage = Ceil(IfElse(fvar(11) * 2 < 2, 2, fvar(11) * 2)), 0
;Ceil(IfElse(fvar(11) * 2 < 2, 2, fvar(11) * 2)), 0
; 2, 0
animtype = Hard	
hitflag = MAF
priority = 4, Hit
pausetime = 5,6 ;8,8
guard.pausetime = 6,6 ;8,8
sparkno = s7010+10*(random%3)
guard.sparkno = s7000
sparkxy = -23,-57
hitsound = s5, random%2
guardsound = S6,1
ground.type = High
ground.slidetime = 10
ground.hittime  = 10
ground.velocity = 1
guard.velocity = -3
air.type = High	
air.velocity = -0.5,-1
air.hittime = 12
air.animtype = back
getpower= 0,0
givepower = 8,8
yaccel = 0.4
kill = 0

[State 200, 1]
type = null;HitDef
trigger1 = animelem = 6
attr = S, HA
damage = Ceil(IfElse(fvar(11) * 2 < 2, 2, fvar(11) * 2)), 0
;Ceil(IfElse(fvar(11) * 2 < 2, 2, fvar(11) * 2)), 0
; 2, 0
animtype = Hard	
hitflag = MAF
priority = 4, Hit
pausetime = 5,6 ;8,8
guard.pausetime = 6,6 ;8,8
sparkno = s7010+10*(random%3)
guard.sparkno = s7000
sparkxy = -15,-70
hitsound = s5, random%2
guardsound = S6,1
ground.type = Low
ground.slidetime = 10
ground.hittime  = 10
ground.velocity = 1
guard.velocity = -3
air.type = High	
air.velocity = -0.5,-1
air.hittime = 12
air.animtype = back
getpower= 0,0
givepower = 8,8
yaccel = 0.4
kill = 0

[State 3700]; Send Gohan to next state
type = changestate
trigger1 = !animtime
value = IfElse(stateno=prevstateno,3010,3005)
ctrl = 0

;------------------------------------------------
; Gohan Uppercut
[Statedef 3010]
type    = S
movetype = A
physics = N
anim = 3010
juggle = 0
ctrl = 0
velset = 0,0
facep2 = 1
sprpriority = 2

[State -2, AssertSpecial]
type = AssertSpecial
trigger1 = 1
flag = nobardisplay
ignorehitpause = 1

[State 200, 1]
type = PlaySnd
trigger1 = animelem = 3
value = 0, 2
channel = 1

[state 0]
type = hitadd
trigger1 = animelem = 4
value = 1

[state 0, envshake]
type = envshake
trigger1 = animelem = 4
time = 16
freq = 60
ampl = 4

[State 200, 1]
type = null;HitDef
trigger1 = animelem = 4
attr = S, HA
damage = Ceil(IfElse(fvar(11) * 5 < 5, 5, fvar(11) * 5)), 0
;Ceil(IfElse(fvar(11) * 5 < 5, 5, fvar(11) * 5)), 0
; 5, 0
animtype = Hard	
hitflag = MAF
priority = 4, Hit
pausetime = 5,6
sparkno = s7030
sparkxy = -20,-90
hitsound = s5, 2
ground.type = Low
ground.slidetime = 20
ground.hittime  = 20
ground.velocity = 1
air.type = High	
air.velocity = -2.5,-8
air.hittime = 12
air.animtype = back
getpower= 0,0
givepower = 50,50
yaccel = 0.4
kill = 0
;p2stateno = 3011
envshake.time = 16
envshake.freq = 60
envshake.ampl = 4
id = 3011

[State 1315, Sparks]
type=explod
trigger1 = animelem = 4
anim = 2512
sprpriority=7
postype = p1
pos = 50,-115
removetime=-2
ownpal=1
facing=-1
ignorehitpause=1
persistent=0
pausemovetime=100
supermovetime=100

[State 13100, explosion SND]
type = PlaySnd
trigger1 = animelem = 4
value = 2511,0
volume = 355
ignorehitpause = 1
persistent = 0

[State 3700]; Send Gohan to next state
type = changestate
trigger1 = !animtime
value = 3015
ctrl = 0

;------------------------------------------------
;P2 State - Sent in the air by uppercut
[Statedef 3011]
type = S
physics = N
movetype = H
ctrl = 0
velset = -7, -15

[State 3020, 2]
type = changeanim2
trigger1 = !time && anim !=3011
value = 3011

[State 3020, to fix Silvy by Hanma ...]
type = VelSet
trigger1 = pos Y < -1000
Y = 0

[State 181, 1]
type = NotHitBy
trigger1 = 1
value = SCA
;time = 20

[State 1050, 1]
type = sprpriority
trigger1 = 1
value = 1

[State 182, 1]
type = screenbound
trigger1 = 1
movecamera = 0,0
value = 1

[State 3000, state] ;go back to center of screen
type = ChangeState
trigger1 = P2StateNo = 3020   ;when Gohan out of screen
value = 3021
ctrl = 0

;------------------------------------------------
; Gohan Masenko Up
[Statedef 3015]
type    = S
movetype = A
physics = N
anim = 3015
juggle = 0
ctrl = 0
velset = 0,0
facep2 = 1
sprpriority = 2

[state 0]
type = nothitby
trigger1 = 1
value = SCA

[State -2, AssertSpecial]
type = AssertSpecial
trigger1 = 1
flag = nobardisplay
ignorehitpause = 1

[State 200, 1];voice Masenko
type = PlaySnd
;triggerall = var(55)=2		;Voice=Custom Corey Holland
trigger1 = !time
value = 3015,1
channel = 0

[State 200, Masenko charge long]
type = PlaySnd
trigger1 = animelem = 4
channel = 7
value = 2000,1

[State 200, Charge snd]
type = PlaySnd
trigger1 = animelemtime(4)=0
value = 2000,10

[State 0, Charge Ball FX]
type = Explod
trigger1 = animelemtime(4)=0
anim = 2015
pos = -7,-109
postype = p1
supermovetime = 9999
pausemovetime = 9999
supermove = 1
removetime = 18+36+18
sprpriority = 5
ownpal = 1
bindtime = -1
scale = 1,1
persistent = 0

[State 0, Ki Gather FX]
type = Explod
trigger1 = animelemtime(4)=0
anim = 2016
pos = -7,-109
postype = p1
supermovetime = 9999
pausemovetime = 9999
supermove = 1
removetime = -2
sprpriority = 6
ownpal = 1
bindtime = -1
scale = 1,1
persistent = 0

[State 0, Charge lightning FX]
type = Explod
trigger1 = animelemtime(4)=0
anim = 2006
pos = -10,0
postype = p1
supermovetime = 9999
pausemovetime = 9999
supermove = 1
removetime = 18+36+18
sprpriority = 5
ownpal = 1
bindtime = -1
scale = 1,1

[state 1215, Smoke FX]
type = explod
trigger1 = animelemtime(28)=0
anim = 1206+(var(2)=0)
id = 1206
pos = -25,3
postype = P1
sprpriority = 3
ownpal = 1
removetime = -2
persistent = 0
ignorehitpause = 1

[state 1215, Masenko]
type = explod
trigger1 = animelemtime(28)=0
anim = 3016
id = 3016
pos = 19,-105
postype = P1
sprpriority = 3
ownpal = 1
removetime = -1
persistent = 0

[State 200, 1];voice Masenko
type = PlaySnd
;triggerall = var(55)=2		;Voice=Custom Corey Holland
trigger1 = animelemtime(28)=0
value = 2401,7
channel = 0

[State 200, 1];Launching SFX
type = PlaySnd
trigger1 = animelemtime(30)=0
value = 3015,2 ;0
persistent = 0

[State 3700]; Send Gohan to next state
type = changestate
trigger1 = time=160
value = 3020
ctrl = 0

;-------------------------
; Gohan out of screen
[Statedef 3020]
type    = S
movetype = A
physics = N
anim = 15999
juggle = 0
ctrl = 0
velset = 0,0
facep2 = 1
sprpriority = 2

[state 0]
type = nothitby
trigger1 = 1
value = SCA

[State 2201, remove masenko]
type = RemoveExplod
trigger1 = !time
ID = 3016

[State 2201, helper]; Background lines
type = Helper
trigger1 = !time
;pos = -320, 350
pos = -170, 200
postype = back
stateno = 3022
helpertype = normal
name = "diagonal_lines_BG"
ownpal = 1
supermovetime = 150
pausemovetime = 150

[State 2201, helper]; Background lines
type = Helper
trigger1 = !time
;pos = 0, 300
pos = 150, 150
postype = back
stateno = 3022
helpertype = normal
name = "diagonal_lines_BG"
ownpal = 1
supermovetime = 150
pausemovetime = 150

[State 2260, bg]
type = assertspecial
trigger1 = 1
flag = noFG
flag2 = noBG
flag3 = nobardisplay
ignorehitpause = 1

[State 2260, bg]
type = assertspecial
trigger1 = 1
flag = globalnoshadow
flag2 = noshadow
ignorehitpause = 1

[State 3001, screen]
type = Screenbound
trigger1 = 1
movecamera = 0,0
value = 0

[state 2772, out of screen]
type = posset
trigger1 = !time
y = 400

[State 2201, Mega Masenko travelling helper]
type = Helper
trigger1 = !time
postype = back
stateno = 3025
ID = 3025
helpertype = normal
name = "Mega_Masenko_Travel"
ownpal = 1
supermovetime = 150
pausemovetime = 150

[state 3020, damage]
type = targetlifeadd
trigger1 = time = 80
value = -ceil(ifelse(fvar(11)*280 < 190, 190, fvar(11)*280))

[State 1315, White BG Fades]
type = explod
trigger1= numhelper(3025)
trigger1 = time = 90
anim = 3020
ID = 3020
pos =  160,120
postype = left
sprpriority = 7
ontop = 1
facing = 1
bindtime = -1
ownpal = 1
removetime = -2
pausemovetime = 99999999999999
supermovetime = 99999999999999
supermove = 1
scale = 1.20,1.20
ignorehitpause = 1
persistent = 0

[State 200, 1];Dramatic SFX
type = PlaySnd
trigger1 = WinKO && p2stateno=5944
value = 5941,0
persistent = 0

[State 3700]; Send Gohan back to screen
type = changestate
trigger1 = time=165
value = 3030
ctrl = 0

;------------------------------------
;P2 center of screen
[Statedef 3021]
type = A
movetype = H
physics = N
velset = 0,0
ctrl = 0
sprpriority = 2

[state 0]
type = nothitby
trigger1 = 1
value = SCA

[State 2260, bg]
type = assertspecial
trigger1 = 1
flag = globalnoshadow
ignorehitpause = 1

[State 3001, screen]
type = Screenbound
trigger1 = 1
movecamera = 0,0
value = 1

[State 3001, anim2]
type = Changeanim2
trigger1 = time = 0
value = 2761

[state 3021, hit anim]
type = changeanim2
triggerall = enemy, numhelper(3025)
trigger1 = time = 30
value = 7696

[State 3001, PosSet]
type = PosSet
trigger1 = 1
x = -30*facing
y = -30

[State 3001, shake]
type = EnvShake
trigger1 = time = 0
time = 140
freq = 100
ampl = 3

[state 3021, killed]
type = changestate
trigger1 = time >= 80
trigger1 = MatchOver
value = 5944

[state 3021, end]
type = changestate
triggerall = time = 165
trigger1 = !matchover
trigger2 = numenemy > 2
value = 30210

;------------------------------------
;P2 falling from masenko finisher
[statedef 30210]
type = A
movetype = H
physics = N
velset = 0,0
ctrl = 0

[state 0, nothitby]
type = nothitby
trigger1 = 1
value = SCA

[state 3022, pos]
type = posset
trigger1 = !time
x = enemy,facing*(enemy,pos x + 100)
y = -100

[state 3022, falling anim]
type = changeanim2
trigger1 = !time
value = 5061
elem = 3

[state 3022, falling]
type = statetypeset
trigger1 = !time
physics = A

[state 3022, hit ground]
type = changestate
trigger1 = (pos y + vel y) >= 0
value = 5100
ctrl = 0

;------------------------------------
;Gohan back on screen
[Statedef 3030]
type    = S
movetype = A
physics = S
anim = 0
juggle = 0
ctrl = 0
velset = 0,0
facep2 = 1
sprpriority = 2

[state 0]
type = nothitby
trigger1 = 1
value = SCA

[state 2772, out of screen]
type = posset
trigger1 = !time
y = 0

[State 0, CtrlSet]
type = CtrlSet
trigger1 = Time = 60
value = 1

[State 3700]; Send Gohan back to stance
type = changestate
trigger1 = !animtime
value = 0
ctrl = 1




;===========================================================================
; <<<<< UNLEASHED GEKIRETSU RANBU - FATALITY 2 >>>>>
; State = 3100
; P2 hit by green explosion : 3105
; P2 hitting ground : 3106-3111
; Gohan going back to ground : 3115
; P2 fatality state : 3120
; Debris Helper : 3125-3127
;===========================================================================

; FATALITY 2
[Statedef 3100]
type    = A
movetype = A
physics = N
anim = 3100
juggle = 0
ctrl = 0
velset = 0,0
facep2 = 1
sprpriority = 2

[State 1010, VarAdd - for 'dmg dampening']
type = VarAdd
trigger1 = !Time
fvar(13) = -3
ignorehitpause = 1

[state 0]
type = nothitby
trigger1 = 1
value = SCA

[State 2260, bg]
type = assertspecial
trigger1 = 1
flag = noFG
flag2 = noBG
flag3 = nobardisplay
ignorehitpause = 1

[State 2260, bg]
type = assertspecial
trigger1 = 1
flag = globalnoshadow
flag2 = noshadow
ignorehitpause = 1

[State 220, snd]
type = null;PlaySnd
triggerall = var(55)=0		;Voice=Japan
trigger1 = animelem=10
value = 260,1
channel = 0

[State 220, snd]
type = null;PlaySnd
triggerall = var(55)=1		;Voice=English
trigger1 = animelem=10
value = 1100,100+(random%5)
channel = 0

[State 200, 1];voice
type = PlaySnd
;triggerall = var(55)=2		;Voice=Custom Corey Holland
trigger1 = animelem=5
value = 3100,2
channel = 0

[State 250, turning sound]
type = PlaySnd
trigger1 = AnimElem = 2
value = 3100,0

[State 250, 1]
type = PlaySnd
trigger1 = AnimElem = 11
value = 0, 2

[state 3100, hit sound]
type = playsnd
trigger1 = animelem = 14
value = s2720,2

[state 0, hitadd]
type = hitadd
trigger1 = animelem = 14
value = 1

[state 0, envshake]
type = envshake
trigger1 = animelem = 14
time = 40
freq = 100
ampl = 8

[state 3100, damage]
type = targetlifeadd
trigger1 = animelem = 14
value = -Ceil(IfElse(fvar(11) * 230 < 145, 145, fvar(11) * 230))

[State 1120, HitDef]
type = null;HitDef
trigger1 = animelem = 14
attr = S, HA
animtype  = Hard
damage = Ceil(IfElse(fvar(11) * 230 < 145, 145, fvar(11) * 230)), 0;Ceil(IfElse(fvar(11) * 290 < 145, 145, fvar(11) * 290)), 0
;Ceil(IfElse(fvar(11) * 205 < 7, 7, fvar(11) * 205)), 0
; 205,0
priority = 6,Hit
getpower = 0,0
givepower = 100,0
hitflag = MAF
pausetime = 29,70
sparkno = -1
guard.sparkno = S8410
sparkxy = -15, -60
hitsound = S2720,2
ground.type = High
ground.slidetime = 13
ground.hittime  = 20
guard.hittime = 18
guard.slidetime = 13
guard.ctrltime = 18
ground.velocity = -5
guard.velocity = 0
air.velocity = -2.0*const(size.xscale),0
fall = 0
fall.recover = 0
down.bounce = 1
air.fall = 0
yaccel = .80*const(size.yscale)
persistent = 0
envshake.time = 40
envshake.freq = 100
envshake.ampl = 8
P2facing = 1
ground.cornerpush.veloff = 0
guard.cornerpush.veloff = 0
;p2stateno = 3105
id = 3105

[State 250, explosion sound]
type = PlaySnd
trigger1 = AnimElem = 14
value = 3100,1

[State 1315, Big Explosion]
type = explod
trigger1 = animelem = 14
anim = 3101
sprpriority=5
postype = p1
pos = 80,-80
removetime=-2
facing = -1
ownpal=1
ignorehitpause=1
persistent = 1
pausemovetime=100
supermovetime=100

[State 1315, Thundershock]
type = explod
trigger1 = animelem = 14
anim = 3102
sprpriority=6
postype = p1
pos = 80,-80
removetime=-2
ownpal=1
ignorehitpause=1
persistent = 1
pausemovetime=100
supermovetime=100

[State 1315, Explosion]
type = explod
trigger1 = animelem = 14
anim = 2512
sprpriority=7
postype = p1
pos = 90,-90
removetime=-2
ownpal=1
ignorehitpause=1
persistent = 1
pausemovetime=100
supermovetime=100

[State 3000, debris]
type = helper
trigger1 = enemy,stateno=3120 && !numhelper(3125)
helpertype = normal
stateno = 3125
ID = 3125
name = "debris"
postype = p2
pos = 0,0
ownpal = 1

[State 3700]; Send Gohan to next state
type = changestate
trigger1 = !animtime
value = 3115

;------------------------------------------------
;P2 State - Hit by green explosion
[Statedef 3105]
type = A
physics = N
movetype = H
ctrl = 0
velset = 0, 0

[State 3025, state - killed fatality]
type = changestate
trigger1 = time>7 && MatchOver
value = 3120
ignorehitpause = 1

[State 2260, bg]
type = assertspecial
trigger1 = 1
flag = noFG
flag2 = noBG
flag3 = nobardisplay
ignorehitpause = 1

[State 3020, 2]
type = changeanim2
trigger1 = !time && anim !=3105
value = 3105

[State 3020, 2]
type = velset
trigger1 = time=10
X = -13
Y = 0

[State 181, 1]
type = NotHitBy
trigger1 = 1
value = SCA
time = 200

[State 1050, 1]
type = sprpriority
trigger1 = 1
value = 1

[State 182, 1]
type = screenbound
trigger1 = 1
movecamera = 0,0
value = 0

[State 3020, 2]
type = velset
trigger1 = pos Y > 300
X = 0
Y = 0

[State 3000, state] ;go to ground
type = ChangeState
trigger1 = P2StateNo = 3115   ;2791
value = 3106
ctrl = 0

;------------------------------------------------
; P2 goes back to ground
[StateDef 3106] 
type = S
movetype = H
physics = N
ctrl = 0
sprpriority = -1
velset = -10, 8

[State 182, 1]
type = screenbound
trigger1 = 1
movecamera = 0,0
value = 0

[State 182, 1]
type = PosSet
trigger1 = !time
X = 300*IfElse(facing=1,1,-1)
Y = -200

[State 182, 1]
type = ChangeAnim2
trigger1 = !time && anim!=3106
value = 3106

[State 13100, shake]
type = envshake
trigger1 = Pos Y >= 10
trigger1 = Vel Y > 0
time = 15
freq = 90
ampl = 6

[State 1200]
type = ChangeState
trigger1 = Pos Y >= 10
trigger1 = Vel Y > 0
value = 3107

;---------------------------------------------------------------------------
;P2 bouncing on the ground
[Statedef 3107]
type    = L
movetype= H
physics = N

[State 3000, nhb]
type = NotHitBy
trigger1 = 1
time = 1
value = SCA

[State 5100, 1]
type = VelSet
trigger1 = Time = 0
trigger1 = GetHitVar(fall.yvel) = 0
trigger1 = vel x > 1
x = 1

[State 5100, EnvShake]
type = FallEnvShake
trigger1 = Time = 0

[State 5100, Var] ;Save fall velocity
type = VarSet
trigger1 = Time = 0
sysvar(1) = floor(vel y)

[State 5100, 2] ;Hit ground anim (normal)
type = ChangeAnim
triggerall = time = 0
trigger1 = (anim != [5051,5059]) && (anim != [5061,5069])
trigger2 = !SelfAnimExist(5100 + (anim % 10))
value = 5100

[State 5100, 3] ;Hit ground anim (for hit up)
type = ChangeAnim
trigger1 = time = 0
trigger1 = (anim = [5051,5059]) || (anim = [5061,5069])
trigger1 = SelfAnimExist(5100 + (anim % 10))
value = 5100 + (anim % 10)

[State 5100, 4]
type = PosSet
trigger1 = Time = 0
y = 0

[State 5100, 5]
type = VelSet
trigger1 = Time = 0
y = 0

[State 5100, 6] ;Reduce speed
type = VelMul
trigger1 = Time = 0
x = 0.6

;[State 5100, 10]  ;remember kids: never put sound effects in a custom state!!!!!
;type = PlaySnd
;trigger1 = Time = 1
;value = F7,2

[State 5100, 5]
type = VelSet
trigger1 = AnimTime = 0
y = -5

[State 111, 1]
type = StateTypeSet
trigger1 = AnimTime = 0
physics = A

[State 5100, 12]
type = ChangeState
trigger1 = AnimTime = 0
value = 3108    ;=5050 modified
;---------------------------
; HITA_FALL (knocked up, falling)
[Statedef 3108]
type    = A
movetype= H
physics = N
ctrl = 0

[State 3000, nhb]
type = NotHitBy
trigger1 = 1
time = 1
value = SCA

[State 5050, 1] ;Change anim when done with transition
type = ChangeAnim
trigger1 = AnimTime = 0
trigger1 = Anim = 5035
trigger2 = Time = 0     ;If no transition anim
trigger2 = Anim != 5035
trigger2 = (Anim != [5051, 5059]) && (Anim != [5061, 5069])
trigger2 = Anim != 5090 ;Not if hit off ground anim
value = 5050

[State 5050, 2] ;Coming down anim
type = ChangeAnim
trigger1 = anim = [5050,5059]
trigger1 = Vel Y >= IfElse(anim = 5050, 1, -2)
trigger1 = SelfAnimExist(anim+10)
value = anim+10
persistent = 0

[State 5050, 3] ;Gravity
type = VelAdd
trigger1 = 1
y = GetHitVar(yaccel)

[State 5050, 6]
type = ChangeState
trigger1 = Vel Y > 0
trigger1 = Pos Y >= IfElse((anim = [5051,5059]) || (anim = [5061,5069]), 0, 25)
value = 3109   ;=5100 modified

;---------------------------------------------------------------------------
; HIT_BOUNCE (hit ground)
[Statedef 3109]
type    = L
movetype= H
physics = N
ctrl = 0

[State 3000, nhb]
type = NotHitBy
trigger1 = 1
time = 1
value = SCA

[State 5100, 1]
type = VelSet
trigger1 = Time = 0
trigger1 = GetHitVar(fall.yvel) = 0
trigger1 = vel x > 1
x = 1

[State 5100, EnvShake]
type = FallEnvShake
trigger1 = Time = 0

[State 5100, Var] ;Save fall velocity
type = VarSet
trigger1 = Time = 0
sysvar(1) = floor(vel y)

[State 5100, 2] ;Hit ground anim (normal)
type = ChangeAnim
triggerall = time = 0
trigger1 = (anim != [5051,5059]) && (anim != [5061,5069])
trigger2 = !SelfAnimExist(5100 + (anim % 10))
value = 5100

[State 5100, 3] ;Hit ground anim (for hit up)
type = ChangeAnim
trigger1 = time = 0
trigger1 = (anim = [5051,5059]) || (anim = [5061,5069])
trigger1 = SelfAnimExist(5100 + (anim % 10))
value = 5100 + (anim % 10)

[State 5100, 4]
type = PosSet
trigger1 = Time = 0
y = 0

[State 5100, 5]
type = VelSet
trigger1 = Time = 0
y = 0

[State 5100, 6] ;Reduce speed
type = VelMul
trigger1 = Time = 0
x = 0.75

[State 5100, 11]
type = PosFreeze
trigger1 = 1

[State 5100, 12]
type = ChangeState
trigger1 = AnimTime = 0
value = 3110    ;=5101 modified

;---------------------------------------------------------------------------
; HIT_BOUNCE (bounce into air)
[Statedef 3110]
type    = L
movetype= H
physics = N

[State 3000, nhb]
type = NotHitBy
trigger1 = 1
time = 1
value = SCA

[State 5101, 1] ;Coming hit ground anim (normal)
type = ChangeAnim
triggerall = time = 0
trigger1 = anim != [5101,5109]
trigger2 = !SelfAnimExist(5160 + (anim % 10))
value = 5160

[State 5101, 2] ;Coming hit ground anim (for hit up)
type = ChangeAnim
triggerall = time = 0
trigger1 = anim = [5101,5109]
trigger1 = SelfAnimExist(5160 + (anim % 10))
value = 5160 + (anim % 10)

[State 5101, 3]
type = HitFallVel
trigger1 = Time = 0

[State 5101, 4]
type = PosSet
trigger1 = Time = 0
y = 20

[State 5101, 5] ;Acceleration
type = VelAdd
trigger1 = 1
y = .4

[State 5101, 6] ;Hit ground
trigger1 = Vel Y > 0
trigger1 = Pos Y >= 12
type = ChangeState
value = 3111   ;=5110 modified

;---------------------------------------------------------------------------
; HIT_LIEDOWN
[Statedef 3111]
type    = L
movetype= H
physics = N

[State 3000, nhb]
type = NotHitBy
trigger1 = 1
time = 1
value = SCA

[State 5110, EnvShake]
type = FallEnvShake
trigger1 = Time = 0

[State 5110, 2] ;Hit ground anim (normal)
type = ChangeAnim
triggerall = time = 0
triggerall = anim != [5110,5119] ;Not already changed anim
trigger1 = anim != [5161,5169]
trigger2 = !SelfAnimExist(5170 + (anim % 10))
value = 5170

[State 5110, 4]
type = HitFallDamage
trigger1 = Time = 0

[State 5110, 5]
type = PosSet
trigger1 = Time = 0
y = 0

[State 5110, Var] ;Get fall velocity
type = VarSet
trigger1 = Time = 0
trigger1 = GetHitVar(fall.yvel) != 0
sysvar(1) = floor(vel y)

[State 5110, 6]
type = PlaySnd
trigger1 = Time = 0
trigger1 = !SysVar(0)
;value = F7, (sysvar(1) > 5) + (sysvar(1) > 14)
value = F7,2

[State 5110, 8]
type = VelSet
trigger1 = Time = 0
y = 0

[State 5110, 9] ;For hit up type
type = ChangeAnim
persistent = 0
triggerall = anim = [5171,5179]
triggerall = SelfAnimExist(5110 + (anim % 10))
trigger1 = AnimTime = 0
trigger2 = SysVar(0) ;SysVar(0) = 1 avoids hit ground anim
value = 5110 + (anim % 10)

[State 5110, 10] ;For normal
type = ChangeAnim
persistent = 0
triggerall = Anim != [5111,5119]
trigger1 = AnimTime = 0
trigger2 = SysVar(0) ;SysVar(0) = 1 avoids hit ground frame
value = 5110

[State 5110, 11] ;If just died
type = SelfState
triggerall = !alive
trigger1 = AnimTime = 0
trigger2 = SysVar(0) ;SysVar(0) = 1 avoids hit ground frame
trigger3 = Anim = [5110,5119]
value = 5150

[State 5110, 11] ;Alive
type = SelfState
triggerall = alive
trigger1 = time = 40
value = 5120

[State 5110, 12]
type = VarSet
trigger1 = SysVar(0)
trigger1 = Time = 0
sysvar(0) = 0

[State 5110, 13] ;Friction
type = VelMul
trigger1 = 1
x = 0.85

;-------------------------
; Gohan Fall back to ground
[Statedef 3115]
type    = A
movetype = I
physics = N
anim = 2790
juggle = 0
ctrl = 0
velset = 0,0
facep2 = 1
sprpriority = 2

[State -2, Var]
type = Varset
trigger1 = !time
fvar(28) = 0

[State 3020, pos]
type = PosSet
trigger1 = !time
X = -60*IfElse(facing=1,1,-1)
Y = -300

[State 182, 1]
type = screenbound
trigger1 = 1
movecamera = 0,0
value = 0

[State -2, Vel]
type = VelAdd
trigger1 = time>30
Y = 0.4

[State -2, AssertSpecial]
type = AssertSpecial
trigger1 = 1
flag = nobardisplay
ignorehitpause = 1

[State 3700]; Send Gohan to next state
type = changestate
trigger1 = pos Y >= -5
value = 2795
ctrl = 0


;---------------------------------------------------------------------------------------
;Prevent Freezing from Fatality 2
[Statedef 3120]
type = S
movetype= H
physics = N
velset = 0,0

[State 182, 1]
type = screenbound
trigger1 = 1
movecamera = 0,0
value = 1

[State 49999, 1]
type = LifeSet
trigger1 = 1
value = 0

[State 49999, 1]
type = PosSet
trigger1 = time > 50
y = 9000

[State 49999, 5]
type = ChangeAnim2
trigger1 = !time
value = 15999

[State 444, 0]
type = Changestate
trigger1 = time >=60
value = 5150




;===========================================================================
; <<<<< UNLEASHED GEKIRETSU RANBU - FATALITY 3 >>>>>
; Teleports in : 						3200
; f.SK :							3201
; P2 State - sent away : 					3202
; Gohan Chou Kmh charge : 					3205
; Goten [HELPER] : 						3210
; Goten lands [HELPER] : 					3211
; Goten charges [HELPER] : 					3212
; Goten launches [HELPER] : 					3213
; Goten Moving out at end of finisher 3 [HELPER] :		3214
; Throwing Team Chou Kamehameha : 				3220
; Chou Kamehameha [HELPER] : 					3221 (tip) & 3222 (beam)
; Horizontal Background lines : 				3224
; Moving out of screen while throwing Chou Kmh : 		3225
; Goten Moving out of screen while throwing Chou Kmh [HELPER] :	3226
; Gohan Kamehameha FX beam simple [HELPER] : 			3227
; Goten Kamehameha FX beam simple [HELPER] : 			3228
; Twirl FX [HELPER] :						3229
; Beam + Twirl FX [HELPER] :					3231
; P2 state - comes back to screen :				3235
; Gohan waiting out of screen :					3240
; Going back to screen - HD winpose :				3241
; P2 state - sent high in sky if not killed :			3245
; P2 states from modified 5000 states :				3246-3250
; Circus Act Winpose (in system.cns) :				3260
;===========================================================================

; FATALITY 3
; Gohan Teleports in
[Statedef 3200]
type    = S
movetype = A
physics = N
anim = 3200
juggle = 0
ctrl = 0
velset = 0,0
facep2 = 1
sprpriority = 2

[state 0] ;exit emo mode
type = varset
trigger1 = !time
fvar(27) = 0
ignorehitpause = 1

[State 1010, VarAdd - for 'dmg dampening']
type = VarAdd
trigger1 = !Time
fvar(13) = -4
ignorehitpause = 1

[State 3020, pos]
type = PosSet
trigger1 = !time
X = enemy,pos X + 50*facing
Y = 0

[State 3020, pos]
type = Turn
trigger1 = !time

[State 182, 1]
type = screenbound
trigger1 = 1
movecamera = 0,0
value = 0

[State -2, AssertSpecial]
type = AssertSpecial
trigger1 = 1
flag = nobardisplay
ignorehitpause = 1

[State 250, teleport sound]
type = PlaySnd
trigger1 = AnimElem = 2
value = 2302, 0

[State 3700]; Send Gohan to next state
type = changestate
trigger1 = !animtime
value = 3201
ctrl = 0

;-------------------------
; Gohan - f.SK
[Statedef 3201]
type    = A
movetype = A
physics = N
anim = 3201
juggle = 0
ctrl = 0
velset = 0,0
facep2 = 1
sprpriority = 2

[State 0, VarSet]
type = VarSet
trigger1 = 1
var(9) = 0

[State -2, AssertSpecial]
type = AssertSpecial
trigger1 = 1
flag = nobardisplay
ignorehitpause = 1

[State 280, go]
type = VelSet
trigger1 = animelem = 1
y = -6

[State 220, snd]
type = null;PlaySnd
triggerall = var(55)=0		;Voice=Japan
trigger1 = animelem=1
value = 260,1
channel = 0

[State 200, 1];voice
type = null;PlaySnd
triggerall = var(55)=1		;Voice=English
trigger1 = animelem=1
value = 3,104+random%4
channel = 0

[State 200, 1];voice
type = PlaySnd
;triggerall = var(55)=2		;Voice=Custom Corey Holland
trigger1 = animelem=1
value = 3,220+random%9
channel = 0

[State 280, go]
type = VelAdd
trigger1 = animelemtime(1) > 0 && animelemtime(8) < 0
Y = 0.5
ignorehitpause = 1

[State 220, land]
type = statetypeset
trigger1 = animelem=8 
statetype = S

[State 280, go]
type = VelSet
trigger1 = animelem = 8
x = 0
y = 0

[State 1, land]
type = PosSet
trigger1 = animelem=8
y = 0

[State 1, go]
type = PosAdd
trigger1 = animelem=9
x = 20

[State 250, wheel kick SFX]
type = PlaySnd
trigger1 = AnimElem = 2
value = 270,0

[State 250, 1]
type = PlaySnd
trigger1 = AnimElem = 8
value = 0, 5

[State 250, 2]
type = HitDef
trigger1 = AnimElem = 9
attr = S, HA
animtype  = diagup
damage = Ceil(IfElse(fvar(11) * 44 < 22, 22, fvar(11) * 44)), 0
;Ceil(IfElse(fvar(11) * 44 < 7, 7, fvar(11) * 44)), 0
; 44,0
;priority = 4, Hit
guardflag = MAF
pausetime = 21,22
guard.pausetime = 22,22
sparkno = s7030
guard.sparkno = s7000
sparkxy = -30,-80
hitsound   = S2604,0
guardsound = S6,1
ground.type = low
ground.slidetime = 30
ground.hittime = 30
ground.velocity = ifelse(facing != enemy,facing,-6,6),-6
air.velocity = ifelse(facing != enemy,facing,-4,4),-4
air.animtype = diagup
getpower= 0,0
givepower = 35,35
yaccel = 0.5
p2facing = 1
fall = 1
fall.recovertime = 45
envshake.time = 40
envshake.freq = 200
envshake.ampl = 10 
kill = 0
;p2stateno = 3202
id = 3202

[State 0, TargetState]  ;New state
type = TargetState
trigger1 = Numtarget(3202)
trigger1 = movehit = 1
value = 3202
ID = 3202
ignorehitpause = 1
persistent = 0

[State 1, go]
type = PosAdd
trigger1 = animelem=15
x = -20

[State 250, 3]
type = ChangeState
triggerall = enemynear, StateNo = 3202
trigger1   = AnimTime = 0
value      = 3205
ctrl       = 0

[State 250, 3]
type = ChangeState
triggerall = enemynear, StateNo != 3202
trigger1   = AnimTime = 0
value      = 0
ctrl       = 1

;------------------------------------------------
; P2 sent away
[StateDef 3202]
type = A
movetype = H
physics = N
velset = ifelse(facing = enemy,facing,10,-10),-0.5
ctrl = 0
sprpriority = -1
facep2 = 1

;[State -3, GetHit Snd]
;type=PlaySnd
;trigger1 = !time
;value = 5000,1+(random%5)
;ignorehitpause = 1

[State 0, NotHitBy]
type = NotHitBy
trigger1 = 1
value = SCA,NA,SA,HA,NP,SP,HP,NT,ST,HT
;value2 = S,NA
time = 1
;ignorehitpause = 
;persistent = 


[State 13200, Anim]
type = ChangeAnim
trigger1 = Time = 0
value = IfElse(selfanimexist(5052),5052,5030)

[State 182, 1]
type = screenbound
trigger1 = 1
movecamera = 0,0
value = 0

[State 3000, state] ;invisible
type = ChangeAnim2
trigger1 = time = 20
value = 15999

[State 3000, state] ;go back to screen (finally !)
type = ChangeState
trigger1 = Time >20
trigger1 = enemy,numhelper(3231)
value = 3235

;-----------------------------------------------------
; Gohan Chou Kmh charge
[Statedef 3205]
type = S
physics = S
movetype = A
anim = 2400
ctrl = 0
velset = 0,0
sprpriority = 1

[State 0, VarSet]
type = VarSet
trigger1 = 1
var(9) = 0

[State -2, AssertSpecial]
type = AssertSpecial
trigger1 = 1
flag = nobardisplay
ignorehitpause = 1

[State 0, AssertSpecial]
type = AssertSpecial
triggerall = anim = 2400
trigger1 = 1
flag = noFG

[State 3000, nhb]
type = NotHitBy
trigger1 = 1
time = 1
value = SCA

[State 1000, shake]
type = EnvShake
triggerall = anim=2400
trigger1 = !(time%4)
time=4
freq=80
ampl=2+0.02*time

[State 200, Kmh charge long]
type = PlaySnd
triggerall = anim = 2400
trigger1 = time = 60
value = 2400,1

[State 200, 1];charge power-up sound
type = PlaySnd
trigger1 = time = 5
value = 2400,20
channel = 5

[State 200, electricity]
type = PlaySnd
trigger1 = time > 60
trigger1 = (GameTime%40) = 20
value = 2400,2
volume = 10

[State 2500, bgpalfx1]
type = bgpalfx
triggerall = anim = 2400
trigger1 = 1  ;time = [1,200]
time = 1
color=0
mul=0,0,0

[State 200, SuperPause sound]
type = PlaySnd
trigger1 = time=5
value = 2350,0

[State 3000, SuperPause]
type = SuperPause
triggerall = anim = 2400
trigger1 = time=5
time = 192
p2defmul = 1
unhittable = 1
anim = -1
darken = 0
movetime = 192

[State 0, Charge Ball FX]
type = Explod
triggerall = anim = 2400
trigger1 = time = 5
anim = 2420+10000*(var(2)=0)
id = 2420
pos = -25,-60
postype = p1
supermovetime = 9999
pausemovetime = 9999
supermove = 1
removetime = -1
sprpriority = 5
ownpal = 1
bindtime = -1
scale = 0.6,0.6
persistent = 0

[state 17100, scale charge FX]
type = ModifyExplod
trigger1 = numexplod(2420)
scale = 0.6+0.002*(time-20),0.6+0.002*(time-20)
id = 2420

[State 0, Charge lightning FX]
type = Explod
triggerall = anim = 2400
trigger1 = time = 5
anim = 2430
id = 2430
pos = -25,-57
postype = p1
supermovetime = 9999
pausemovetime = 9999
supermove = 1
removetime = -1
sprpriority = 5
ownpal = 1
bindtime = -1
scale = 1,1
persistent = 0

[State 0,from sky lightning]
type = explod
triggerall = anim = 2400 && time>=45
trigger1 = gametime%(40-var(26)/5) = 0
anim = 2450+random%6
sprpriority = 7
postype = p1
pos = 0,ceil(pos y)
facing = IfElse(random<500,-1,1)
random = 160,0
scale = 1,2
pausemovetime = -1
supermovetime = -1
ownpal = 1

[State 0, lightning sound]
type = PlaySnd
triggerall = anim = 2400 && time>=45
trigger1 = gametime%(40-var(26)/5) = 0
value = 2400,3
volume = -170-(32*numexplod)
freqmul = .9 + (random/5000.0)

[State 1211, BGPalFX]
type = BGPalFX
triggerall = anim = 2400 && time>=45
trigger1 = gametime%(40-var(26)/5) = 0
time = 3
color = 0
invertall = 1

[State 3000, GOTEN]
type = helper
trigger1 = time = 40
helpertype = normal
stateno = 3210
ID = 3210
name = "goten"
supermovetime = 999999
pausemovetime = 999999

[State 200, 1];Voice (Kamehameha)
type = PlaySnd
trigger1 = time = 50
value = 3205,0
channel = 0
volume = 355

[State 200, 1];Voice (Kamehameha)
type = PlaySnd
trigger1 = time = 85
value = 3205,1
channel = 0
volume = 355

[State 200, 1];voice (Kamehameha)
type = PlaySnd
trigger1 = time = 150
value = 3205,2
channel = 0
volume = 255

;Throw Kmh
[State 901, ChangeAnim]
type = ChangeState
trigger1 = time = 250
value = 3220
ctrl = 0

;-----------------------------
;Throwing Team Chou Kamehameha
[Statedef 3220]
type = S
physics = S
movetype = A
anim = 2401
ctrl = 0
velset = 0,0
sprpriority = 1

[State 0, Explod]
type = null;Explod
trigger1 = !Time
anim = 19876
ID = 19876
pos = 0,0
postype = p1  ;p2,front,back,left,right
bindtime = -1
scale = 3331,3331
sprpriority = 0
ontop = 1

[State -2, AssertSpecial]
type = AssertSpecial
trigger1 = 1
flag = nobardisplay
flag2 = noFG
ignorehitpause = 1

[State 2500, bgpalfx1]
type = bgpalfx
trigger1 = 1
time = 1
color=0
mul=0,0,0

[state -2, remove charge ball FX Chou Kmh]
type = removeexplod
trigger1 = !time
id = 2420
[state -2, remove lightning FX]
type = removeexplod
trigger1 = !time
id = 2430

[State 3000, nhb]
type = NotHitBy
trigger1 = 1
time = 1
value = SCA

[State 1000, shake]
type = EnvShake
trigger1 = !(time%4)
time=4
freq=80
ampl=4

[State 200, 1];Launching SFX
type = PlaySnd
trigger1 = time=4
value = 2401,1

[State 200, 1];Super Launching Twirl SFX
type = PlaySnd
trigger1 = animelem=4
value = 3225,0
volume = 300
persistent = 0

[state 1215, Smoke FX]
type = explod
trigger1 = anim=2401 && animelem=3
anim = 1206+(var(2)=0)
id = 1206
pos = -25,3
postype = P1
sprpriority = 3
ownpal = 1
removetime = -2
persistent = 0
ignorehitpause = 1

[state 1215, Flash FX]
type = explod
trigger1 = anim=2401 && time=3
anim = 2406
id = 2405
pos = 0,0
postype = P1
sprpriority = 3
ownpal = 1
removetime = -1
persistent = 0
ignorehitpause = 0

[State 3000, Kamehameha]
type = helper
trigger1 = anim=2401 && animelem=3
helpertype = normal
stateno = 3221   ;2402
ID = 3221   ;2402
name = "ckameha"
postype = p1
pos = 40,-54
ownpal = 1

[State -2, Explod];On hands explod
type = Explod
triggerall = !numexplod(3220)
trigger1 = anim=2401 && animelem=3
anim = 2403
removetime = -1
sprpriority = 4
id = 3220
ownpal = 1
pos = 53,-54
ignorehitpause = 1
bindtime = -1

[State 3000, Kamehameha FX beam]
type = helper
trigger1 = anim=2401 && animelem=3
helpertype = normal
stateno = 3222  ;2464
ID = 3222       ;2464
name = "ckamehaFX_scale_beam"
postype = p1
pos = 47,-54
ownpal = 1

;move out of screen
[State 901, ChangeAnim]
type = ChangeState
trigger1 = time = 100
value = 3225
ctrl = 0

;-----------------------------
;Moving out of screen while throwing Team Chou Kamehameha
[Statedef 3225]
type = S
physics = S
movetype = A
ctrl = 0
velset = -7,0
sprpriority = 1

[State 2201, helper]; Background lines
type = Helper
trigger1 = !time
pos = -640, -480
postype = back
stateno = 3224
helpertype = normal
name = "horizontal_lines_BG"
id = 3224
ownpal = 1
supermovetime = 150
pausemovetime = 150
sprpriority = 4
size.xscale = 5
size.yscale= 5

[State -2, AssertSpecial]
type = AssertSpecial
trigger1 = 1
flag = nobardisplay
flag2 = noFG
ignorehitpause = 1

[State 2500, bgpalfx1]
type = bgpalfx
trigger1 = 1
time = 1
color=0
mul=0,0,0

[State 3000, nhb]
type = NotHitBy
trigger1 = 1
time = 1
value = SCA

[State 3001, screen]
type = Screenbound
trigger1 = 1
movecamera = 0,0
value = 0

[State 1000, shake]
type = EnvShake
trigger1 = !(time%4)
time=4
freq=80
ampl=4

[State -2, Explod];On hands explod
type = modifyExplod
triggerall = !numexplod(3220)
trigger1 = Time=20
anim = 2403
removetime = -1
sprpriority = 4
vel = -12,0
id = 3220
ownpal = 1
pos = 53,-54
ignorehitpause = 1
bindtime = 1

[State 1061, Velocity];;;;;; 100
type = VelSet
trigger1 = time < 20
x = -12
[State 1061, Velocity]
type = VelSet
trigger1 = time = 35
x = 0

[State 3000, Gohan Kamehameha FX beam]
type = helper
trigger1 = time = 50
helpertype = normal
stateno = 3227
ID = 3227
name = "fixed_beam_simple_Gohan"
postype = p1
pos = 47,-54
ownpal = 1

[State 3000, Goten Kamehameha FX beam]
type = helper
trigger1 = time = 52
helpertype = normal
stateno = 3228
ID = 3228
name = "fixed_beam_simple_Goten"
postype = p1
pos = 47,-34
ownpal = 1
size.yscale = 0.7

[State 1061, End]
type = RemoveExplod
trigger1 = Time >= 30
ID = 3220

[State 1061, End]
type = RemoveExplod
trigger1 = var(36)>0 && time>10
ID = 3220

[State 1305, P2 pushed sound]
type = PlaySnd
trigger1 = time>200 && enemy,stateno=3235 && enemy,vel X = 0
value = 3225,1
volume = 300
persistent = 0

[State 200, 1];Beam looping sound
type = PlaySnd
trigger1 = time=200
value = 2480,0
volume = 300
loop = 1
channel = 5

;---------------------------
; START HITTING P2

[State 800, count]
type = VarSet
trigger1= !time
var(36) = 0

[State 800, count]; time>380 before
type = VarAdd
trigger1= (time%3=0) && (time> 350) && var(36)<=80
var(36) = 1

[State 1315, Sparks]
type=explod
trigger1= NumTarget
trigger1= (time%4=0) && (time> 350) && var(36)<=80
anim=7030
sprpriority=8
postype=p2
pos=(target,const(size.ground.front)-40)+(random%60), (random%60)-30
removetime=-2
ownpal=1
facing=-1
ignorehitpause=1
pausemovetime=100
supermovetime=100

[State 800, count]
type = HitAdd
trigger1= (time%3=0) && (time> 350) && var(36)<=80
value = 1

[State 13100, shake]
type = envshake
trigger1 = (time> 220) && var(36)<=80
trigger1 = (time%12)=0
time = 12
freq = 150
ampl = 10

[State 800, hitsound]
type = PlaySnd
trigger1= (time%6=0) && (time> 350) && var(36)<=80
value = s1000,0
volume = 300

[State 13100, Hurt]
type = TargetLifeAdd
trigger1 = var(36) = 80
value = ceil(ifElse(fvar(11) * -280 > -160, -160, fvar(11) * -280))
kill = 1
persistent = 0

[State 13100, Hurt]
type = TargetPowerAdd
trigger1 = var(36) = 80
value = 2000
persistent = 0

[State 1315, White BG Fades]
type = explod
triggerall = enemynear, stateno != [5941,5946]
trigger1= Time = 588
anim = 3020
ID = 322555
pos =  160,120
postype = left
sprpriority = 7
ontop = 1
facing = 1
bindtime = -1
ownpal = 1
removetime = -2
pausemovetime = 99999999999999
supermovetime = 99999999999999
supermove = 1
scale = 1.20,1.20
ignorehitpause = 1
persistent = 0

[State 13100, Back to screen]
type = ChangeState
trigger1 = var(36) = 80
value = 3240
ctrl = 0

;------------------------------------------------
; P2 comes back to screen
[StateDef 3235]
type = A
movetype = H
physics = N
velset = 0,0
ctrl = 0
sprpriority = -1

[State 13200, Anim]
type = ChangeAnim2
trigger1 = Time = 0
value = 3235

[State 182, 1]
type = screenbound
trigger1 = 1
movecamera = 0,0
value = 0

[State 13200, Pos]
type = PosSet
trigger1 = Time = 0
X = -500*facing
Y = -(enemy,screenpos Y) + 120

[State 13200, Vel]
type = VelSet
trigger1 = Time = 0
X = 8

[State 13200, Vel]
type = VelSet
trigger1 = Time = 60
X = 0

[State 1000, shake]
type = EnvShake
trigger1 = Time = 60
time=10
freq=130
ampl=7

[State 13200, Hit]
type = ChangeAnim2
trigger1 = Time = 60
Value = 3236

[State 13200, Pos if fatality]
type = PosAdd
trigger1 = enemy,stateno=3240
trigger1 = MatchOver
Y = -const(size.mid.pos.Y)

[State 3025, p2state - killed fatality]
type = changestate
trigger1 = enemy,stateno=3240
trigger1 = MatchOver
value = IfElse(SelfAnimExist(5941), 5941, 5943)
ignorehitpause = 1

[State 801, end]
type = changestate
trigger1 = enemy,stateno=3240
trigger1 = enemy,time > 15
value = 3245
ctrl = 0

;----------------------------
; Gohan waiting
[Statedef 3240]
type = A
physics = N
movetype = A
ctrl = 0
sprpriority = 1
velset = 0,0

[State 182, 1]
type = screenbound
trigger1 = 1
movecamera = 0,0
value = 0

[State 3025, killed, beam fatality sound]
type = PlaySnd
trigger1 = numenemy
trigger1 = (enemy,stateno=5941 || enemy,stateno=5943 || enemy,stateno=2990) && enemy,time=30
value = 5941,0
volume = 300
persistent = 0

[State 13100, Back to screen]
type = ChangeState
;triggerall = enemy,stateno != 2990   ;;;;;;;;;;
trigger1 = time >= 60+40*MatchOver
value = 3241
ctrl = 0

;---------------------------------------
; Going back to screen - HD winpose
[Statedef 3241]
type    = S
movetype = A
physics = N
ctrl = 0
anim = 3241
sprpriority = 1
velset = 0,0

[State 1000, goten]
type = Helper
helpertype = normal
trigger1 = time=1
name = "goten_out"
postype = P1
pos = -45,0
stateno = 3214
id = 3214

[State -2, Explod];On hands explod
type = RemoveExplod
trigger1 = !time
ID = 3220

[State -2, AssertSpecial]
type = AssertSpecial
trigger1 = 1
flag = nobardisplay
ignorehitpause = 1

[State 13200, to circus winpose variable]
type = Varset
triggerall = var(37) = 0
trigger1 = NumEnemy = 1
trigger1 = P2Life = 0
trigger2 = NumEnemy = 2
trigger2 = (EnemyNear(0), Life) + (EnemyNear(1), Life) = 0
var(37) = 1

[State 13200, to circus winpose]
type = ChangeState
trigger1 = time=80 && winko
value = 3260

[State 13200, go back to stance]
type = ChangeAnim
trigger1 = Time = 80
Value = 3242

[State 13200, to stance]
type = ChangeState
trigger1 = Anim=3242 && !animtime
value = 0
ctrl = 1

;---------------------------------------
; P2 sent very high in the sky (if not killed)
[StateDef 3245]
type = A
movetype = H
physics = A
velset = -1,-25
ctrl = 0
sprpriority = -1

[State 182, 1]
type = screenbound
trigger1 = 1
movecamera = 0,0
value = 0

[State 5035, 1]
type = ChangeAnim2
trigger1 = Time = 0
value = 3245

[State 13100, Back to screen]
type = ChangeState
trigger1 = time = 0
value = 3246   ; modified state 5035
ctrl = 0

;---------------------------------------------------------------------------
; HITA_UP_T (transition)
[Statedef 3246]
type    = A
movetype= H
physics = N
ctrl = 0

[State 182, 1]
type = screenbound
trigger1 = 1
movecamera = 0,0
value = 0

[State 5035, 1]
type = ChangeAnim
trigger1 = Time = 0
trigger1 = SelfAnimExist(5035)
trigger1 = Anim != [5051,5059] ;Not if in hit up anim
trigger1 = Anim != 5090 ;Not if hit off ground anim
value = 5035

[State 5035, 4]
type = ChangeState
triggerall = HitFall
trigger1 = HitOver  ;Hit is over
trigger2 = AnimTime = 0 ;Anim is over
trigger3 = Vel Y > 0    ;Hit ground
trigger3 = Pos Y >= 10  ;.
trigger4 = Time = 0     ;No transition anim
trigger4 = Anim != 5035 ;.
value = 3247   ; modified state 5050

;---------------------------------------------------------------------------
; HITA_FALL (knocked up, falling)
[Statedef 3247]
type    = A
movetype= H
physics = N
ctrl = 0

[State 182, 1]
type = screenbound
trigger1 = 1
movecamera = 0,0
value = 0

[State 5050, 1] ;Change anim when done with transition
type = ChangeAnim
trigger1 = AnimTime = 0
trigger1 = Anim = 5035
trigger2 = Time = 0     ;If no transition anim
trigger2 = Anim != 5035
trigger2 = (Anim != [5051, 5059]) && (Anim != [5061, 5069])
trigger2 = Anim != 5090 ;Not if hit off ground anim
value = 5050

[State 5050, 2] ;Coming down anim
type = ChangeAnim
trigger1 = anim = [5050,5059]
trigger1 = Vel Y >= IfElse(anim = 5050, 1, -2)
trigger1 = SelfAnimExist(anim+10)
value = anim+10
persistent = 0

[State 5050, 3] ;Gravity
type = VelAdd
trigger1 = 1
y = GetHitVar(yaccel)

[State 5050, 6]
type = ChangeState
trigger1 = Vel Y > 0
trigger1 = Pos Y >= IfElse((anim = [5051,5059]) || (anim = [5061,5069]), 0, 25)
value = 3248   ; modified state 5100 ;HIT_BOUNCE

;---------------------------------------------------------------------------
; HIT_BOUNCE (hit ground)
[Statedef 3248]
type    = L
movetype= H
physics = N

[State 5100, 1]
type = VelSet
trigger1 = Time = 0
trigger1 = GetHitVar(fall.yvel) = 0
trigger1 = vel x > 1
x = 1

[State 5100, EnvShake]
type = FallEnvShake
trigger1 = Time = 0

[State 5100, Var] ;Save fall velocity
type = VarSet
trigger1 = Time = 0
sysvar(1) = floor(vel y)

[State 5100, 2] ;Hit ground anim (normal)
type = ChangeAnim
triggerall = time = 0
trigger1 = (anim != [5051,5059]) && (anim != [5061,5069])
trigger2 = !SelfAnimExist(5100 + (anim % 10))
value = 5100

[State 5100, 3] ;Hit ground anim (for hit up)
type = ChangeAnim
trigger1 = time = 0
trigger1 = (anim = [5051,5059]) || (anim = [5061,5069])
trigger1 = SelfAnimExist(5100 + (anim % 10))
value = 5100 + (anim % 10)

[State 5100, 4]
type = PosSet
trigger1 = Time = 0
y = 0

[State 5100, 5]
type = VelSet
trigger1 = Time = 0
y = 0

[State 5100, 6] ;Reduce speed
type = VelMul
trigger1 = Time = 0
x = 0.75

[State 5100, 7]
type = ChangeState
trigger1 = Time = 0
trigger1 = GetHitVar(fall.yvel) = 0
value = 3250 ;HIT_LIEDOWN

[State 5100, 11]
type = PosFreeze
trigger1 = 1

[State 5100, 12]
type = ChangeState
trigger1 = AnimTime = 0
value = 3249   ; modified state 5101

;---------------------------------------------------------------------------
; HIT_BOUNCE (bounce into air)
[Statedef 3249]
type    = L
movetype= H
physics = N

[State 5101, 1] ;Coming hit ground anim (normal)
type = ChangeAnim
triggerall = time = 0
trigger1 = anim != [5101,5109]
trigger2 = !SelfAnimExist(5160 + (anim % 10))
value = 5160

[State 5101, 2] ;Coming hit ground anim (for hit up)
type = ChangeAnim
triggerall = time = 0
trigger1 = anim = [5101,5109]
trigger1 = SelfAnimExist(5160 + (anim % 10))
value = 5160 + (anim % 10)

[State 5101, 3]
type = HitFallVel
trigger1 = Time = 0

[State 5101, 4]
type = PosSet
trigger1 = Time = 0
y = 20

[State 5101, 5] ;Acceleration
type = VelAdd
trigger1 = 1
y = .4

[State 5101, 6] ;Hit ground
trigger1 = Vel Y > 0
trigger1 = Pos Y >= 12
type = ChangeState
value = 3250   ; modified state 5110

;---------------------------------------------------------------------------
; HIT_LIEDOWN
[Statedef 3250]
type    = L
movetype= H
physics = N

[State 5110, EnvShake]
type = FallEnvShake
trigger1 = Time = 0

[State 5110, 1] ;For hit up/up-diag type (from state 5081)
type = ChangeAnim
persistent = 0
trigger1 = SelfAnimExist(5110 + (anim % 10))
trigger1 = anim = [5081,5089]
value = 5110 + (anim % 10)

[State 5110, 2] ;Hit ground anim (normal)
type = ChangeAnim
triggerall = time = 0
triggerall = anim != [5110,5119] ;Not already changed anim
trigger1 = anim != [5161,5169]
trigger2 = !SelfAnimExist(5170 + (anim % 10))
value = 5170

[State 5110, 3] ;Hit ground anim (for hit up)
type = ChangeAnim
triggerall = time = 0
triggerall = anim != [5110,5119] ;Not already changed anim
trigger1 = anim = [5161,5169]
trigger1 = SelfAnimExist(5170 + (anim % 10))
value = 5170 + (anim % 10)

[State 5110, 4]
type = HitFallDamage
trigger1 = Time = 0

[State 5110, 5]
type = PosSet
trigger1 = Time = 0
y = 0

[State 5110, Var] ;Get fall velocity
type = VarSet
trigger1 = Time = 0
trigger1 = GetHitVar(fall.yvel) != 0
sysvar(1) = floor(vel y)

[State 5110, 8]
type = VelSet
trigger1 = Time = 0
y = 0

[State 5110, 9] ;For hit up type
type = ChangeAnim
persistent = 0
triggerall = anim = [5171,5179]
triggerall = SelfAnimExist(5110 + (anim % 10))
trigger1 = AnimTime = 0
trigger2 = SysVar(0) ;SysVar(0) = 1 avoids hit ground anim
value = 5110 + (anim % 10)

[State 5110, 10] ;For normal
type = ChangeAnim
persistent = 0
triggerall = Anim != [5111,5119]
trigger1 = AnimTime = 0
trigger2 = SysVar(0) ;SysVar(0) = 1 avoids hit ground frame
value = 5110

[State 5110, 11] ;If just died
type = SelfState
triggerall = !alive
trigger1 = AnimTime = 0
trigger2 = SysVar(0)
trigger3 = Anim = [5110,5119]
value = 5150

[State 5110, 12]
type = VarSet
trigger1 = SysVar(0)
trigger1 = Time = 0
sysvar(0) = 0

[State 5110, 13] ;Friction
type = VelMul
trigger1 = 1
x = 0.85

[State 5110, 11] ;If alive
type = SelfState
triggerall = alive
trigger1 = time = 45
value = 5120
